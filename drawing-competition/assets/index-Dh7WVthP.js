(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=e(r);fetch(r.href,l)}})();function KT(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Md={exports:{}},So={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xy;function ZT(){if(Xy)return So;Xy=1;var a=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(i,r,l){var c=null;if(l!==void 0&&(c=""+l),r.key!==void 0&&(c=""+r.key),"key"in r){l={};for(var h in r)h!=="key"&&(l[h]=r[h])}else l=r;return r=l.ref,{$$typeof:a,type:i,key:c,ref:r!==void 0?r:null,props:l}}return So.Fragment=t,So.jsx=e,So.jsxs=e,So}var qy;function JT(){return qy||(qy=1,Md.exports=ZT()),Md.exports}var x=JT(),Rd={exports:{}},pt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wy;function $T(){if(Wy)return pt;Wy=1;var a=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),v=Symbol.iterator;function S(D){return D===null||typeof D!="object"?null:(D=v&&D[v]||D["@@iterator"],typeof D=="function"?D:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function N(D,X,$){this.props=D,this.context=X,this.refs=w,this.updater=$||b}N.prototype.isReactComponent={},N.prototype.setState=function(D,X){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,X,"setState")},N.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function I(){}I.prototype=N.prototype;function j(D,X,$){this.props=D,this.context=X,this.refs=w,this.updater=$||b}var Y=j.prototype=new I;Y.constructor=j,T(Y,N.prototype),Y.isPureReactComponent=!0;var B=Array.isArray;function K(){}var F={H:null,A:null,T:null,S:null},Q=Object.prototype.hasOwnProperty;function Z(D,X,$){var et=$.ref;return{$$typeof:a,type:D,key:X,ref:et!==void 0?et:null,props:$}}function nt(D,X){return Z(D.type,X,D.props)}function ot(D){return typeof D=="object"&&D!==null&&D.$$typeof===a}function rt(D){var X={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function($){return X[$]})}var ft=/\/+/g;function ct(D,X){return typeof D=="object"&&D!==null&&D.key!=null?rt(""+D.key):X.toString(36)}function vt(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(K,K):(D.status="pending",D.then(function(X){D.status==="pending"&&(D.status="fulfilled",D.value=X)},function(X){D.status==="pending"&&(D.status="rejected",D.reason=X)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function U(D,X,$,et,dt){var gt=typeof D;(gt==="undefined"||gt==="boolean")&&(D=null);var At=!1;if(D===null)At=!0;else switch(gt){case"bigint":case"string":case"number":At=!0;break;case"object":switch(D.$$typeof){case a:case t:At=!0;break;case p:return At=D._init,U(At(D._payload),X,$,et,dt)}}if(At)return dt=dt(D),At=et===""?"."+ct(D,0):et,B(dt)?($="",At!=null&&($=At.replace(ft,"$&/")+"/"),U(dt,X,$,"",function(Xe){return Xe})):dt!=null&&(ot(dt)&&(dt=nt(dt,$+(dt.key==null||D&&D.key===dt.key?"":(""+dt.key).replace(ft,"$&/")+"/")+At)),X.push(dt)),1;At=0;var Ae=et===""?".":et+":";if(B(D))for(var Zt=0;Zt<D.length;Zt++)et=D[Zt],gt=Ae+ct(et,Zt),At+=U(et,X,$,gt,dt);else if(Zt=S(D),typeof Zt=="function")for(D=Zt.call(D),Zt=0;!(et=D.next()).done;)et=et.value,gt=Ae+ct(et,Zt++),At+=U(et,X,$,gt,dt);else if(gt==="object"){if(typeof D.then=="function")return U(vt(D),X,$,et,dt);throw X=String(D),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return At}function W(D,X,$){if(D==null)return D;var et=[],dt=0;return U(D,et,"","",function(gt){return X.call($,gt,dt++)}),et}function tt(D){if(D._status===-1){var X=D._result;X=X(),X.then(function($){(D._status===0||D._status===-1)&&(D._status=1,D._result=$)},function($){(D._status===0||D._status===-1)&&(D._status=2,D._result=$)}),D._status===-1&&(D._status=0,D._result=X)}if(D._status===1)return D._result.default;throw D._result}var mt=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)},bt={map:W,forEach:function(D,X,$){W(D,function(){X.apply(this,arguments)},$)},count:function(D){var X=0;return W(D,function(){X++}),X},toArray:function(D){return W(D,function(X){return X})||[]},only:function(D){if(!ot(D))throw Error("React.Children.only expected to receive a single React element child.");return D}};return pt.Activity=_,pt.Children=bt,pt.Component=N,pt.Fragment=e,pt.Profiler=r,pt.PureComponent=j,pt.StrictMode=i,pt.Suspense=f,pt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,pt.__COMPILER_RUNTIME={__proto__:null,c:function(D){return F.H.useMemoCache(D)}},pt.cache=function(D){return function(){return D.apply(null,arguments)}},pt.cacheSignal=function(){return null},pt.cloneElement=function(D,X,$){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var et=T({},D.props),dt=D.key;if(X!=null)for(gt in X.key!==void 0&&(dt=""+X.key),X)!Q.call(X,gt)||gt==="key"||gt==="__self"||gt==="__source"||gt==="ref"&&X.ref===void 0||(et[gt]=X[gt]);var gt=arguments.length-2;if(gt===1)et.children=$;else if(1<gt){for(var At=Array(gt),Ae=0;Ae<gt;Ae++)At[Ae]=arguments[Ae+2];et.children=At}return Z(D.type,dt,et)},pt.createContext=function(D){return D={$$typeof:c,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:l,_context:D},D},pt.createElement=function(D,X,$){var et,dt={},gt=null;if(X!=null)for(et in X.key!==void 0&&(gt=""+X.key),X)Q.call(X,et)&&et!=="key"&&et!=="__self"&&et!=="__source"&&(dt[et]=X[et]);var At=arguments.length-2;if(At===1)dt.children=$;else if(1<At){for(var Ae=Array(At),Zt=0;Zt<At;Zt++)Ae[Zt]=arguments[Zt+2];dt.children=Ae}if(D&&D.defaultProps)for(et in At=D.defaultProps,At)dt[et]===void 0&&(dt[et]=At[et]);return Z(D,gt,dt)},pt.createRef=function(){return{current:null}},pt.forwardRef=function(D){return{$$typeof:h,render:D}},pt.isValidElement=ot,pt.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:tt}},pt.memo=function(D,X){return{$$typeof:d,type:D,compare:X===void 0?null:X}},pt.startTransition=function(D){var X=F.T,$={};F.T=$;try{var et=D(),dt=F.S;dt!==null&&dt($,et),typeof et=="object"&&et!==null&&typeof et.then=="function"&&et.then(K,mt)}catch(gt){mt(gt)}finally{X!==null&&$.types!==null&&(X.types=$.types),F.T=X}},pt.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},pt.use=function(D){return F.H.use(D)},pt.useActionState=function(D,X,$){return F.H.useActionState(D,X,$)},pt.useCallback=function(D,X){return F.H.useCallback(D,X)},pt.useContext=function(D){return F.H.useContext(D)},pt.useDebugValue=function(){},pt.useDeferredValue=function(D,X){return F.H.useDeferredValue(D,X)},pt.useEffect=function(D,X){return F.H.useEffect(D,X)},pt.useEffectEvent=function(D){return F.H.useEffectEvent(D)},pt.useId=function(){return F.H.useId()},pt.useImperativeHandle=function(D,X,$){return F.H.useImperativeHandle(D,X,$)},pt.useInsertionEffect=function(D,X){return F.H.useInsertionEffect(D,X)},pt.useLayoutEffect=function(D,X){return F.H.useLayoutEffect(D,X)},pt.useMemo=function(D,X){return F.H.useMemo(D,X)},pt.useOptimistic=function(D,X){return F.H.useOptimistic(D,X)},pt.useReducer=function(D,X,$){return F.H.useReducer(D,X,$)},pt.useRef=function(D){return F.H.useRef(D)},pt.useState=function(D){return F.H.useState(D)},pt.useSyncExternalStore=function(D,X,$){return F.H.useSyncExternalStore(D,X,$)},pt.useTransition=function(){return F.H.useTransition()},pt.version="19.2.0",pt}var Qy;function Yg(){return Qy||(Qy=1,Rd.exports=$T()),Rd.exports}var _t=Yg();const Se=KT(_t);var Nd={exports:{}},bo={},jd={exports:{}},kd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ky;function tw(){return Ky||(Ky=1,(function(a){function t(U,W){var tt=U.length;U.push(W);t:for(;0<tt;){var mt=tt-1>>>1,bt=U[mt];if(0<r(bt,W))U[mt]=W,U[tt]=bt,tt=mt;else break t}}function e(U){return U.length===0?null:U[0]}function i(U){if(U.length===0)return null;var W=U[0],tt=U.pop();if(tt!==W){U[0]=tt;t:for(var mt=0,bt=U.length,D=bt>>>1;mt<D;){var X=2*(mt+1)-1,$=U[X],et=X+1,dt=U[et];if(0>r($,tt))et<bt&&0>r(dt,$)?(U[mt]=dt,U[et]=tt,mt=et):(U[mt]=$,U[X]=tt,mt=X);else if(et<bt&&0>r(dt,tt))U[mt]=dt,U[et]=tt,mt=et;else break t}}return W}function r(U,W){var tt=U.sortIndex-W.sortIndex;return tt!==0?tt:U.id-W.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;a.unstable_now=function(){return l.now()}}else{var c=Date,h=c.now();a.unstable_now=function(){return c.now()-h}}var f=[],d=[],p=1,_=null,v=3,S=!1,b=!1,T=!1,w=!1,N=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function Y(U){for(var W=e(d);W!==null;){if(W.callback===null)i(d);else if(W.startTime<=U)i(d),W.sortIndex=W.expirationTime,t(f,W);else break;W=e(d)}}function B(U){if(T=!1,Y(U),!b)if(e(f)!==null)b=!0,K||(K=!0,rt());else{var W=e(d);W!==null&&vt(B,W.startTime-U)}}var K=!1,F=-1,Q=5,Z=-1;function nt(){return w?!0:!(a.unstable_now()-Z<Q)}function ot(){if(w=!1,K){var U=a.unstable_now();Z=U;var W=!0;try{t:{b=!1,T&&(T=!1,I(F),F=-1),S=!0;var tt=v;try{e:{for(Y(U),_=e(f);_!==null&&!(_.expirationTime>U&&nt());){var mt=_.callback;if(typeof mt=="function"){_.callback=null,v=_.priorityLevel;var bt=mt(_.expirationTime<=U);if(U=a.unstable_now(),typeof bt=="function"){_.callback=bt,Y(U),W=!0;break e}_===e(f)&&i(f),Y(U)}else i(f);_=e(f)}if(_!==null)W=!0;else{var D=e(d);D!==null&&vt(B,D.startTime-U),W=!1}}break t}finally{_=null,v=tt,S=!1}W=void 0}}finally{W?rt():K=!1}}}var rt;if(typeof j=="function")rt=function(){j(ot)};else if(typeof MessageChannel<"u"){var ft=new MessageChannel,ct=ft.port2;ft.port1.onmessage=ot,rt=function(){ct.postMessage(null)}}else rt=function(){N(ot,0)};function vt(U,W){F=N(function(){U(a.unstable_now())},W)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(U){U.callback=null},a.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<U?Math.floor(1e3/U):5},a.unstable_getCurrentPriorityLevel=function(){return v},a.unstable_next=function(U){switch(v){case 1:case 2:case 3:var W=3;break;default:W=v}var tt=v;v=W;try{return U()}finally{v=tt}},a.unstable_requestPaint=function(){w=!0},a.unstable_runWithPriority=function(U,W){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var tt=v;v=U;try{return W()}finally{v=tt}},a.unstable_scheduleCallback=function(U,W,tt){var mt=a.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?mt+tt:mt):tt=mt,U){case 1:var bt=-1;break;case 2:bt=250;break;case 5:bt=1073741823;break;case 4:bt=1e4;break;default:bt=5e3}return bt=tt+bt,U={id:p++,callback:W,priorityLevel:U,startTime:tt,expirationTime:bt,sortIndex:-1},tt>mt?(U.sortIndex=tt,t(d,U),e(f)===null&&U===e(d)&&(T?(I(F),F=-1):T=!0,vt(B,tt-mt))):(U.sortIndex=bt,t(f,U),b||S||(b=!0,K||(K=!0,rt()))),U},a.unstable_shouldYield=nt,a.unstable_wrapCallback=function(U){var W=v;return function(){var tt=v;v=W;try{return U.apply(this,arguments)}finally{v=tt}}}})(kd)),kd}var Zy;function ew(){return Zy||(Zy=1,jd.exports=tw()),jd.exports}var Ld={exports:{}},Ie={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jy;function nw(){if(Jy)return Ie;Jy=1;var a=Yg();function t(f){var d="https://react.dev/errors/"+f;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var i={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(f,d,p){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:_==null?null:""+_,children:f,containerInfo:d,implementation:p}}var c=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,d){if(f==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Ie.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ie.createPortal=function(f,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(t(299));return l(f,d,null,p)},Ie.flushSync=function(f){var d=c.T,p=i.p;try{if(c.T=null,i.p=2,f)return f()}finally{c.T=d,i.p=p,i.d.f()}},Ie.preconnect=function(f,d){typeof f=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(f,d))},Ie.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Ie.preinit=function(f,d){if(typeof f=="string"&&d&&typeof d.as=="string"){var p=d.as,_=h(p,d.crossOrigin),v=typeof d.integrity=="string"?d.integrity:void 0,S=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(f,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:_,integrity:v,fetchPriority:S}):p==="script"&&i.d.X(f,{crossOrigin:_,integrity:v,fetchPriority:S,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Ie.preinitModule=function(f,d){if(typeof f=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=h(d.as,d.crossOrigin);i.d.M(f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(f)},Ie.preload=function(f,d){if(typeof f=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,_=h(p,d.crossOrigin);i.d.L(f,p,{crossOrigin:_,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Ie.preloadModule=function(f,d){if(typeof f=="string")if(d){var p=h(d.as,d.crossOrigin);i.d.m(f,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(f)},Ie.requestFormReset=function(f){i.d.r(f)},Ie.unstable_batchedUpdates=function(f,d){return f(d)},Ie.useFormState=function(f,d,p){return c.H.useFormState(f,d,p)},Ie.useFormStatus=function(){return c.H.useHostTransitionStatus()},Ie.version="19.2.0",Ie}var $y;function iw(){if($y)return Ld.exports;$y=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(t){console.error(t)}}return a(),Ld.exports=nw(),Ld.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t0;function sw(){if(t0)return bo;t0=1;var a=ew(),t=Yg(),e=iw();function i(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function l(n){var s=n,o=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(o=s.return),n=s.return;while(n)}return s.tag===3?o:null}function c(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function h(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function f(n){if(l(n)!==n)throw Error(i(188))}function d(n){var s=n.alternate;if(!s){if(s=l(n),s===null)throw Error(i(188));return s!==n?null:n}for(var o=n,u=s;;){var g=o.return;if(g===null)break;var m=g.alternate;if(m===null){if(u=g.return,u!==null){o=u;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===o)return f(g),n;if(m===u)return f(g),s;m=m.sibling}throw Error(i(188))}if(o.return!==u.return)o=g,u=m;else{for(var y=!1,C=g.child;C;){if(C===o){y=!0,o=g,u=m;break}if(C===u){y=!0,u=g,o=m;break}C=C.sibling}if(!y){for(C=m.child;C;){if(C===o){y=!0,o=m,u=g;break}if(C===u){y=!0,u=m,o=g;break}C=C.sibling}if(!y)throw Error(i(189))}}if(o.alternate!==u)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?n:s}function p(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=p(n),s!==null)return s;n=n.sibling}return null}var _=Object.assign,v=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),j=Symbol.for("react.context"),Y=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),Z=Symbol.for("react.activity"),nt=Symbol.for("react.memo_cache_sentinel"),ot=Symbol.iterator;function rt(n){return n===null||typeof n!="object"?null:(n=ot&&n[ot]||n["@@iterator"],typeof n=="function"?n:null)}var ft=Symbol.for("react.client.reference");function ct(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===ft?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case T:return"Fragment";case N:return"Profiler";case w:return"StrictMode";case B:return"Suspense";case K:return"SuspenseList";case Z:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case b:return"Portal";case j:return n.displayName||"Context";case I:return(n._context.displayName||"Context")+".Consumer";case Y:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case F:return s=n.displayName||null,s!==null?s:ct(n.type)||"Memo";case Q:s=n._payload,n=n._init;try{return ct(n(s))}catch{}}return null}var vt=Array.isArray,U=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,tt={pending:!1,data:null,method:null,action:null},mt=[],bt=-1;function D(n){return{current:n}}function X(n){0>bt||(n.current=mt[bt],mt[bt]=null,bt--)}function $(n,s){bt++,mt[bt]=n.current,n.current=s}var et=D(null),dt=D(null),gt=D(null),At=D(null);function Ae(n,s){switch($(gt,s),$(dt,n),$(et,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?my(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=my(s),n=py(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}X(et),$(et,n)}function Zt(){X(et),X(dt),X(gt)}function Xe(n){n.memoizedState!==null&&$(At,n);var s=et.current,o=py(s,n.type);s!==o&&($(dt,n),$(et,o))}function gl(n){dt.current===n&&(X(et),X(dt)),At.current===n&&(X(At),po._currentValue=tt)}var hh,Gm;function Os(n){if(hh===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);hh=s&&s[1]||"",Gm=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+hh+n+Gm}var fh=!1;function dh(n,s){if(!n||fh)return"";fh=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(s){var q=function(){throw Error()};if(Object.defineProperty(q.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(q,[])}catch(H){var z=H}Reflect.construct(n,[],q)}else{try{q.call()}catch(H){z=H}n.call(q.prototype)}}else{try{throw Error()}catch(H){z=H}(q=n())&&typeof q.catch=="function"&&q.catch(function(){})}}catch(H){if(H&&z&&typeof H.stack=="string")return[H.stack,z.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=u.DetermineComponentFrameRoot(),y=m[0],C=m[1];if(y&&C){var E=y.split(`
`),L=C.split(`
`);for(g=u=0;u<E.length&&!E[u].includes("DetermineComponentFrameRoot");)u++;for(;g<L.length&&!L[g].includes("DetermineComponentFrameRoot");)g++;if(u===E.length||g===L.length)for(u=E.length-1,g=L.length-1;1<=u&&0<=g&&E[u]!==L[g];)g--;for(;1<=u&&0<=g;u--,g--)if(E[u]!==L[g]){if(u!==1||g!==1)do if(u--,g--,0>g||E[u]!==L[g]){var V=`
`+E[u].replace(" at new "," at ");return n.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",n.displayName)),V}while(1<=u&&0<=g);break}}}finally{fh=!1,Error.prepareStackTrace=o}return(o=n?n.displayName||n.name:"")?Os(o):""}function O1(n,s){switch(n.tag){case 26:case 27:case 5:return Os(n.type);case 16:return Os("Lazy");case 13:return n.child!==s&&s!==null?Os("Suspense Fallback"):Os("Suspense");case 19:return Os("SuspenseList");case 0:case 15:return dh(n.type,!1);case 11:return dh(n.type.render,!1);case 1:return dh(n.type,!0);case 31:return Os("Activity");default:return""}}function Xm(n){try{var s="",o=null;do s+=O1(n,o),o=n,n=n.return;while(n);return s}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var gh=Object.prototype.hasOwnProperty,mh=a.unstable_scheduleCallback,ph=a.unstable_cancelCallback,D1=a.unstable_shouldYield,A1=a.unstable_requestPaint,on=a.unstable_now,M1=a.unstable_getCurrentPriorityLevel,qm=a.unstable_ImmediatePriority,Wm=a.unstable_UserBlockingPriority,ml=a.unstable_NormalPriority,R1=a.unstable_LowPriority,Qm=a.unstable_IdlePriority,N1=a.log,j1=a.unstable_setDisableYieldValue,Oa=null,ln=null;function Hi(n){if(typeof N1=="function"&&j1(n),ln&&typeof ln.setStrictMode=="function")try{ln.setStrictMode(Oa,n)}catch{}}var cn=Math.clz32?Math.clz32:z1,k1=Math.log,L1=Math.LN2;function z1(n){return n>>>=0,n===0?32:31-(k1(n)/L1|0)|0}var pl=256,_l=262144,vl=4194304;function Ds(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function yl(n,s,o){var u=n.pendingLanes;if(u===0)return 0;var g=0,m=n.suspendedLanes,y=n.pingedLanes;n=n.warmLanes;var C=u&134217727;return C!==0?(u=C&~m,u!==0?g=Ds(u):(y&=C,y!==0?g=Ds(y):o||(o=C&~n,o!==0&&(g=Ds(o))))):(C=u&~m,C!==0?g=Ds(C):y!==0?g=Ds(y):o||(o=u&~n,o!==0&&(g=Ds(o)))),g===0?0:s!==0&&s!==g&&(s&m)===0&&(m=g&-g,o=s&-s,m>=o||m===32&&(o&4194048)!==0)?s:g}function Da(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function B1(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Km(){var n=vl;return vl<<=1,(vl&62914560)===0&&(vl=4194304),n}function _h(n){for(var s=[],o=0;31>o;o++)s.push(n);return s}function Aa(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function I1(n,s,o,u,g,m){var y=n.pendingLanes;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=o,n.entangledLanes&=o,n.errorRecoveryDisabledLanes&=o,n.shellSuspendCounter=0;var C=n.entanglements,E=n.expirationTimes,L=n.hiddenUpdates;for(o=y&~o;0<o;){var V=31-cn(o),q=1<<V;C[V]=0,E[V]=-1;var z=L[V];if(z!==null)for(L[V]=null,V=0;V<z.length;V++){var H=z[V];H!==null&&(H.lane&=-536870913)}o&=~q}u!==0&&Zm(n,u,0),m!==0&&g===0&&n.tag!==0&&(n.suspendedLanes|=m&~(y&~s))}function Zm(n,s,o){n.pendingLanes|=s,n.suspendedLanes&=~s;var u=31-cn(s);n.entangledLanes|=s,n.entanglements[u]=n.entanglements[u]|1073741824|o&261930}function Jm(n,s){var o=n.entangledLanes|=s;for(n=n.entanglements;o;){var u=31-cn(o),g=1<<u;g&s|n[u]&s&&(n[u]|=s),o&=~g}}function $m(n,s){var o=s&-s;return o=(o&42)!==0?1:vh(o),(o&(n.suspendedLanes|s))!==0?0:o}function vh(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function yh(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function tp(){var n=W.p;return n!==0?n:(n=window.event,n===void 0?32:Fy(n.type))}function ep(n,s){var o=W.p;try{return W.p=n,s()}finally{W.p=o}}var Yi=Math.random().toString(36).slice(2),Me="__reactFiber$"+Yi,qe="__reactProps$"+Yi,ur="__reactContainer$"+Yi,Sh="__reactEvents$"+Yi,F1="__reactListeners$"+Yi,U1="__reactHandles$"+Yi,np="__reactResources$"+Yi,Ma="__reactMarker$"+Yi;function bh(n){delete n[Me],delete n[qe],delete n[Sh],delete n[F1],delete n[U1]}function hr(n){var s=n[Me];if(s)return s;for(var o=n.parentNode;o;){if(s=o[ur]||o[Me]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(n=xy(n);n!==null;){if(o=n[Me])return o;n=xy(n)}return s}n=o,o=n.parentNode}return null}function fr(n){if(n=n[Me]||n[ur]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function Ra(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(i(33))}function dr(n){var s=n[np];return s||(s=n[np]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function we(n){n[Ma]=!0}var ip=new Set,sp={};function As(n,s){gr(n,s),gr(n+"Capture",s)}function gr(n,s){for(sp[n]=s,n=0;n<s.length;n++)ip.add(s[n])}var P1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rp={},ap={};function H1(n){return gh.call(ap,n)?!0:gh.call(rp,n)?!1:P1.test(n)?ap[n]=!0:(rp[n]=!0,!1)}function Sl(n,s,o){if(H1(s))if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var u=s.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+o)}}function bl(n,s,o){if(o===null)n.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+o)}}function ri(n,s,o,u){if(u===null)n.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttributeNS(s,o,""+u)}}function yn(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function op(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Y1(n,s,o){var u=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var g=u.get,m=u.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return g.call(this)},set:function(y){o=""+y,m.call(this,y)}}),Object.defineProperty(n,s,{enumerable:u.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function Ch(n){if(!n._valueTracker){var s=op(n)?"checked":"value";n._valueTracker=Y1(n,s,""+n[s])}}function lp(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var o=s.getValue(),u="";return n&&(u=op(n)?n.checked?"true":"false":n.value),n=u,n!==o?(s.setValue(n),!0):!1}function Cl(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var V1=/[\n"\\]/g;function Sn(n){return n.replace(V1,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function xh(n,s,o,u,g,m,y,C){n.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?n.type=y:n.removeAttribute("type"),s!=null?y==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+yn(s)):n.value!==""+yn(s)&&(n.value=""+yn(s)):y!=="submit"&&y!=="reset"||n.removeAttribute("value"),s!=null?Th(n,y,yn(s)):o!=null?Th(n,y,yn(o)):u!=null&&n.removeAttribute("value"),g==null&&m!=null&&(n.defaultChecked=!!m),g!=null&&(n.checked=g&&typeof g!="function"&&typeof g!="symbol"),C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?n.name=""+yn(C):n.removeAttribute("name")}function cp(n,s,o,u,g,m,y,C){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(n.type=m),s!=null||o!=null){if(!(m!=="submit"&&m!=="reset"||s!=null)){Ch(n);return}o=o!=null?""+yn(o):"",s=s!=null?""+yn(s):o,C||s===n.value||(n.value=s),n.defaultValue=s}u=u??g,u=typeof u!="function"&&typeof u!="symbol"&&!!u,n.checked=C?n.checked:!!u,n.defaultChecked=!!u,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(n.name=y),Ch(n)}function Th(n,s,o){s==="number"&&Cl(n.ownerDocument)===n||n.defaultValue===""+o||(n.defaultValue=""+o)}function mr(n,s,o,u){if(n=n.options,s){s={};for(var g=0;g<o.length;g++)s["$"+o[g]]=!0;for(o=0;o<n.length;o++)g=s.hasOwnProperty("$"+n[o].value),n[o].selected!==g&&(n[o].selected=g),g&&u&&(n[o].defaultSelected=!0)}else{for(o=""+yn(o),s=null,g=0;g<n.length;g++){if(n[g].value===o){n[g].selected=!0,u&&(n[g].defaultSelected=!0);return}s!==null||n[g].disabled||(s=n[g])}s!==null&&(s.selected=!0)}}function up(n,s,o){if(s!=null&&(s=""+yn(s),s!==n.value&&(n.value=s),o==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=o!=null?""+yn(o):""}function hp(n,s,o,u){if(s==null){if(u!=null){if(o!=null)throw Error(i(92));if(vt(u)){if(1<u.length)throw Error(i(93));u=u[0]}o=u}o==null&&(o=""),s=o}o=yn(s),n.defaultValue=o,u=n.textContent,u===o&&u!==""&&u!==null&&(n.value=u),Ch(n)}function pr(n,s){if(s){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=s;return}}n.textContent=s}var G1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function fp(n,s,o){var u=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?u?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":u?n.setProperty(s,o):typeof o!="number"||o===0||G1.has(s)?s==="float"?n.cssFloat=o:n[s]=(""+o).trim():n[s]=o+"px"}function dp(n,s,o){if(s!=null&&typeof s!="object")throw Error(i(62));if(n=n.style,o!=null){for(var u in o)!o.hasOwnProperty(u)||s!=null&&s.hasOwnProperty(u)||(u.indexOf("--")===0?n.setProperty(u,""):u==="float"?n.cssFloat="":n[u]="");for(var g in s)u=s[g],s.hasOwnProperty(g)&&o[g]!==u&&fp(n,g,u)}else for(var m in s)s.hasOwnProperty(m)&&fp(n,m,s[m])}function wh(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var X1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),q1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function xl(n){return q1.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function ai(){}var Eh=null;function Oh(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var _r=null,vr=null;function gp(n){var s=fr(n);if(s&&(n=s.stateNode)){var o=n[qe]||null;t:switch(n=s.stateNode,s.type){case"input":if(xh(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Sn(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var u=o[s];if(u!==n&&u.form===n.form){var g=u[qe]||null;if(!g)throw Error(i(90));xh(u,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(s=0;s<o.length;s++)u=o[s],u.form===n.form&&lp(u)}break t;case"textarea":up(n,o.value,o.defaultValue);break t;case"select":s=o.value,s!=null&&mr(n,!!o.multiple,s,!1)}}}var Dh=!1;function mp(n,s,o){if(Dh)return n(s,o);Dh=!0;try{var u=n(s);return u}finally{if(Dh=!1,(_r!==null||vr!==null)&&(uc(),_r&&(s=_r,n=vr,vr=_r=null,gp(s),n)))for(s=0;s<n.length;s++)gp(n[s])}}function Na(n,s){var o=n.stateNode;if(o===null)return null;var u=o[qe]||null;if(u===null)return null;o=u[s];t:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(n=n.type,u=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!u;break t;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(i(231,s,typeof o));return o}var oi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ah=!1;if(oi)try{var ja={};Object.defineProperty(ja,"passive",{get:function(){Ah=!0}}),window.addEventListener("test",ja,ja),window.removeEventListener("test",ja,ja)}catch{Ah=!1}var Vi=null,Mh=null,Tl=null;function pp(){if(Tl)return Tl;var n,s=Mh,o=s.length,u,g="value"in Vi?Vi.value:Vi.textContent,m=g.length;for(n=0;n<o&&s[n]===g[n];n++);var y=o-n;for(u=1;u<=y&&s[o-u]===g[m-u];u++);return Tl=g.slice(n,1<u?1-u:void 0)}function wl(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function El(){return!0}function _p(){return!1}function We(n){function s(o,u,g,m,y){this._reactName=o,this._targetInst=g,this.type=u,this.nativeEvent=m,this.target=y,this.currentTarget=null;for(var C in n)n.hasOwnProperty(C)&&(o=n[C],this[C]=o?o(m):m[C]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?El:_p,this.isPropagationStopped=_p,this}return _(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=El)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=El)},persist:function(){},isPersistent:El}),s}var Ms={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ol=We(Ms),ka=_({},Ms,{view:0,detail:0}),W1=We(ka),Rh,Nh,La,Dl=_({},ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kh,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==La&&(La&&n.type==="mousemove"?(Rh=n.screenX-La.screenX,Nh=n.screenY-La.screenY):Nh=Rh=0,La=n),Rh)},movementY:function(n){return"movementY"in n?n.movementY:Nh}}),vp=We(Dl),Q1=_({},Dl,{dataTransfer:0}),K1=We(Q1),Z1=_({},ka,{relatedTarget:0}),jh=We(Z1),J1=_({},Ms,{animationName:0,elapsedTime:0,pseudoElement:0}),$1=We(J1),tx=_({},Ms,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),ex=We(tx),nx=_({},Ms,{data:0}),yp=We(nx),ix={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ax(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=rx[n])?!!s[n]:!1}function kh(){return ax}var ox=_({},ka,{key:function(n){if(n.key){var s=ix[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=wl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?sx[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kh,charCode:function(n){return n.type==="keypress"?wl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?wl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),lx=We(ox),cx=_({},Dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sp=We(cx),ux=_({},ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kh}),hx=We(ux),fx=_({},Ms,{propertyName:0,elapsedTime:0,pseudoElement:0}),dx=We(fx),gx=_({},Dl,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),mx=We(gx),px=_({},Ms,{newState:0,oldState:0}),_x=We(px),vx=[9,13,27,32],Lh=oi&&"CompositionEvent"in window,za=null;oi&&"documentMode"in document&&(za=document.documentMode);var yx=oi&&"TextEvent"in window&&!za,bp=oi&&(!Lh||za&&8<za&&11>=za),Cp=" ",xp=!1;function Tp(n,s){switch(n){case"keyup":return vx.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wp(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var yr=!1;function Sx(n,s){switch(n){case"compositionend":return wp(s);case"keypress":return s.which!==32?null:(xp=!0,Cp);case"textInput":return n=s.data,n===Cp&&xp?null:n;default:return null}}function bx(n,s){if(yr)return n==="compositionend"||!Lh&&Tp(n,s)?(n=pp(),Tl=Mh=Vi=null,yr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return bp&&s.locale!=="ko"?null:s.data;default:return null}}var Cx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ep(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Cx[n.type]:s==="textarea"}function Op(n,s,o,u){_r?vr?vr.push(u):vr=[u]:_r=u,s=_c(s,"onChange"),0<s.length&&(o=new Ol("onChange","change",null,o,u),n.push({event:o,listeners:s}))}var Ba=null,Ia=null;function xx(n){cy(n,0)}function Al(n){var s=Ra(n);if(lp(s))return n}function Dp(n,s){if(n==="change")return s}var Ap=!1;if(oi){var zh;if(oi){var Bh="oninput"in document;if(!Bh){var Mp=document.createElement("div");Mp.setAttribute("oninput","return;"),Bh=typeof Mp.oninput=="function"}zh=Bh}else zh=!1;Ap=zh&&(!document.documentMode||9<document.documentMode)}function Rp(){Ba&&(Ba.detachEvent("onpropertychange",Np),Ia=Ba=null)}function Np(n){if(n.propertyName==="value"&&Al(Ia)){var s=[];Op(s,Ia,n,Oh(n)),mp(xx,s)}}function Tx(n,s,o){n==="focusin"?(Rp(),Ba=s,Ia=o,Ba.attachEvent("onpropertychange",Np)):n==="focusout"&&Rp()}function wx(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Al(Ia)}function Ex(n,s){if(n==="click")return Al(s)}function Ox(n,s){if(n==="input"||n==="change")return Al(s)}function Dx(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var un=typeof Object.is=="function"?Object.is:Dx;function Fa(n,s){if(un(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var o=Object.keys(n),u=Object.keys(s);if(o.length!==u.length)return!1;for(u=0;u<o.length;u++){var g=o[u];if(!gh.call(s,g)||!un(n[g],s[g]))return!1}return!0}function jp(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function kp(n,s){var o=jp(n);n=0;for(var u;o;){if(o.nodeType===3){if(u=n+o.textContent.length,n<=s&&u>=s)return{node:o,offset:s-n};n=u}t:{for(;o;){if(o.nextSibling){o=o.nextSibling;break t}o=o.parentNode}o=void 0}o=jp(o)}}function Lp(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Lp(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function zp(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=Cl(n.document);s instanceof n.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)n=s.contentWindow;else break;s=Cl(n.document)}return s}function Ih(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var Ax=oi&&"documentMode"in document&&11>=document.documentMode,Sr=null,Fh=null,Ua=null,Uh=!1;function Bp(n,s,o){var u=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Uh||Sr==null||Sr!==Cl(u)||(u=Sr,"selectionStart"in u&&Ih(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Ua&&Fa(Ua,u)||(Ua=u,u=_c(Fh,"onSelect"),0<u.length&&(s=new Ol("onSelect","select",null,s,o),n.push({event:s,listeners:u}),s.target=Sr)))}function Rs(n,s){var o={};return o[n.toLowerCase()]=s.toLowerCase(),o["Webkit"+n]="webkit"+s,o["Moz"+n]="moz"+s,o}var br={animationend:Rs("Animation","AnimationEnd"),animationiteration:Rs("Animation","AnimationIteration"),animationstart:Rs("Animation","AnimationStart"),transitionrun:Rs("Transition","TransitionRun"),transitionstart:Rs("Transition","TransitionStart"),transitioncancel:Rs("Transition","TransitionCancel"),transitionend:Rs("Transition","TransitionEnd")},Ph={},Ip={};oi&&(Ip=document.createElement("div").style,"AnimationEvent"in window||(delete br.animationend.animation,delete br.animationiteration.animation,delete br.animationstart.animation),"TransitionEvent"in window||delete br.transitionend.transition);function Ns(n){if(Ph[n])return Ph[n];if(!br[n])return n;var s=br[n],o;for(o in s)if(s.hasOwnProperty(o)&&o in Ip)return Ph[n]=s[o];return n}var Fp=Ns("animationend"),Up=Ns("animationiteration"),Pp=Ns("animationstart"),Mx=Ns("transitionrun"),Rx=Ns("transitionstart"),Nx=Ns("transitioncancel"),Hp=Ns("transitionend"),Yp=new Map,Hh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Hh.push("scrollEnd");function Ln(n,s){Yp.set(n,s),As(s,[n])}var Ml=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},bn=[],Cr=0,Yh=0;function Rl(){for(var n=Cr,s=Yh=Cr=0;s<n;){var o=bn[s];bn[s++]=null;var u=bn[s];bn[s++]=null;var g=bn[s];bn[s++]=null;var m=bn[s];if(bn[s++]=null,u!==null&&g!==null){var y=u.pending;y===null?g.next=g:(g.next=y.next,y.next=g),u.pending=g}m!==0&&Vp(o,g,m)}}function Nl(n,s,o,u){bn[Cr++]=n,bn[Cr++]=s,bn[Cr++]=o,bn[Cr++]=u,Yh|=u,n.lanes|=u,n=n.alternate,n!==null&&(n.lanes|=u)}function Vh(n,s,o,u){return Nl(n,s,o,u),jl(n)}function js(n,s){return Nl(n,null,null,s),jl(n)}function Vp(n,s,o){n.lanes|=o;var u=n.alternate;u!==null&&(u.lanes|=o);for(var g=!1,m=n.return;m!==null;)m.childLanes|=o,u=m.alternate,u!==null&&(u.childLanes|=o),m.tag===22&&(n=m.stateNode,n===null||n._visibility&1||(g=!0)),n=m,m=m.return;return n.tag===3?(m=n.stateNode,g&&s!==null&&(g=31-cn(o),n=m.hiddenUpdates,u=n[g],u===null?n[g]=[s]:u.push(s),s.lane=o|536870912),m):null}function jl(n){if(50<lo)throw lo=0,td=null,Error(i(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var xr={};function jx(n,s,o,u){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hn(n,s,o,u){return new jx(n,s,o,u)}function Gh(n){return n=n.prototype,!(!n||!n.isReactComponent)}function li(n,s){var o=n.alternate;return o===null?(o=hn(n.tag,s,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=s,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&65011712,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,s=n.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o.refCleanup=n.refCleanup,o}function Gp(n,s){n.flags&=65011714;var o=n.alternate;return o===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,s=o.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function kl(n,s,o,u,g,m){var y=0;if(u=n,typeof n=="function")Gh(n)&&(y=1);else if(typeof n=="string")y=IT(n,o,et.current)?26:n==="html"||n==="head"||n==="body"?27:5;else t:switch(n){case Z:return n=hn(31,o,s,g),n.elementType=Z,n.lanes=m,n;case T:return ks(o.children,g,m,s);case w:y=8,g|=24;break;case N:return n=hn(12,o,s,g|2),n.elementType=N,n.lanes=m,n;case B:return n=hn(13,o,s,g),n.elementType=B,n.lanes=m,n;case K:return n=hn(19,o,s,g),n.elementType=K,n.lanes=m,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case j:y=10;break t;case I:y=9;break t;case Y:y=11;break t;case F:y=14;break t;case Q:y=16,u=null;break t}y=29,o=Error(i(130,n===null?"null":typeof n,"")),u=null}return s=hn(y,o,s,g),s.elementType=n,s.type=u,s.lanes=m,s}function ks(n,s,o,u){return n=hn(7,n,u,s),n.lanes=o,n}function Xh(n,s,o){return n=hn(6,n,null,s),n.lanes=o,n}function Xp(n){var s=hn(18,null,null,0);return s.stateNode=n,s}function qh(n,s,o){return s=hn(4,n.children!==null?n.children:[],n.key,s),s.lanes=o,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var qp=new WeakMap;function Cn(n,s){if(typeof n=="object"&&n!==null){var o=qp.get(n);return o!==void 0?o:(s={value:n,source:s,stack:Xm(s)},qp.set(n,s),s)}return{value:n,source:s,stack:Xm(s)}}var Tr=[],wr=0,Ll=null,Pa=0,xn=[],Tn=0,Gi=null,Qn=1,Kn="";function ci(n,s){Tr[wr++]=Pa,Tr[wr++]=Ll,Ll=n,Pa=s}function Wp(n,s,o){xn[Tn++]=Qn,xn[Tn++]=Kn,xn[Tn++]=Gi,Gi=n;var u=Qn;n=Kn;var g=32-cn(u)-1;u&=~(1<<g),o+=1;var m=32-cn(s)+g;if(30<m){var y=g-g%5;m=(u&(1<<y)-1).toString(32),u>>=y,g-=y,Qn=1<<32-cn(s)+g|o<<g|u,Kn=m+n}else Qn=1<<m|o<<g|u,Kn=n}function Wh(n){n.return!==null&&(ci(n,1),Wp(n,1,0))}function Qh(n){for(;n===Ll;)Ll=Tr[--wr],Tr[wr]=null,Pa=Tr[--wr],Tr[wr]=null;for(;n===Gi;)Gi=xn[--Tn],xn[Tn]=null,Kn=xn[--Tn],xn[Tn]=null,Qn=xn[--Tn],xn[Tn]=null}function Qp(n,s){xn[Tn++]=Qn,xn[Tn++]=Kn,xn[Tn++]=Gi,Qn=s.id,Kn=s.overflow,Gi=n}var Re=null,Jt=null,Nt=!1,Xi=null,wn=!1,Kh=Error(i(519));function qi(n){var s=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ha(Cn(s,n)),Kh}function Kp(n){var s=n.stateNode,o=n.type,u=n.memoizedProps;switch(s[Me]=n,s[qe]=u,o){case"dialog":Et("cancel",s),Et("close",s);break;case"iframe":case"object":case"embed":Et("load",s);break;case"video":case"audio":for(o=0;o<uo.length;o++)Et(uo[o],s);break;case"source":Et("error",s);break;case"img":case"image":case"link":Et("error",s),Et("load",s);break;case"details":Et("toggle",s);break;case"input":Et("invalid",s),cp(s,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":Et("invalid",s);break;case"textarea":Et("invalid",s),hp(s,u.value,u.defaultValue,u.children)}o=u.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||u.suppressHydrationWarning===!0||dy(s.textContent,o)?(u.popover!=null&&(Et("beforetoggle",s),Et("toggle",s)),u.onScroll!=null&&Et("scroll",s),u.onScrollEnd!=null&&Et("scrollend",s),u.onClick!=null&&(s.onclick=ai),s=!0):s=!1,s||qi(n,!0)}function Zp(n){for(Re=n.return;Re;)switch(Re.tag){case 5:case 31:case 13:wn=!1;return;case 27:case 3:wn=!0;return;default:Re=Re.return}}function Er(n){if(n!==Re)return!1;if(!Nt)return Zp(n),Nt=!0,!1;var s=n.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=n.type,o=!(o!=="form"&&o!=="button")||md(n.type,n.memoizedProps)),o=!o),o&&Jt&&qi(n),Zp(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));Jt=Cy(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));Jt=Cy(n)}else s===27?(s=Jt,os(n.type)?(n=Sd,Sd=null,Jt=n):Jt=s):Jt=Re?On(n.stateNode.nextSibling):null;return!0}function Ls(){Jt=Re=null,Nt=!1}function Zh(){var n=Xi;return n!==null&&(Je===null?Je=n:Je.push.apply(Je,n),Xi=null),n}function Ha(n){Xi===null?Xi=[n]:Xi.push(n)}var Jh=D(null),zs=null,ui=null;function Wi(n,s,o){$(Jh,s._currentValue),s._currentValue=o}function hi(n){n._currentValue=Jh.current,X(Jh)}function $h(n,s,o){for(;n!==null;){var u=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),n===o)break;n=n.return}}function tf(n,s,o,u){var g=n.child;for(g!==null&&(g.return=n);g!==null;){var m=g.dependencies;if(m!==null){var y=g.child;m=m.firstContext;t:for(;m!==null;){var C=m;m=g;for(var E=0;E<s.length;E++)if(C.context===s[E]){m.lanes|=o,C=m.alternate,C!==null&&(C.lanes|=o),$h(m.return,o,n),u||(y=null);break t}m=C.next}}else if(g.tag===18){if(y=g.return,y===null)throw Error(i(341));y.lanes|=o,m=y.alternate,m!==null&&(m.lanes|=o),$h(y,o,n),y=null}else y=g.child;if(y!==null)y.return=g;else for(y=g;y!==null;){if(y===n){y=null;break}if(g=y.sibling,g!==null){g.return=y.return,y=g;break}y=y.return}g=y}}function Or(n,s,o,u){n=null;for(var g=s,m=!1;g!==null;){if(!m){if((g.flags&524288)!==0)m=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var y=g.alternate;if(y===null)throw Error(i(387));if(y=y.memoizedProps,y!==null){var C=g.type;un(g.pendingProps.value,y.value)||(n!==null?n.push(C):n=[C])}}else if(g===At.current){if(y=g.alternate,y===null)throw Error(i(387));y.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(n!==null?n.push(po):n=[po])}g=g.return}n!==null&&tf(s,n,o,u),s.flags|=262144}function zl(n){for(n=n.firstContext;n!==null;){if(!un(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Bs(n){zs=n,ui=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Ne(n){return Jp(zs,n)}function Bl(n,s){return zs===null&&Bs(n),Jp(n,s)}function Jp(n,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},ui===null){if(n===null)throw Error(i(308));ui=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else ui=ui.next=s;return o}var kx=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(o,u){n.push(u)}};this.abort=function(){s.aborted=!0,n.forEach(function(o){return o()})}},Lx=a.unstable_scheduleCallback,zx=a.unstable_NormalPriority,ge={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ef(){return{controller:new kx,data:new Map,refCount:0}}function Ya(n){n.refCount--,n.refCount===0&&Lx(zx,function(){n.controller.abort()})}var Va=null,nf=0,Dr=0,Ar=null;function Bx(n,s){if(Va===null){var o=Va=[];nf=0,Dr=ad(),Ar={status:"pending",value:void 0,then:function(u){o.push(u)}}}return nf++,s.then($p,$p),s}function $p(){if(--nf===0&&Va!==null){Ar!==null&&(Ar.status="fulfilled");var n=Va;Va=null,Dr=0,Ar=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function Ix(n,s){var o=[],u={status:"pending",value:null,reason:null,then:function(g){o.push(g)}};return n.then(function(){u.status="fulfilled",u.value=s;for(var g=0;g<o.length;g++)(0,o[g])(s)},function(g){for(u.status="rejected",u.reason=g,g=0;g<o.length;g++)(0,o[g])(void 0)}),u}var t_=U.S;U.S=function(n,s){Bv=on(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Bx(n,s),t_!==null&&t_(n,s)};var Is=D(null);function sf(){var n=Is.current;return n!==null?n:Xt.pooledCache}function Il(n,s){s===null?$(Is,Is.current):$(Is,s.pool)}function e_(){var n=sf();return n===null?null:{parent:ge._currentValue,pool:n}}var Mr=Error(i(460)),rf=Error(i(474)),Fl=Error(i(542)),Ul={then:function(){}};function n_(n){return n=n.status,n==="fulfilled"||n==="rejected"}function i_(n,s,o){switch(o=n[o],o===void 0?n.push(s):o!==s&&(s.then(ai,ai),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,r_(n),n;default:if(typeof s.status=="string")s.then(ai,ai);else{if(n=Xt,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=s,n.status="pending",n.then(function(u){if(s.status==="pending"){var g=s;g.status="fulfilled",g.value=u}},function(u){if(s.status==="pending"){var g=s;g.status="rejected",g.reason=u}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,r_(n),n}throw Us=s,Mr}}function Fs(n){try{var s=n._init;return s(n._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(Us=o,Mr):o}}var Us=null;function s_(){if(Us===null)throw Error(i(459));var n=Us;return Us=null,n}function r_(n){if(n===Mr||n===Fl)throw Error(i(483))}var Rr=null,Ga=0;function Pl(n){var s=Ga;return Ga+=1,Rr===null&&(Rr=[]),i_(Rr,n,s)}function Xa(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Hl(n,s){throw s.$$typeof===v?Error(i(525)):(n=Object.prototype.toString.call(s),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function a_(n){function s(R,O){if(n){var k=R.deletions;k===null?(R.deletions=[O],R.flags|=16):k.push(O)}}function o(R,O){if(!n)return null;for(;O!==null;)s(R,O),O=O.sibling;return null}function u(R){for(var O=new Map;R!==null;)R.key!==null?O.set(R.key,R):O.set(R.index,R),R=R.sibling;return O}function g(R,O){return R=li(R,O),R.index=0,R.sibling=null,R}function m(R,O,k){return R.index=k,n?(k=R.alternate,k!==null?(k=k.index,k<O?(R.flags|=67108866,O):k):(R.flags|=67108866,O)):(R.flags|=1048576,O)}function y(R){return n&&R.alternate===null&&(R.flags|=67108866),R}function C(R,O,k,G){return O===null||O.tag!==6?(O=Xh(k,R.mode,G),O.return=R,O):(O=g(O,k),O.return=R,O)}function E(R,O,k,G){var lt=k.type;return lt===T?V(R,O,k.props.children,G,k.key):O!==null&&(O.elementType===lt||typeof lt=="object"&&lt!==null&&lt.$$typeof===Q&&Fs(lt)===O.type)?(O=g(O,k.props),Xa(O,k),O.return=R,O):(O=kl(k.type,k.key,k.props,null,R.mode,G),Xa(O,k),O.return=R,O)}function L(R,O,k,G){return O===null||O.tag!==4||O.stateNode.containerInfo!==k.containerInfo||O.stateNode.implementation!==k.implementation?(O=qh(k,R.mode,G),O.return=R,O):(O=g(O,k.children||[]),O.return=R,O)}function V(R,O,k,G,lt){return O===null||O.tag!==7?(O=ks(k,R.mode,G,lt),O.return=R,O):(O=g(O,k),O.return=R,O)}function q(R,O,k){if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return O=Xh(""+O,R.mode,k),O.return=R,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case S:return k=kl(O.type,O.key,O.props,null,R.mode,k),Xa(k,O),k.return=R,k;case b:return O=qh(O,R.mode,k),O.return=R,O;case Q:return O=Fs(O),q(R,O,k)}if(vt(O)||rt(O))return O=ks(O,R.mode,k,null),O.return=R,O;if(typeof O.then=="function")return q(R,Pl(O),k);if(O.$$typeof===j)return q(R,Bl(R,O),k);Hl(R,O)}return null}function z(R,O,k,G){var lt=O!==null?O.key:null;if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return lt!==null?null:C(R,O,""+k,G);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case S:return k.key===lt?E(R,O,k,G):null;case b:return k.key===lt?L(R,O,k,G):null;case Q:return k=Fs(k),z(R,O,k,G)}if(vt(k)||rt(k))return lt!==null?null:V(R,O,k,G,null);if(typeof k.then=="function")return z(R,O,Pl(k),G);if(k.$$typeof===j)return z(R,O,Bl(R,k),G);Hl(R,k)}return null}function H(R,O,k,G,lt){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return R=R.get(k)||null,C(O,R,""+G,lt);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case S:return R=R.get(G.key===null?k:G.key)||null,E(O,R,G,lt);case b:return R=R.get(G.key===null?k:G.key)||null,L(O,R,G,lt);case Q:return G=Fs(G),H(R,O,k,G,lt)}if(vt(G)||rt(G))return R=R.get(k)||null,V(O,R,G,lt,null);if(typeof G.then=="function")return H(R,O,k,Pl(G),lt);if(G.$$typeof===j)return H(R,O,k,Bl(O,G),lt);Hl(O,G)}return null}function st(R,O,k,G){for(var lt=null,kt=null,at=O,St=O=0,Rt=null;at!==null&&St<k.length;St++){at.index>St?(Rt=at,at=null):Rt=at.sibling;var Lt=z(R,at,k[St],G);if(Lt===null){at===null&&(at=Rt);break}n&&at&&Lt.alternate===null&&s(R,at),O=m(Lt,O,St),kt===null?lt=Lt:kt.sibling=Lt,kt=Lt,at=Rt}if(St===k.length)return o(R,at),Nt&&ci(R,St),lt;if(at===null){for(;St<k.length;St++)at=q(R,k[St],G),at!==null&&(O=m(at,O,St),kt===null?lt=at:kt.sibling=at,kt=at);return Nt&&ci(R,St),lt}for(at=u(at);St<k.length;St++)Rt=H(at,R,St,k[St],G),Rt!==null&&(n&&Rt.alternate!==null&&at.delete(Rt.key===null?St:Rt.key),O=m(Rt,O,St),kt===null?lt=Rt:kt.sibling=Rt,kt=Rt);return n&&at.forEach(function(fs){return s(R,fs)}),Nt&&ci(R,St),lt}function ut(R,O,k,G){if(k==null)throw Error(i(151));for(var lt=null,kt=null,at=O,St=O=0,Rt=null,Lt=k.next();at!==null&&!Lt.done;St++,Lt=k.next()){at.index>St?(Rt=at,at=null):Rt=at.sibling;var fs=z(R,at,Lt.value,G);if(fs===null){at===null&&(at=Rt);break}n&&at&&fs.alternate===null&&s(R,at),O=m(fs,O,St),kt===null?lt=fs:kt.sibling=fs,kt=fs,at=Rt}if(Lt.done)return o(R,at),Nt&&ci(R,St),lt;if(at===null){for(;!Lt.done;St++,Lt=k.next())Lt=q(R,Lt.value,G),Lt!==null&&(O=m(Lt,O,St),kt===null?lt=Lt:kt.sibling=Lt,kt=Lt);return Nt&&ci(R,St),lt}for(at=u(at);!Lt.done;St++,Lt=k.next())Lt=H(at,R,St,Lt.value,G),Lt!==null&&(n&&Lt.alternate!==null&&at.delete(Lt.key===null?St:Lt.key),O=m(Lt,O,St),kt===null?lt=Lt:kt.sibling=Lt,kt=Lt);return n&&at.forEach(function(QT){return s(R,QT)}),Nt&&ci(R,St),lt}function Vt(R,O,k,G){if(typeof k=="object"&&k!==null&&k.type===T&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case S:t:{for(var lt=k.key;O!==null;){if(O.key===lt){if(lt=k.type,lt===T){if(O.tag===7){o(R,O.sibling),G=g(O,k.props.children),G.return=R,R=G;break t}}else if(O.elementType===lt||typeof lt=="object"&&lt!==null&&lt.$$typeof===Q&&Fs(lt)===O.type){o(R,O.sibling),G=g(O,k.props),Xa(G,k),G.return=R,R=G;break t}o(R,O);break}else s(R,O);O=O.sibling}k.type===T?(G=ks(k.props.children,R.mode,G,k.key),G.return=R,R=G):(G=kl(k.type,k.key,k.props,null,R.mode,G),Xa(G,k),G.return=R,R=G)}return y(R);case b:t:{for(lt=k.key;O!==null;){if(O.key===lt)if(O.tag===4&&O.stateNode.containerInfo===k.containerInfo&&O.stateNode.implementation===k.implementation){o(R,O.sibling),G=g(O,k.children||[]),G.return=R,R=G;break t}else{o(R,O);break}else s(R,O);O=O.sibling}G=qh(k,R.mode,G),G.return=R,R=G}return y(R);case Q:return k=Fs(k),Vt(R,O,k,G)}if(vt(k))return st(R,O,k,G);if(rt(k)){if(lt=rt(k),typeof lt!="function")throw Error(i(150));return k=lt.call(k),ut(R,O,k,G)}if(typeof k.then=="function")return Vt(R,O,Pl(k),G);if(k.$$typeof===j)return Vt(R,O,Bl(R,k),G);Hl(R,k)}return typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint"?(k=""+k,O!==null&&O.tag===6?(o(R,O.sibling),G=g(O,k),G.return=R,R=G):(o(R,O),G=Xh(k,R.mode,G),G.return=R,R=G),y(R)):o(R,O)}return function(R,O,k,G){try{Ga=0;var lt=Vt(R,O,k,G);return Rr=null,lt}catch(at){if(at===Mr||at===Fl)throw at;var kt=hn(29,at,null,R.mode);return kt.lanes=G,kt.return=R,kt}finally{}}}var Ps=a_(!0),o_=a_(!1),Qi=!1;function af(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function of(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Ki(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Zi(n,s,o){var u=n.updateQueue;if(u===null)return null;if(u=u.shared,(Bt&2)!==0){var g=u.pending;return g===null?s.next=s:(s.next=g.next,g.next=s),u.pending=s,s=jl(n),Vp(n,null,o),s}return Nl(n,u,s,o),jl(n)}function qa(n,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var u=s.lanes;u&=n.pendingLanes,o|=u,s.lanes=o,Jm(n,o)}}function lf(n,s){var o=n.updateQueue,u=n.alternate;if(u!==null&&(u=u.updateQueue,o===u)){var g=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var y={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};m===null?g=m=y:m=m.next=y,o=o.next}while(o!==null);m===null?g=m=s:m=m.next=s}else g=m=s;o={baseState:u.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:u.shared,callbacks:u.callbacks},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=s:n.next=s,o.lastBaseUpdate=s}var cf=!1;function Wa(){if(cf){var n=Ar;if(n!==null)throw n}}function Qa(n,s,o,u){cf=!1;var g=n.updateQueue;Qi=!1;var m=g.firstBaseUpdate,y=g.lastBaseUpdate,C=g.shared.pending;if(C!==null){g.shared.pending=null;var E=C,L=E.next;E.next=null,y===null?m=L:y.next=L,y=E;var V=n.alternate;V!==null&&(V=V.updateQueue,C=V.lastBaseUpdate,C!==y&&(C===null?V.firstBaseUpdate=L:C.next=L,V.lastBaseUpdate=E))}if(m!==null){var q=g.baseState;y=0,V=L=E=null,C=m;do{var z=C.lane&-536870913,H=z!==C.lane;if(H?(Mt&z)===z:(u&z)===z){z!==0&&z===Dr&&(cf=!0),V!==null&&(V=V.next={lane:0,tag:C.tag,payload:C.payload,callback:null,next:null});t:{var st=n,ut=C;z=s;var Vt=o;switch(ut.tag){case 1:if(st=ut.payload,typeof st=="function"){q=st.call(Vt,q,z);break t}q=st;break t;case 3:st.flags=st.flags&-65537|128;case 0:if(st=ut.payload,z=typeof st=="function"?st.call(Vt,q,z):st,z==null)break t;q=_({},q,z);break t;case 2:Qi=!0}}z=C.callback,z!==null&&(n.flags|=64,H&&(n.flags|=8192),H=g.callbacks,H===null?g.callbacks=[z]:H.push(z))}else H={lane:z,tag:C.tag,payload:C.payload,callback:C.callback,next:null},V===null?(L=V=H,E=q):V=V.next=H,y|=z;if(C=C.next,C===null){if(C=g.shared.pending,C===null)break;H=C,C=H.next,H.next=null,g.lastBaseUpdate=H,g.shared.pending=null}}while(!0);V===null&&(E=q),g.baseState=E,g.firstBaseUpdate=L,g.lastBaseUpdate=V,m===null&&(g.shared.lanes=0),ns|=y,n.lanes=y,n.memoizedState=q}}function l_(n,s){if(typeof n!="function")throw Error(i(191,n));n.call(s)}function c_(n,s){var o=n.callbacks;if(o!==null)for(n.callbacks=null,n=0;n<o.length;n++)l_(o[n],s)}var Nr=D(null),Yl=D(0);function u_(n,s){n=Si,$(Yl,n),$(Nr,s),Si=n|s.baseLanes}function uf(){$(Yl,Si),$(Nr,Nr.current)}function hf(){Si=Yl.current,X(Nr),X(Yl)}var fn=D(null),En=null;function Ji(n){var s=n.alternate;$(ue,ue.current&1),$(fn,n),En===null&&(s===null||Nr.current!==null||s.memoizedState!==null)&&(En=n)}function ff(n){$(ue,ue.current),$(fn,n),En===null&&(En=n)}function h_(n){n.tag===22?($(ue,ue.current),$(fn,n),En===null&&(En=n)):$i()}function $i(){$(ue,ue.current),$(fn,fn.current)}function dn(n){X(fn),En===n&&(En=null),X(ue)}var ue=D(0);function Vl(n){for(var s=n;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||vd(o)||yd(o)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var fi=0,yt=null,Ht=null,me=null,Gl=!1,jr=!1,Hs=!1,Xl=0,Ka=0,kr=null,Fx=0;function ie(){throw Error(i(321))}function df(n,s){if(s===null)return!1;for(var o=0;o<s.length&&o<n.length;o++)if(!un(n[o],s[o]))return!1;return!0}function gf(n,s,o,u,g,m){return fi=m,yt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,U.H=n===null||n.memoizedState===null?W_:Af,Hs=!1,m=o(u,g),Hs=!1,jr&&(m=d_(s,o,u,g)),f_(n),m}function f_(n){U.H=$a;var s=Ht!==null&&Ht.next!==null;if(fi=0,me=Ht=yt=null,Gl=!1,Ka=0,kr=null,s)throw Error(i(300));n===null||pe||(n=n.dependencies,n!==null&&zl(n)&&(pe=!0))}function d_(n,s,o,u){yt=n;var g=0;do{if(jr&&(kr=null),Ka=0,jr=!1,25<=g)throw Error(i(301));if(g+=1,me=Ht=null,n.updateQueue!=null){var m=n.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}U.H=Q_,m=s(o,u)}while(jr);return m}function Ux(){var n=U.H,s=n.useState()[0];return s=typeof s.then=="function"?Za(s):s,n=n.useState()[0],(Ht!==null?Ht.memoizedState:null)!==n&&(yt.flags|=1024),s}function mf(){var n=Xl!==0;return Xl=0,n}function pf(n,s,o){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~o}function _f(n){if(Gl){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Gl=!1}fi=0,me=Ht=yt=null,jr=!1,Ka=Xl=0,kr=null}function Ue(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return me===null?yt.memoizedState=me=n:me=me.next=n,me}function he(){if(Ht===null){var n=yt.alternate;n=n!==null?n.memoizedState:null}else n=Ht.next;var s=me===null?yt.memoizedState:me.next;if(s!==null)me=s,Ht=n;else{if(n===null)throw yt.alternate===null?Error(i(467)):Error(i(310));Ht=n,n={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},me===null?yt.memoizedState=me=n:me=me.next=n}return me}function ql(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Za(n){var s=Ka;return Ka+=1,kr===null&&(kr=[]),n=i_(kr,n,s),s=yt,(me===null?s.memoizedState:me.next)===null&&(s=s.alternate,U.H=s===null||s.memoizedState===null?W_:Af),n}function Wl(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Za(n);if(n.$$typeof===j)return Ne(n)}throw Error(i(438,String(n)))}function vf(n){var s=null,o=yt.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var u=yt.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(s={data:u.data.map(function(g){return g.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=ql(),yt.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(n),u=0;u<n;u++)o[u]=nt;return s.index++,o}function di(n,s){return typeof s=="function"?s(n):s}function Ql(n){var s=he();return yf(s,Ht,n)}function yf(n,s,o){var u=n.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=o;var g=n.baseQueue,m=u.pending;if(m!==null){if(g!==null){var y=g.next;g.next=m.next,m.next=y}s.baseQueue=g=m,u.pending=null}if(m=n.baseState,g===null)n.memoizedState=m;else{s=g.next;var C=y=null,E=null,L=s,V=!1;do{var q=L.lane&-536870913;if(q!==L.lane?(Mt&q)===q:(fi&q)===q){var z=L.revertLane;if(z===0)E!==null&&(E=E.next={lane:0,revertLane:0,gesture:null,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null}),q===Dr&&(V=!0);else if((fi&z)===z){L=L.next,z===Dr&&(V=!0);continue}else q={lane:0,revertLane:L.revertLane,gesture:null,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null},E===null?(C=E=q,y=m):E=E.next=q,yt.lanes|=z,ns|=z;q=L.action,Hs&&o(m,q),m=L.hasEagerState?L.eagerState:o(m,q)}else z={lane:q,revertLane:L.revertLane,gesture:L.gesture,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null},E===null?(C=E=z,y=m):E=E.next=z,yt.lanes|=q,ns|=q;L=L.next}while(L!==null&&L!==s);if(E===null?y=m:E.next=C,!un(m,n.memoizedState)&&(pe=!0,V&&(o=Ar,o!==null)))throw o;n.memoizedState=m,n.baseState=y,n.baseQueue=E,u.lastRenderedState=m}return g===null&&(u.lanes=0),[n.memoizedState,u.dispatch]}function Sf(n){var s=he(),o=s.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=n;var u=o.dispatch,g=o.pending,m=s.memoizedState;if(g!==null){o.pending=null;var y=g=g.next;do m=n(m,y.action),y=y.next;while(y!==g);un(m,s.memoizedState)||(pe=!0),s.memoizedState=m,s.baseQueue===null&&(s.baseState=m),o.lastRenderedState=m}return[m,u]}function g_(n,s,o){var u=yt,g=he(),m=Nt;if(m){if(o===void 0)throw Error(i(407));o=o()}else o=s();var y=!un((Ht||g).memoizedState,o);if(y&&(g.memoizedState=o,pe=!0),g=g.queue,xf(__.bind(null,u,g,n),[n]),g.getSnapshot!==s||y||me!==null&&me.memoizedState.tag&1){if(u.flags|=2048,Lr(9,{destroy:void 0},p_.bind(null,u,g,o,s),null),Xt===null)throw Error(i(349));m||(fi&127)!==0||m_(u,s,o)}return o}function m_(n,s,o){n.flags|=16384,n={getSnapshot:s,value:o},s=yt.updateQueue,s===null?(s=ql(),yt.updateQueue=s,s.stores=[n]):(o=s.stores,o===null?s.stores=[n]:o.push(n))}function p_(n,s,o,u){s.value=o,s.getSnapshot=u,v_(s)&&y_(n)}function __(n,s,o){return o(function(){v_(s)&&y_(n)})}function v_(n){var s=n.getSnapshot;n=n.value;try{var o=s();return!un(n,o)}catch{return!0}}function y_(n){var s=js(n,2);s!==null&&$e(s,n,2)}function bf(n){var s=Ue();if(typeof n=="function"){var o=n;if(n=o(),Hs){Hi(!0);try{o()}finally{Hi(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:di,lastRenderedState:n},s}function S_(n,s,o,u){return n.baseState=o,yf(n,Ht,typeof u=="function"?u:di)}function Px(n,s,o,u,g){if(Jl(n))throw Error(i(485));if(n=s.action,n!==null){var m={payload:g,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){m.listeners.push(y)}};U.T!==null?o(!0):m.isTransition=!1,u(m),o=s.pending,o===null?(m.next=s.pending=m,b_(s,m)):(m.next=o.next,s.pending=o.next=m)}}function b_(n,s){var o=s.action,u=s.payload,g=n.state;if(s.isTransition){var m=U.T,y={};U.T=y;try{var C=o(g,u),E=U.S;E!==null&&E(y,C),C_(n,s,C)}catch(L){Cf(n,s,L)}finally{m!==null&&y.types!==null&&(m.types=y.types),U.T=m}}else try{m=o(g,u),C_(n,s,m)}catch(L){Cf(n,s,L)}}function C_(n,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(u){x_(n,s,u)},function(u){return Cf(n,s,u)}):x_(n,s,o)}function x_(n,s,o){s.status="fulfilled",s.value=o,T_(s),n.state=o,s=n.pending,s!==null&&(o=s.next,o===s?n.pending=null:(o=o.next,s.next=o,b_(n,o)))}function Cf(n,s,o){var u=n.pending;if(n.pending=null,u!==null){u=u.next;do s.status="rejected",s.reason=o,T_(s),s=s.next;while(s!==u)}n.action=null}function T_(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function w_(n,s){return s}function E_(n,s){if(Nt){var o=Xt.formState;if(o!==null){t:{var u=yt;if(Nt){if(Jt){e:{for(var g=Jt,m=wn;g.nodeType!==8;){if(!m){g=null;break e}if(g=On(g.nextSibling),g===null){g=null;break e}}m=g.data,g=m==="F!"||m==="F"?g:null}if(g){Jt=On(g.nextSibling),u=g.data==="F!";break t}}qi(u)}u=!1}u&&(s=o[0])}}return o=Ue(),o.memoizedState=o.baseState=s,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:w_,lastRenderedState:s},o.queue=u,o=G_.bind(null,yt,u),u.dispatch=o,u=bf(!1),m=Df.bind(null,yt,!1,u.queue),u=Ue(),g={state:s,dispatch:null,action:n,pending:null},u.queue=g,o=Px.bind(null,yt,g,m,o),g.dispatch=o,u.memoizedState=n,[s,o,!1]}function O_(n){var s=he();return D_(s,Ht,n)}function D_(n,s,o){if(s=yf(n,s,w_)[0],n=Ql(di)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var u=Za(s)}catch(y){throw y===Mr?Fl:y}else u=s;s=he();var g=s.queue,m=g.dispatch;return o!==s.memoizedState&&(yt.flags|=2048,Lr(9,{destroy:void 0},Hx.bind(null,g,o),null)),[u,m,n]}function Hx(n,s){n.action=s}function A_(n){var s=he(),o=Ht;if(o!==null)return D_(s,o,n);he(),s=s.memoizedState,o=he();var u=o.queue.dispatch;return o.memoizedState=n,[s,u,!1]}function Lr(n,s,o,u){return n={tag:n,create:o,deps:u,inst:s,next:null},s=yt.updateQueue,s===null&&(s=ql(),yt.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=n.next=n:(u=o.next,o.next=n,n.next=u,s.lastEffect=n),n}function M_(){return he().memoizedState}function Kl(n,s,o,u){var g=Ue();yt.flags|=n,g.memoizedState=Lr(1|s,{destroy:void 0},o,u===void 0?null:u)}function Zl(n,s,o,u){var g=he();u=u===void 0?null:u;var m=g.memoizedState.inst;Ht!==null&&u!==null&&df(u,Ht.memoizedState.deps)?g.memoizedState=Lr(s,m,o,u):(yt.flags|=n,g.memoizedState=Lr(1|s,m,o,u))}function R_(n,s){Kl(8390656,8,n,s)}function xf(n,s){Zl(2048,8,n,s)}function Yx(n){yt.flags|=4;var s=yt.updateQueue;if(s===null)s=ql(),yt.updateQueue=s,s.events=[n];else{var o=s.events;o===null?s.events=[n]:o.push(n)}}function N_(n){var s=he().memoizedState;return Yx({ref:s,nextImpl:n}),function(){if((Bt&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}function j_(n,s){return Zl(4,2,n,s)}function k_(n,s){return Zl(4,4,n,s)}function L_(n,s){if(typeof s=="function"){n=n();var o=s(n);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function z_(n,s,o){o=o!=null?o.concat([n]):null,Zl(4,4,L_.bind(null,s,n),o)}function Tf(){}function B_(n,s){var o=he();s=s===void 0?null:s;var u=o.memoizedState;return s!==null&&df(s,u[1])?u[0]:(o.memoizedState=[n,s],n)}function I_(n,s){var o=he();s=s===void 0?null:s;var u=o.memoizedState;if(s!==null&&df(s,u[1]))return u[0];if(u=n(),Hs){Hi(!0);try{n()}finally{Hi(!1)}}return o.memoizedState=[u,s],u}function wf(n,s,o){return o===void 0||(fi&1073741824)!==0&&(Mt&261930)===0?n.memoizedState=s:(n.memoizedState=o,n=Fv(),yt.lanes|=n,ns|=n,o)}function F_(n,s,o,u){return un(o,s)?o:Nr.current!==null?(n=wf(n,o,u),un(n,s)||(pe=!0),n):(fi&42)===0||(fi&1073741824)!==0&&(Mt&261930)===0?(pe=!0,n.memoizedState=o):(n=Fv(),yt.lanes|=n,ns|=n,s)}function U_(n,s,o,u,g){var m=W.p;W.p=m!==0&&8>m?m:8;var y=U.T,C={};U.T=C,Df(n,!1,s,o);try{var E=g(),L=U.S;if(L!==null&&L(C,E),E!==null&&typeof E=="object"&&typeof E.then=="function"){var V=Ix(E,u);Ja(n,s,V,pn(n))}else Ja(n,s,u,pn(n))}catch(q){Ja(n,s,{then:function(){},status:"rejected",reason:q},pn())}finally{W.p=m,y!==null&&C.types!==null&&(y.types=C.types),U.T=y}}function Vx(){}function Ef(n,s,o,u){if(n.tag!==5)throw Error(i(476));var g=P_(n).queue;U_(n,g,s,tt,o===null?Vx:function(){return H_(n),o(u)})}function P_(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:tt,baseState:tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:di,lastRenderedState:tt},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:di,lastRenderedState:o},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function H_(n){var s=P_(n);s.next===null&&(s=n.alternate.memoizedState),Ja(n,s.next.queue,{},pn())}function Of(){return Ne(po)}function Y_(){return he().memoizedState}function V_(){return he().memoizedState}function Gx(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var o=pn();n=Ki(o);var u=Zi(s,n,o);u!==null&&($e(u,s,o),qa(u,s,o)),s={cache:ef()},n.payload=s;return}s=s.return}}function Xx(n,s,o){var u=pn();o={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},Jl(n)?X_(s,o):(o=Vh(n,s,o,u),o!==null&&($e(o,n,u),q_(o,s,u)))}function G_(n,s,o){var u=pn();Ja(n,s,o,u)}function Ja(n,s,o,u){var g={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(Jl(n))X_(s,g);else{var m=n.alternate;if(n.lanes===0&&(m===null||m.lanes===0)&&(m=s.lastRenderedReducer,m!==null))try{var y=s.lastRenderedState,C=m(y,o);if(g.hasEagerState=!0,g.eagerState=C,un(C,y))return Nl(n,s,g,0),Xt===null&&Rl(),!1}catch{}finally{}if(o=Vh(n,s,g,u),o!==null)return $e(o,n,u),q_(o,s,u),!0}return!1}function Df(n,s,o,u){if(u={lane:2,revertLane:ad(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Jl(n)){if(s)throw Error(i(479))}else s=Vh(n,o,u,2),s!==null&&$e(s,n,2)}function Jl(n){var s=n.alternate;return n===yt||s!==null&&s===yt}function X_(n,s){jr=Gl=!0;var o=n.pending;o===null?s.next=s:(s.next=o.next,o.next=s),n.pending=s}function q_(n,s,o){if((o&4194048)!==0){var u=s.lanes;u&=n.pendingLanes,o|=u,s.lanes=o,Jm(n,o)}}var $a={readContext:Ne,use:Wl,useCallback:ie,useContext:ie,useEffect:ie,useImperativeHandle:ie,useLayoutEffect:ie,useInsertionEffect:ie,useMemo:ie,useReducer:ie,useRef:ie,useState:ie,useDebugValue:ie,useDeferredValue:ie,useTransition:ie,useSyncExternalStore:ie,useId:ie,useHostTransitionStatus:ie,useFormState:ie,useActionState:ie,useOptimistic:ie,useMemoCache:ie,useCacheRefresh:ie};$a.useEffectEvent=ie;var W_={readContext:Ne,use:Wl,useCallback:function(n,s){return Ue().memoizedState=[n,s===void 0?null:s],n},useContext:Ne,useEffect:R_,useImperativeHandle:function(n,s,o){o=o!=null?o.concat([n]):null,Kl(4194308,4,L_.bind(null,s,n),o)},useLayoutEffect:function(n,s){return Kl(4194308,4,n,s)},useInsertionEffect:function(n,s){Kl(4,2,n,s)},useMemo:function(n,s){var o=Ue();s=s===void 0?null:s;var u=n();if(Hs){Hi(!0);try{n()}finally{Hi(!1)}}return o.memoizedState=[u,s],u},useReducer:function(n,s,o){var u=Ue();if(o!==void 0){var g=o(s);if(Hs){Hi(!0);try{o(s)}finally{Hi(!1)}}}else g=s;return u.memoizedState=u.baseState=g,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:g},u.queue=n,n=n.dispatch=Xx.bind(null,yt,n),[u.memoizedState,n]},useRef:function(n){var s=Ue();return n={current:n},s.memoizedState=n},useState:function(n){n=bf(n);var s=n.queue,o=G_.bind(null,yt,s);return s.dispatch=o,[n.memoizedState,o]},useDebugValue:Tf,useDeferredValue:function(n,s){var o=Ue();return wf(o,n,s)},useTransition:function(){var n=bf(!1);return n=U_.bind(null,yt,n.queue,!0,!1),Ue().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,o){var u=yt,g=Ue();if(Nt){if(o===void 0)throw Error(i(407));o=o()}else{if(o=s(),Xt===null)throw Error(i(349));(Mt&127)!==0||m_(u,s,o)}g.memoizedState=o;var m={value:o,getSnapshot:s};return g.queue=m,R_(__.bind(null,u,m,n),[n]),u.flags|=2048,Lr(9,{destroy:void 0},p_.bind(null,u,m,o,s),null),o},useId:function(){var n=Ue(),s=Xt.identifierPrefix;if(Nt){var o=Kn,u=Qn;o=(u&~(1<<32-cn(u)-1)).toString(32)+o,s="_"+s+"R_"+o,o=Xl++,0<o&&(s+="H"+o.toString(32)),s+="_"}else o=Fx++,s="_"+s+"r_"+o.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:Of,useFormState:E_,useActionState:E_,useOptimistic:function(n){var s=Ue();s.memoizedState=s.baseState=n;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=Df.bind(null,yt,!0,o),o.dispatch=s,[n,s]},useMemoCache:vf,useCacheRefresh:function(){return Ue().memoizedState=Gx.bind(null,yt)},useEffectEvent:function(n){var s=Ue(),o={impl:n};return s.memoizedState=o,function(){if((Bt&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}},Af={readContext:Ne,use:Wl,useCallback:B_,useContext:Ne,useEffect:xf,useImperativeHandle:z_,useInsertionEffect:j_,useLayoutEffect:k_,useMemo:I_,useReducer:Ql,useRef:M_,useState:function(){return Ql(di)},useDebugValue:Tf,useDeferredValue:function(n,s){var o=he();return F_(o,Ht.memoizedState,n,s)},useTransition:function(){var n=Ql(di)[0],s=he().memoizedState;return[typeof n=="boolean"?n:Za(n),s]},useSyncExternalStore:g_,useId:Y_,useHostTransitionStatus:Of,useFormState:O_,useActionState:O_,useOptimistic:function(n,s){var o=he();return S_(o,Ht,n,s)},useMemoCache:vf,useCacheRefresh:V_};Af.useEffectEvent=N_;var Q_={readContext:Ne,use:Wl,useCallback:B_,useContext:Ne,useEffect:xf,useImperativeHandle:z_,useInsertionEffect:j_,useLayoutEffect:k_,useMemo:I_,useReducer:Sf,useRef:M_,useState:function(){return Sf(di)},useDebugValue:Tf,useDeferredValue:function(n,s){var o=he();return Ht===null?wf(o,n,s):F_(o,Ht.memoizedState,n,s)},useTransition:function(){var n=Sf(di)[0],s=he().memoizedState;return[typeof n=="boolean"?n:Za(n),s]},useSyncExternalStore:g_,useId:Y_,useHostTransitionStatus:Of,useFormState:A_,useActionState:A_,useOptimistic:function(n,s){var o=he();return Ht!==null?S_(o,Ht,n,s):(o.baseState=n,[n,o.queue.dispatch])},useMemoCache:vf,useCacheRefresh:V_};Q_.useEffectEvent=N_;function Mf(n,s,o,u){s=n.memoizedState,o=o(u,s),o=o==null?s:_({},s,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var Rf={enqueueSetState:function(n,s,o){n=n._reactInternals;var u=pn(),g=Ki(u);g.payload=s,o!=null&&(g.callback=o),s=Zi(n,g,u),s!==null&&($e(s,n,u),qa(s,n,u))},enqueueReplaceState:function(n,s,o){n=n._reactInternals;var u=pn(),g=Ki(u);g.tag=1,g.payload=s,o!=null&&(g.callback=o),s=Zi(n,g,u),s!==null&&($e(s,n,u),qa(s,n,u))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var o=pn(),u=Ki(o);u.tag=2,s!=null&&(u.callback=s),s=Zi(n,u,o),s!==null&&($e(s,n,o),qa(s,n,o))}};function K_(n,s,o,u,g,m,y){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(u,m,y):s.prototype&&s.prototype.isPureReactComponent?!Fa(o,u)||!Fa(g,m):!0}function Z_(n,s,o,u){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,u),s.state!==n&&Rf.enqueueReplaceState(s,s.state,null)}function Ys(n,s){var o=s;if("ref"in s){o={};for(var u in s)u!=="ref"&&(o[u]=s[u])}if(n=n.defaultProps){o===s&&(o=_({},o));for(var g in n)o[g]===void 0&&(o[g]=n[g])}return o}function J_(n){Ml(n)}function $_(n){console.error(n)}function tv(n){Ml(n)}function $l(n,s){try{var o=n.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(u){setTimeout(function(){throw u})}}function ev(n,s,o){try{var u=n.onCaughtError;u(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Nf(n,s,o){return o=Ki(o),o.tag=3,o.payload={element:null},o.callback=function(){$l(n,s)},o}function nv(n){return n=Ki(n),n.tag=3,n}function iv(n,s,o,u){var g=o.type.getDerivedStateFromError;if(typeof g=="function"){var m=u.value;n.payload=function(){return g(m)},n.callback=function(){ev(s,o,u)}}var y=o.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(n.callback=function(){ev(s,o,u),typeof g!="function"&&(is===null?is=new Set([this]):is.add(this));var C=u.stack;this.componentDidCatch(u.value,{componentStack:C!==null?C:""})})}function qx(n,s,o,u,g){if(o.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(s=o.alternate,s!==null&&Or(s,o,g,!0),o=fn.current,o!==null){switch(o.tag){case 31:case 13:return En===null?hc():o.alternate===null&&se===0&&(se=3),o.flags&=-257,o.flags|=65536,o.lanes=g,u===Ul?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([u]):s.add(u),id(n,u,g)),!1;case 22:return o.flags|=65536,u===Ul?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([u])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([u]):o.add(u)),id(n,u,g)),!1}throw Error(i(435,o.tag))}return id(n,u,g),hc(),!1}if(Nt)return s=fn.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=g,u!==Kh&&(n=Error(i(422),{cause:u}),Ha(Cn(n,o)))):(u!==Kh&&(s=Error(i(423),{cause:u}),Ha(Cn(s,o))),n=n.current.alternate,n.flags|=65536,g&=-g,n.lanes|=g,u=Cn(u,o),g=Nf(n.stateNode,u,g),lf(n,g),se!==4&&(se=2)),!1;var m=Error(i(520),{cause:u});if(m=Cn(m,o),oo===null?oo=[m]:oo.push(m),se!==4&&(se=2),s===null)return!0;u=Cn(u,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,n=g&-g,o.lanes|=n,n=Nf(o.stateNode,u,n),lf(o,n),!1;case 1:if(s=o.type,m=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(is===null||!is.has(m))))return o.flags|=65536,g&=-g,o.lanes|=g,g=nv(g),iv(g,n,o,u),lf(o,g),!1}o=o.return}while(o!==null);return!1}var jf=Error(i(461)),pe=!1;function je(n,s,o,u){s.child=n===null?o_(s,null,o,u):Ps(s,n.child,o,u)}function sv(n,s,o,u,g){o=o.render;var m=s.ref;if("ref"in u){var y={};for(var C in u)C!=="ref"&&(y[C]=u[C])}else y=u;return Bs(s),u=gf(n,s,o,y,m,g),C=mf(),n!==null&&!pe?(pf(n,s,g),gi(n,s,g)):(Nt&&C&&Wh(s),s.flags|=1,je(n,s,u,g),s.child)}function rv(n,s,o,u,g){if(n===null){var m=o.type;return typeof m=="function"&&!Gh(m)&&m.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=m,av(n,s,m,u,g)):(n=kl(o.type,null,u,s,s.mode,g),n.ref=s.ref,n.return=s,s.child=n)}if(m=n.child,!Pf(n,g)){var y=m.memoizedProps;if(o=o.compare,o=o!==null?o:Fa,o(y,u)&&n.ref===s.ref)return gi(n,s,g)}return s.flags|=1,n=li(m,u),n.ref=s.ref,n.return=s,s.child=n}function av(n,s,o,u,g){if(n!==null){var m=n.memoizedProps;if(Fa(m,u)&&n.ref===s.ref)if(pe=!1,s.pendingProps=u=m,Pf(n,g))(n.flags&131072)!==0&&(pe=!0);else return s.lanes=n.lanes,gi(n,s,g)}return kf(n,s,o,u,g)}function ov(n,s,o,u){var g=u.children,m=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((s.flags&128)!==0){if(m=m!==null?m.baseLanes|o:o,n!==null){for(u=s.child=n.child,g=0;u!==null;)g=g|u.lanes|u.childLanes,u=u.sibling;u=g&~m}else u=0,s.child=null;return lv(n,s,m,o,u)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&Il(s,m!==null?m.cachePool:null),m!==null?u_(s,m):uf(),h_(s);else return u=s.lanes=536870912,lv(n,s,m!==null?m.baseLanes|o:o,o,u)}else m!==null?(Il(s,m.cachePool),u_(s,m),$i(),s.memoizedState=null):(n!==null&&Il(s,null),uf(),$i());return je(n,s,g,o),s.child}function to(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function lv(n,s,o,u,g){var m=sf();return m=m===null?null:{parent:ge._currentValue,pool:m},s.memoizedState={baseLanes:o,cachePool:m},n!==null&&Il(s,null),uf(),h_(s),n!==null&&Or(n,s,u,!0),s.childLanes=g,null}function tc(n,s){return s=nc({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function cv(n,s,o){return Ps(s,n.child,null,o),n=tc(s,s.pendingProps),n.flags|=2,dn(s),s.memoizedState=null,n}function Wx(n,s,o){var u=s.pendingProps,g=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(Nt){if(u.mode==="hidden")return n=tc(s,u),s.lanes=536870912,to(null,n);if(ff(s),(n=Jt)?(n=by(n,wn),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Gi!==null?{id:Qn,overflow:Kn}:null,retryLane:536870912,hydrationErrors:null},o=Xp(n),o.return=s,s.child=o,Re=s,Jt=null)):n=null,n===null)throw qi(s);return s.lanes=536870912,null}return tc(s,u)}var m=n.memoizedState;if(m!==null){var y=m.dehydrated;if(ff(s),g)if(s.flags&256)s.flags&=-257,s=cv(n,s,o);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(i(558));else if(pe||Or(n,s,o,!1),g=(o&n.childLanes)!==0,pe||g){if(u=Xt,u!==null&&(y=$m(u,o),y!==0&&y!==m.retryLane))throw m.retryLane=y,js(n,y),$e(u,n,y),jf;hc(),s=cv(n,s,o)}else n=m.treeContext,Jt=On(y.nextSibling),Re=s,Nt=!0,Xi=null,wn=!1,n!==null&&Qp(s,n),s=tc(s,u),s.flags|=4096;return s}return n=li(n.child,{mode:u.mode,children:u.children}),n.ref=s.ref,s.child=n,n.return=s,n}function ec(n,s){var o=s.ref;if(o===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(n===null||n.ref!==o)&&(s.flags|=4194816)}}function kf(n,s,o,u,g){return Bs(s),o=gf(n,s,o,u,void 0,g),u=mf(),n!==null&&!pe?(pf(n,s,g),gi(n,s,g)):(Nt&&u&&Wh(s),s.flags|=1,je(n,s,o,g),s.child)}function uv(n,s,o,u,g,m){return Bs(s),s.updateQueue=null,o=d_(s,u,o,g),f_(n),u=mf(),n!==null&&!pe?(pf(n,s,m),gi(n,s,m)):(Nt&&u&&Wh(s),s.flags|=1,je(n,s,o,m),s.child)}function hv(n,s,o,u,g){if(Bs(s),s.stateNode===null){var m=xr,y=o.contextType;typeof y=="object"&&y!==null&&(m=Ne(y)),m=new o(u,m),s.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Rf,s.stateNode=m,m._reactInternals=s,m=s.stateNode,m.props=u,m.state=s.memoizedState,m.refs={},af(s),y=o.contextType,m.context=typeof y=="object"&&y!==null?Ne(y):xr,m.state=s.memoizedState,y=o.getDerivedStateFromProps,typeof y=="function"&&(Mf(s,o,y,u),m.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(y=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),y!==m.state&&Rf.enqueueReplaceState(m,m.state,null),Qa(s,u,m,g),Wa(),m.state=s.memoizedState),typeof m.componentDidMount=="function"&&(s.flags|=4194308),u=!0}else if(n===null){m=s.stateNode;var C=s.memoizedProps,E=Ys(o,C);m.props=E;var L=m.context,V=o.contextType;y=xr,typeof V=="object"&&V!==null&&(y=Ne(V));var q=o.getDerivedStateFromProps;V=typeof q=="function"||typeof m.getSnapshotBeforeUpdate=="function",C=s.pendingProps!==C,V||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(C||L!==y)&&Z_(s,m,u,y),Qi=!1;var z=s.memoizedState;m.state=z,Qa(s,u,m,g),Wa(),L=s.memoizedState,C||z!==L||Qi?(typeof q=="function"&&(Mf(s,o,q,u),L=s.memoizedState),(E=Qi||K_(s,o,E,u,z,L,y))?(V||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(s.flags|=4194308)):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=L),m.props=u,m.state=L,m.context=y,u=E):(typeof m.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{m=s.stateNode,of(n,s),y=s.memoizedProps,V=Ys(o,y),m.props=V,q=s.pendingProps,z=m.context,L=o.contextType,E=xr,typeof L=="object"&&L!==null&&(E=Ne(L)),C=o.getDerivedStateFromProps,(L=typeof C=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(y!==q||z!==E)&&Z_(s,m,u,E),Qi=!1,z=s.memoizedState,m.state=z,Qa(s,u,m,g),Wa();var H=s.memoizedState;y!==q||z!==H||Qi||n!==null&&n.dependencies!==null&&zl(n.dependencies)?(typeof C=="function"&&(Mf(s,o,C,u),H=s.memoizedState),(V=Qi||K_(s,o,V,u,z,H,E)||n!==null&&n.dependencies!==null&&zl(n.dependencies))?(L||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(u,H,E),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(u,H,E)),typeof m.componentDidUpdate=="function"&&(s.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof m.componentDidUpdate!="function"||y===n.memoizedProps&&z===n.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===n.memoizedProps&&z===n.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=H),m.props=u,m.state=H,m.context=E,u=V):(typeof m.componentDidUpdate!="function"||y===n.memoizedProps&&z===n.memoizedState||(s.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||y===n.memoizedProps&&z===n.memoizedState||(s.flags|=1024),u=!1)}return m=u,ec(n,s),u=(s.flags&128)!==0,m||u?(m=s.stateNode,o=u&&typeof o.getDerivedStateFromError!="function"?null:m.render(),s.flags|=1,n!==null&&u?(s.child=Ps(s,n.child,null,g),s.child=Ps(s,null,o,g)):je(n,s,o,g),s.memoizedState=m.state,n=s.child):n=gi(n,s,g),n}function fv(n,s,o,u){return Ls(),s.flags|=256,je(n,s,o,u),s.child}var Lf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zf(n){return{baseLanes:n,cachePool:e_()}}function Bf(n,s,o){return n=n!==null?n.childLanes&~o:0,s&&(n|=mn),n}function dv(n,s,o){var u=s.pendingProps,g=!1,m=(s.flags&128)!==0,y;if((y=m)||(y=n!==null&&n.memoizedState===null?!1:(ue.current&2)!==0),y&&(g=!0,s.flags&=-129),y=(s.flags&32)!==0,s.flags&=-33,n===null){if(Nt){if(g?Ji(s):$i(),(n=Jt)?(n=by(n,wn),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Gi!==null?{id:Qn,overflow:Kn}:null,retryLane:536870912,hydrationErrors:null},o=Xp(n),o.return=s,s.child=o,Re=s,Jt=null)):n=null,n===null)throw qi(s);return yd(n)?s.lanes=32:s.lanes=536870912,null}var C=u.children;return u=u.fallback,g?($i(),g=s.mode,C=nc({mode:"hidden",children:C},g),u=ks(u,g,o,null),C.return=s,u.return=s,C.sibling=u,s.child=C,u=s.child,u.memoizedState=zf(o),u.childLanes=Bf(n,y,o),s.memoizedState=Lf,to(null,u)):(Ji(s),If(s,C))}var E=n.memoizedState;if(E!==null&&(C=E.dehydrated,C!==null)){if(m)s.flags&256?(Ji(s),s.flags&=-257,s=Ff(n,s,o)):s.memoizedState!==null?($i(),s.child=n.child,s.flags|=128,s=null):($i(),C=u.fallback,g=s.mode,u=nc({mode:"visible",children:u.children},g),C=ks(C,g,o,null),C.flags|=2,u.return=s,C.return=s,u.sibling=C,s.child=u,Ps(s,n.child,null,o),u=s.child,u.memoizedState=zf(o),u.childLanes=Bf(n,y,o),s.memoizedState=Lf,s=to(null,u));else if(Ji(s),yd(C)){if(y=C.nextSibling&&C.nextSibling.dataset,y)var L=y.dgst;y=L,u=Error(i(419)),u.stack="",u.digest=y,Ha({value:u,source:null,stack:null}),s=Ff(n,s,o)}else if(pe||Or(n,s,o,!1),y=(o&n.childLanes)!==0,pe||y){if(y=Xt,y!==null&&(u=$m(y,o),u!==0&&u!==E.retryLane))throw E.retryLane=u,js(n,u),$e(y,n,u),jf;vd(C)||hc(),s=Ff(n,s,o)}else vd(C)?(s.flags|=192,s.child=n.child,s=null):(n=E.treeContext,Jt=On(C.nextSibling),Re=s,Nt=!0,Xi=null,wn=!1,n!==null&&Qp(s,n),s=If(s,u.children),s.flags|=4096);return s}return g?($i(),C=u.fallback,g=s.mode,E=n.child,L=E.sibling,u=li(E,{mode:"hidden",children:u.children}),u.subtreeFlags=E.subtreeFlags&65011712,L!==null?C=li(L,C):(C=ks(C,g,o,null),C.flags|=2),C.return=s,u.return=s,u.sibling=C,s.child=u,to(null,u),u=s.child,C=n.child.memoizedState,C===null?C=zf(o):(g=C.cachePool,g!==null?(E=ge._currentValue,g=g.parent!==E?{parent:E,pool:E}:g):g=e_(),C={baseLanes:C.baseLanes|o,cachePool:g}),u.memoizedState=C,u.childLanes=Bf(n,y,o),s.memoizedState=Lf,to(n.child,u)):(Ji(s),o=n.child,n=o.sibling,o=li(o,{mode:"visible",children:u.children}),o.return=s,o.sibling=null,n!==null&&(y=s.deletions,y===null?(s.deletions=[n],s.flags|=16):y.push(n)),s.child=o,s.memoizedState=null,o)}function If(n,s){return s=nc({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function nc(n,s){return n=hn(22,n,null,s),n.lanes=0,n}function Ff(n,s,o){return Ps(s,n.child,null,o),n=If(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function gv(n,s,o){n.lanes|=s;var u=n.alternate;u!==null&&(u.lanes|=s),$h(n.return,s,o)}function Uf(n,s,o,u,g,m){var y=n.memoizedState;y===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:o,tailMode:g,treeForkCount:m}:(y.isBackwards=s,y.rendering=null,y.renderingStartTime=0,y.last=u,y.tail=o,y.tailMode=g,y.treeForkCount=m)}function mv(n,s,o){var u=s.pendingProps,g=u.revealOrder,m=u.tail;u=u.children;var y=ue.current,C=(y&2)!==0;if(C?(y=y&1|2,s.flags|=128):y&=1,$(ue,y),je(n,s,u,o),u=Nt?Pa:0,!C&&n!==null&&(n.flags&128)!==0)t:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&gv(n,o,s);else if(n.tag===19)gv(n,o,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break t;for(;n.sibling===null;){if(n.return===null||n.return===s)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(g){case"forwards":for(o=s.child,g=null;o!==null;)n=o.alternate,n!==null&&Vl(n)===null&&(g=o),o=o.sibling;o=g,o===null?(g=s.child,s.child=null):(g=o.sibling,o.sibling=null),Uf(s,!1,g,o,m,u);break;case"backwards":case"unstable_legacy-backwards":for(o=null,g=s.child,s.child=null;g!==null;){if(n=g.alternate,n!==null&&Vl(n)===null){s.child=g;break}n=g.sibling,g.sibling=o,o=g,g=n}Uf(s,!0,o,null,m,u);break;case"together":Uf(s,!1,null,null,void 0,u);break;default:s.memoizedState=null}return s.child}function gi(n,s,o){if(n!==null&&(s.dependencies=n.dependencies),ns|=s.lanes,(o&s.childLanes)===0)if(n!==null){if(Or(n,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(i(153));if(s.child!==null){for(n=s.child,o=li(n,n.pendingProps),s.child=o,o.return=s;n.sibling!==null;)n=n.sibling,o=o.sibling=li(n,n.pendingProps),o.return=s;o.sibling=null}return s.child}function Pf(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&zl(n)))}function Qx(n,s,o){switch(s.tag){case 3:Ae(s,s.stateNode.containerInfo),Wi(s,ge,n.memoizedState.cache),Ls();break;case 27:case 5:Xe(s);break;case 4:Ae(s,s.stateNode.containerInfo);break;case 10:Wi(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,ff(s),null;break;case 13:var u=s.memoizedState;if(u!==null)return u.dehydrated!==null?(Ji(s),s.flags|=128,null):(o&s.child.childLanes)!==0?dv(n,s,o):(Ji(s),n=gi(n,s,o),n!==null?n.sibling:null);Ji(s);break;case 19:var g=(n.flags&128)!==0;if(u=(o&s.childLanes)!==0,u||(Or(n,s,o,!1),u=(o&s.childLanes)!==0),g){if(u)return mv(n,s,o);s.flags|=128}if(g=s.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),$(ue,ue.current),u)break;return null;case 22:return s.lanes=0,ov(n,s,o,s.pendingProps);case 24:Wi(s,ge,n.memoizedState.cache)}return gi(n,s,o)}function pv(n,s,o){if(n!==null)if(n.memoizedProps!==s.pendingProps)pe=!0;else{if(!Pf(n,o)&&(s.flags&128)===0)return pe=!1,Qx(n,s,o);pe=(n.flags&131072)!==0}else pe=!1,Nt&&(s.flags&1048576)!==0&&Wp(s,Pa,s.index);switch(s.lanes=0,s.tag){case 16:t:{var u=s.pendingProps;if(n=Fs(s.elementType),s.type=n,typeof n=="function")Gh(n)?(u=Ys(n,u),s.tag=1,s=hv(null,s,n,u,o)):(s.tag=0,s=kf(null,s,n,u,o));else{if(n!=null){var g=n.$$typeof;if(g===Y){s.tag=11,s=sv(null,s,n,u,o);break t}else if(g===F){s.tag=14,s=rv(null,s,n,u,o);break t}}throw s=ct(n)||n,Error(i(306,s,""))}}return s;case 0:return kf(n,s,s.type,s.pendingProps,o);case 1:return u=s.type,g=Ys(u,s.pendingProps),hv(n,s,u,g,o);case 3:t:{if(Ae(s,s.stateNode.containerInfo),n===null)throw Error(i(387));u=s.pendingProps;var m=s.memoizedState;g=m.element,of(n,s),Qa(s,u,null,o);var y=s.memoizedState;if(u=y.cache,Wi(s,ge,u),u!==m.cache&&tf(s,[ge],o,!0),Wa(),u=y.element,m.isDehydrated)if(m={element:u,isDehydrated:!1,cache:y.cache},s.updateQueue.baseState=m,s.memoizedState=m,s.flags&256){s=fv(n,s,u,o);break t}else if(u!==g){g=Cn(Error(i(424)),s),Ha(g),s=fv(n,s,u,o);break t}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Jt=On(n.firstChild),Re=s,Nt=!0,Xi=null,wn=!0,o=o_(s,null,u,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(Ls(),u===g){s=gi(n,s,o);break t}je(n,s,u,o)}s=s.child}return s;case 26:return ec(n,s),n===null?(o=Oy(s.type,null,s.pendingProps,null))?s.memoizedState=o:Nt||(o=s.type,n=s.pendingProps,u=vc(gt.current).createElement(o),u[Me]=s,u[qe]=n,ke(u,o,n),we(u),s.stateNode=u):s.memoizedState=Oy(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return Xe(s),n===null&&Nt&&(u=s.stateNode=Ty(s.type,s.pendingProps,gt.current),Re=s,wn=!0,g=Jt,os(s.type)?(Sd=g,Jt=On(u.firstChild)):Jt=g),je(n,s,s.pendingProps.children,o),ec(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&Nt&&((g=u=Jt)&&(u=wT(u,s.type,s.pendingProps,wn),u!==null?(s.stateNode=u,Re=s,Jt=On(u.firstChild),wn=!1,g=!0):g=!1),g||qi(s)),Xe(s),g=s.type,m=s.pendingProps,y=n!==null?n.memoizedProps:null,u=m.children,md(g,m)?u=null:y!==null&&md(g,y)&&(s.flags|=32),s.memoizedState!==null&&(g=gf(n,s,Ux,null,null,o),po._currentValue=g),ec(n,s),je(n,s,u,o),s.child;case 6:return n===null&&Nt&&((n=o=Jt)&&(o=ET(o,s.pendingProps,wn),o!==null?(s.stateNode=o,Re=s,Jt=null,n=!0):n=!1),n||qi(s)),null;case 13:return dv(n,s,o);case 4:return Ae(s,s.stateNode.containerInfo),u=s.pendingProps,n===null?s.child=Ps(s,null,u,o):je(n,s,u,o),s.child;case 11:return sv(n,s,s.type,s.pendingProps,o);case 7:return je(n,s,s.pendingProps,o),s.child;case 8:return je(n,s,s.pendingProps.children,o),s.child;case 12:return je(n,s,s.pendingProps.children,o),s.child;case 10:return u=s.pendingProps,Wi(s,s.type,u.value),je(n,s,u.children,o),s.child;case 9:return g=s.type._context,u=s.pendingProps.children,Bs(s),g=Ne(g),u=u(g),s.flags|=1,je(n,s,u,o),s.child;case 14:return rv(n,s,s.type,s.pendingProps,o);case 15:return av(n,s,s.type,s.pendingProps,o);case 19:return mv(n,s,o);case 31:return Wx(n,s,o);case 22:return ov(n,s,o,s.pendingProps);case 24:return Bs(s),u=Ne(ge),n===null?(g=sf(),g===null&&(g=Xt,m=ef(),g.pooledCache=m,m.refCount++,m!==null&&(g.pooledCacheLanes|=o),g=m),s.memoizedState={parent:u,cache:g},af(s),Wi(s,ge,g)):((n.lanes&o)!==0&&(of(n,s),Qa(s,null,null,o),Wa()),g=n.memoizedState,m=s.memoizedState,g.parent!==u?(g={parent:u,cache:u},s.memoizedState=g,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=g),Wi(s,ge,u)):(u=m.cache,Wi(s,ge,u),u!==g.cache&&tf(s,[ge],o,!0))),je(n,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function mi(n){n.flags|=4}function Hf(n,s,o,u,g){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(g&335544128)===g)if(n.stateNode.complete)n.flags|=8192;else if(Yv())n.flags|=8192;else throw Us=Ul,rf}else n.flags&=-16777217}function _v(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Ny(s))if(Yv())n.flags|=8192;else throw Us=Ul,rf}function ic(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?Km():536870912,n.lanes|=s,Fr|=s)}function eo(n,s){if(!Nt)switch(n.tailMode){case"hidden":s=n.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:u.sibling=null}}function $t(n){var s=n.alternate!==null&&n.alternate.child===n.child,o=0,u=0;if(s)for(var g=n.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags&65011712,u|=g.flags&65011712,g.return=n,g=g.sibling;else for(g=n.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags,u|=g.flags,g.return=n,g=g.sibling;return n.subtreeFlags|=u,n.childLanes=o,s}function Kx(n,s,o){var u=s.pendingProps;switch(Qh(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $t(s),null;case 1:return $t(s),null;case 3:return o=s.stateNode,u=null,n!==null&&(u=n.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),hi(ge),Zt(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(n===null||n.child===null)&&(Er(s)?mi(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Zh())),$t(s),null;case 26:var g=s.type,m=s.memoizedState;return n===null?(mi(s),m!==null?($t(s),_v(s,m)):($t(s),Hf(s,g,null,u,o))):m?m!==n.memoizedState?(mi(s),$t(s),_v(s,m)):($t(s),s.flags&=-16777217):(n=n.memoizedProps,n!==u&&mi(s),$t(s),Hf(s,g,n,u,o)),null;case 27:if(gl(s),o=gt.current,g=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==u&&mi(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return $t(s),null}n=et.current,Er(s)?Kp(s):(n=Ty(g,u,o),s.stateNode=n,mi(s))}return $t(s),null;case 5:if(gl(s),g=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==u&&mi(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return $t(s),null}if(m=et.current,Er(s))Kp(s);else{var y=vc(gt.current);switch(m){case 1:m=y.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:m=y.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":m=y.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":m=y.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":m=y.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild);break;case"select":m=typeof u.is=="string"?y.createElement("select",{is:u.is}):y.createElement("select"),u.multiple?m.multiple=!0:u.size&&(m.size=u.size);break;default:m=typeof u.is=="string"?y.createElement(g,{is:u.is}):y.createElement(g)}}m[Me]=s,m[qe]=u;t:for(y=s.child;y!==null;){if(y.tag===5||y.tag===6)m.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===s)break t;for(;y.sibling===null;){if(y.return===null||y.return===s)break t;y=y.return}y.sibling.return=y.return,y=y.sibling}s.stateNode=m;t:switch(ke(m,g,u),g){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break t;case"img":u=!0;break t;default:u=!1}u&&mi(s)}}return $t(s),Hf(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,o),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==u&&mi(s);else{if(typeof u!="string"&&s.stateNode===null)throw Error(i(166));if(n=gt.current,Er(s)){if(n=s.stateNode,o=s.memoizedProps,u=null,g=Re,g!==null)switch(g.tag){case 27:case 5:u=g.memoizedProps}n[Me]=s,n=!!(n.nodeValue===o||u!==null&&u.suppressHydrationWarning===!0||dy(n.nodeValue,o)),n||qi(s,!0)}else n=vc(n).createTextNode(u),n[Me]=s,s.stateNode=n}return $t(s),null;case 31:if(o=s.memoizedState,n===null||n.memoizedState!==null){if(u=Er(s),o!==null){if(n===null){if(!u)throw Error(i(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[Me]=s}else Ls(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;$t(s),n=!1}else o=Zh(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=o),n=!0;if(!n)return s.flags&256?(dn(s),s):(dn(s),null);if((s.flags&128)!==0)throw Error(i(558))}return $t(s),null;case 13:if(u=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(g=Er(s),u!==null&&u.dehydrated!==null){if(n===null){if(!g)throw Error(i(318));if(g=s.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Me]=s}else Ls(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;$t(s),g=!1}else g=Zh(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=g),g=!0;if(!g)return s.flags&256?(dn(s),s):(dn(s),null)}return dn(s),(s.flags&128)!==0?(s.lanes=o,s):(o=u!==null,n=n!==null&&n.memoizedState!==null,o&&(u=s.child,g=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(g=u.alternate.memoizedState.cachePool.pool),m=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(m=u.memoizedState.cachePool.pool),m!==g&&(u.flags|=2048)),o!==n&&o&&(s.child.flags|=8192),ic(s,s.updateQueue),$t(s),null);case 4:return Zt(),n===null&&ud(s.stateNode.containerInfo),$t(s),null;case 10:return hi(s.type),$t(s),null;case 19:if(X(ue),u=s.memoizedState,u===null)return $t(s),null;if(g=(s.flags&128)!==0,m=u.rendering,m===null)if(g)eo(u,!1);else{if(se!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(m=Vl(n),m!==null){for(s.flags|=128,eo(u,!1),n=m.updateQueue,s.updateQueue=n,ic(s,n),s.subtreeFlags=0,n=o,o=s.child;o!==null;)Gp(o,n),o=o.sibling;return $(ue,ue.current&1|2),Nt&&ci(s,u.treeForkCount),s.child}n=n.sibling}u.tail!==null&&on()>lc&&(s.flags|=128,g=!0,eo(u,!1),s.lanes=4194304)}else{if(!g)if(n=Vl(m),n!==null){if(s.flags|=128,g=!0,n=n.updateQueue,s.updateQueue=n,ic(s,n),eo(u,!0),u.tail===null&&u.tailMode==="hidden"&&!m.alternate&&!Nt)return $t(s),null}else 2*on()-u.renderingStartTime>lc&&o!==536870912&&(s.flags|=128,g=!0,eo(u,!1),s.lanes=4194304);u.isBackwards?(m.sibling=s.child,s.child=m):(n=u.last,n!==null?n.sibling=m:s.child=m,u.last=m)}return u.tail!==null?(n=u.tail,u.rendering=n,u.tail=n.sibling,u.renderingStartTime=on(),n.sibling=null,o=ue.current,$(ue,g?o&1|2:o&1),Nt&&ci(s,u.treeForkCount),n):($t(s),null);case 22:case 23:return dn(s),hf(),u=s.memoizedState!==null,n!==null?n.memoizedState!==null!==u&&(s.flags|=8192):u&&(s.flags|=8192),u?(o&536870912)!==0&&(s.flags&128)===0&&($t(s),s.subtreeFlags&6&&(s.flags|=8192)):$t(s),o=s.updateQueue,o!==null&&ic(s,o.retryQueue),o=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),u=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),u!==o&&(s.flags|=2048),n!==null&&X(Is),null;case 24:return o=null,n!==null&&(o=n.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),hi(ge),$t(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function Zx(n,s){switch(Qh(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return hi(ge),Zt(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return gl(s),null;case 31:if(s.memoizedState!==null){if(dn(s),s.alternate===null)throw Error(i(340));Ls()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if(dn(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(i(340));Ls()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return X(ue),null;case 4:return Zt(),null;case 10:return hi(s.type),null;case 22:case 23:return dn(s),hf(),n!==null&&X(Is),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return hi(ge),null;case 25:return null;default:return null}}function vv(n,s){switch(Qh(s),s.tag){case 3:hi(ge),Zt();break;case 26:case 27:case 5:gl(s);break;case 4:Zt();break;case 31:s.memoizedState!==null&&dn(s);break;case 13:dn(s);break;case 19:X(ue);break;case 10:hi(s.type);break;case 22:case 23:dn(s),hf(),n!==null&&X(Is);break;case 24:hi(ge)}}function no(n,s){try{var o=s.updateQueue,u=o!==null?o.lastEffect:null;if(u!==null){var g=u.next;o=g;do{if((o.tag&n)===n){u=void 0;var m=o.create,y=o.inst;u=m(),y.destroy=u}o=o.next}while(o!==g)}}catch(C){Ut(s,s.return,C)}}function ts(n,s,o){try{var u=s.updateQueue,g=u!==null?u.lastEffect:null;if(g!==null){var m=g.next;u=m;do{if((u.tag&n)===n){var y=u.inst,C=y.destroy;if(C!==void 0){y.destroy=void 0,g=s;var E=o,L=C;try{L()}catch(V){Ut(g,E,V)}}}u=u.next}while(u!==m)}}catch(V){Ut(s,s.return,V)}}function yv(n){var s=n.updateQueue;if(s!==null){var o=n.stateNode;try{c_(s,o)}catch(u){Ut(n,n.return,u)}}}function Sv(n,s,o){o.props=Ys(n.type,n.memoizedProps),o.state=n.memoizedState;try{o.componentWillUnmount()}catch(u){Ut(n,s,u)}}function io(n,s){try{var o=n.ref;if(o!==null){switch(n.tag){case 26:case 27:case 5:var u=n.stateNode;break;case 30:u=n.stateNode;break;default:u=n.stateNode}typeof o=="function"?n.refCleanup=o(u):o.current=u}}catch(g){Ut(n,s,g)}}function Zn(n,s){var o=n.ref,u=n.refCleanup;if(o!==null)if(typeof u=="function")try{u()}catch(g){Ut(n,s,g)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(g){Ut(n,s,g)}else o.current=null}function bv(n){var s=n.type,o=n.memoizedProps,u=n.stateNode;try{t:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&u.focus();break t;case"img":o.src?u.src=o.src:o.srcSet&&(u.srcset=o.srcSet)}}catch(g){Ut(n,n.return,g)}}function Yf(n,s,o){try{var u=n.stateNode;yT(u,n.type,o,s),u[qe]=s}catch(g){Ut(n,n.return,g)}}function Cv(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&os(n.type)||n.tag===4}function Vf(n){t:for(;;){for(;n.sibling===null;){if(n.return===null||Cv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&os(n.type)||n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Gf(n,s,o){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(n,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(n),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=ai));else if(u!==4&&(u===27&&os(n.type)&&(o=n.stateNode,s=null),n=n.child,n!==null))for(Gf(n,s,o),n=n.sibling;n!==null;)Gf(n,s,o),n=n.sibling}function sc(n,s,o){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?o.insertBefore(n,s):o.appendChild(n);else if(u!==4&&(u===27&&os(n.type)&&(o=n.stateNode),n=n.child,n!==null))for(sc(n,s,o),n=n.sibling;n!==null;)sc(n,s,o),n=n.sibling}function xv(n){var s=n.stateNode,o=n.memoizedProps;try{for(var u=n.type,g=s.attributes;g.length;)s.removeAttributeNode(g[0]);ke(s,u,o),s[Me]=n,s[qe]=o}catch(m){Ut(n,n.return,m)}}var pi=!1,_e=!1,Xf=!1,Tv=typeof WeakSet=="function"?WeakSet:Set,Ee=null;function Jx(n,s){if(n=n.containerInfo,dd=wc,n=zp(n),Ih(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else t:{o=(o=n.ownerDocument)&&o.defaultView||window;var u=o.getSelection&&o.getSelection();if(u&&u.rangeCount!==0){o=u.anchorNode;var g=u.anchorOffset,m=u.focusNode;u=u.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break t}var y=0,C=-1,E=-1,L=0,V=0,q=n,z=null;e:for(;;){for(var H;q!==o||g!==0&&q.nodeType!==3||(C=y+g),q!==m||u!==0&&q.nodeType!==3||(E=y+u),q.nodeType===3&&(y+=q.nodeValue.length),(H=q.firstChild)!==null;)z=q,q=H;for(;;){if(q===n)break e;if(z===o&&++L===g&&(C=y),z===m&&++V===u&&(E=y),(H=q.nextSibling)!==null)break;q=z,z=q.parentNode}q=H}o=C===-1||E===-1?null:{start:C,end:E}}else o=null}o=o||{start:0,end:0}}else o=null;for(gd={focusedElem:n,selectionRange:o},wc=!1,Ee=s;Ee!==null;)if(s=Ee,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,Ee=n;else for(;Ee!==null;){switch(s=Ee,m=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(o=0;o<n.length;o++)g=n[o],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&m!==null){n=void 0,o=s,g=m.memoizedProps,m=m.memoizedState,u=o.stateNode;try{var st=Ys(o.type,g);n=u.getSnapshotBeforeUpdate(st,m),u.__reactInternalSnapshotBeforeUpdate=n}catch(ut){Ut(o,o.return,ut)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,o=n.nodeType,o===9)_d(n);else if(o===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":_d(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=s.sibling,n!==null){n.return=s.return,Ee=n;break}Ee=s.return}}function wv(n,s,o){var u=o.flags;switch(o.tag){case 0:case 11:case 15:vi(n,o),u&4&&no(5,o);break;case 1:if(vi(n,o),u&4)if(n=o.stateNode,s===null)try{n.componentDidMount()}catch(y){Ut(o,o.return,y)}else{var g=Ys(o.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(g,s,n.__reactInternalSnapshotBeforeUpdate)}catch(y){Ut(o,o.return,y)}}u&64&&yv(o),u&512&&io(o,o.return);break;case 3:if(vi(n,o),u&64&&(n=o.updateQueue,n!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{c_(n,s)}catch(y){Ut(o,o.return,y)}}break;case 27:s===null&&u&4&&xv(o);case 26:case 5:vi(n,o),s===null&&u&4&&bv(o),u&512&&io(o,o.return);break;case 12:vi(n,o);break;case 31:vi(n,o),u&4&&Dv(n,o);break;case 13:vi(n,o),u&4&&Av(n,o),u&64&&(n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(o=oT.bind(null,o),OT(n,o))));break;case 22:if(u=o.memoizedState!==null||pi,!u){s=s!==null&&s.memoizedState!==null||_e,g=pi;var m=_e;pi=u,(_e=s)&&!m?yi(n,o,(o.subtreeFlags&8772)!==0):vi(n,o),pi=g,_e=m}break;case 30:break;default:vi(n,o)}}function Ev(n){var s=n.alternate;s!==null&&(n.alternate=null,Ev(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&bh(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var te=null,Qe=!1;function _i(n,s,o){for(o=o.child;o!==null;)Ov(n,s,o),o=o.sibling}function Ov(n,s,o){if(ln&&typeof ln.onCommitFiberUnmount=="function")try{ln.onCommitFiberUnmount(Oa,o)}catch{}switch(o.tag){case 26:_e||Zn(o,s),_i(n,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:_e||Zn(o,s);var u=te,g=Qe;os(o.type)&&(te=o.stateNode,Qe=!1),_i(n,s,o),fo(o.stateNode),te=u,Qe=g;break;case 5:_e||Zn(o,s);case 6:if(u=te,g=Qe,te=null,_i(n,s,o),te=u,Qe=g,te!==null)if(Qe)try{(te.nodeType===9?te.body:te.nodeName==="HTML"?te.ownerDocument.body:te).removeChild(o.stateNode)}catch(m){Ut(o,s,m)}else try{te.removeChild(o.stateNode)}catch(m){Ut(o,s,m)}break;case 18:te!==null&&(Qe?(n=te,yy(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,o.stateNode),qr(n)):yy(te,o.stateNode));break;case 4:u=te,g=Qe,te=o.stateNode.containerInfo,Qe=!0,_i(n,s,o),te=u,Qe=g;break;case 0:case 11:case 14:case 15:ts(2,o,s),_e||ts(4,o,s),_i(n,s,o);break;case 1:_e||(Zn(o,s),u=o.stateNode,typeof u.componentWillUnmount=="function"&&Sv(o,s,u)),_i(n,s,o);break;case 21:_i(n,s,o);break;case 22:_e=(u=_e)||o.memoizedState!==null,_i(n,s,o),_e=u;break;default:_i(n,s,o)}}function Dv(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{qr(n)}catch(o){Ut(s,s.return,o)}}}function Av(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{qr(n)}catch(o){Ut(s,s.return,o)}}function $x(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new Tv),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new Tv),s;default:throw Error(i(435,n.tag))}}function rc(n,s){var o=$x(n);s.forEach(function(u){if(!o.has(u)){o.add(u);var g=lT.bind(null,n,u);u.then(g,g)}})}function Ke(n,s){var o=s.deletions;if(o!==null)for(var u=0;u<o.length;u++){var g=o[u],m=n,y=s,C=y;t:for(;C!==null;){switch(C.tag){case 27:if(os(C.type)){te=C.stateNode,Qe=!1;break t}break;case 5:te=C.stateNode,Qe=!1;break t;case 3:case 4:te=C.stateNode.containerInfo,Qe=!0;break t}C=C.return}if(te===null)throw Error(i(160));Ov(m,y,g),te=null,Qe=!1,m=g.alternate,m!==null&&(m.return=null),g.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Mv(s,n),s=s.sibling}var zn=null;function Mv(n,s){var o=n.alternate,u=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Ke(s,n),Ze(n),u&4&&(ts(3,n,n.return),no(3,n),ts(5,n,n.return));break;case 1:Ke(s,n),Ze(n),u&512&&(_e||o===null||Zn(o,o.return)),u&64&&pi&&(n=n.updateQueue,n!==null&&(u=n.callbacks,u!==null&&(o=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=o===null?u:o.concat(u))));break;case 26:var g=zn;if(Ke(s,n),Ze(n),u&512&&(_e||o===null||Zn(o,o.return)),u&4){var m=o!==null?o.memoizedState:null;if(u=n.memoizedState,o===null)if(u===null)if(n.stateNode===null){t:{u=n.type,o=n.memoizedProps,g=g.ownerDocument||g;e:switch(u){case"title":m=g.getElementsByTagName("title")[0],(!m||m[Ma]||m[Me]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=g.createElement(u),g.head.insertBefore(m,g.querySelector("head > title"))),ke(m,u,o),m[Me]=n,we(m),u=m;break t;case"link":var y=My("link","href",g).get(u+(o.href||""));if(y){for(var C=0;C<y.length;C++)if(m=y[C],m.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&m.getAttribute("rel")===(o.rel==null?null:o.rel)&&m.getAttribute("title")===(o.title==null?null:o.title)&&m.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){y.splice(C,1);break e}}m=g.createElement(u),ke(m,u,o),g.head.appendChild(m);break;case"meta":if(y=My("meta","content",g).get(u+(o.content||""))){for(C=0;C<y.length;C++)if(m=y[C],m.getAttribute("content")===(o.content==null?null:""+o.content)&&m.getAttribute("name")===(o.name==null?null:o.name)&&m.getAttribute("property")===(o.property==null?null:o.property)&&m.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&m.getAttribute("charset")===(o.charSet==null?null:o.charSet)){y.splice(C,1);break e}}m=g.createElement(u),ke(m,u,o),g.head.appendChild(m);break;default:throw Error(i(468,u))}m[Me]=n,we(m),u=m}n.stateNode=u}else Ry(g,n.type,n.stateNode);else n.stateNode=Ay(g,u,n.memoizedProps);else m!==u?(m===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):m.count--,u===null?Ry(g,n.type,n.stateNode):Ay(g,u,n.memoizedProps)):u===null&&n.stateNode!==null&&Yf(n,n.memoizedProps,o.memoizedProps)}break;case 27:Ke(s,n),Ze(n),u&512&&(_e||o===null||Zn(o,o.return)),o!==null&&u&4&&Yf(n,n.memoizedProps,o.memoizedProps);break;case 5:if(Ke(s,n),Ze(n),u&512&&(_e||o===null||Zn(o,o.return)),n.flags&32){g=n.stateNode;try{pr(g,"")}catch(st){Ut(n,n.return,st)}}u&4&&n.stateNode!=null&&(g=n.memoizedProps,Yf(n,g,o!==null?o.memoizedProps:g)),u&1024&&(Xf=!0);break;case 6:if(Ke(s,n),Ze(n),u&4){if(n.stateNode===null)throw Error(i(162));u=n.memoizedProps,o=n.stateNode;try{o.nodeValue=u}catch(st){Ut(n,n.return,st)}}break;case 3:if(bc=null,g=zn,zn=yc(s.containerInfo),Ke(s,n),zn=g,Ze(n),u&4&&o!==null&&o.memoizedState.isDehydrated)try{qr(s.containerInfo)}catch(st){Ut(n,n.return,st)}Xf&&(Xf=!1,Rv(n));break;case 4:u=zn,zn=yc(n.stateNode.containerInfo),Ke(s,n),Ze(n),zn=u;break;case 12:Ke(s,n),Ze(n);break;case 31:Ke(s,n),Ze(n),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,rc(n,u)));break;case 13:Ke(s,n),Ze(n),n.child.flags&8192&&n.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(oc=on()),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,rc(n,u)));break;case 22:g=n.memoizedState!==null;var E=o!==null&&o.memoizedState!==null,L=pi,V=_e;if(pi=L||g,_e=V||E,Ke(s,n),_e=V,pi=L,Ze(n),u&8192)t:for(s=n.stateNode,s._visibility=g?s._visibility&-2:s._visibility|1,g&&(o===null||E||pi||_e||Vs(n)),o=null,s=n;;){if(s.tag===5||s.tag===26){if(o===null){E=o=s;try{if(m=E.stateNode,g)y=m.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{C=E.stateNode;var q=E.memoizedProps.style,z=q!=null&&q.hasOwnProperty("display")?q.display:null;C.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(st){Ut(E,E.return,st)}}}else if(s.tag===6){if(o===null){E=s;try{E.stateNode.nodeValue=g?"":E.memoizedProps}catch(st){Ut(E,E.return,st)}}}else if(s.tag===18){if(o===null){E=s;try{var H=E.stateNode;g?Sy(H,!0):Sy(E.stateNode,!1)}catch(st){Ut(E,E.return,st)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break t;for(;s.sibling===null;){if(s.return===null||s.return===n)break t;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}u&4&&(u=n.updateQueue,u!==null&&(o=u.retryQueue,o!==null&&(u.retryQueue=null,rc(n,o))));break;case 19:Ke(s,n),Ze(n),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,rc(n,u)));break;case 30:break;case 21:break;default:Ke(s,n),Ze(n)}}function Ze(n){var s=n.flags;if(s&2){try{for(var o,u=n.return;u!==null;){if(Cv(u)){o=u;break}u=u.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var g=o.stateNode,m=Vf(n);sc(n,m,g);break;case 5:var y=o.stateNode;o.flags&32&&(pr(y,""),o.flags&=-33);var C=Vf(n);sc(n,C,y);break;case 3:case 4:var E=o.stateNode.containerInfo,L=Vf(n);Gf(n,L,E);break;default:throw Error(i(161))}}catch(V){Ut(n,n.return,V)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function Rv(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;Rv(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function vi(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)wv(n,s.alternate,s),s=s.sibling}function Vs(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:ts(4,s,s.return),Vs(s);break;case 1:Zn(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&Sv(s,s.return,o),Vs(s);break;case 27:fo(s.stateNode);case 26:case 5:Zn(s,s.return),Vs(s);break;case 22:s.memoizedState===null&&Vs(s);break;case 30:Vs(s);break;default:Vs(s)}n=n.sibling}}function yi(n,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var u=s.alternate,g=n,m=s,y=m.flags;switch(m.tag){case 0:case 11:case 15:yi(g,m,o),no(4,m);break;case 1:if(yi(g,m,o),u=m,g=u.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(L){Ut(u,u.return,L)}if(u=m,g=u.updateQueue,g!==null){var C=u.stateNode;try{var E=g.shared.hiddenCallbacks;if(E!==null)for(g.shared.hiddenCallbacks=null,g=0;g<E.length;g++)l_(E[g],C)}catch(L){Ut(u,u.return,L)}}o&&y&64&&yv(m),io(m,m.return);break;case 27:xv(m);case 26:case 5:yi(g,m,o),o&&u===null&&y&4&&bv(m),io(m,m.return);break;case 12:yi(g,m,o);break;case 31:yi(g,m,o),o&&y&4&&Dv(g,m);break;case 13:yi(g,m,o),o&&y&4&&Av(g,m);break;case 22:m.memoizedState===null&&yi(g,m,o),io(m,m.return);break;case 30:break;default:yi(g,m,o)}s=s.sibling}}function qf(n,s){var o=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==o&&(n!=null&&n.refCount++,o!=null&&Ya(o))}function Wf(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Ya(n))}function Bn(n,s,o,u){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Nv(n,s,o,u),s=s.sibling}function Nv(n,s,o,u){var g=s.flags;switch(s.tag){case 0:case 11:case 15:Bn(n,s,o,u),g&2048&&no(9,s);break;case 1:Bn(n,s,o,u);break;case 3:Bn(n,s,o,u),g&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&Ya(n)));break;case 12:if(g&2048){Bn(n,s,o,u),n=s.stateNode;try{var m=s.memoizedProps,y=m.id,C=m.onPostCommit;typeof C=="function"&&C(y,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(E){Ut(s,s.return,E)}}else Bn(n,s,o,u);break;case 31:Bn(n,s,o,u);break;case 13:Bn(n,s,o,u);break;case 23:break;case 22:m=s.stateNode,y=s.alternate,s.memoizedState!==null?m._visibility&2?Bn(n,s,o,u):so(n,s):m._visibility&2?Bn(n,s,o,u):(m._visibility|=2,zr(n,s,o,u,(s.subtreeFlags&10256)!==0||!1)),g&2048&&qf(y,s);break;case 24:Bn(n,s,o,u),g&2048&&Wf(s.alternate,s);break;default:Bn(n,s,o,u)}}function zr(n,s,o,u,g){for(g=g&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var m=n,y=s,C=o,E=u,L=y.flags;switch(y.tag){case 0:case 11:case 15:zr(m,y,C,E,g),no(8,y);break;case 23:break;case 22:var V=y.stateNode;y.memoizedState!==null?V._visibility&2?zr(m,y,C,E,g):so(m,y):(V._visibility|=2,zr(m,y,C,E,g)),g&&L&2048&&qf(y.alternate,y);break;case 24:zr(m,y,C,E,g),g&&L&2048&&Wf(y.alternate,y);break;default:zr(m,y,C,E,g)}s=s.sibling}}function so(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=n,u=s,g=u.flags;switch(u.tag){case 22:so(o,u),g&2048&&qf(u.alternate,u);break;case 24:so(o,u),g&2048&&Wf(u.alternate,u);break;default:so(o,u)}s=s.sibling}}var ro=8192;function Br(n,s,o){if(n.subtreeFlags&ro)for(n=n.child;n!==null;)jv(n,s,o),n=n.sibling}function jv(n,s,o){switch(n.tag){case 26:Br(n,s,o),n.flags&ro&&n.memoizedState!==null&&FT(o,zn,n.memoizedState,n.memoizedProps);break;case 5:Br(n,s,o);break;case 3:case 4:var u=zn;zn=yc(n.stateNode.containerInfo),Br(n,s,o),zn=u;break;case 22:n.memoizedState===null&&(u=n.alternate,u!==null&&u.memoizedState!==null?(u=ro,ro=16777216,Br(n,s,o),ro=u):Br(n,s,o));break;default:Br(n,s,o)}}function kv(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function ao(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var u=s[o];Ee=u,zv(u,n)}kv(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Lv(n),n=n.sibling}function Lv(n){switch(n.tag){case 0:case 11:case 15:ao(n),n.flags&2048&&ts(9,n,n.return);break;case 3:ao(n);break;case 12:ao(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,ac(n)):ao(n);break;default:ao(n)}}function ac(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var u=s[o];Ee=u,zv(u,n)}kv(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:ts(8,s,s.return),ac(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,ac(s));break;default:ac(s)}n=n.sibling}}function zv(n,s){for(;Ee!==null;){var o=Ee;switch(o.tag){case 0:case 11:case 15:ts(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var u=o.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Ya(o.memoizedState.cache)}if(u=o.child,u!==null)u.return=o,Ee=u;else t:for(o=n;Ee!==null;){u=Ee;var g=u.sibling,m=u.return;if(Ev(u),u===o){Ee=null;break t}if(g!==null){g.return=m,Ee=g;break t}Ee=m}}}var tT={getCacheForType:function(n){var s=Ne(ge),o=s.data.get(n);return o===void 0&&(o=n(),s.data.set(n,o)),o},cacheSignal:function(){return Ne(ge).controller.signal}},eT=typeof WeakMap=="function"?WeakMap:Map,Bt=0,Xt=null,wt=null,Mt=0,Ft=0,gn=null,es=!1,Ir=!1,Qf=!1,Si=0,se=0,ns=0,Gs=0,Kf=0,mn=0,Fr=0,oo=null,Je=null,Zf=!1,oc=0,Bv=0,lc=1/0,cc=null,is=null,ye=0,ss=null,Ur=null,bi=0,Jf=0,$f=null,Iv=null,lo=0,td=null;function pn(){return(Bt&2)!==0&&Mt!==0?Mt&-Mt:U.T!==null?ad():tp()}function Fv(){if(mn===0)if((Mt&536870912)===0||Nt){var n=_l;_l<<=1,(_l&3932160)===0&&(_l=262144),mn=n}else mn=536870912;return n=fn.current,n!==null&&(n.flags|=32),mn}function $e(n,s,o){(n===Xt&&(Ft===2||Ft===9)||n.cancelPendingCommit!==null)&&(Pr(n,0),rs(n,Mt,mn,!1)),Aa(n,o),((Bt&2)===0||n!==Xt)&&(n===Xt&&((Bt&2)===0&&(Gs|=o),se===4&&rs(n,Mt,mn,!1)),Jn(n))}function Uv(n,s,o){if((Bt&6)!==0)throw Error(i(327));var u=!o&&(s&127)===0&&(s&n.expiredLanes)===0||Da(n,s),g=u?sT(n,s):nd(n,s,!0),m=u;do{if(g===0){Ir&&!u&&rs(n,s,0,!1);break}else{if(o=n.current.alternate,m&&!nT(o)){g=nd(n,s,!1),m=!1;continue}if(g===2){if(m=s,n.errorRecoveryDisabledLanes&m)var y=0;else y=n.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){s=y;t:{var C=n;g=oo;var E=C.current.memoizedState.isDehydrated;if(E&&(Pr(C,y).flags|=256),y=nd(C,y,!1),y!==2){if(Qf&&!E){C.errorRecoveryDisabledLanes|=m,Gs|=m,g=4;break t}m=Je,Je=g,m!==null&&(Je===null?Je=m:Je.push.apply(Je,m))}g=y}if(m=!1,g!==2)continue}}if(g===1){Pr(n,0),rs(n,s,0,!0);break}t:{switch(u=n,m=g,m){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:rs(u,s,mn,!es);break t;case 2:Je=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(g=oc+300-on(),10<g)){if(rs(u,s,mn,!es),yl(u,0,!0)!==0)break t;bi=s,u.timeoutHandle=_y(Pv.bind(null,u,o,Je,cc,Zf,s,mn,Gs,Fr,es,m,"Throttled",-0,0),g);break t}Pv(u,o,Je,cc,Zf,s,mn,Gs,Fr,es,m,null,-0,0)}}break}while(!0);Jn(n)}function Pv(n,s,o,u,g,m,y,C,E,L,V,q,z,H){if(n.timeoutHandle=-1,q=s.subtreeFlags,q&8192||(q&16785408)===16785408){q={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ai},jv(s,m,q);var st=(m&62914560)===m?oc-on():(m&4194048)===m?Bv-on():0;if(st=UT(q,st),st!==null){bi=m,n.cancelPendingCommit=st(Qv.bind(null,n,s,m,o,u,g,y,C,E,V,q,null,z,H)),rs(n,m,y,!L);return}}Qv(n,s,m,o,u,g,y,C,E)}function nT(n){for(var s=n;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var u=0;u<o.length;u++){var g=o[u],m=g.getSnapshot;g=g.value;try{if(!un(m(),g))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function rs(n,s,o,u){s&=~Kf,s&=~Gs,n.suspendedLanes|=s,n.pingedLanes&=~s,u&&(n.warmLanes|=s),u=n.expirationTimes;for(var g=s;0<g;){var m=31-cn(g),y=1<<m;u[m]=-1,g&=~y}o!==0&&Zm(n,o,s)}function uc(){return(Bt&6)===0?(co(0),!1):!0}function ed(){if(wt!==null){if(Ft===0)var n=wt.return;else n=wt,ui=zs=null,_f(n),Rr=null,Ga=0,n=wt;for(;n!==null;)vv(n.alternate,n),n=n.return;wt=null}}function Pr(n,s){var o=n.timeoutHandle;o!==-1&&(n.timeoutHandle=-1,CT(o)),o=n.cancelPendingCommit,o!==null&&(n.cancelPendingCommit=null,o()),bi=0,ed(),Xt=n,wt=o=li(n.current,null),Mt=s,Ft=0,gn=null,es=!1,Ir=Da(n,s),Qf=!1,Fr=mn=Kf=Gs=ns=se=0,Je=oo=null,Zf=!1,(s&8)!==0&&(s|=s&32);var u=n.entangledLanes;if(u!==0)for(n=n.entanglements,u&=s;0<u;){var g=31-cn(u),m=1<<g;s|=n[g],u&=~m}return Si=s,Rl(),o}function Hv(n,s){yt=null,U.H=$a,s===Mr||s===Fl?(s=s_(),Ft=3):s===rf?(s=s_(),Ft=4):Ft=s===jf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,gn=s,wt===null&&(se=1,$l(n,Cn(s,n.current)))}function Yv(){var n=fn.current;return n===null?!0:(Mt&4194048)===Mt?En===null:(Mt&62914560)===Mt||(Mt&536870912)!==0?n===En:!1}function Vv(){var n=U.H;return U.H=$a,n===null?$a:n}function Gv(){var n=U.A;return U.A=tT,n}function hc(){se=4,es||(Mt&4194048)!==Mt&&fn.current!==null||(Ir=!0),(ns&134217727)===0&&(Gs&134217727)===0||Xt===null||rs(Xt,Mt,mn,!1)}function nd(n,s,o){var u=Bt;Bt|=2;var g=Vv(),m=Gv();(Xt!==n||Mt!==s)&&(cc=null,Pr(n,s)),s=!1;var y=se;t:do try{if(Ft!==0&&wt!==null){var C=wt,E=gn;switch(Ft){case 8:ed(),y=6;break t;case 3:case 2:case 9:case 6:fn.current===null&&(s=!0);var L=Ft;if(Ft=0,gn=null,Hr(n,C,E,L),o&&Ir){y=0;break t}break;default:L=Ft,Ft=0,gn=null,Hr(n,C,E,L)}}iT(),y=se;break}catch(V){Hv(n,V)}while(!0);return s&&n.shellSuspendCounter++,ui=zs=null,Bt=u,U.H=g,U.A=m,wt===null&&(Xt=null,Mt=0,Rl()),y}function iT(){for(;wt!==null;)Xv(wt)}function sT(n,s){var o=Bt;Bt|=2;var u=Vv(),g=Gv();Xt!==n||Mt!==s?(cc=null,lc=on()+500,Pr(n,s)):Ir=Da(n,s);t:do try{if(Ft!==0&&wt!==null){s=wt;var m=gn;e:switch(Ft){case 1:Ft=0,gn=null,Hr(n,s,m,1);break;case 2:case 9:if(n_(m)){Ft=0,gn=null,qv(s);break}s=function(){Ft!==2&&Ft!==9||Xt!==n||(Ft=7),Jn(n)},m.then(s,s);break t;case 3:Ft=7;break t;case 4:Ft=5;break t;case 7:n_(m)?(Ft=0,gn=null,qv(s)):(Ft=0,gn=null,Hr(n,s,m,7));break;case 5:var y=null;switch(wt.tag){case 26:y=wt.memoizedState;case 5:case 27:var C=wt;if(y?Ny(y):C.stateNode.complete){Ft=0,gn=null;var E=C.sibling;if(E!==null)wt=E;else{var L=C.return;L!==null?(wt=L,fc(L)):wt=null}break e}}Ft=0,gn=null,Hr(n,s,m,5);break;case 6:Ft=0,gn=null,Hr(n,s,m,6);break;case 8:ed(),se=6;break t;default:throw Error(i(462))}}rT();break}catch(V){Hv(n,V)}while(!0);return ui=zs=null,U.H=u,U.A=g,Bt=o,wt!==null?0:(Xt=null,Mt=0,Rl(),se)}function rT(){for(;wt!==null&&!D1();)Xv(wt)}function Xv(n){var s=pv(n.alternate,n,Si);n.memoizedProps=n.pendingProps,s===null?fc(n):wt=s}function qv(n){var s=n,o=s.alternate;switch(s.tag){case 15:case 0:s=uv(o,s,s.pendingProps,s.type,void 0,Mt);break;case 11:s=uv(o,s,s.pendingProps,s.type.render,s.ref,Mt);break;case 5:_f(s);default:vv(o,s),s=wt=Gp(s,Si),s=pv(o,s,Si)}n.memoizedProps=n.pendingProps,s===null?fc(n):wt=s}function Hr(n,s,o,u){ui=zs=null,_f(s),Rr=null,Ga=0;var g=s.return;try{if(qx(n,g,s,o,Mt)){se=1,$l(n,Cn(o,n.current)),wt=null;return}}catch(m){if(g!==null)throw wt=g,m;se=1,$l(n,Cn(o,n.current)),wt=null;return}s.flags&32768?(Nt||u===1?n=!0:Ir||(Mt&536870912)!==0?n=!1:(es=n=!0,(u===2||u===9||u===3||u===6)&&(u=fn.current,u!==null&&u.tag===13&&(u.flags|=16384))),Wv(s,n)):fc(s)}function fc(n){var s=n;do{if((s.flags&32768)!==0){Wv(s,es);return}n=s.return;var o=Kx(s.alternate,s,Si);if(o!==null){wt=o;return}if(s=s.sibling,s!==null){wt=s;return}wt=s=n}while(s!==null);se===0&&(se=5)}function Wv(n,s){do{var o=Zx(n.alternate,n);if(o!==null){o.flags&=32767,wt=o;return}if(o=n.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(n=n.sibling,n!==null)){wt=n;return}wt=n=o}while(n!==null);se=6,wt=null}function Qv(n,s,o,u,g,m,y,C,E){n.cancelPendingCommit=null;do dc();while(ye!==0);if((Bt&6)!==0)throw Error(i(327));if(s!==null){if(s===n.current)throw Error(i(177));if(m=s.lanes|s.childLanes,m|=Yh,I1(n,o,m,y,C,E),n===Xt&&(wt=Xt=null,Mt=0),Ur=s,ss=n,bi=o,Jf=m,$f=g,Iv=u,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,cT(ml,function(){return ty(),null})):(n.callbackNode=null,n.callbackPriority=0),u=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||u){u=U.T,U.T=null,g=W.p,W.p=2,y=Bt,Bt|=4;try{Jx(n,s,o)}finally{Bt=y,W.p=g,U.T=u}}ye=1,Kv(),Zv(),Jv()}}function Kv(){if(ye===1){ye=0;var n=ss,s=Ur,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=U.T,U.T=null;var u=W.p;W.p=2;var g=Bt;Bt|=4;try{Mv(s,n);var m=gd,y=zp(n.containerInfo),C=m.focusedElem,E=m.selectionRange;if(y!==C&&C&&C.ownerDocument&&Lp(C.ownerDocument.documentElement,C)){if(E!==null&&Ih(C)){var L=E.start,V=E.end;if(V===void 0&&(V=L),"selectionStart"in C)C.selectionStart=L,C.selectionEnd=Math.min(V,C.value.length);else{var q=C.ownerDocument||document,z=q&&q.defaultView||window;if(z.getSelection){var H=z.getSelection(),st=C.textContent.length,ut=Math.min(E.start,st),Vt=E.end===void 0?ut:Math.min(E.end,st);!H.extend&&ut>Vt&&(y=Vt,Vt=ut,ut=y);var R=kp(C,ut),O=kp(C,Vt);if(R&&O&&(H.rangeCount!==1||H.anchorNode!==R.node||H.anchorOffset!==R.offset||H.focusNode!==O.node||H.focusOffset!==O.offset)){var k=q.createRange();k.setStart(R.node,R.offset),H.removeAllRanges(),ut>Vt?(H.addRange(k),H.extend(O.node,O.offset)):(k.setEnd(O.node,O.offset),H.addRange(k))}}}}for(q=[],H=C;H=H.parentNode;)H.nodeType===1&&q.push({element:H,left:H.scrollLeft,top:H.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<q.length;C++){var G=q[C];G.element.scrollLeft=G.left,G.element.scrollTop=G.top}}wc=!!dd,gd=dd=null}finally{Bt=g,W.p=u,U.T=o}}n.current=s,ye=2}}function Zv(){if(ye===2){ye=0;var n=ss,s=Ur,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=U.T,U.T=null;var u=W.p;W.p=2;var g=Bt;Bt|=4;try{wv(n,s.alternate,s)}finally{Bt=g,W.p=u,U.T=o}}ye=3}}function Jv(){if(ye===4||ye===3){ye=0,A1();var n=ss,s=Ur,o=bi,u=Iv;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ye=5:(ye=0,Ur=ss=null,$v(n,n.pendingLanes));var g=n.pendingLanes;if(g===0&&(is=null),yh(o),s=s.stateNode,ln&&typeof ln.onCommitFiberRoot=="function")try{ln.onCommitFiberRoot(Oa,s,void 0,(s.current.flags&128)===128)}catch{}if(u!==null){s=U.T,g=W.p,W.p=2,U.T=null;try{for(var m=n.onRecoverableError,y=0;y<u.length;y++){var C=u[y];m(C.value,{componentStack:C.stack})}}finally{U.T=s,W.p=g}}(bi&3)!==0&&dc(),Jn(n),g=n.pendingLanes,(o&261930)!==0&&(g&42)!==0?n===td?lo++:(lo=0,td=n):lo=0,co(0)}}function $v(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,Ya(s)))}function dc(){return Kv(),Zv(),Jv(),ty()}function ty(){if(ye!==5)return!1;var n=ss,s=Jf;Jf=0;var o=yh(bi),u=U.T,g=W.p;try{W.p=32>o?32:o,U.T=null,o=$f,$f=null;var m=ss,y=bi;if(ye=0,Ur=ss=null,bi=0,(Bt&6)!==0)throw Error(i(331));var C=Bt;if(Bt|=4,Lv(m.current),Nv(m,m.current,y,o),Bt=C,co(0,!1),ln&&typeof ln.onPostCommitFiberRoot=="function")try{ln.onPostCommitFiberRoot(Oa,m)}catch{}return!0}finally{W.p=g,U.T=u,$v(n,s)}}function ey(n,s,o){s=Cn(o,s),s=Nf(n.stateNode,s,2),n=Zi(n,s,2),n!==null&&(Aa(n,2),Jn(n))}function Ut(n,s,o){if(n.tag===3)ey(n,n,o);else for(;s!==null;){if(s.tag===3){ey(s,n,o);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(is===null||!is.has(u))){n=Cn(o,n),o=nv(2),u=Zi(s,o,2),u!==null&&(iv(o,u,s,n),Aa(u,2),Jn(u));break}}s=s.return}}function id(n,s,o){var u=n.pingCache;if(u===null){u=n.pingCache=new eT;var g=new Set;u.set(s,g)}else g=u.get(s),g===void 0&&(g=new Set,u.set(s,g));g.has(o)||(Qf=!0,g.add(o),n=aT.bind(null,n,s,o),s.then(n,n))}function aT(n,s,o){var u=n.pingCache;u!==null&&u.delete(s),n.pingedLanes|=n.suspendedLanes&o,n.warmLanes&=~o,Xt===n&&(Mt&o)===o&&(se===4||se===3&&(Mt&62914560)===Mt&&300>on()-oc?(Bt&2)===0&&Pr(n,0):Kf|=o,Fr===Mt&&(Fr=0)),Jn(n)}function ny(n,s){s===0&&(s=Km()),n=js(n,s),n!==null&&(Aa(n,s),Jn(n))}function oT(n){var s=n.memoizedState,o=0;s!==null&&(o=s.retryLane),ny(n,o)}function lT(n,s){var o=0;switch(n.tag){case 31:case 13:var u=n.stateNode,g=n.memoizedState;g!==null&&(o=g.retryLane);break;case 19:u=n.stateNode;break;case 22:u=n.stateNode._retryCache;break;default:throw Error(i(314))}u!==null&&u.delete(s),ny(n,o)}function cT(n,s){return mh(n,s)}var gc=null,Yr=null,sd=!1,mc=!1,rd=!1,as=0;function Jn(n){n!==Yr&&n.next===null&&(Yr===null?gc=Yr=n:Yr=Yr.next=n),mc=!0,sd||(sd=!0,hT())}function co(n,s){if(!rd&&mc){rd=!0;do for(var o=!1,u=gc;u!==null;){if(n!==0){var g=u.pendingLanes;if(g===0)var m=0;else{var y=u.suspendedLanes,C=u.pingedLanes;m=(1<<31-cn(42|n)+1)-1,m&=g&~(y&~C),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(o=!0,ay(u,m))}else m=Mt,m=yl(u,u===Xt?m:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(m&3)===0||Da(u,m)||(o=!0,ay(u,m));u=u.next}while(o);rd=!1}}function uT(){iy()}function iy(){mc=sd=!1;var n=0;as!==0&&bT()&&(n=as);for(var s=on(),o=null,u=gc;u!==null;){var g=u.next,m=sy(u,s);m===0?(u.next=null,o===null?gc=g:o.next=g,g===null&&(Yr=o)):(o=u,(n!==0||(m&3)!==0)&&(mc=!0)),u=g}ye!==0&&ye!==5||co(n),as!==0&&(as=0)}function sy(n,s){for(var o=n.suspendedLanes,u=n.pingedLanes,g=n.expirationTimes,m=n.pendingLanes&-62914561;0<m;){var y=31-cn(m),C=1<<y,E=g[y];E===-1?((C&o)===0||(C&u)!==0)&&(g[y]=B1(C,s)):E<=s&&(n.expiredLanes|=C),m&=~C}if(s=Xt,o=Mt,o=yl(n,n===s?o:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u=n.callbackNode,o===0||n===s&&(Ft===2||Ft===9)||n.cancelPendingCommit!==null)return u!==null&&u!==null&&ph(u),n.callbackNode=null,n.callbackPriority=0;if((o&3)===0||Da(n,o)){if(s=o&-o,s===n.callbackPriority)return s;switch(u!==null&&ph(u),yh(o)){case 2:case 8:o=Wm;break;case 32:o=ml;break;case 268435456:o=Qm;break;default:o=ml}return u=ry.bind(null,n),o=mh(o,u),n.callbackPriority=s,n.callbackNode=o,s}return u!==null&&u!==null&&ph(u),n.callbackPriority=2,n.callbackNode=null,2}function ry(n,s){if(ye!==0&&ye!==5)return n.callbackNode=null,n.callbackPriority=0,null;var o=n.callbackNode;if(dc()&&n.callbackNode!==o)return null;var u=Mt;return u=yl(n,n===Xt?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u===0?null:(Uv(n,u,s),sy(n,on()),n.callbackNode!=null&&n.callbackNode===o?ry.bind(null,n):null)}function ay(n,s){if(dc())return null;Uv(n,s,!0)}function hT(){xT(function(){(Bt&6)!==0?mh(qm,uT):iy()})}function ad(){if(as===0){var n=Dr;n===0&&(n=pl,pl<<=1,(pl&261888)===0&&(pl=256)),as=n}return as}function oy(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:xl(""+n)}function ly(n,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,n.id&&o.setAttribute("form",n.id),s.parentNode.insertBefore(o,s),n=new FormData(n),o.parentNode.removeChild(o),n}function fT(n,s,o,u,g){if(s==="submit"&&o&&o.stateNode===g){var m=oy((g[qe]||null).action),y=u.submitter;y&&(s=(s=y[qe]||null)?oy(s.formAction):y.getAttribute("formAction"),s!==null&&(m=s,y=null));var C=new Ol("action","action",null,u,g);n.push({event:C,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(as!==0){var E=y?ly(g,y):new FormData(g);Ef(o,{pending:!0,data:E,method:g.method,action:m},null,E)}}else typeof m=="function"&&(C.preventDefault(),E=y?ly(g,y):new FormData(g),Ef(o,{pending:!0,data:E,method:g.method,action:m},m,E))},currentTarget:g}]})}}for(var od=0;od<Hh.length;od++){var ld=Hh[od],dT=ld.toLowerCase(),gT=ld[0].toUpperCase()+ld.slice(1);Ln(dT,"on"+gT)}Ln(Fp,"onAnimationEnd"),Ln(Up,"onAnimationIteration"),Ln(Pp,"onAnimationStart"),Ln("dblclick","onDoubleClick"),Ln("focusin","onFocus"),Ln("focusout","onBlur"),Ln(Mx,"onTransitionRun"),Ln(Rx,"onTransitionStart"),Ln(Nx,"onTransitionCancel"),Ln(Hp,"onTransitionEnd"),gr("onMouseEnter",["mouseout","mouseover"]),gr("onMouseLeave",["mouseout","mouseover"]),gr("onPointerEnter",["pointerout","pointerover"]),gr("onPointerLeave",["pointerout","pointerover"]),As("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),As("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),As("onBeforeInput",["compositionend","keypress","textInput","paste"]),As("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),As("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),As("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var uo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(uo));function cy(n,s){s=(s&4)!==0;for(var o=0;o<n.length;o++){var u=n[o],g=u.event;u=u.listeners;t:{var m=void 0;if(s)for(var y=u.length-1;0<=y;y--){var C=u[y],E=C.instance,L=C.currentTarget;if(C=C.listener,E!==m&&g.isPropagationStopped())break t;m=C,g.currentTarget=L;try{m(g)}catch(V){Ml(V)}g.currentTarget=null,m=E}else for(y=0;y<u.length;y++){if(C=u[y],E=C.instance,L=C.currentTarget,C=C.listener,E!==m&&g.isPropagationStopped())break t;m=C,g.currentTarget=L;try{m(g)}catch(V){Ml(V)}g.currentTarget=null,m=E}}}}function Et(n,s){var o=s[Sh];o===void 0&&(o=s[Sh]=new Set);var u=n+"__bubble";o.has(u)||(uy(s,n,2,!1),o.add(u))}function cd(n,s,o){var u=0;s&&(u|=4),uy(o,n,u,s)}var pc="_reactListening"+Math.random().toString(36).slice(2);function ud(n){if(!n[pc]){n[pc]=!0,ip.forEach(function(o){o!=="selectionchange"&&(mT.has(o)||cd(o,!1,n),cd(o,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[pc]||(s[pc]=!0,cd("selectionchange",!1,s))}}function uy(n,s,o,u){switch(Fy(s)){case 2:var g=YT;break;case 8:g=VT;break;default:g=wd}o=g.bind(null,s,o,n),g=void 0,!Ah||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(g=!0),u?g!==void 0?n.addEventListener(s,o,{capture:!0,passive:g}):n.addEventListener(s,o,!0):g!==void 0?n.addEventListener(s,o,{passive:g}):n.addEventListener(s,o,!1)}function hd(n,s,o,u,g){var m=u;if((s&1)===0&&(s&2)===0&&u!==null)t:for(;;){if(u===null)return;var y=u.tag;if(y===3||y===4){var C=u.stateNode.containerInfo;if(C===g)break;if(y===4)for(y=u.return;y!==null;){var E=y.tag;if((E===3||E===4)&&y.stateNode.containerInfo===g)return;y=y.return}for(;C!==null;){if(y=hr(C),y===null)return;if(E=y.tag,E===5||E===6||E===26||E===27){u=m=y;continue t}C=C.parentNode}}u=u.return}mp(function(){var L=m,V=Oh(o),q=[];t:{var z=Yp.get(n);if(z!==void 0){var H=Ol,st=n;switch(n){case"keypress":if(wl(o)===0)break t;case"keydown":case"keyup":H=lx;break;case"focusin":st="focus",H=jh;break;case"focusout":st="blur",H=jh;break;case"beforeblur":case"afterblur":H=jh;break;case"click":if(o.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=vp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=K1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=hx;break;case Fp:case Up:case Pp:H=$1;break;case Hp:H=dx;break;case"scroll":case"scrollend":H=W1;break;case"wheel":H=mx;break;case"copy":case"cut":case"paste":H=ex;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=Sp;break;case"toggle":case"beforetoggle":H=_x}var ut=(s&4)!==0,Vt=!ut&&(n==="scroll"||n==="scrollend"),R=ut?z!==null?z+"Capture":null:z;ut=[];for(var O=L,k;O!==null;){var G=O;if(k=G.stateNode,G=G.tag,G!==5&&G!==26&&G!==27||k===null||R===null||(G=Na(O,R),G!=null&&ut.push(ho(O,G,k))),Vt)break;O=O.return}0<ut.length&&(z=new H(z,st,null,o,V),q.push({event:z,listeners:ut}))}}if((s&7)===0){t:{if(z=n==="mouseover"||n==="pointerover",H=n==="mouseout"||n==="pointerout",z&&o!==Eh&&(st=o.relatedTarget||o.fromElement)&&(hr(st)||st[ur]))break t;if((H||z)&&(z=V.window===V?V:(z=V.ownerDocument)?z.defaultView||z.parentWindow:window,H?(st=o.relatedTarget||o.toElement,H=L,st=st?hr(st):null,st!==null&&(Vt=l(st),ut=st.tag,st!==Vt||ut!==5&&ut!==27&&ut!==6)&&(st=null)):(H=null,st=L),H!==st)){if(ut=vp,G="onMouseLeave",R="onMouseEnter",O="mouse",(n==="pointerout"||n==="pointerover")&&(ut=Sp,G="onPointerLeave",R="onPointerEnter",O="pointer"),Vt=H==null?z:Ra(H),k=st==null?z:Ra(st),z=new ut(G,O+"leave",H,o,V),z.target=Vt,z.relatedTarget=k,G=null,hr(V)===L&&(ut=new ut(R,O+"enter",st,o,V),ut.target=k,ut.relatedTarget=Vt,G=ut),Vt=G,H&&st)e:{for(ut=pT,R=H,O=st,k=0,G=R;G;G=ut(G))k++;G=0;for(var lt=O;lt;lt=ut(lt))G++;for(;0<k-G;)R=ut(R),k--;for(;0<G-k;)O=ut(O),G--;for(;k--;){if(R===O||O!==null&&R===O.alternate){ut=R;break e}R=ut(R),O=ut(O)}ut=null}else ut=null;H!==null&&hy(q,z,H,ut,!1),st!==null&&Vt!==null&&hy(q,Vt,st,ut,!0)}}t:{if(z=L?Ra(L):window,H=z.nodeName&&z.nodeName.toLowerCase(),H==="select"||H==="input"&&z.type==="file")var kt=Dp;else if(Ep(z))if(Ap)kt=Ox;else{kt=wx;var at=Tx}else H=z.nodeName,!H||H.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?L&&wh(L.elementType)&&(kt=Dp):kt=Ex;if(kt&&(kt=kt(n,L))){Op(q,kt,o,V);break t}at&&at(n,z,L),n==="focusout"&&L&&z.type==="number"&&L.memoizedProps.value!=null&&Th(z,"number",z.value)}switch(at=L?Ra(L):window,n){case"focusin":(Ep(at)||at.contentEditable==="true")&&(Sr=at,Fh=L,Ua=null);break;case"focusout":Ua=Fh=Sr=null;break;case"mousedown":Uh=!0;break;case"contextmenu":case"mouseup":case"dragend":Uh=!1,Bp(q,o,V);break;case"selectionchange":if(Ax)break;case"keydown":case"keyup":Bp(q,o,V)}var St;if(Lh)t:{switch(n){case"compositionstart":var Rt="onCompositionStart";break t;case"compositionend":Rt="onCompositionEnd";break t;case"compositionupdate":Rt="onCompositionUpdate";break t}Rt=void 0}else yr?Tp(n,o)&&(Rt="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(Rt="onCompositionStart");Rt&&(bp&&o.locale!=="ko"&&(yr||Rt!=="onCompositionStart"?Rt==="onCompositionEnd"&&yr&&(St=pp()):(Vi=V,Mh="value"in Vi?Vi.value:Vi.textContent,yr=!0)),at=_c(L,Rt),0<at.length&&(Rt=new yp(Rt,n,null,o,V),q.push({event:Rt,listeners:at}),St?Rt.data=St:(St=wp(o),St!==null&&(Rt.data=St)))),(St=yx?Sx(n,o):bx(n,o))&&(Rt=_c(L,"onBeforeInput"),0<Rt.length&&(at=new yp("onBeforeInput","beforeinput",null,o,V),q.push({event:at,listeners:Rt}),at.data=St)),fT(q,n,L,o,V)}cy(q,s)})}function ho(n,s,o){return{instance:n,listener:s,currentTarget:o}}function _c(n,s){for(var o=s+"Capture",u=[];n!==null;){var g=n,m=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||m===null||(g=Na(n,o),g!=null&&u.unshift(ho(n,g,m)),g=Na(n,s),g!=null&&u.push(ho(n,g,m))),n.tag===3)return u;n=n.return}return[]}function pT(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function hy(n,s,o,u,g){for(var m=s._reactName,y=[];o!==null&&o!==u;){var C=o,E=C.alternate,L=C.stateNode;if(C=C.tag,E!==null&&E===u)break;C!==5&&C!==26&&C!==27||L===null||(E=L,g?(L=Na(o,m),L!=null&&y.unshift(ho(o,L,E))):g||(L=Na(o,m),L!=null&&y.push(ho(o,L,E)))),o=o.return}y.length!==0&&n.push({event:s,listeners:y})}var _T=/\r\n?/g,vT=/\u0000|\uFFFD/g;function fy(n){return(typeof n=="string"?n:""+n).replace(_T,`
`).replace(vT,"")}function dy(n,s){return s=fy(s),fy(n)===s}function Yt(n,s,o,u,g,m){switch(o){case"children":typeof u=="string"?s==="body"||s==="textarea"&&u===""||pr(n,u):(typeof u=="number"||typeof u=="bigint")&&s!=="body"&&pr(n,""+u);break;case"className":bl(n,"class",u);break;case"tabIndex":bl(n,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":bl(n,o,u);break;case"style":dp(n,u,m);break;case"data":if(s!=="object"){bl(n,"data",u);break}case"src":case"href":if(u===""&&(s!=="a"||o!=="href")){n.removeAttribute(o);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(o);break}u=xl(""+u),n.setAttribute(o,u);break;case"action":case"formAction":if(typeof u=="function"){n.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(o==="formAction"?(s!=="input"&&Yt(n,s,"name",g.name,g,null),Yt(n,s,"formEncType",g.formEncType,g,null),Yt(n,s,"formMethod",g.formMethod,g,null),Yt(n,s,"formTarget",g.formTarget,g,null)):(Yt(n,s,"encType",g.encType,g,null),Yt(n,s,"method",g.method,g,null),Yt(n,s,"target",g.target,g,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(o);break}u=xl(""+u),n.setAttribute(o,u);break;case"onClick":u!=null&&(n.onclick=ai);break;case"onScroll":u!=null&&Et("scroll",n);break;case"onScrollEnd":u!=null&&Et("scrollend",n);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(o=u.__html,o!=null){if(g.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"multiple":n.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":n.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){n.removeAttribute("xlink:href");break}o=xl(""+u),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(o,""+u):n.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(o,""):n.removeAttribute(o);break;case"capture":case"download":u===!0?n.setAttribute(o,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(o,u):n.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?n.setAttribute(o,u):n.removeAttribute(o);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?n.removeAttribute(o):n.setAttribute(o,u);break;case"popover":Et("beforetoggle",n),Et("toggle",n),Sl(n,"popover",u);break;case"xlinkActuate":ri(n,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":ri(n,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":ri(n,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":ri(n,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":ri(n,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":ri(n,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":ri(n,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":ri(n,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":ri(n,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Sl(n,"is",u);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=X1.get(o)||o,Sl(n,o,u))}}function fd(n,s,o,u,g,m){switch(o){case"style":dp(n,u,m);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(o=u.__html,o!=null){if(g.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"children":typeof u=="string"?pr(n,u):(typeof u=="number"||typeof u=="bigint")&&pr(n,""+u);break;case"onScroll":u!=null&&Et("scroll",n);break;case"onScrollEnd":u!=null&&Et("scrollend",n);break;case"onClick":u!=null&&(n.onclick=ai);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!sp.hasOwnProperty(o))t:{if(o[0]==="o"&&o[1]==="n"&&(g=o.endsWith("Capture"),s=o.slice(2,g?o.length-7:void 0),m=n[qe]||null,m=m!=null?m[o]:null,typeof m=="function"&&n.removeEventListener(s,m,g),typeof u=="function")){typeof m!="function"&&m!==null&&(o in n?n[o]=null:n.hasAttribute(o)&&n.removeAttribute(o)),n.addEventListener(s,u,g);break t}o in n?n[o]=u:u===!0?n.setAttribute(o,""):Sl(n,o,u)}}}function ke(n,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Et("error",n),Et("load",n);var u=!1,g=!1,m;for(m in o)if(o.hasOwnProperty(m)){var y=o[m];if(y!=null)switch(m){case"src":u=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Yt(n,s,m,y,o,null)}}g&&Yt(n,s,"srcSet",o.srcSet,o,null),u&&Yt(n,s,"src",o.src,o,null);return;case"input":Et("invalid",n);var C=m=y=g=null,E=null,L=null;for(u in o)if(o.hasOwnProperty(u)){var V=o[u];if(V!=null)switch(u){case"name":g=V;break;case"type":y=V;break;case"checked":E=V;break;case"defaultChecked":L=V;break;case"value":m=V;break;case"defaultValue":C=V;break;case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(i(137,s));break;default:Yt(n,s,u,V,o,null)}}cp(n,m,C,E,L,y,g,!1);return;case"select":Et("invalid",n),u=y=m=null;for(g in o)if(o.hasOwnProperty(g)&&(C=o[g],C!=null))switch(g){case"value":m=C;break;case"defaultValue":y=C;break;case"multiple":u=C;default:Yt(n,s,g,C,o,null)}s=m,o=y,n.multiple=!!u,s!=null?mr(n,!!u,s,!1):o!=null&&mr(n,!!u,o,!0);return;case"textarea":Et("invalid",n),m=g=u=null;for(y in o)if(o.hasOwnProperty(y)&&(C=o[y],C!=null))switch(y){case"value":u=C;break;case"defaultValue":g=C;break;case"children":m=C;break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(i(91));break;default:Yt(n,s,y,C,o,null)}hp(n,u,g,m);return;case"option":for(E in o)if(o.hasOwnProperty(E)&&(u=o[E],u!=null))switch(E){case"selected":n.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:Yt(n,s,E,u,o,null)}return;case"dialog":Et("beforetoggle",n),Et("toggle",n),Et("cancel",n),Et("close",n);break;case"iframe":case"object":Et("load",n);break;case"video":case"audio":for(u=0;u<uo.length;u++)Et(uo[u],n);break;case"image":Et("error",n),Et("load",n);break;case"details":Et("toggle",n);break;case"embed":case"source":case"link":Et("error",n),Et("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(L in o)if(o.hasOwnProperty(L)&&(u=o[L],u!=null))switch(L){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Yt(n,s,L,u,o,null)}return;default:if(wh(s)){for(V in o)o.hasOwnProperty(V)&&(u=o[V],u!==void 0&&fd(n,s,V,u,o,void 0));return}}for(C in o)o.hasOwnProperty(C)&&(u=o[C],u!=null&&Yt(n,s,C,u,o,null))}function yT(n,s,o,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,m=null,y=null,C=null,E=null,L=null,V=null;for(H in o){var q=o[H];if(o.hasOwnProperty(H)&&q!=null)switch(H){case"checked":break;case"value":break;case"defaultValue":E=q;default:u.hasOwnProperty(H)||Yt(n,s,H,null,u,q)}}for(var z in u){var H=u[z];if(q=o[z],u.hasOwnProperty(z)&&(H!=null||q!=null))switch(z){case"type":m=H;break;case"name":g=H;break;case"checked":L=H;break;case"defaultChecked":V=H;break;case"value":y=H;break;case"defaultValue":C=H;break;case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(i(137,s));break;default:H!==q&&Yt(n,s,z,H,u,q)}}xh(n,y,C,E,L,V,m,g);return;case"select":H=y=C=z=null;for(m in o)if(E=o[m],o.hasOwnProperty(m)&&E!=null)switch(m){case"value":break;case"multiple":H=E;default:u.hasOwnProperty(m)||Yt(n,s,m,null,u,E)}for(g in u)if(m=u[g],E=o[g],u.hasOwnProperty(g)&&(m!=null||E!=null))switch(g){case"value":z=m;break;case"defaultValue":C=m;break;case"multiple":y=m;default:m!==E&&Yt(n,s,g,m,u,E)}s=C,o=y,u=H,z!=null?mr(n,!!o,z,!1):!!u!=!!o&&(s!=null?mr(n,!!o,s,!0):mr(n,!!o,o?[]:"",!1));return;case"textarea":H=z=null;for(C in o)if(g=o[C],o.hasOwnProperty(C)&&g!=null&&!u.hasOwnProperty(C))switch(C){case"value":break;case"children":break;default:Yt(n,s,C,null,u,g)}for(y in u)if(g=u[y],m=o[y],u.hasOwnProperty(y)&&(g!=null||m!=null))switch(y){case"value":z=g;break;case"defaultValue":H=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==m&&Yt(n,s,y,g,u,m)}up(n,z,H);return;case"option":for(var st in o)if(z=o[st],o.hasOwnProperty(st)&&z!=null&&!u.hasOwnProperty(st))switch(st){case"selected":n.selected=!1;break;default:Yt(n,s,st,null,u,z)}for(E in u)if(z=u[E],H=o[E],u.hasOwnProperty(E)&&z!==H&&(z!=null||H!=null))switch(E){case"selected":n.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:Yt(n,s,E,z,u,H)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ut in o)z=o[ut],o.hasOwnProperty(ut)&&z!=null&&!u.hasOwnProperty(ut)&&Yt(n,s,ut,null,u,z);for(L in u)if(z=u[L],H=o[L],u.hasOwnProperty(L)&&z!==H&&(z!=null||H!=null))switch(L){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(i(137,s));break;default:Yt(n,s,L,z,u,H)}return;default:if(wh(s)){for(var Vt in o)z=o[Vt],o.hasOwnProperty(Vt)&&z!==void 0&&!u.hasOwnProperty(Vt)&&fd(n,s,Vt,void 0,u,z);for(V in u)z=u[V],H=o[V],!u.hasOwnProperty(V)||z===H||z===void 0&&H===void 0||fd(n,s,V,z,u,H);return}}for(var R in o)z=o[R],o.hasOwnProperty(R)&&z!=null&&!u.hasOwnProperty(R)&&Yt(n,s,R,null,u,z);for(q in u)z=u[q],H=o[q],!u.hasOwnProperty(q)||z===H||z==null&&H==null||Yt(n,s,q,z,u,H)}function gy(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ST(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,o=performance.getEntriesByType("resource"),u=0;u<o.length;u++){var g=o[u],m=g.transferSize,y=g.initiatorType,C=g.duration;if(m&&C&&gy(y)){for(y=0,C=g.responseEnd,u+=1;u<o.length;u++){var E=o[u],L=E.startTime;if(L>C)break;var V=E.transferSize,q=E.initiatorType;V&&gy(q)&&(E=E.responseEnd,y+=V*(E<C?1:(C-L)/(E-L)))}if(--u,s+=8*(m+y)/(g.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var dd=null,gd=null;function vc(n){return n.nodeType===9?n:n.ownerDocument}function my(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function py(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function md(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var pd=null;function bT(){var n=window.event;return n&&n.type==="popstate"?n===pd?!1:(pd=n,!0):(pd=null,!1)}var _y=typeof setTimeout=="function"?setTimeout:void 0,CT=typeof clearTimeout=="function"?clearTimeout:void 0,vy=typeof Promise=="function"?Promise:void 0,xT=typeof queueMicrotask=="function"?queueMicrotask:typeof vy<"u"?function(n){return vy.resolve(null).then(n).catch(TT)}:_y;function TT(n){setTimeout(function(){throw n})}function os(n){return n==="head"}function yy(n,s){var o=s,u=0;do{var g=o.nextSibling;if(n.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"||o==="/&"){if(u===0){n.removeChild(g),qr(s);return}u--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")u++;else if(o==="html")fo(n.ownerDocument.documentElement);else if(o==="head"){o=n.ownerDocument.head,fo(o);for(var m=o.firstChild;m;){var y=m.nextSibling,C=m.nodeName;m[Ma]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&m.rel.toLowerCase()==="stylesheet"||o.removeChild(m),m=y}}else o==="body"&&fo(n.ownerDocument.body);o=g}while(o);qr(s)}function Sy(n,s){var o=n;n=0;do{var u=o.nextSibling;if(o.nodeType===1?s?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(s?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),u&&u.nodeType===8)if(o=u.data,o==="/$"){if(n===0)break;n--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||n++;o=u}while(o)}function _d(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":_d(o),bh(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}n.removeChild(o)}}function wT(n,s,o,u){for(;n.nodeType===1;){var g=o;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!u&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(u){if(!n[Ma])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(m=n.getAttribute("rel"),m==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(m!==g.rel||n.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||n.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||n.getAttribute("title")!==(g.title==null?null:g.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(m=n.getAttribute("src"),(m!==(g.src==null?null:g.src)||n.getAttribute("type")!==(g.type==null?null:g.type)||n.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&m&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var m=g.name==null?null:""+g.name;if(g.type==="hidden"&&n.getAttribute("name")===m)return n}else return n;if(n=On(n.nextSibling),n===null)break}return null}function ET(n,s,o){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!o||(n=On(n.nextSibling),n===null))return null;return n}function by(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=On(n.nextSibling),n===null))return null;return n}function vd(n){return n.data==="$?"||n.data==="$~"}function yd(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function OT(n,s){var o=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||o.readyState!=="loading")s();else{var u=function(){s(),o.removeEventListener("DOMContentLoaded",u)};o.addEventListener("DOMContentLoaded",u),n._reactRetry=u}}function On(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var Sd=null;function Cy(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"||o==="/&"){if(s===0)return On(n.nextSibling);s--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||s++}n=n.nextSibling}return null}function xy(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(s===0)return n;s--}else o!=="/$"&&o!=="/&"||s++}n=n.previousSibling}return null}function Ty(n,s,o){switch(s=vc(o),n){case"html":if(n=s.documentElement,!n)throw Error(i(452));return n;case"head":if(n=s.head,!n)throw Error(i(453));return n;case"body":if(n=s.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function fo(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);bh(n)}var Dn=new Map,wy=new Set;function yc(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Ci=W.d;W.d={f:DT,r:AT,D:MT,C:RT,L:NT,m:jT,X:LT,S:kT,M:zT};function DT(){var n=Ci.f(),s=uc();return n||s}function AT(n){var s=fr(n);s!==null&&s.tag===5&&s.type==="form"?H_(s):Ci.r(n)}var Vr=typeof document>"u"?null:document;function Ey(n,s,o){var u=Vr;if(u&&typeof s=="string"&&s){var g=Sn(s);g='link[rel="'+n+'"][href="'+g+'"]',typeof o=="string"&&(g+='[crossorigin="'+o+'"]'),wy.has(g)||(wy.add(g),n={rel:n,crossOrigin:o,href:s},u.querySelector(g)===null&&(s=u.createElement("link"),ke(s,"link",n),we(s),u.head.appendChild(s)))}}function MT(n){Ci.D(n),Ey("dns-prefetch",n,null)}function RT(n,s){Ci.C(n,s),Ey("preconnect",n,s)}function NT(n,s,o){Ci.L(n,s,o);var u=Vr;if(u&&n&&s){var g='link[rel="preload"][as="'+Sn(s)+'"]';s==="image"&&o&&o.imageSrcSet?(g+='[imagesrcset="'+Sn(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(g+='[imagesizes="'+Sn(o.imageSizes)+'"]')):g+='[href="'+Sn(n)+'"]';var m=g;switch(s){case"style":m=Gr(n);break;case"script":m=Xr(n)}Dn.has(m)||(n=_({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:n,as:s},o),Dn.set(m,n),u.querySelector(g)!==null||s==="style"&&u.querySelector(go(m))||s==="script"&&u.querySelector(mo(m))||(s=u.createElement("link"),ke(s,"link",n),we(s),u.head.appendChild(s)))}}function jT(n,s){Ci.m(n,s);var o=Vr;if(o&&n){var u=s&&typeof s.as=="string"?s.as:"script",g='link[rel="modulepreload"][as="'+Sn(u)+'"][href="'+Sn(n)+'"]',m=g;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Xr(n)}if(!Dn.has(m)&&(n=_({rel:"modulepreload",href:n},s),Dn.set(m,n),o.querySelector(g)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(mo(m)))return}u=o.createElement("link"),ke(u,"link",n),we(u),o.head.appendChild(u)}}}function kT(n,s,o){Ci.S(n,s,o);var u=Vr;if(u&&n){var g=dr(u).hoistableStyles,m=Gr(n);s=s||"default";var y=g.get(m);if(!y){var C={loading:0,preload:null};if(y=u.querySelector(go(m)))C.loading=5;else{n=_({rel:"stylesheet",href:n,"data-precedence":s},o),(o=Dn.get(m))&&bd(n,o);var E=y=u.createElement("link");we(E),ke(E,"link",n),E._p=new Promise(function(L,V){E.onload=L,E.onerror=V}),E.addEventListener("load",function(){C.loading|=1}),E.addEventListener("error",function(){C.loading|=2}),C.loading|=4,Sc(y,s,u)}y={type:"stylesheet",instance:y,count:1,state:C},g.set(m,y)}}}function LT(n,s){Ci.X(n,s);var o=Vr;if(o&&n){var u=dr(o).hoistableScripts,g=Xr(n),m=u.get(g);m||(m=o.querySelector(mo(g)),m||(n=_({src:n,async:!0},s),(s=Dn.get(g))&&Cd(n,s),m=o.createElement("script"),we(m),ke(m,"link",n),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(g,m))}}function zT(n,s){Ci.M(n,s);var o=Vr;if(o&&n){var u=dr(o).hoistableScripts,g=Xr(n),m=u.get(g);m||(m=o.querySelector(mo(g)),m||(n=_({src:n,async:!0,type:"module"},s),(s=Dn.get(g))&&Cd(n,s),m=o.createElement("script"),we(m),ke(m,"link",n),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(g,m))}}function Oy(n,s,o,u){var g=(g=gt.current)?yc(g):null;if(!g)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=Gr(o.href),o=dr(g).hoistableStyles,u=o.get(s),u||(u={type:"style",instance:null,count:0,state:null},o.set(s,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){n=Gr(o.href);var m=dr(g).hoistableStyles,y=m.get(n);if(y||(g=g.ownerDocument||g,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(n,y),(m=g.querySelector(go(n)))&&!m._p&&(y.instance=m,y.state.loading=5),Dn.has(n)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},Dn.set(n,o),m||BT(g,n,o,y.state))),s&&u===null)throw Error(i(528,""));return y}if(s&&u!==null)throw Error(i(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Xr(o),o=dr(g).hoistableScripts,u=o.get(s),u||(u={type:"script",instance:null,count:0,state:null},o.set(s,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function Gr(n){return'href="'+Sn(n)+'"'}function go(n){return'link[rel="stylesheet"]['+n+"]"}function Dy(n){return _({},n,{"data-precedence":n.precedence,precedence:null})}function BT(n,s,o,u){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?u.loading=1:(s=n.createElement("link"),u.preload=s,s.addEventListener("load",function(){return u.loading|=1}),s.addEventListener("error",function(){return u.loading|=2}),ke(s,"link",o),we(s),n.head.appendChild(s))}function Xr(n){return'[src="'+Sn(n)+'"]'}function mo(n){return"script[async]"+n}function Ay(n,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var u=n.querySelector('style[data-href~="'+Sn(o.href)+'"]');if(u)return s.instance=u,we(u),u;var g=_({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return u=(n.ownerDocument||n).createElement("style"),we(u),ke(u,"style",g),Sc(u,o.precedence,n),s.instance=u;case"stylesheet":g=Gr(o.href);var m=n.querySelector(go(g));if(m)return s.state.loading|=4,s.instance=m,we(m),m;u=Dy(o),(g=Dn.get(g))&&bd(u,g),m=(n.ownerDocument||n).createElement("link"),we(m);var y=m;return y._p=new Promise(function(C,E){y.onload=C,y.onerror=E}),ke(m,"link",u),s.state.loading|=4,Sc(m,o.precedence,n),s.instance=m;case"script":return m=Xr(o.src),(g=n.querySelector(mo(m)))?(s.instance=g,we(g),g):(u=o,(g=Dn.get(m))&&(u=_({},o),Cd(u,g)),n=n.ownerDocument||n,g=n.createElement("script"),we(g),ke(g,"link",u),n.head.appendChild(g),s.instance=g);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(u=s.instance,s.state.loading|=4,Sc(u,o.precedence,n));return s.instance}function Sc(n,s,o){for(var u=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=u.length?u[u.length-1]:null,m=g,y=0;y<u.length;y++){var C=u[y];if(C.dataset.precedence===s)m=C;else if(m!==g)break}m?m.parentNode.insertBefore(n,m.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(n,s.firstChild))}function bd(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function Cd(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var bc=null;function My(n,s,o){if(bc===null){var u=new Map,g=bc=new Map;g.set(o,u)}else g=bc,u=g.get(o),u||(u=new Map,g.set(o,u));if(u.has(n))return u;for(u.set(n,null),o=o.getElementsByTagName(n),g=0;g<o.length;g++){var m=o[g];if(!(m[Ma]||m[Me]||n==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var y=m.getAttribute(s)||"";y=n+y;var C=u.get(y);C?C.push(m):u.set(y,[m])}}return u}function Ry(n,s,o){n=n.ownerDocument||n,n.head.insertBefore(o,s==="title"?n.querySelector("head > title"):null)}function IT(n,s,o){if(o===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Ny(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function FT(n,s,o,u){if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=Gr(u.href),m=s.querySelector(go(g));if(m){s=m._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=Cc.bind(n),s.then(n,n)),o.state.loading|=4,o.instance=m,we(m);return}m=s.ownerDocument||s,u=Dy(u),(g=Dn.get(g))&&bd(u,g),m=m.createElement("link"),we(m);var y=m;y._p=new Promise(function(C,E){y.onload=C,y.onerror=E}),ke(m,"link",u),o.instance=m}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(n.count++,o=Cc.bind(n),s.addEventListener("load",o),s.addEventListener("error",o))}}var xd=0;function UT(n,s){return n.stylesheets&&n.count===0&&Tc(n,n.stylesheets),0<n.count||0<n.imgCount?function(o){var u=setTimeout(function(){if(n.stylesheets&&Tc(n,n.stylesheets),n.unsuspend){var m=n.unsuspend;n.unsuspend=null,m()}},6e4+s);0<n.imgBytes&&xd===0&&(xd=62500*ST());var g=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Tc(n,n.stylesheets),n.unsuspend)){var m=n.unsuspend;n.unsuspend=null,m()}},(n.imgBytes>xd?50:800)+s);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(u),clearTimeout(g)}}:null}function Cc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Tc(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var xc=null;function Tc(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,xc=new Map,s.forEach(PT,n),xc=null,Cc.call(n))}function PT(n,s){if(!(s.state.loading&4)){var o=xc.get(n);if(o)var u=o.get(null);else{o=new Map,xc.set(n,o);for(var g=n.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<g.length;m++){var y=g[m];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(o.set(y.dataset.precedence,y),u=y)}u&&o.set(null,u)}g=s.instance,y=g.getAttribute("data-precedence"),m=o.get(y)||u,m===u&&o.set(null,g),o.set(y,g),this.count++,u=Cc.bind(this),g.addEventListener("load",u),g.addEventListener("error",u),m?m.parentNode.insertBefore(g,m.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(g,n.firstChild)),s.state.loading|=4}}var po={$$typeof:j,Provider:null,Consumer:null,_currentValue:tt,_currentValue2:tt,_threadCount:0};function HT(n,s,o,u,g,m,y,C,E){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_h(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_h(0),this.hiddenUpdates=_h(null),this.identifierPrefix=u,this.onUncaughtError=g,this.onCaughtError=m,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=E,this.incompleteTransitions=new Map}function jy(n,s,o,u,g,m,y,C,E,L,V,q){return n=new HT(n,s,o,y,E,L,V,q,C),s=1,m===!0&&(s|=24),m=hn(3,null,null,s),n.current=m,m.stateNode=n,s=ef(),s.refCount++,n.pooledCache=s,s.refCount++,m.memoizedState={element:u,isDehydrated:o,cache:s},af(m),n}function ky(n){return n?(n=xr,n):xr}function Ly(n,s,o,u,g,m){g=ky(g),u.context===null?u.context=g:u.pendingContext=g,u=Ki(s),u.payload={element:o},m=m===void 0?null:m,m!==null&&(u.callback=m),o=Zi(n,u,s),o!==null&&($e(o,n,s),qa(o,n,s))}function zy(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<s?o:s}}function Td(n,s){zy(n,s),(n=n.alternate)&&zy(n,s)}function By(n){if(n.tag===13||n.tag===31){var s=js(n,67108864);s!==null&&$e(s,n,67108864),Td(n,67108864)}}function Iy(n){if(n.tag===13||n.tag===31){var s=pn();s=vh(s);var o=js(n,s);o!==null&&$e(o,n,s),Td(n,s)}}var wc=!0;function YT(n,s,o,u){var g=U.T;U.T=null;var m=W.p;try{W.p=2,wd(n,s,o,u)}finally{W.p=m,U.T=g}}function VT(n,s,o,u){var g=U.T;U.T=null;var m=W.p;try{W.p=8,wd(n,s,o,u)}finally{W.p=m,U.T=g}}function wd(n,s,o,u){if(wc){var g=Ed(u);if(g===null)hd(n,s,u,Ec,o),Uy(n,u);else if(XT(g,n,s,o,u))u.stopPropagation();else if(Uy(n,u),s&4&&-1<GT.indexOf(n)){for(;g!==null;){var m=fr(g);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var y=Ds(m.pendingLanes);if(y!==0){var C=m;for(C.pendingLanes|=2,C.entangledLanes|=2;y;){var E=1<<31-cn(y);C.entanglements[1]|=E,y&=~E}Jn(m),(Bt&6)===0&&(lc=on()+500,co(0))}}break;case 31:case 13:C=js(m,2),C!==null&&$e(C,m,2),uc(),Td(m,2)}if(m=Ed(u),m===null&&hd(n,s,u,Ec,o),m===g)break;g=m}g!==null&&u.stopPropagation()}else hd(n,s,u,null,o)}}function Ed(n){return n=Oh(n),Od(n)}var Ec=null;function Od(n){if(Ec=null,n=hr(n),n!==null){var s=l(n);if(s===null)n=null;else{var o=s.tag;if(o===13){if(n=c(s),n!==null)return n;n=null}else if(o===31){if(n=h(s),n!==null)return n;n=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return Ec=n,null}function Fy(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(M1()){case qm:return 2;case Wm:return 8;case ml:case R1:return 32;case Qm:return 268435456;default:return 32}default:return 32}}var Dd=!1,ls=null,cs=null,us=null,_o=new Map,vo=new Map,hs=[],GT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Uy(n,s){switch(n){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":cs=null;break;case"mouseover":case"mouseout":us=null;break;case"pointerover":case"pointerout":_o.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":vo.delete(s.pointerId)}}function yo(n,s,o,u,g,m){return n===null||n.nativeEvent!==m?(n={blockedOn:s,domEventName:o,eventSystemFlags:u,nativeEvent:m,targetContainers:[g]},s!==null&&(s=fr(s),s!==null&&By(s)),n):(n.eventSystemFlags|=u,s=n.targetContainers,g!==null&&s.indexOf(g)===-1&&s.push(g),n)}function XT(n,s,o,u,g){switch(s){case"focusin":return ls=yo(ls,n,s,o,u,g),!0;case"dragenter":return cs=yo(cs,n,s,o,u,g),!0;case"mouseover":return us=yo(us,n,s,o,u,g),!0;case"pointerover":var m=g.pointerId;return _o.set(m,yo(_o.get(m)||null,n,s,o,u,g)),!0;case"gotpointercapture":return m=g.pointerId,vo.set(m,yo(vo.get(m)||null,n,s,o,u,g)),!0}return!1}function Py(n){var s=hr(n.target);if(s!==null){var o=l(s);if(o!==null){if(s=o.tag,s===13){if(s=c(o),s!==null){n.blockedOn=s,ep(n.priority,function(){Iy(o)});return}}else if(s===31){if(s=h(o),s!==null){n.blockedOn=s,ep(n.priority,function(){Iy(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Oc(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var o=Ed(n.nativeEvent);if(o===null){o=n.nativeEvent;var u=new o.constructor(o.type,o);Eh=u,o.target.dispatchEvent(u),Eh=null}else return s=fr(o),s!==null&&By(s),n.blockedOn=o,!1;s.shift()}return!0}function Hy(n,s,o){Oc(n)&&o.delete(s)}function qT(){Dd=!1,ls!==null&&Oc(ls)&&(ls=null),cs!==null&&Oc(cs)&&(cs=null),us!==null&&Oc(us)&&(us=null),_o.forEach(Hy),vo.forEach(Hy)}function Dc(n,s){n.blockedOn===s&&(n.blockedOn=null,Dd||(Dd=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,qT)))}var Ac=null;function Yy(n){Ac!==n&&(Ac=n,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){Ac===n&&(Ac=null);for(var s=0;s<n.length;s+=3){var o=n[s],u=n[s+1],g=n[s+2];if(typeof u!="function"){if(Od(u||o)===null)continue;break}var m=fr(o);m!==null&&(n.splice(s,3),s-=3,Ef(m,{pending:!0,data:g,method:o.method,action:u},u,g))}}))}function qr(n){function s(E){return Dc(E,n)}ls!==null&&Dc(ls,n),cs!==null&&Dc(cs,n),us!==null&&Dc(us,n),_o.forEach(s),vo.forEach(s);for(var o=0;o<hs.length;o++){var u=hs[o];u.blockedOn===n&&(u.blockedOn=null)}for(;0<hs.length&&(o=hs[0],o.blockedOn===null);)Py(o),o.blockedOn===null&&hs.shift();if(o=(n.ownerDocument||n).$$reactFormReplay,o!=null)for(u=0;u<o.length;u+=3){var g=o[u],m=o[u+1],y=g[qe]||null;if(typeof m=="function")y||Yy(o);else if(y){var C=null;if(m&&m.hasAttribute("formAction")){if(g=m,y=m[qe]||null)C=y.formAction;else if(Od(g)!==null)continue}else C=y.action;typeof C=="function"?o[u+1]=C:(o.splice(u,3),u-=3),Yy(o)}}}function Vy(){function n(m){m.canIntercept&&m.info==="react-transition"&&m.intercept({handler:function(){return new Promise(function(y){return g=y})},focusReset:"manual",scroll:"manual"})}function s(){g!==null&&(g(),g=null),u||setTimeout(o,20)}function o(){if(!u&&!navigation.transition){var m=navigation.currentEntry;m&&m.url!=null&&navigation.navigate(m.url,{state:m.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,g=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(o,100),function(){u=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),g!==null&&(g(),g=null)}}}function Ad(n){this._internalRoot=n}Mc.prototype.render=Ad.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(i(409));var o=s.current,u=pn();Ly(o,u,n,s,null,null)},Mc.prototype.unmount=Ad.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;Ly(n.current,2,null,n,null,null),uc(),s[ur]=null}};function Mc(n){this._internalRoot=n}Mc.prototype.unstable_scheduleHydration=function(n){if(n){var s=tp();n={blockedOn:null,target:n,priority:s};for(var o=0;o<hs.length&&s!==0&&s<hs[o].priority;o++);hs.splice(o,0,n),o===0&&Py(n)}};var Gy=t.version;if(Gy!=="19.2.0")throw Error(i(527,Gy,"19.2.0"));W.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=d(s),n=n!==null?p(n):null,n=n===null?null:n.stateNode,n};var WT={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rc.isDisabled&&Rc.supportsFiber)try{Oa=Rc.inject(WT),ln=Rc}catch{}}return bo.createRoot=function(n,s){if(!r(n))throw Error(i(299));var o=!1,u="",g=J_,m=$_,y=tv;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(g=s.onUncaughtError),s.onCaughtError!==void 0&&(m=s.onCaughtError),s.onRecoverableError!==void 0&&(y=s.onRecoverableError)),s=jy(n,1,!1,null,null,o,u,null,g,m,y,Vy),n[ur]=s.current,ud(n),new Ad(s)},bo.hydrateRoot=function(n,s,o){if(!r(n))throw Error(i(299));var u=!1,g="",m=J_,y=$_,C=tv,E=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onUncaughtError!==void 0&&(m=o.onUncaughtError),o.onCaughtError!==void 0&&(y=o.onCaughtError),o.onRecoverableError!==void 0&&(C=o.onRecoverableError),o.formState!==void 0&&(E=o.formState)),s=jy(n,1,!0,s,o??null,u,g,E,m,y,C,Vy),s.context=ky(null),o=s.current,u=pn(),u=vh(u),g=Ki(u),g.callback=null,Zi(o,g,u),o=u,s.current.lanes=o,Aa(s,o),Jn(s),n[ur]=s.current,ud(n),new Mc(s)},bo.version="19.2.0",bo}var e0;function rw(){if(e0)return Nd.exports;e0=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(t){console.error(t)}}return a(),Nd.exports=sw(),Nd.exports}var aw=rw();const ow=()=>{};var n0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BS={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J=function(a,t){if(!a)throw pa(t)},pa=function(a){return new Error("Firebase Database ("+BS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IS=function(a){const t=[];let e=0;for(let i=0;i<a.length;i++){let r=a.charCodeAt(i);r<128?t[e++]=r:r<2048?(t[e++]=r>>6|192,t[e++]=r&63|128):(r&64512)===55296&&i+1<a.length&&(a.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(a.charCodeAt(++i)&1023),t[e++]=r>>18|240,t[e++]=r>>12&63|128,t[e++]=r>>6&63|128,t[e++]=r&63|128):(t[e++]=r>>12|224,t[e++]=r>>6&63|128,t[e++]=r&63|128)}return t},lw=function(a){const t=[];let e=0,i=0;for(;e<a.length;){const r=a[e++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const l=a[e++];t[i++]=String.fromCharCode((r&31)<<6|l&63)}else if(r>239&&r<365){const l=a[e++],c=a[e++],h=a[e++],f=((r&7)<<18|(l&63)<<12|(c&63)<<6|h&63)-65536;t[i++]=String.fromCharCode(55296+(f>>10)),t[i++]=String.fromCharCode(56320+(f&1023))}else{const l=a[e++],c=a[e++];t[i++]=String.fromCharCode((r&15)<<12|(l&63)<<6|c&63)}}return t.join("")},Vg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,t){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<a.length;r+=3){const l=a[r],c=r+1<a.length,h=c?a[r+1]:0,f=r+2<a.length,d=f?a[r+2]:0,p=l>>2,_=(l&3)<<4|h>>4;let v=(h&15)<<2|d>>6,S=d&63;f||(S=64,c||(v=64)),i.push(e[p],e[_],e[v],e[S])}return i.join("")},encodeString(a,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(a):this.encodeByteArray(IS(a),t)},decodeString(a,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(a):lw(this.decodeStringToByteArray(a,t))},decodeStringToByteArray(a,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<a.length;){const l=e[a.charAt(r++)],h=r<a.length?e[a.charAt(r)]:0;++r;const d=r<a.length?e[a.charAt(r)]:64;++r;const _=r<a.length?e[a.charAt(r)]:64;if(++r,l==null||h==null||d==null||_==null)throw new cw;const v=l<<2|h>>4;if(i.push(v),d!==64){const S=h<<4&240|d>>2;if(i.push(S),_!==64){const b=d<<6&192|_;i.push(b)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class cw extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const FS=function(a){const t=IS(a);return Vg.encodeByteArray(t,!0)},hu=function(a){return FS(a).replace(/\./g,"")},og=function(a){try{return Vg.decodeString(a,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(a){return US(void 0,a)}function US(a,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const e=t;return new Date(e.getTime());case Object:a===void 0&&(a={});break;case Array:a=[];break;default:return t}for(const e in t)!t.hasOwnProperty(e)||!hw(e)||(a[e]=US(a[e],t[e]));return a}function hw(a){return a!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dw=()=>fw().__FIREBASE_DEFAULTS__,gw=()=>{if(typeof process>"u"||typeof n0>"u")return;const a=n0.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},mw=()=>{if(typeof document>"u")return;let a;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=a&&og(a[1]);return t&&JSON.parse(t)},PS=()=>{try{return ow()||dw()||gw()||mw()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},pw=a=>PS()?.emulatorHosts?.[a],_w=a=>{const t=pw(a);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]},HS=()=>PS()?.config;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gg(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function vw(a){return(await fetch(a,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(a,t){if(a.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},i=t||"demo-project",r=a.iat||0,l=a.sub||a.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...a};return[hu(JSON.stringify(e)),hu(JSON.stringify(c)),""].join(".")}const Ao={};function Sw(){const a={prod:[],emulator:[]};for(const t of Object.keys(Ao))Ao[t]?a.emulator.push(t):a.prod.push(t);return a}function bw(a){let t=document.getElementById(a),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",a),e=!0),{created:e,element:t}}let i0=!1;function Cw(a,t){if(typeof window>"u"||typeof document>"u"||!Gg(window.location.host)||Ao[a]===t||Ao[a]||i0)return;Ao[a]=t;function e(v){return`__firebase__banner__${v}`}const i="__firebase__banner",l=Sw().prod.length>0;function c(){const v=document.getElementById(i);v&&v.remove()}function h(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function f(v,S){v.setAttribute("width","24"),v.setAttribute("id",S),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{i0=!0,c()},v}function p(v,S){v.setAttribute("id",S),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function _(){const v=bw(i),S=e("text"),b=document.getElementById(S)||document.createElement("span"),T=e("learnmore"),w=document.getElementById(T)||document.createElement("a"),N=e("preprendIcon"),I=document.getElementById(N)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const j=v.element;h(j),p(w,T);const Y=d();f(I,N),j.append(I,b,w,Y),document.body.appendChild(j)}l?(b.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xw(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function YS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xw())}function Tw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ww(){return BS.NODE_ADMIN===!0}function Ew(){try{return typeof indexedDB=="object"}catch{return!1}}function Ow(){return new Promise((a,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),e||self.indexedDB.deleteDatabase(i),a(!0)},r.onupgradeneeded=()=>{e=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dw="FirebaseError";class sl extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Dw,Object.setPrototypeOf(this,sl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,VS.prototype.create)}}class VS{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},r=`${this.service}/${t}`,l=this.errors[t],c=l?Aw(l,i):"Error",h=`${this.serviceName}: ${c} (${r}).`;return new sl(r,h,i)}}function Aw(a,t){return a.replace(Mw,(e,i)=>{const r=t[i];return r!=null?String(r):`<${i}?>`})}const Mw=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fo(a){return JSON.parse(a)}function Ce(a){return JSON.stringify(a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GS=function(a){let t={},e={},i={},r="";try{const l=a.split(".");t=Fo(og(l[0])||""),e=Fo(og(l[1])||""),r=l[2],i=e.d||{},delete e.d}catch{}return{header:t,claims:e,data:i,signature:r}},Rw=function(a){const t=GS(a),e=t.claims;return!!e&&typeof e=="object"&&e.hasOwnProperty("iat")},Nw=function(a){const t=GS(a).claims;return typeof t=="object"&&t.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(a,t){return Object.prototype.hasOwnProperty.call(a,t)}function ca(a,t){if(Object.prototype.hasOwnProperty.call(a,t))return a[t]}function s0(a){for(const t in a)if(Object.prototype.hasOwnProperty.call(a,t))return!1;return!0}function fu(a,t,e){const i={};for(const r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i[r]=t.call(e,a[r],r,a));return i}function du(a,t){if(a===t)return!0;const e=Object.keys(a),i=Object.keys(t);for(const r of e){if(!i.includes(r))return!1;const l=a[r],c=t[r];if(r0(l)&&r0(c)){if(!du(l,c))return!1}else if(l!==c)return!1}for(const r of i)if(!e.includes(r))return!1;return!0}function r0(a){return a!==null&&typeof a=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jw(a){const t=[];for(const[e,i]of Object.entries(a))Array.isArray(i)?i.forEach(r=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(r))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const i=this.W_;if(typeof t=="string")for(let _=0;_<16;_++)i[_]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let _=0;_<16;_++)i[_]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let _=16;_<80;_++){const v=i[_-3]^i[_-8]^i[_-14]^i[_-16];i[_]=(v<<1|v>>>31)&4294967295}let r=this.chain_[0],l=this.chain_[1],c=this.chain_[2],h=this.chain_[3],f=this.chain_[4],d,p;for(let _=0;_<80;_++){_<40?_<20?(d=h^l&(c^h),p=1518500249):(d=l^c^h,p=1859775393):_<60?(d=l&c|h&(l|c),p=2400959708):(d=l^c^h,p=3395469782);const v=(r<<5|r>>>27)+d+f+p+i[_]&4294967295;f=h,h=c,c=(l<<30|l>>>2)&4294967295,l=r,r=v}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295}update(t,e){if(t==null)return;e===void 0&&(e=t.length);const i=e-this.blockSize;let r=0;const l=this.buf_;let c=this.inbuf_;for(;r<e;){if(c===0)for(;r<=i;)this.compress_(t,r),r+=this.blockSize;if(typeof t=="string"){for(;r<e;)if(l[c]=t.charCodeAt(r),++c,++r,c===this.blockSize){this.compress_(l),c=0;break}}else for(;r<e;)if(l[c]=t[r],++c,++r,c===this.blockSize){this.compress_(l),c=0;break}}this.inbuf_=c,this.total_+=e}digest(){const t=[];let e=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=e&255,e/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let l=24;l>=0;l-=8)t[i]=this.chain_[r]>>l&255,++i;return t}}function Pu(a,t){return`${a} failed: ${t} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lw=function(a){const t=[];let e=0;for(let i=0;i<a.length;i++){let r=a.charCodeAt(i);if(r>=55296&&r<=56319){const l=r-55296;i++,J(i<a.length,"Surrogate pair missing trail surrogate.");const c=a.charCodeAt(i)-56320;r=65536+(l<<10)+c}r<128?t[e++]=r:r<2048?(t[e++]=r>>6|192,t[e++]=r&63|128):r<65536?(t[e++]=r>>12|224,t[e++]=r>>6&63|128,t[e++]=r&63|128):(t[e++]=r>>18|240,t[e++]=r>>12&63|128,t[e++]=r>>6&63|128,t[e++]=r&63|128)}return t},Hu=function(a){let t=0;for(let e=0;e<a.length;e++){const i=a.charCodeAt(e);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,e++):t+=3}return t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ar(a){return a&&a._delegate?a._delegate:a}class Uo{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zw{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const i=new il;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:e});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),i=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Iw(t))try{this.getOrInitializeService({instanceIdentifier:Xs})}catch{}for(const[e,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const l=this.getOrInitializeService({instanceIdentifier:r});i.resolve(l)}catch{}}}}clearInstance(t=Xs){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Xs){return this.instances.has(t)}getOptions(t=Xs){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[l,c]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(l);i===h&&c.resolve(r)}return r}onInit(t,e){const i=this.normalizeInstanceIdentifier(e),r=this.onInitCallbacks.get(i)??new Set;r.add(t),this.onInitCallbacks.set(i,r);const l=this.instances.get(i);return l&&t(l,i),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const r of i)try{r(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Bw(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=Xs){return this.component?this.component.multipleInstances?t:Xs:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Bw(a){return a===Xs?void 0:a}function Iw(a){return a.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new zw(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wt;(function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"})(Wt||(Wt={}));const Uw={debug:Wt.DEBUG,verbose:Wt.VERBOSE,info:Wt.INFO,warn:Wt.WARN,error:Wt.ERROR,silent:Wt.SILENT},Pw=Wt.INFO,Hw={[Wt.DEBUG]:"log",[Wt.VERBOSE]:"log",[Wt.INFO]:"info",[Wt.WARN]:"warn",[Wt.ERROR]:"error"},Yw=(a,t,...e)=>{if(t<a.logLevel)return;const i=new Date().toISOString(),r=Hw[t];if(r)console[r](`[${i}]  ${a.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class XS{constructor(t){this.name=t,this._logLevel=Pw,this._logHandler=Yw,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Wt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Uw[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Wt.DEBUG,...t),this._logHandler(this,Wt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Wt.VERBOSE,...t),this._logHandler(this,Wt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Wt.INFO,...t),this._logHandler(this,Wt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Wt.WARN,...t),this._logHandler(this,Wt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Wt.ERROR,...t),this._logHandler(this,Wt.ERROR,...t)}}const Vw=(a,t)=>t.some(e=>a instanceof e);let a0,o0;function Gw(){return a0||(a0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xw(){return o0||(o0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qS=new WeakMap,lg=new WeakMap,WS=new WeakMap,zd=new WeakMap,Xg=new WeakMap;function qw(a){const t=new Promise((e,i)=>{const r=()=>{a.removeEventListener("success",l),a.removeEventListener("error",c)},l=()=>{e(_s(a.result)),r()},c=()=>{i(a.error),r()};a.addEventListener("success",l),a.addEventListener("error",c)});return t.then(e=>{e instanceof IDBCursor&&qS.set(e,a)}).catch(()=>{}),Xg.set(t,a),t}function Ww(a){if(lg.has(a))return;const t=new Promise((e,i)=>{const r=()=>{a.removeEventListener("complete",l),a.removeEventListener("error",c),a.removeEventListener("abort",c)},l=()=>{e(),r()},c=()=>{i(a.error||new DOMException("AbortError","AbortError")),r()};a.addEventListener("complete",l),a.addEventListener("error",c),a.addEventListener("abort",c)});lg.set(a,t)}let cg={get(a,t,e){if(a instanceof IDBTransaction){if(t==="done")return lg.get(a);if(t==="objectStoreNames")return a.objectStoreNames||WS.get(a);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return _s(a[t])},set(a,t,e){return a[t]=e,!0},has(a,t){return a instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in a}};function Qw(a){cg=a(cg)}function Kw(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=a.call(Bd(this),t,...e);return WS.set(i,t.sort?t.sort():[t]),_s(i)}:Xw().includes(a)?function(...t){return a.apply(Bd(this),t),_s(qS.get(this))}:function(...t){return _s(a.apply(Bd(this),t))}}function Zw(a){return typeof a=="function"?Kw(a):(a instanceof IDBTransaction&&Ww(a),Vw(a,Gw())?new Proxy(a,cg):a)}function _s(a){if(a instanceof IDBRequest)return qw(a);if(zd.has(a))return zd.get(a);const t=Zw(a);return t!==a&&(zd.set(a,t),Xg.set(t,a)),t}const Bd=a=>Xg.get(a);function Jw(a,t,{blocked:e,upgrade:i,blocking:r,terminated:l}={}){const c=indexedDB.open(a,t),h=_s(c);return i&&c.addEventListener("upgradeneeded",f=>{i(_s(c.result),f.oldVersion,f.newVersion,_s(c.transaction),f)}),e&&c.addEventListener("blocked",f=>e(f.oldVersion,f.newVersion,f)),h.then(f=>{l&&f.addEventListener("close",()=>l()),r&&f.addEventListener("versionchange",d=>r(d.oldVersion,d.newVersion,d))}).catch(()=>{}),h}const $w=["get","getKey","getAll","getAllKeys","count"],tE=["put","add","delete","clear"],Id=new Map;function l0(a,t){if(!(a instanceof IDBDatabase&&!(t in a)&&typeof t=="string"))return;if(Id.get(t))return Id.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,r=tE.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(r||$w.includes(e)))return;const l=async function(c,...h){const f=this.transaction(c,r?"readwrite":"readonly");let d=f.store;return i&&(d=d.index(h.shift())),(await Promise.all([d[e](...h),r&&f.done]))[0]};return Id.set(t,l),l}Qw(a=>({...a,get:(t,e,i)=>l0(t,e)||a.get(t,e,i),has:(t,e)=>!!l0(t,e)||a.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(nE(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function nE(a){return a.getComponent()?.type==="VERSION"}const ug="@firebase/app",c0="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ji=new XS("@firebase/app"),iE="@firebase/app-compat",sE="@firebase/analytics-compat",rE="@firebase/analytics",aE="@firebase/app-check-compat",oE="@firebase/app-check",lE="@firebase/auth",cE="@firebase/auth-compat",uE="@firebase/database",hE="@firebase/data-connect",fE="@firebase/database-compat",dE="@firebase/functions",gE="@firebase/functions-compat",mE="@firebase/installations",pE="@firebase/installations-compat",_E="@firebase/messaging",vE="@firebase/messaging-compat",yE="@firebase/performance",SE="@firebase/performance-compat",bE="@firebase/remote-config",CE="@firebase/remote-config-compat",xE="@firebase/storage",TE="@firebase/storage-compat",wE="@firebase/firestore",EE="@firebase/ai",OE="@firebase/firestore-compat",DE="firebase",AE="12.3.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hg="[DEFAULT]",ME={[ug]:"fire-core",[iE]:"fire-core-compat",[rE]:"fire-analytics",[sE]:"fire-analytics-compat",[oE]:"fire-app-check",[aE]:"fire-app-check-compat",[lE]:"fire-auth",[cE]:"fire-auth-compat",[uE]:"fire-rtdb",[hE]:"fire-data-connect",[fE]:"fire-rtdb-compat",[dE]:"fire-fn",[gE]:"fire-fn-compat",[mE]:"fire-iid",[pE]:"fire-iid-compat",[_E]:"fire-fcm",[vE]:"fire-fcm-compat",[yE]:"fire-perf",[SE]:"fire-perf-compat",[bE]:"fire-rc",[CE]:"fire-rc-compat",[xE]:"fire-gcs",[TE]:"fire-gcs-compat",[wE]:"fire-fst",[OE]:"fire-fst-compat",[EE]:"fire-vertex","fire-js":"fire-js",[DE]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gu=new Map,RE=new Map,fg=new Map;function u0(a,t){try{a.container.addComponent(t)}catch(e){ji.debug(`Component ${t.name} failed to register with FirebaseApp ${a.name}`,e)}}function mu(a){const t=a.name;if(fg.has(t))return ji.debug(`There were multiple attempts to register component ${t}.`),!1;fg.set(t,a);for(const e of gu.values())u0(e,a);for(const e of RE.values())u0(e,a);return!0}function NE(a,t){const e=a.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),a.container.getProvider(t)}function jE(a){return a==null?!1:a.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kE={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vs=new VS("app","Firebase",kE);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{constructor(t,e,i){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Uo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw vs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zE=AE;function QS(a,t={}){let e=a;typeof t!="object"&&(t={name:t});const i={name:hg,automaticDataCollectionEnabled:!0,...t},r=i.name;if(typeof r!="string"||!r)throw vs.create("bad-app-name",{appName:String(r)});if(e||(e=HS()),!e)throw vs.create("no-options");const l=gu.get(r);if(l){if(du(e,l.options)&&du(i,l.config))return l;throw vs.create("duplicate-app",{appName:r})}const c=new Fw(r);for(const f of fg.values())c.addComponent(f);const h=new LE(e,i,c);return gu.set(r,h),h}function BE(a=hg){const t=gu.get(a);if(!t&&a===hg&&HS())return QS();if(!t)throw vs.create("no-app",{appName:a});return t}function ia(a,t,e){let i=ME[a]??a;e&&(i+=`-${e}`);const r=i.match(/\s|\//),l=t.match(/\s|\//);if(r||l){const c=[`Unable to register library "${i}" with version "${t}":`];r&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&l&&c.push("and"),l&&c.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ji.warn(c.join(" "));return}mu(new Uo(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IE="firebase-heartbeat-database",FE=1,Po="firebase-heartbeat-store";let Fd=null;function KS(){return Fd||(Fd=Jw(IE,FE,{upgrade:(a,t)=>{switch(t){case 0:try{a.createObjectStore(Po)}catch(e){console.warn(e)}}}}).catch(a=>{throw vs.create("idb-open",{originalErrorMessage:a.message})})),Fd}async function UE(a){try{const e=(await KS()).transaction(Po),i=await e.objectStore(Po).get(ZS(a));return await e.done,i}catch(t){if(t instanceof sl)ji.warn(t.message);else{const e=vs.create("idb-get",{originalErrorMessage:t?.message});ji.warn(e.message)}}}async function h0(a,t){try{const i=(await KS()).transaction(Po,"readwrite");await i.objectStore(Po).put(t,ZS(a)),await i.done}catch(e){if(e instanceof sl)ji.warn(e.message);else{const i=vs.create("idb-set",{originalErrorMessage:e?.message});ji.warn(i.message)}}}function ZS(a){return`${a.name}!${a.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE=1024,HE=30;class YE{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new GE(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=f0();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(r=>r.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:e}),this._heartbeatsCache.heartbeats.length>HE){const r=XE(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){ji.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=f0(),{heartbeatsToSend:e,unsentEntries:i}=VE(this._heartbeatsCache.heartbeats),r=hu(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return ji.warn(t),""}}}function f0(){return new Date().toISOString().substring(0,10)}function VE(a,t=PE){const e=[];let i=a.slice();for(const r of a){const l=e.find(c=>c.agent===r.agent);if(l){if(l.dates.push(r.date),d0(e)>t){l.dates.pop();break}}else if(e.push({agent:r.agent,dates:[r.date]}),d0(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class GE{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ew()?Ow().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await UE(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const i=await this.read();return h0(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const i=await this.read();return h0(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}}function d0(a){return hu(JSON.stringify({version:2,heartbeats:a})).length}function XE(a){if(a.length===0)return-1;let t=0,e=a[0].date;for(let i=1;i<a.length;i++)a[i].date<e&&(e=a[i].date,t=i);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qE(a){mu(new Uo("platform-logger",t=>new eE(t),"PRIVATE")),mu(new Uo("heartbeat",t=>new YE(t),"PRIVATE")),ia(ug,c0,a),ia(ug,c0,"esm2020"),ia("fire-js","")}qE("");var g0={};const m0="@firebase/database",p0="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let JS="";function WE(a){JS=a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Ce(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:Fo(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KE{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return ii(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $S=function(a){try{if(typeof window<"u"&&typeof window[a]<"u"){const t=window[a];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new QE(t)}}catch{}return new KE},Ks=$S("localStorage"),ZE=$S("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sa=new XS("@firebase/database"),JE=(function(){let a=1;return function(){return a++}})(),tb=function(a){const t=Lw(a),e=new kw;e.update(t);const i=e.digest();return Vg.encodeByteArray(i)},rl=function(...a){let t="";for(let e=0;e<a.length;e++){const i=a[e];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?t+=rl.apply(null,i):typeof i=="object"?t+=Ce(i):t+=i,t+=" "}return t};let Mo=null,_0=!0;const $E=function(a,t){J(!0,"Can't turn on custom loggers persistently."),sa.logLevel=Wt.VERBOSE,Mo=sa.log.bind(sa)},Le=function(...a){if(_0===!0&&(_0=!1,Mo===null&&ZE.get("logging_enabled")===!0&&$E()),Mo){const t=rl.apply(null,a);Mo(t)}},al=function(a){return function(...t){Le(a,...t)}},dg=function(...a){const t="FIREBASE INTERNAL ERROR: "+rl(...a);sa.error(t)},ki=function(...a){const t=`FIREBASE FATAL ERROR: ${rl(...a)}`;throw sa.error(t),new Error(t)},Ve=function(...a){const t="FIREBASE WARNING: "+rl(...a);sa.warn(t)},t2=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ve("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},qg=function(a){return typeof a=="number"&&(a!==a||a===Number.POSITIVE_INFINITY||a===Number.NEGATIVE_INFINITY)},e2=function(a){if(document.readyState==="complete")a();else{let t=!1;const e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,a())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},ua="[MIN_NAME]",er="[MAX_NAME]",or=function(a,t){if(a===t)return 0;if(a===ua||t===er)return-1;if(t===ua||a===er)return 1;{const e=v0(a),i=v0(t);return e!==null?i!==null?e-i===0?a.length-t.length:e-i:-1:i!==null?1:a<t?-1:1}},n2=function(a,t){return a===t?0:a<t?-1:1},Co=function(a,t){if(t&&a in t)return t[a];throw new Error("Missing required key ("+a+") in object: "+Ce(t))},Wg=function(a){if(typeof a!="object"||a===null)return Ce(a);const t=[];for(const i in a)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)i!==0&&(e+=","),e+=Ce(t[i]),e+=":",e+=Wg(a[t[i]]);return e+="}",e},eb=function(a,t){const e=a.length;if(e<=t)return[a];const i=[];for(let r=0;r<e;r+=t)r+t>e?i.push(a.substring(r,e)):i.push(a.substring(r,r+t));return i};function Be(a,t){for(const e in a)a.hasOwnProperty(e)&&t(e,a[e])}const nb=function(a){J(!qg(a),"Invalid JSON number");const t=11,e=52,i=(1<<t-1)-1;let r,l,c,h,f;a===0?(l=0,c=0,r=1/a===-1/0?1:0):(r=a<0,a=Math.abs(a),a>=Math.pow(2,1-i)?(h=Math.min(Math.floor(Math.log(a)/Math.LN2),i),l=h+i,c=Math.round(a*Math.pow(2,e-h)-Math.pow(2,e))):(l=0,c=Math.round(a/Math.pow(2,1-i-e))));const d=[];for(f=e;f;f-=1)d.push(c%2?1:0),c=Math.floor(c/2);for(f=t;f;f-=1)d.push(l%2?1:0),l=Math.floor(l/2);d.push(r?1:0),d.reverse();const p=d.join("");let _="";for(f=0;f<64;f+=8){let v=parseInt(p.substr(f,8),2).toString(16);v.length===1&&(v="0"+v),_=_+v}return _.toLowerCase()},i2=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},s2=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function r2(a,t){let e="Unknown Error";a==="too_big"?e="The data requested exceeds the maximum size that can be accessed with a single request.":a==="permission_denied"?e="Client doesn't have permission to access the desired data.":a==="unavailable"&&(e="The service is unavailable");const i=new Error(a+" at "+t._path.toString()+": "+e);return i.code=a.toUpperCase(),i}const a2=new RegExp("^-?(0*)\\d{1,10}$"),o2=-2147483648,l2=2147483647,v0=function(a){if(a2.test(a)){const t=Number(a);if(t>=o2&&t<=l2)return t}return null},_a=function(a){try{a()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Ve("Exception was thrown by user callback.",e),t},Math.floor(0))}},c2=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ro=function(a,t){const e=setTimeout(a,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u2{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,jE(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(i=>this.appCheck=i)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.appCheckProvider?.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Ve(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h2{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?(Le("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ve(t)}}class ru{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}ru.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qg="5",ib="v",sb="s",rb="r",ab="f",ob=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,lb="ls",cb="p",gg="ac",ub="websocket",hb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(t,e,i,r,l=!1,c="",h=!1,f=!1,d=null){this.secure=e,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=l,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=f,this.emulatorOptions=d,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ks.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ks.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function f2(a){return a.host!==a.internalHost||a.isCustomHost()||a.includeNamespaceInQueryParams}function db(a,t,e){J(typeof t=="string","typeof type must == string"),J(typeof e=="object","typeof params must == object");let i;if(t===ub)i=(a.secure?"wss://":"ws://")+a.internalHost+"/.ws?";else if(t===hb)i=(a.secure?"https://":"http://")+a.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);f2(a)&&(e.ns=a.namespace);const r=[];return Be(e,(l,c)=>{r.push(l+"="+c)}),i+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2{constructor(){this.counters_={}}incrementCounter(t,e=1){ii(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return uw(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ud={},Pd={};function Kg(a){const t=a.toString();return Ud[t]||(Ud[t]=new d2),Ud[t]}function g2(a,t){const e=a.toString();return Pd[e]||(Pd[e]=t()),Pd[e]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&_a(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y0="start",p2="close",_2="pLPCommand",v2="pRTLPCB",gb="id",mb="pw",pb="ser",y2="cb",S2="seg",b2="ts",C2="d",x2="dframe",_b=1870,vb=30,T2=_b-vb,w2=25e3,E2=3e4;class Jr{constructor(t,e,i,r,l,c,h){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=r,this.authToken=l,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=al(t),this.stats_=Kg(e),this.urlFn=f=>(this.appCheckToken&&(f[gg]=this.appCheckToken),db(e,hb,f))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new m2(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(E2)),e2(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Zg((...l)=>{const[c,h,f,d,p]=l;if(this.incrementIncomingBytes_(l),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,c===y0)this.id=h,this.password=f;else if(c===p2)h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+c)},(...l)=>{const[c,h]=l;this.incrementIncomingBytes_(l),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const i={};i[y0]="t",i[pb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[y2]=this.scriptTagHolder.uniqueCallbackIdentifier),i[ib]=Qg,this.transportSessionId&&(i[sb]=this.transportSessionId),this.lastSessionId&&(i[lb]=this.lastSessionId),this.applicationId&&(i[cb]=this.applicationId),this.appCheckToken&&(i[gg]=this.appCheckToken),typeof location<"u"&&location.hostname&&ob.test(location.hostname)&&(i[rb]=ab);const r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Jr.forceAllow_=!0}static forceDisallow(){Jr.forceDisallow_=!0}static isAvailable(){return Jr.forceAllow_?!0:!Jr.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!i2()&&!s2()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=Ce(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=FS(e),r=eb(i,T2);for(let l=0;l<r.length;l++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[l]),this.curSegmentNum++}addDisconnectPingFrame(t,e){this.myDisconnFrame=document.createElement("iframe");const i={};i[x2]="t",i[gb]=t,i[mb]=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=Ce(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Zg{constructor(t,e,i,r){this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=JE(),window[_2+this.uniqueCallbackIdentifier]=t,window[v2+this.uniqueCallbackIdentifier]=e,this.myIFrame=Zg.createIFrame_();let l="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(l='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+l+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){Le("frame writing exception"),h.stack&&Le(h.stack),Le(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||Le("No IE domain setting required")}catch{const i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[gb]=this.myID,t[mb]=this.myPW,t[pb]=this.currentSerial;let e=this.urlFn(t),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+vb+i.length<=_b;){const c=this.pendingSegs.shift();i=i+"&"+S2+r+"="+c.seg+"&"+b2+r+"="+c.ts+"&"+C2+r+"="+c.d,r++}return e=e+i,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},r=setTimeout(i,Math.floor(w2)),l=()=>{clearTimeout(r),i()};this.addTag(t,l)}addTag(t,e){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){const r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{Le("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2=16384,D2=45e3;let pu=null;typeof MozWebSocket<"u"?pu=MozWebSocket:typeof WebSocket<"u"&&(pu=WebSocket);class Pn{constructor(t,e,i,r,l,c,h){this.connId=t,this.applicationId=i,this.appCheckToken=r,this.authToken=l,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=al(this.connId),this.stats_=Kg(e),this.connURL=Pn.connectionURL_(e,c,h,r,i),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,i,r,l){const c={};return c[ib]=Qg,typeof location<"u"&&location.hostname&&ob.test(location.hostname)&&(c[rb]=ab),e&&(c[sb]=e),i&&(c[lb]=i),r&&(c[gg]=r),l&&(c[cb]=l),db(t,ub,c)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ks.set("previous_websocket_failure",!0);try{let i;ww(),this.mySock=new pu(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Pn.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(e);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&pu!==null&&!Pn.forceDisallow_}static previouslyFailed(){return Ks.isInMemoryStorage||Ks.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ks.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const i=Fo(e);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(J(this.frames===null,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(e);else{const i=this.extractFrameCount_(e);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();const e=Ce(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=eb(e,O2);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(D2))}sendString_(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Pn.responsesRequiredToBeHealthy=2;Pn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{static get ALL_TRANSPORTS(){return[Jr,Pn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=Pn&&Pn.isAvailable();let i=e&&!Pn.previouslyFailed();if(t.webSocketOnly&&(e||Ve("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Pn];else{const r=this.transports_=[];for(const l of Ho.ALL_TRANSPORTS)l&&l.isAvailable()&&r.push(l);Ho.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ho.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2=6e4,M2=5e3,R2=10*1024,N2=100*1024,Hd="t",S0="d",j2="s",b0="r",k2="e",C0="o",x0="a",T0="n",w0="p",L2="h";class z2{constructor(t,e,i,r,l,c,h,f,d,p){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=l,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=f,this.onKill_=d,this.lastSessionId=p,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=al("c:"+this.id+":"),this.transportManager_=new Ho(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));const r=t.healthyTimeout||0;r>0&&(this.healthyTimeout_=Ro(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>N2?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>R2?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(Hd in t){const e=t[Hd];e===x0?this.upgradeIfSecondaryHealthy_():e===b0?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===C0&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=Co("t",t),i=Co("d",t);if(e==="c")this.onSecondaryControl_(i);else if(e==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:w0,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:x0,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:T0,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=Co("t",t),i=Co("d",t);e==="c"?this.onControl_(i):e==="d"&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=Co(Hd,t);if(S0 in t){const i=t[S0];if(e===L2){const r={...i};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(e===T0){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===j2?this.onConnectionShutdown_(i):e===b0?this.onReset_(i):e===k2?dg("Server Error: "+i):e===C0?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):dg("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,i=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),Qg!==i&&Ve("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),Ro(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(A2))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ro(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(M2))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:w0,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ks.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yb{put(t,e,i,r){}merge(t,e,i,r){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(t){this.allowedEvents_=t,this.listeners_={},J(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const i=[...this.listeners_[t]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});const r=this.getInitialEvent(t);r&&e.apply(i,r)}off(t,e,i){this.validateEventType_(t);const r=this.listeners_[t]||[];for(let l=0;l<r.length;l++)if(r[l].callback===e&&(!i||i===r[l].context)){r.splice(l,1);return}}validateEventType_(t){J(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u extends Sb{static getInstance(){return new _u}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!YS()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return J(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E0=32,O0=768;class Gt{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}}function zt(){return new Gt("")}function xt(a){return a.pieceNum_>=a.pieces_.length?null:a.pieces_[a.pieceNum_]}function bs(a){return a.pieces_.length-a.pieceNum_}function Qt(a){let t=a.pieceNum_;return t<a.pieces_.length&&t++,new Gt(a.pieces_,t)}function Jg(a){return a.pieceNum_<a.pieces_.length?a.pieces_[a.pieces_.length-1]:null}function B2(a){let t="";for(let e=a.pieceNum_;e<a.pieces_.length;e++)a.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(a.pieces_[e])));return t||"/"}function Yo(a,t=0){return a.pieces_.slice(a.pieceNum_+t)}function bb(a){if(a.pieceNum_>=a.pieces_.length)return null;const t=[];for(let e=a.pieceNum_;e<a.pieces_.length-1;e++)t.push(a.pieces_[e]);return new Gt(t,0)}function le(a,t){const e=[];for(let i=a.pieceNum_;i<a.pieces_.length;i++)e.push(a.pieces_[i]);if(t instanceof Gt)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{const i=t.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&e.push(i[r])}return new Gt(e,0)}function Dt(a){return a.pieceNum_>=a.pieces_.length}function Ye(a,t){const e=xt(a),i=xt(t);if(e===null)return t;if(e===i)return Ye(Qt(a),Qt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+a+")")}function I2(a,t){const e=Yo(a,0),i=Yo(t,0);for(let r=0;r<e.length&&r<i.length;r++){const l=or(e[r],i[r]);if(l!==0)return l}return e.length===i.length?0:e.length<i.length?-1:1}function $g(a,t){if(bs(a)!==bs(t))return!1;for(let e=a.pieceNum_,i=t.pieceNum_;e<=a.pieces_.length;e++,i++)if(a.pieces_[e]!==t.pieces_[i])return!1;return!0}function Rn(a,t){let e=a.pieceNum_,i=t.pieceNum_;if(bs(a)>bs(t))return!1;for(;e<a.pieces_.length;){if(a.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}class F2{constructor(t,e){this.errorPrefix_=e,this.parts_=Yo(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Hu(this.parts_[i]);Cb(this)}}function U2(a,t){a.parts_.length>0&&(a.byteLength_+=1),a.parts_.push(t),a.byteLength_+=Hu(t),Cb(a)}function P2(a){const t=a.parts_.pop();a.byteLength_-=Hu(t),a.parts_.length>0&&(a.byteLength_-=1)}function Cb(a){if(a.byteLength_>O0)throw new Error(a.errorPrefix_+"has a key path longer than "+O0+" bytes ("+a.byteLength_+").");if(a.parts_.length>E0)throw new Error(a.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+E0+") or object contains a cycle "+qs(a))}function qs(a){return a.parts_.length===0?"":"in property '"+a.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tm extends Sb{static getInstance(){return new tm}constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(t){return J(t==="visible","Unknown event type: "+t),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xo=1e3,H2=300*1e3,D0=30*1e3,Y2=1.3,V2=3e4,G2="server_kill",A0=3;class Ai extends yb{constructor(t,e,i,r,l,c,h,f){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=l,this.authTokenProvider_=c,this.appCheckTokenProvider_=h,this.authOverride_=f,this.id=Ai.nextPersistentConnectionId_++,this.log_=al("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xo,this.maxReconnectDelay_=H2,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,f)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");tm.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&_u.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,i){const r=++this.requestNumber_,l={r,a:t,b:e};this.log_(Ce(l)),J(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(l),i&&(this.requestCBHash_[r]=i)}get(t){this.initConnection_();const e=new il,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:c=>{const h=c.d;c.s==="ok"?e.resolve(h):e.reject(h)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const l=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(l),e.promise}listen(t,e,i,r){this.initConnection_();const l=t._queryIdentifier,c=t._path.toString();this.log_("Listen called for "+c+" "+l),this.listens.has(c)||this.listens.set(c,new Map),J(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),J(!this.listens.get(c).has(l),"listen() called twice for same path/queryId.");const h={onComplete:r,hashFn:e,query:t,tag:i};this.listens.get(c).set(l,h),this.connected_&&this.sendListen_(h)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(i)})}sendListen_(t){const e=t.query,i=e._path.toString(),r=e._queryIdentifier;this.log_("Listen on "+i+" for "+r);const l={p:i},c="q";t.tag&&(l.q=e._queryObject,l.t=t.tag),l.h=t.hashFn(),this.sendRequest(c,l,h=>{const f=h.d,d=h.s;Ai.warnOnListenWarnings_(f,e),(this.listens.get(i)&&this.listens.get(i).get(r))===t&&(this.log_("listen response",h),d!=="ok"&&this.removeListen_(i,r),t.onComplete&&t.onComplete(d,f))})}static warnOnListenWarnings_(t,e){if(t&&typeof t=="object"&&ii(t,"w")){const i=ca(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const r='".indexOn": "'+e._queryParams.getIndex().toString()+'"',l=e._path.toString();Ve(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${l} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Nw(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=D0)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=Rw(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(e,i,r=>{const l=r.s,c=r.d||"error";this.authToken_===t&&(l==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(l,c))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const e=t.s,i=t.d||"error";e==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,i)})}unlisten(t,e){const i=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),J(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,t._queryObject,e)}sendUnlisten_(t,e,i,r){this.log_("Unlisten on "+t+" for "+e);const l={p:t},c="n";r&&(l.q=i,l.t=r),this.sendRequest(c,l)}onDisconnectPut(t,e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:i})}onDisconnectMerge(t,e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:i})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,i,r){const l={p:e,d:i};this.log_("onDisconnect "+t,l),this.sendRequest(t,l,c=>{r&&setTimeout(()=>{r(c.s,c.d)},Math.floor(0))})}put(t,e,i,r){this.putInternal("p",t,e,i,r)}merge(t,e,i,r){this.putInternal("m",t,e,i,r)}putInternal(t,e,i,r,l){this.initConnection_();const c={p:e,d:i};l!==void 0&&(c.h=l),this.outstandingPuts_.push({action:t,request:c,onComplete:r}),this.outstandingPutCount_++;const h=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(h):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,i,l=>{this.log_(e+" response",l),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(l.s,l.d)})}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,i=>{if(i.s!=="ok"){const l=i.d;this.log_("reportStats","Error sending stats: "+l)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ce(t));const e=t.r,i=this.requestCBHash_[e];i&&(delete this.requestCBHash_[e],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),t==="d"?this.onDataUpdate_(e.p,e.d,!1,e.t):t==="m"?this.onDataUpdate_(e.p,e.d,!0,e.t):t==="c"?this.onListenRevoked_(e.p,e.q):t==="ac"?this.onAuthRevoked_(e.s,e.d):t==="apc"?this.onAppCheckRevoked_(e.s,e.d):t==="sd"?this.onSecurityDebugPacket_(e):dg("Unrecognized action received from server: "+Ce(t)+`
Are you using the latest client?`)}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){J(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=xo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>V2&&(this.reconnectDelay_=xo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Y2)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Ai.nextConnectionId_++,l=this.lastSessionId;let c=!1,h=null;const f=function(){h?h.close():(c=!0,i())},d=function(_){J(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(_)};this.realtime_={close:f,sendRequest:d};const p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[_,v]=await Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);c?Le("getToken() completed but was canceled"):(Le("getToken() completed. Creating connection."),this.authToken_=_&&_.accessToken,this.appCheckToken_=v&&v.token,h=new z2(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,i,S=>{Ve(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(G2)},l))}catch(_){this.log_("Failed to get token: "+_),c||(this.repoInfo_.nodeAdmin&&Ve(_),f())}}}interrupt(t){Le("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Le("Resuming connection for reason: "+t),delete this.interruptReasons_[t],s0(this.interruptReasons_)&&(this.reconnectDelay_=xo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let i;e?i=e.map(l=>Wg(l)).join("$"):i="default";const r=this.removeListen_(t,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,e){const i=new Gt(t).toString();let r;if(this.listens.has(i)){const l=this.listens.get(i);r=l.get(e),l.delete(e),l.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(t,e){Le("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=A0&&(this.reconnectDelay_=D0,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Le("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=A0&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";t["sdk."+e+"."+JS.replace(/\./g,"-")]=1,YS()?t["framework.cordova"]=1:Tw()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=_u.getInstance().currentlyOnline();return s0(this.interruptReasons_)&&t}}Ai.nextPersistentConnectionId_=0;Ai.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new Tt(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const i=new Tt(ua,t),r=new Tt(ua,e);return this.compare(i,r)!==0}minPost(){return Tt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nc;class xb extends Yu{static get __EMPTY_NODE(){return Nc}static set __EMPTY_NODE(t){Nc=t}compare(t,e){return or(t.name,e.name)}isDefinedOn(t){throw pa("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return Tt.MIN}maxPost(){return new Tt(er,Nc)}makePost(t,e){return J(typeof t=="string","KeyIndex indexValue must always be a string."),new Tt(t,Nc)}toString(){return".key"}}const ra=new xb;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{constructor(t,e,i,r,l=null){this.isReverse_=r,this.resultGenerator_=l,this.nodeStack_=[];let c=1;for(;!t.isEmpty();)if(t=t,c=e?i(t.key,e):1,r&&(c*=-1),c<0)this.isReverse_?t=t.left:t=t.right;else if(c===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class De{constructor(t,e,i,r,l){this.key=t,this.value=e,this.color=i??De.RED,this.left=r??en.EMPTY_NODE,this.right=l??en.EMPTY_NODE}copy(t,e,i,r,l){return new De(t??this.key,e??this.value,i??this.color,r??this.left,l??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let r=this;const l=i(t,r.key);return l<0?r=r.copy(null,null,null,r.left.insert(t,e,i),null):l===0?r=r.copy(null,e,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,e,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return en.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let i,r;if(i=this,e(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),e(t,i.key)===0){if(i.right.isEmpty())return en.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,De.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,De.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}De.RED=!0;De.BLACK=!1;class X2{copy(t,e,i,r,l){return this}insert(t,e,i){return new De(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class en{constructor(t,e=en.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new en(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,De.BLACK,null,null))}remove(t){return new en(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,De.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),e===0)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,r=null;for(;!i.isEmpty();)if(e=this.comparator_(t,i.key),e===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else e<0?i=i.left:e>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new jc(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new jc(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new jc(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new jc(this.root_,null,this.comparator_,!0,t)}}en.EMPTY_NODE=new X2;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q2(a,t){return or(a.name,t.name)}function em(a,t){return or(a,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mg;function W2(a){mg=a}const Tb=function(a){return typeof a=="number"?"number:"+nb(a):"string:"+a},wb=function(a){if(a.isLeafNode()){const t=a.val();J(typeof t=="string"||typeof t=="number"||typeof t=="object"&&ii(t,".sv"),"Priority must be a string or number.")}else J(a===mg||a.isEmpty(),"priority of unexpected type.");J(a===mg||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let M0;class Oe{static set __childrenNodeConstructor(t){M0=t}static get __childrenNodeConstructor(){return M0}constructor(t,e=Oe.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,J(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),wb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Oe(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:Oe.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Dt(t)?this:xt(t)===".priority"?this.priorityNode_:Oe.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return t===".priority"?this.updatePriority(e):e.isEmpty()&&t!==".priority"?this:Oe.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const i=xt(t);return i===null?e:e.isEmpty()&&i!==".priority"?this:(J(i!==".priority"||bs(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,Oe.__childrenNodeConstructor.EMPTY_NODE.updateChild(Qt(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Tb(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",e==="number"?t+=nb(this.value_):t+=this.value_,this.lazyHash_=tb(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Oe.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Oe.__childrenNodeConstructor?-1:(J(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,i=typeof this.value_,r=Oe.VALUE_TYPE_ORDER.indexOf(e),l=Oe.VALUE_TYPE_ORDER.indexOf(i);return J(r>=0,"Unknown leaf type: "+e),J(l>=0,"Unknown leaf type: "+i),r===l?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:l-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}else return!1}}Oe.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eb,Ob;function Q2(a){Eb=a}function K2(a){Ob=a}class Z2 extends Yu{compare(t,e){const i=t.node.getPriority(),r=e.node.getPriority(),l=i.compareTo(r);return l===0?or(t.name,e.name):l}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return Tt.MIN}maxPost(){return new Tt(er,new Oe("[PRIORITY-POST]",Ob))}makePost(t,e){const i=Eb(t);return new Tt(e,new Oe("[PRIORITY-POST]",i))}toString(){return".priority"}}const ce=new Z2;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2=Math.log(2);class $2{constructor(t){const e=l=>parseInt(Math.log(l)/J2,10),i=l=>parseInt(Array(l+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const r=i(this.count);this.bits_=t+1&r}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const vu=function(a,t,e,i){a.sort(t);const r=function(f,d){const p=d-f;let _,v;if(p===0)return null;if(p===1)return _=a[f],v=e?e(_):_,new De(v,_.node,De.BLACK,null,null);{const S=parseInt(p/2,10)+f,b=r(f,S),T=r(S+1,d);return _=a[S],v=e?e(_):_,new De(v,_.node,De.BLACK,b,T)}},l=function(f){let d=null,p=null,_=a.length;const v=function(b,T){const w=_-b,N=_;_-=b;const I=r(w+1,N),j=a[w],Y=e?e(j):j;S(new De(Y,j.node,T,null,I))},S=function(b){d?(d.left=b,d=b):(p=b,d=b)};for(let b=0;b<f.count;++b){const T=f.nextBitIsOne(),w=Math.pow(2,f.count-(b+1));T?v(w,De.BLACK):(v(w,De.BLACK),v(w,De.RED))}return p},c=new $2(a.length),h=l(c);return new en(i||t,h)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yd;const Wr={};class Ei{static get Default(){return J(Wr&&ce,"ChildrenNode.ts has not been loaded"),Yd=Yd||new Ei({".priority":Wr},{".priority":ce}),Yd}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=ca(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof en?e:null}hasIndex(t){return ii(this.indexSet_,t.toString())}addIndex(t,e){J(t!==ra,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let r=!1;const l=e.getIterator(Tt.Wrap);let c=l.getNext();for(;c;)r=r||t.isDefinedOn(c.node),i.push(c),c=l.getNext();let h;r?h=vu(i,t.getCompare()):h=Wr;const f=t.toString(),d={...this.indexSet_};d[f]=t;const p={...this.indexes_};return p[f]=h,new Ei(p,d)}addToIndexes(t,e){const i=fu(this.indexes_,(r,l)=>{const c=ca(this.indexSet_,l);if(J(c,"Missing index implementation for "+l),r===Wr)if(c.isDefinedOn(t.node)){const h=[],f=e.getIterator(Tt.Wrap);let d=f.getNext();for(;d;)d.name!==t.name&&h.push(d),d=f.getNext();return h.push(t),vu(h,c.getCompare())}else return Wr;else{const h=e.get(t.name);let f=r;return h&&(f=f.remove(new Tt(t.name,h))),f.insert(t,t.node)}});return new Ei(i,this.indexSet_)}removeFromIndexes(t,e){const i=fu(this.indexes_,r=>{if(r===Wr)return r;{const l=e.get(t.name);return l?r.remove(new Tt(t.name,l)):r}});return new Ei(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let To;class ht{static get EMPTY_NODE(){return To||(To=new ht(new en(em),null,Ei.Default))}constructor(t,e,i){this.children_=t,this.priorityNode_=e,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&wb(this.priorityNode_),this.children_.isEmpty()&&J(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||To}updatePriority(t){return this.children_.isEmpty()?this:new ht(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{const e=this.children_.get(t);return e===null?To:e}}getChild(t){const e=xt(t);return e===null?this:this.getImmediateChild(e).getChild(Qt(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,e){if(J(e,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(e);{const i=new Tt(t,e);let r,l;e.isEmpty()?(r=this.children_.remove(t),l=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(t,e),l=this.indexMap_.addToIndexes(i,this.children_));const c=r.isEmpty()?To:this.priorityNode_;return new ht(r,c,l)}}updateChild(t,e){const i=xt(t);if(i===null)return e;{J(xt(t)!==".priority"||bs(t)===1,".priority must be the last token in a path");const r=this.getImmediateChild(i).updateChild(Qt(t),e);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let i=0,r=0,l=!0;if(this.forEachChild(ce,(c,h)=>{e[c]=h.val(t),i++,l&&ht.INTEGER_REGEXP_.test(c)?r=Math.max(r,Number(c)):l=!1}),!t&&l&&r<2*i){const c=[];for(const h in e)c[h]=e[h];return c}else return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Tb(this.getPriority().val())+":"),this.forEachChild(ce,(e,i)=>{const r=i.hash();r!==""&&(t+=":"+e+":"+r)}),this.lazyHash_=t===""?"":tb(t)}return this.lazyHash_}getPredecessorChildName(t,e,i){const r=this.resolveIndex_(i);if(r){const l=r.getPredecessorKey(new Tt(t,e));return l?l.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const i=e.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new Tt(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const i=e.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new Tt(e,this.children_.get(e)):null}forEachChild(t,e){const i=this.resolveIndex_(t);return i?i.inorderTraversal(r=>e(r.name,r.node)):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const i=this.resolveIndex_(e);if(i)return i.getIteratorFrom(t,r=>r);{const r=this.children_.getIteratorFrom(t.name,Tt.Wrap);let l=r.peek();for(;l!=null&&e.compare(l,t)<0;)r.getNext(),l=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const i=this.resolveIndex_(e);if(i)return i.getReverseIteratorFrom(t,r=>r);{const r=this.children_.getReverseIteratorFrom(t.name,Tt.Wrap);let l=r.peek();for(;l!=null&&e.compare(l,t)>0;)r.getNext(),l=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===ol?-1:0}withIndex(t){if(t===ra||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new ht(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===ra||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority()))if(this.children_.count()===e.children_.count()){const i=this.getIterator(ce),r=e.getIterator(ce);let l=i.getNext(),c=r.getNext();for(;l&&c;){if(l.name!==c.name||!l.node.equals(c.node))return!1;l=i.getNext(),c=r.getNext()}return l===null&&c===null}else return!1;else return!1}}resolveIndex_(t){return t===ra?null:this.indexMap_.get(t.toString())}}ht.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class tO extends ht{constructor(){super(new en(em),ht.EMPTY_NODE,Ei.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return ht.EMPTY_NODE}isEmpty(){return!1}}const ol=new tO;Object.defineProperties(Tt,{MIN:{value:new Tt(ua,ht.EMPTY_NODE)},MAX:{value:new Tt(er,ol)}});xb.__EMPTY_NODE=ht.EMPTY_NODE;Oe.__childrenNodeConstructor=ht;W2(ol);K2(ol);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eO=!0;function be(a,t=null){if(a===null)return ht.EMPTY_NODE;if(typeof a=="object"&&".priority"in a&&(t=a[".priority"]),J(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof a=="object"&&".value"in a&&a[".value"]!==null&&(a=a[".value"]),typeof a!="object"||".sv"in a){const e=a;return new Oe(e,be(t))}if(!(a instanceof Array)&&eO){const e=[];let i=!1;if(Be(a,(c,h)=>{if(c.substring(0,1)!=="."){const f=be(h);f.isEmpty()||(i=i||!f.getPriority().isEmpty(),e.push(new Tt(c,f)))}}),e.length===0)return ht.EMPTY_NODE;const l=vu(e,q2,c=>c.name,em);if(i){const c=vu(e,ce.getCompare());return new ht(l,be(t),new Ei({".priority":c},{".priority":ce}))}else return new ht(l,be(t),Ei.Default)}else{let e=ht.EMPTY_NODE;return Be(a,(i,r)=>{if(ii(a,i)&&i.substring(0,1)!=="."){const l=be(r);(l.isLeafNode()||!l.isEmpty())&&(e=e.updateImmediateChild(i,l))}}),e.updatePriority(be(t))}}Q2(be);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO extends Yu{constructor(t){super(),this.indexPath_=t,J(!Dt(t)&&xt(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const i=this.extractChild(t.node),r=this.extractChild(e.node),l=i.compareTo(r);return l===0?or(t.name,e.name):l}makePost(t,e){const i=be(t),r=ht.EMPTY_NODE.updateChild(this.indexPath_,i);return new Tt(e,r)}maxPost(){const t=ht.EMPTY_NODE.updateChild(this.indexPath_,ol);return new Tt(er,t)}toString(){return Yo(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iO extends Yu{compare(t,e){const i=t.node.compareTo(e.node);return i===0?or(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return Tt.MIN}maxPost(){return Tt.MAX}makePost(t,e){const i=be(t);return new Tt(e,i)}toString(){return".value"}}const sO=new iO;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Db(a){return{type:"value",snapshotNode:a}}function ha(a,t){return{type:"child_added",snapshotNode:t,childName:a}}function Vo(a,t){return{type:"child_removed",snapshotNode:t,childName:a}}function Go(a,t,e){return{type:"child_changed",snapshotNode:t,childName:a,oldSnap:e}}function rO(a,t){return{type:"child_moved",snapshotNode:t,childName:a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(t){this.index_=t}updateChild(t,e,i,r,l,c){J(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=t.getImmediateChild(e);return h.getChild(r).equals(i.getChild(r))&&h.isEmpty()===i.isEmpty()||(c!=null&&(i.isEmpty()?t.hasChild(e)?c.trackChildChange(Vo(e,h)):J(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(ha(e,i)):c.trackChildChange(Go(e,i,h))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(e,i).withIndex(this.index_)}updateFullNode(t,e,i){return i!=null&&(t.isLeafNode()||t.forEachChild(ce,(r,l)=>{e.hasChild(r)||i.trackChildChange(Vo(r,l))}),e.isLeafNode()||e.forEachChild(ce,(r,l)=>{if(t.hasChild(r)){const c=t.getImmediateChild(r);c.equals(l)||i.trackChildChange(Go(r,l,c))}else i.trackChildChange(ha(r,l))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?ht.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(t){this.indexedFilter_=new nm(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Xo.getStartPost_(t),this.endPost_=Xo.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&i}updateChild(t,e,i,r,l,c){return this.matches(new Tt(e,i))||(i=ht.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,r,l,c)}updateFullNode(t,e,i){e.isLeafNode()&&(e=ht.EMPTY_NODE);let r=e.withIndex(this.index_);r=r.updatePriority(ht.EMPTY_NODE);const l=this;return e.forEachChild(ce,(c,h)=>{l.matches(new Tt(c,h))||(r=r.updateImmediateChild(c,ht.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}else return t.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=e=>{const i=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Xo(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,i,r,l,c){return this.rangedFilter_.matches(new Tt(e,i))||(i=ht.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,r,l,c):this.fullLimitUpdateChild_(t,e,i,l,c)}updateFullNode(t,e,i){let r;if(e.isLeafNode()||e.isEmpty())r=ht.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<e.numChildren()&&e.isIndexed(this.index_)){r=ht.EMPTY_NODE.withIndex(this.index_);let l;this.reverse_?l=e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):l=e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;l.hasNext()&&c<this.limit_;){const h=l.getNext();if(this.withinDirectionalStart(h))if(this.withinDirectionalEnd(h))r=r.updateImmediateChild(h.name,h.node),c++;else break;else continue}}else{r=e.withIndex(this.index_),r=r.updatePriority(ht.EMPTY_NODE);let l;this.reverse_?l=r.getReverseIterator(this.index_):l=r.getIterator(this.index_);let c=0;for(;l.hasNext();){const h=l.getNext();c<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?c++:r=r.updateImmediateChild(h.name,ht.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,r,l){let c;if(this.reverse_){const _=this.index_.getCompare();c=(v,S)=>_(S,v)}else c=this.index_.getCompare();const h=t;J(h.numChildren()===this.limit_,"");const f=new Tt(e,i),d=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),p=this.rangedFilter_.matches(f);if(h.hasChild(e)){const _=h.getImmediateChild(e);let v=r.getChildAfterChild(this.index_,d,this.reverse_);for(;v!=null&&(v.name===e||h.hasChild(v.name));)v=r.getChildAfterChild(this.index_,v,this.reverse_);const S=v==null?1:c(v,f);if(p&&!i.isEmpty()&&S>=0)return l?.trackChildChange(Go(e,i,_)),h.updateImmediateChild(e,i);{l?.trackChildChange(Vo(e,_));const T=h.updateImmediateChild(e,ht.EMPTY_NODE);return v!=null&&this.rangedFilter_.matches(v)?(l?.trackChildChange(ha(v.name,v.node)),T.updateImmediateChild(v.name,v.node)):T}}else return i.isEmpty()?t:p&&c(d,f)>=0?(l!=null&&(l.trackChildChange(Vo(d.name,d.node)),l.trackChildChange(ha(e,i))),h.updateImmediateChild(e,i).updateImmediateChild(d.name,ht.EMPTY_NODE)):t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ce}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return J(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return J(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ua}hasEnd(){return this.endSet_}getIndexEndValue(){return J(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return J(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:er}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return J(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ce}copy(){const t=new im;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function oO(a){return a.loadsAllData()?new nm(a.getIndex()):a.hasLimit()?new aO(a):new Xo(a)}function R0(a){const t={};if(a.isDefault())return t;let e;if(a.index_===ce?e="$priority":a.index_===sO?e="$value":a.index_===ra?e="$key":(J(a.index_ instanceof nO,"Unrecognized index type!"),e=a.index_.toString()),t.orderBy=Ce(e),a.startSet_){const i=a.startAfterSet_?"startAfter":"startAt";t[i]=Ce(a.indexStartValue_),a.startNameSet_&&(t[i]+=","+Ce(a.indexStartName_))}if(a.endSet_){const i=a.endBeforeSet_?"endBefore":"endAt";t[i]=Ce(a.indexEndValue_),a.endNameSet_&&(t[i]+=","+Ce(a.indexEndName_))}return a.limitSet_&&(a.isViewFromLeft()?t.limitToFirst=a.limit_:t.limitToLast=a.limit_),t}function N0(a){const t={};if(a.startSet_&&(t.sp=a.indexStartValue_,a.startNameSet_&&(t.sn=a.indexStartName_),t.sin=!a.startAfterSet_),a.endSet_&&(t.ep=a.indexEndValue_,a.endNameSet_&&(t.en=a.indexEndName_),t.ein=!a.endBeforeSet_),a.limitSet_){t.l=a.limit_;let e=a.viewFrom_;e===""&&(a.isViewFromLeft()?e="l":e="r"),t.vf=e}return a.index_!==ce&&(t.i=a.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu extends yb{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(J(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,i,r){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=al("p:rest:"),this.listens_={}}listen(t,e,i,r){const l=t._path.toString();this.log_("Listen called for "+l+" "+t._queryIdentifier);const c=yu.getListenId_(t,i),h={};this.listens_[c]=h;const f=R0(t._queryParams);this.restRequest_(l+".json",f,(d,p)=>{let _=p;if(d===404&&(_=null,d=null),d===null&&this.onDataUpdate_(l,_,!1,i),ca(this.listens_,c)===h){let v;d?d===401?v="permission_denied":v="rest_error:"+d:v="ok",r(v,null)}})}unlisten(t,e){const i=yu.getListenId_(t,e);delete this.listens_[i]}get(t){const e=R0(t._queryParams),i=t._path.toString(),r=new il;return this.restRequest_(i+".json",e,(l,c)=>{let h=c;l===404&&(h=null,l=null),l===null?(this.onDataUpdate_(i,h,!1,null),r.resolve(h)):r.reject(new Error(h))}),r.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,l])=>{r&&r.accessToken&&(e.auth=r.accessToken),l&&l.token&&(e.ac=l.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+jw(e);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(i&&h.readyState===4){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let f=null;if(h.status>=200&&h.status<300){try{f=Fo(h.responseText)}catch{Ve("Failed to parse JSON response for "+c+": "+h.responseText)}i(null,f)}else h.status!==401&&h.status!==404&&Ve("Got unsuccessful REST response for "+c+" Status: "+h.status),i(h.status);i=null}},h.open("GET",c,!0),h.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(){this.rootNode_=ht.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(){return{value:null,children:new Map}}function Ab(a,t,e){if(Dt(t))a.value=e,a.children.clear();else if(a.value!==null)a.value=a.value.updateChild(t,e);else{const i=xt(t);a.children.has(i)||a.children.set(i,Su());const r=a.children.get(i);t=Qt(t),Ab(r,t,e)}}function pg(a,t,e){a.value!==null?e(t,a.value):cO(a,(i,r)=>{const l=new Gt(t.toString()+"/"+i);pg(r,l,e)})}function cO(a,t){a.children.forEach((e,i)=>{t(i,e)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uO{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e={...t};return this.last_&&Be(this.last_,(i,r)=>{e[i]=e[i]-r}),this.last_=t,e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j0=10*1e3,hO=30*1e3,fO=300*1e3;class dO{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new uO(t);const i=j0+(hO-j0)*Math.random();Ro(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const t=this.statsListener_.get(),e={};let i=!1;Be(t,(r,l)=>{l>0&&ii(this.statsToReport_,r)&&(e[r]=l,i=!0)}),i&&this.server_.reportStats(e),Ro(this.reportStats_.bind(this),Math.floor(Math.random()*2*fO))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yn;(function(a){a[a.OVERWRITE=0]="OVERWRITE",a[a.MERGE=1]="MERGE",a[a.ACK_USER_WRITE=2]="ACK_USER_WRITE",a[a.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Yn||(Yn={}));function sm(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rm(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function am(a){return{fromUser:!1,fromServer:!0,queryId:a,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=Yn.ACK_USER_WRITE,this.source=sm()}operationForChild(t){if(Dt(this.path)){if(this.affectedTree.value!=null)return J(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Gt(t));return new bu(zt(),e,this.revert)}}else return J(xt(this.path)===t,"operationForChild called for unrelated child."),new bu(Qt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(t,e){this.source=t,this.path=e,this.type=Yn.LISTEN_COMPLETE}operationForChild(t){return Dt(this.path)?new qo(this.source,zt()):new qo(this.source,Qt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=Yn.OVERWRITE}operationForChild(t){return Dt(this.path)?new nr(this.source,zt(),this.snap.getImmediateChild(t)):new nr(this.source,Qt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=Yn.MERGE}operationForChild(t){if(Dt(this.path)){const e=this.children.subtree(new Gt(t));return e.isEmpty()?null:e.value?new nr(this.source,zt(),e.value):new fa(this.source,zt(),e)}else return J(xt(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new fa(this.source,Qt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(Dt(t))return this.isFullyInitialized()&&!this.filtered_;const e=xt(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function mO(a,t,e,i){const r=[],l=[];return t.forEach(c=>{c.type==="child_changed"&&a.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&l.push(rO(c.childName,c.snapshotNode))}),wo(a,r,"child_removed",t,i,e),wo(a,r,"child_added",t,i,e),wo(a,r,"child_moved",l,i,e),wo(a,r,"child_changed",t,i,e),wo(a,r,"value",t,i,e),r}function wo(a,t,e,i,r,l){const c=i.filter(h=>h.type===e);c.sort((h,f)=>_O(a,h,f)),c.forEach(h=>{const f=pO(a,h,l);r.forEach(d=>{d.respondsTo(h.type)&&t.push(d.createEvent(f,a.query_))})})}function pO(a,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,a.index_)),t}function _O(a,t,e){if(t.childName==null||e.childName==null)throw pa("Should only compare child_ events.");const i=new Tt(t.childName,t.snapshotNode),r=new Tt(e.childName,e.snapshotNode);return a.index_.compare(i,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vu(a,t){return{eventCache:a,serverCache:t}}function No(a,t,e,i){return Vu(new Cs(t,e,i),a.serverCache)}function Mb(a,t,e,i){return Vu(a.eventCache,new Cs(t,e,i))}function Cu(a){return a.eventCache.isFullyInitialized()?a.eventCache.getNode():null}function ir(a){return a.serverCache.isFullyInitialized()?a.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vd;const vO=()=>(Vd||(Vd=new en(n2)),Vd);class qt{static fromObject(t){let e=new qt(null);return Be(t,(i,r)=>{e=e.set(new Gt(i),r)}),e}constructor(t,e=vO()){this.value=t,this.children=e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:zt(),value:this.value};if(Dt(t))return null;{const i=xt(t),r=this.children.get(i);if(r!==null){const l=r.findRootMostMatchingPathAndValue(Qt(t),e);return l!=null?{path:le(new Gt(i),l.path),value:l.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(Dt(t))return this;{const e=xt(t),i=this.children.get(e);return i!==null?i.subtree(Qt(t)):new qt(null)}}set(t,e){if(Dt(t))return new qt(e,this.children);{const i=xt(t),l=(this.children.get(i)||new qt(null)).set(Qt(t),e),c=this.children.insert(i,l);return new qt(this.value,c)}}remove(t){if(Dt(t))return this.children.isEmpty()?new qt(null):new qt(null,this.children);{const e=xt(t),i=this.children.get(e);if(i){const r=i.remove(Qt(t));let l;return r.isEmpty()?l=this.children.remove(e):l=this.children.insert(e,r),this.value===null&&l.isEmpty()?new qt(null):new qt(this.value,l)}else return this}}get(t){if(Dt(t))return this.value;{const e=xt(t),i=this.children.get(e);return i?i.get(Qt(t)):null}}setTree(t,e){if(Dt(t))return e;{const i=xt(t),l=(this.children.get(i)||new qt(null)).setTree(Qt(t),e);let c;return l.isEmpty()?c=this.children.remove(i):c=this.children.insert(i,l),new qt(this.value,c)}}fold(t){return this.fold_(zt(),t)}fold_(t,e){const i={};return this.children.inorderTraversal((r,l)=>{i[r]=l.fold_(le(t,r),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,zt(),e)}findOnPath_(t,e,i){const r=this.value?i(e,this.value):!1;if(r)return r;if(Dt(t))return null;{const l=xt(t),c=this.children.get(l);return c?c.findOnPath_(Qt(t),le(e,l),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,zt(),e)}foreachOnPath_(t,e,i){if(Dt(t))return this;{this.value&&i(e,this.value);const r=xt(t),l=this.children.get(r);return l?l.foreachOnPath_(Qt(t),le(e,r),i):new qt(null)}}foreach(t){this.foreach_(zt(),t)}foreach_(t,e){this.children.inorderTraversal((i,r)=>{r.foreach_(le(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(t){this.writeTree_=t}static empty(){return new qn(new qt(null))}}function jo(a,t,e){if(Dt(t))return new qn(new qt(e));{const i=a.writeTree_.findRootMostValueAndPath(t);if(i!=null){const r=i.path;let l=i.value;const c=Ye(r,t);return l=l.updateChild(c,e),new qn(a.writeTree_.set(r,l))}else{const r=new qt(e),l=a.writeTree_.setTree(t,r);return new qn(l)}}}function _g(a,t,e){let i=a;return Be(e,(r,l)=>{i=jo(i,le(t,r),l)}),i}function k0(a,t){if(Dt(t))return qn.empty();{const e=a.writeTree_.setTree(t,new qt(null));return new qn(e)}}function vg(a,t){return lr(a,t)!=null}function lr(a,t){const e=a.writeTree_.findRootMostValueAndPath(t);return e!=null?a.writeTree_.get(e.path).getChild(Ye(e.path,t)):null}function L0(a){const t=[],e=a.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(ce,(i,r)=>{t.push(new Tt(i,r))}):a.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&t.push(new Tt(i,r.value))}),t}function ys(a,t){if(Dt(t))return a;{const e=lr(a,t);return e!=null?new qn(new qt(e)):new qn(a.writeTree_.subtree(t))}}function yg(a){return a.writeTree_.isEmpty()}function da(a,t){return Rb(zt(),a.writeTree_,t)}function Rb(a,t,e){if(t.value!=null)return e.updateChild(a,t.value);{let i=null;return t.children.inorderTraversal((r,l)=>{r===".priority"?(J(l.value!==null,"Priority writes must always be leaf nodes"),i=l.value):e=Rb(le(a,r),l,e)}),!e.getChild(a).isEmpty()&&i!==null&&(e=e.updateChild(le(a,".priority"),i)),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(a,t){return Lb(t,a)}function yO(a,t,e,i,r){J(i>a.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),a.allWrites.push({path:t,snap:e,writeId:i,visible:r}),r&&(a.visibleWrites=jo(a.visibleWrites,t,e)),a.lastWriteId=i}function SO(a,t,e,i){J(i>a.lastWriteId,"Stacking an older merge on top of newer ones"),a.allWrites.push({path:t,children:e,writeId:i,visible:!0}),a.visibleWrites=_g(a.visibleWrites,t,e),a.lastWriteId=i}function bO(a,t){for(let e=0;e<a.allWrites.length;e++){const i=a.allWrites[e];if(i.writeId===t)return i}return null}function CO(a,t){const e=a.allWrites.findIndex(h=>h.writeId===t);J(e>=0,"removeWrite called with nonexistent writeId.");const i=a.allWrites[e];a.allWrites.splice(e,1);let r=i.visible,l=!1,c=a.allWrites.length-1;for(;r&&c>=0;){const h=a.allWrites[c];h.visible&&(c>=e&&xO(h,i.path)?r=!1:Rn(i.path,h.path)&&(l=!0)),c--}if(r){if(l)return TO(a),!0;if(i.snap)a.visibleWrites=k0(a.visibleWrites,i.path);else{const h=i.children;Be(h,f=>{a.visibleWrites=k0(a.visibleWrites,le(i.path,f))})}return!0}else return!1}function xO(a,t){if(a.snap)return Rn(a.path,t);for(const e in a.children)if(a.children.hasOwnProperty(e)&&Rn(le(a.path,e),t))return!0;return!1}function TO(a){a.visibleWrites=Nb(a.allWrites,wO,zt()),a.allWrites.length>0?a.lastWriteId=a.allWrites[a.allWrites.length-1].writeId:a.lastWriteId=-1}function wO(a){return a.visible}function Nb(a,t,e){let i=qn.empty();for(let r=0;r<a.length;++r){const l=a[r];if(t(l)){const c=l.path;let h;if(l.snap)Rn(e,c)?(h=Ye(e,c),i=jo(i,h,l.snap)):Rn(c,e)&&(h=Ye(c,e),i=jo(i,zt(),l.snap.getChild(h)));else if(l.children){if(Rn(e,c))h=Ye(e,c),i=_g(i,h,l.children);else if(Rn(c,e))if(h=Ye(c,e),Dt(h))i=_g(i,zt(),l.children);else{const f=ca(l.children,xt(h));if(f){const d=f.getChild(Qt(h));i=jo(i,zt(),d)}}}else throw pa("WriteRecord should have .snap or .children")}}return i}function jb(a,t,e,i,r){if(!i&&!r){const l=lr(a.visibleWrites,t);if(l!=null)return l;{const c=ys(a.visibleWrites,t);if(yg(c))return e;if(e==null&&!vg(c,zt()))return null;{const h=e||ht.EMPTY_NODE;return da(c,h)}}}else{const l=ys(a.visibleWrites,t);if(!r&&yg(l))return e;if(!r&&e==null&&!vg(l,zt()))return null;{const c=function(d){return(d.visible||r)&&(!i||!~i.indexOf(d.writeId))&&(Rn(d.path,t)||Rn(t,d.path))},h=Nb(a.allWrites,c,t),f=e||ht.EMPTY_NODE;return da(h,f)}}}function EO(a,t,e){let i=ht.EMPTY_NODE;const r=lr(a.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(ce,(l,c)=>{i=i.updateImmediateChild(l,c)}),i;if(e){const l=ys(a.visibleWrites,t);return e.forEachChild(ce,(c,h)=>{const f=da(ys(l,new Gt(c)),h);i=i.updateImmediateChild(c,f)}),L0(l).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}else{const l=ys(a.visibleWrites,t);return L0(l).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}}function OO(a,t,e,i,r){J(i||r,"Either existingEventSnap or existingServerSnap must exist");const l=le(t,e);if(vg(a.visibleWrites,l))return null;{const c=ys(a.visibleWrites,l);return yg(c)?r.getChild(e):da(c,r.getChild(e))}}function DO(a,t,e,i){const r=le(t,e),l=lr(a.visibleWrites,r);if(l!=null)return l;if(i.isCompleteForChild(e)){const c=ys(a.visibleWrites,r);return da(c,i.getNode().getImmediateChild(e))}else return null}function AO(a,t){return lr(a.visibleWrites,t)}function MO(a,t,e,i,r,l,c){let h;const f=ys(a.visibleWrites,t),d=lr(f,zt());if(d!=null)h=d;else if(e!=null)h=da(f,e);else return[];if(h=h.withIndex(c),!h.isEmpty()&&!h.isLeafNode()){const p=[],_=c.getCompare(),v=l?h.getReverseIteratorFrom(i,c):h.getIteratorFrom(i,c);let S=v.getNext();for(;S&&p.length<r;)_(S,i)!==0&&p.push(S),S=v.getNext();return p}else return[]}function RO(){return{visibleWrites:qn.empty(),allWrites:[],lastWriteId:-1}}function xu(a,t,e,i){return jb(a.writeTree,a.treePath,t,e,i)}function om(a,t){return EO(a.writeTree,a.treePath,t)}function z0(a,t,e,i){return OO(a.writeTree,a.treePath,t,e,i)}function Tu(a,t){return AO(a.writeTree,le(a.treePath,t))}function NO(a,t,e,i,r,l){return MO(a.writeTree,a.treePath,t,e,i,r,l)}function lm(a,t,e){return DO(a.writeTree,a.treePath,t,e)}function kb(a,t){return Lb(le(a.treePath,t),a.writeTree)}function Lb(a,t){return{treePath:a,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jO{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,i=t.childName;J(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),J(i!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(i);if(r){const l=r.type;if(e==="child_added"&&l==="child_removed")this.changeMap.set(i,Go(i,t.snapshotNode,r.snapshotNode));else if(e==="child_removed"&&l==="child_added")this.changeMap.delete(i);else if(e==="child_removed"&&l==="child_changed")this.changeMap.set(i,Vo(i,r.oldSnap));else if(e==="child_changed"&&l==="child_added")this.changeMap.set(i,ha(i,t.snapshotNode));else if(e==="child_changed"&&l==="child_changed")this.changeMap.set(i,Go(i,t.snapshotNode,r.oldSnap));else throw pa("Illegal combination of changes: "+t+" occurred after "+r)}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kO{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}}const zb=new kO;class cm{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const i=this.optCompleteServerCache_!=null?new Cs(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return lm(this.writes_,t,i)}}getChildAfterChild(t,e,i){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ir(this.viewCache_),l=NO(this.writes_,r,e,1,i,t);return l.length===0?null:l[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LO(a){return{filter:a}}function zO(a,t){J(t.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),J(t.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed")}function BO(a,t,e,i,r){const l=new jO;let c,h;if(e.type===Yn.OVERWRITE){const d=e;d.source.fromUser?c=Sg(a,t,d.path,d.snap,i,r,l):(J(d.source.fromServer,"Unknown source."),h=d.source.tagged||t.serverCache.isFiltered()&&!Dt(d.path),c=wu(a,t,d.path,d.snap,i,r,h,l))}else if(e.type===Yn.MERGE){const d=e;d.source.fromUser?c=FO(a,t,d.path,d.children,i,r,l):(J(d.source.fromServer,"Unknown source."),h=d.source.tagged||t.serverCache.isFiltered(),c=bg(a,t,d.path,d.children,i,r,h,l))}else if(e.type===Yn.ACK_USER_WRITE){const d=e;d.revert?c=HO(a,t,d.path,i,r,l):c=UO(a,t,d.path,d.affectedTree,i,r,l)}else if(e.type===Yn.LISTEN_COMPLETE)c=PO(a,t,e.path,i,l);else throw pa("Unknown operation type: "+e.type);const f=l.getChanges();return IO(t,c,f),{viewCache:c,changes:f}}function IO(a,t,e){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),l=Cu(a);(e.length>0||!a.eventCache.isFullyInitialized()||r&&!i.getNode().equals(l)||!i.getNode().getPriority().equals(l.getPriority()))&&e.push(Db(Cu(t)))}}function Bb(a,t,e,i,r,l){const c=t.eventCache;if(Tu(i,e)!=null)return t;{let h,f;if(Dt(e))if(J(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const d=ir(t),p=d instanceof ht?d:ht.EMPTY_NODE,_=om(i,p);h=a.filter.updateFullNode(t.eventCache.getNode(),_,l)}else{const d=xu(i,ir(t));h=a.filter.updateFullNode(t.eventCache.getNode(),d,l)}else{const d=xt(e);if(d===".priority"){J(bs(e)===1,"Can't have a priority with additional path components");const p=c.getNode();f=t.serverCache.getNode();const _=z0(i,e,p,f);_!=null?h=a.filter.updatePriority(p,_):h=c.getNode()}else{const p=Qt(e);let _;if(c.isCompleteForChild(d)){f=t.serverCache.getNode();const v=z0(i,e,c.getNode(),f);v!=null?_=c.getNode().getImmediateChild(d).updateChild(p,v):_=c.getNode().getImmediateChild(d)}else _=lm(i,d,t.serverCache);_!=null?h=a.filter.updateChild(c.getNode(),d,_,p,r,l):h=c.getNode()}}return No(t,h,c.isFullyInitialized()||Dt(e),a.filter.filtersNodes())}}function wu(a,t,e,i,r,l,c,h){const f=t.serverCache;let d;const p=c?a.filter:a.filter.getIndexedFilter();if(Dt(e))d=p.updateFullNode(f.getNode(),i,null);else if(p.filtersNodes()&&!f.isFiltered()){const S=f.getNode().updateChild(e,i);d=p.updateFullNode(f.getNode(),S,null)}else{const S=xt(e);if(!f.isCompleteForPath(e)&&bs(e)>1)return t;const b=Qt(e),w=f.getNode().getImmediateChild(S).updateChild(b,i);S===".priority"?d=p.updatePriority(f.getNode(),w):d=p.updateChild(f.getNode(),S,w,b,zb,null)}const _=Mb(t,d,f.isFullyInitialized()||Dt(e),p.filtersNodes()),v=new cm(r,_,l);return Bb(a,_,e,r,v,h)}function Sg(a,t,e,i,r,l,c){const h=t.eventCache;let f,d;const p=new cm(r,t,l);if(Dt(e))d=a.filter.updateFullNode(t.eventCache.getNode(),i,c),f=No(t,d,!0,a.filter.filtersNodes());else{const _=xt(e);if(_===".priority")d=a.filter.updatePriority(t.eventCache.getNode(),i),f=No(t,d,h.isFullyInitialized(),h.isFiltered());else{const v=Qt(e),S=h.getNode().getImmediateChild(_);let b;if(Dt(v))b=i;else{const T=p.getCompleteChild(_);T!=null?Jg(v)===".priority"&&T.getChild(bb(v)).isEmpty()?b=T:b=T.updateChild(v,i):b=ht.EMPTY_NODE}if(S.equals(b))f=t;else{const T=a.filter.updateChild(h.getNode(),_,b,v,p,c);f=No(t,T,h.isFullyInitialized(),a.filter.filtersNodes())}}}return f}function B0(a,t){return a.eventCache.isCompleteForChild(t)}function FO(a,t,e,i,r,l,c){let h=t;return i.foreach((f,d)=>{const p=le(e,f);B0(t,xt(p))&&(h=Sg(a,h,p,d,r,l,c))}),i.foreach((f,d)=>{const p=le(e,f);B0(t,xt(p))||(h=Sg(a,h,p,d,r,l,c))}),h}function I0(a,t,e){return e.foreach((i,r)=>{t=t.updateChild(i,r)}),t}function bg(a,t,e,i,r,l,c,h){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let f=t,d;Dt(e)?d=i:d=new qt(null).setTree(e,i);const p=t.serverCache.getNode();return d.children.inorderTraversal((_,v)=>{if(p.hasChild(_)){const S=t.serverCache.getNode().getImmediateChild(_),b=I0(a,S,v);f=wu(a,f,new Gt(_),b,r,l,c,h)}}),d.children.inorderTraversal((_,v)=>{const S=!t.serverCache.isCompleteForChild(_)&&v.value===null;if(!p.hasChild(_)&&!S){const b=t.serverCache.getNode().getImmediateChild(_),T=I0(a,b,v);f=wu(a,f,new Gt(_),T,r,l,c,h)}}),f}function UO(a,t,e,i,r,l,c){if(Tu(r,e)!=null)return t;const h=t.serverCache.isFiltered(),f=t.serverCache;if(i.value!=null){if(Dt(e)&&f.isFullyInitialized()||f.isCompleteForPath(e))return wu(a,t,e,f.getNode().getChild(e),r,l,h,c);if(Dt(e)){let d=new qt(null);return f.getNode().forEachChild(ra,(p,_)=>{d=d.set(new Gt(p),_)}),bg(a,t,e,d,r,l,h,c)}else return t}else{let d=new qt(null);return i.foreach((p,_)=>{const v=le(e,p);f.isCompleteForPath(v)&&(d=d.set(p,f.getNode().getChild(v)))}),bg(a,t,e,d,r,l,h,c)}}function PO(a,t,e,i,r){const l=t.serverCache,c=Mb(t,l.getNode(),l.isFullyInitialized()||Dt(e),l.isFiltered());return Bb(a,c,e,i,zb,r)}function HO(a,t,e,i,r,l){let c;if(Tu(i,e)!=null)return t;{const h=new cm(i,t,r),f=t.eventCache.getNode();let d;if(Dt(e)||xt(e)===".priority"){let p;if(t.serverCache.isFullyInitialized())p=xu(i,ir(t));else{const _=t.serverCache.getNode();J(_ instanceof ht,"serverChildren would be complete if leaf node"),p=om(i,_)}p=p,d=a.filter.updateFullNode(f,p,l)}else{const p=xt(e);let _=lm(i,p,t.serverCache);_==null&&t.serverCache.isCompleteForChild(p)&&(_=f.getImmediateChild(p)),_!=null?d=a.filter.updateChild(f,p,_,Qt(e),h,l):t.eventCache.getNode().hasChild(p)?d=a.filter.updateChild(f,p,ht.EMPTY_NODE,Qt(e),h,l):d=f,d.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=xu(i,ir(t)),c.isLeafNode()&&(d=a.filter.updateFullNode(d,c,l)))}return c=t.serverCache.isFullyInitialized()||Tu(i,zt())!=null,No(t,d,c,a.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YO{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const i=this.query_._queryParams,r=new nm(i.getIndex()),l=oO(i);this.processor_=LO(l);const c=e.serverCache,h=e.eventCache,f=r.updateFullNode(ht.EMPTY_NODE,c.getNode(),null),d=l.updateFullNode(ht.EMPTY_NODE,h.getNode(),null),p=new Cs(f,c.isFullyInitialized(),r.filtersNodes()),_=new Cs(d,h.isFullyInitialized(),l.filtersNodes());this.viewCache_=Vu(_,p),this.eventGenerator_=new gO(this.query_)}get query(){return this.query_}}function VO(a){return a.viewCache_.serverCache.getNode()}function GO(a){return Cu(a.viewCache_)}function XO(a,t){const e=ir(a.viewCache_);return e&&(a.query._queryParams.loadsAllData()||!Dt(t)&&!e.getImmediateChild(xt(t)).isEmpty())?e.getChild(t):null}function F0(a){return a.eventRegistrations_.length===0}function qO(a,t){a.eventRegistrations_.push(t)}function U0(a,t,e){const i=[];if(e){J(t==null,"A cancel should cancel all event registrations.");const r=a.query._path;a.eventRegistrations_.forEach(l=>{const c=l.createCancelEvent(e,r);c&&i.push(c)})}if(t){let r=[];for(let l=0;l<a.eventRegistrations_.length;++l){const c=a.eventRegistrations_[l];if(!c.matches(t))r.push(c);else if(t.hasAnyCallback()){r=r.concat(a.eventRegistrations_.slice(l+1));break}}a.eventRegistrations_=r}else a.eventRegistrations_=[];return i}function P0(a,t,e,i){t.type===Yn.MERGE&&t.source.queryId!==null&&(J(ir(a.viewCache_),"We should always have a full cache before handling merges"),J(Cu(a.viewCache_),"Missing event cache, even though we have a server cache"));const r=a.viewCache_,l=BO(a.processor_,r,t,e,i);return zO(a.processor_,l.viewCache),J(l.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),a.viewCache_=l.viewCache,Ib(a,l.changes,l.viewCache.eventCache.getNode(),null)}function WO(a,t){const e=a.viewCache_.eventCache,i=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(ce,(l,c)=>{i.push(ha(l,c))}),e.isFullyInitialized()&&i.push(Db(e.getNode())),Ib(a,i,e.getNode(),t)}function Ib(a,t,e,i){const r=i?[i]:a.eventRegistrations_;return mO(a.eventGenerator_,t,e,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eu;class Fb{constructor(){this.views=new Map}}function QO(a){J(!Eu,"__referenceConstructor has already been defined"),Eu=a}function KO(){return J(Eu,"Reference.ts has not been loaded"),Eu}function ZO(a){return a.views.size===0}function um(a,t,e,i){const r=t.source.queryId;if(r!==null){const l=a.views.get(r);return J(l!=null,"SyncTree gave us an op for an invalid query."),P0(l,t,e,i)}else{let l=[];for(const c of a.views.values())l=l.concat(P0(c,t,e,i));return l}}function Ub(a,t,e,i,r){const l=t._queryIdentifier,c=a.views.get(l);if(!c){let h=xu(e,r?i:null),f=!1;h?f=!0:i instanceof ht?(h=om(e,i),f=!1):(h=ht.EMPTY_NODE,f=!1);const d=Vu(new Cs(h,f,!1),new Cs(i,r,!1));return new YO(t,d)}return c}function JO(a,t,e,i,r,l){const c=Ub(a,t,i,r,l);return a.views.has(t._queryIdentifier)||a.views.set(t._queryIdentifier,c),qO(c,e),WO(c,e)}function $O(a,t,e,i){const r=t._queryIdentifier,l=[];let c=[];const h=xs(a);if(r==="default")for(const[f,d]of a.views.entries())c=c.concat(U0(d,e,i)),F0(d)&&(a.views.delete(f),d.query._queryParams.loadsAllData()||l.push(d.query));else{const f=a.views.get(r);f&&(c=c.concat(U0(f,e,i)),F0(f)&&(a.views.delete(r),f.query._queryParams.loadsAllData()||l.push(f.query)))}return h&&!xs(a)&&l.push(new(KO())(t._repo,t._path)),{removed:l,events:c}}function Pb(a){const t=[];for(const e of a.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function Ss(a,t){let e=null;for(const i of a.views.values())e=e||XO(i,t);return e}function Hb(a,t){if(t._queryParams.loadsAllData())return Xu(a);{const i=t._queryIdentifier;return a.views.get(i)}}function Yb(a,t){return Hb(a,t)!=null}function xs(a){return Xu(a)!=null}function Xu(a){for(const t of a.views.values())if(t.query._queryParams.loadsAllData())return t;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ou;function tD(a){J(!Ou,"__referenceConstructor has already been defined"),Ou=a}function eD(){return J(Ou,"Reference.ts has not been loaded"),Ou}let nD=1;class H0{constructor(t){this.listenProvider_=t,this.syncPointTree_=new qt(null),this.pendingWriteTree_=RO(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Vb(a,t,e,i,r){return yO(a.pendingWriteTree_,t,e,i,r),r?va(a,new nr(sm(),t,e)):[]}function iD(a,t,e,i){SO(a.pendingWriteTree_,t,e,i);const r=qt.fromObject(e);return va(a,new fa(sm(),t,r))}function ps(a,t,e=!1){const i=bO(a.pendingWriteTree_,t);if(CO(a.pendingWriteTree_,t)){let l=new qt(null);return i.snap!=null?l=l.set(zt(),!0):Be(i.children,c=>{l=l.set(new Gt(c),!0)}),va(a,new bu(i.path,l,e))}else return[]}function ll(a,t,e){return va(a,new nr(rm(),t,e))}function sD(a,t,e){const i=qt.fromObject(e);return va(a,new fa(rm(),t,i))}function rD(a,t){return va(a,new qo(rm(),t))}function aD(a,t,e){const i=fm(a,e);if(i){const r=dm(i),l=r.path,c=r.queryId,h=Ye(l,t),f=new qo(am(c),h);return gm(a,l,f)}else return[]}function Du(a,t,e,i,r=!1){const l=t._path,c=a.syncPointTree_.get(l);let h=[];if(c&&(t._queryIdentifier==="default"||Yb(c,t))){const f=$O(c,t,e,i);ZO(c)&&(a.syncPointTree_=a.syncPointTree_.remove(l));const d=f.removed;if(h=f.events,!r){const p=d.findIndex(v=>v._queryParams.loadsAllData())!==-1,_=a.syncPointTree_.findOnPath(l,(v,S)=>xs(S));if(p&&!_){const v=a.syncPointTree_.subtree(l);if(!v.isEmpty()){const S=cD(v);for(let b=0;b<S.length;++b){const T=S[b],w=T.query,N=Wb(a,T);a.listenProvider_.startListening(ko(w),Wo(a,w),N.hashFn,N.onComplete)}}}!_&&d.length>0&&!i&&(p?a.listenProvider_.stopListening(ko(t),null):d.forEach(v=>{const S=a.queryToTagMap.get(qu(v));a.listenProvider_.stopListening(ko(v),S)}))}uD(a,d)}return h}function Gb(a,t,e,i){const r=fm(a,i);if(r!=null){const l=dm(r),c=l.path,h=l.queryId,f=Ye(c,t),d=new nr(am(h),f,e);return gm(a,c,d)}else return[]}function oD(a,t,e,i){const r=fm(a,i);if(r){const l=dm(r),c=l.path,h=l.queryId,f=Ye(c,t),d=qt.fromObject(e),p=new fa(am(h),f,d);return gm(a,c,p)}else return[]}function Cg(a,t,e,i=!1){const r=t._path;let l=null,c=!1;a.syncPointTree_.foreachOnPath(r,(v,S)=>{const b=Ye(v,r);l=l||Ss(S,b),c=c||xs(S)});let h=a.syncPointTree_.get(r);h?(c=c||xs(h),l=l||Ss(h,zt())):(h=new Fb,a.syncPointTree_=a.syncPointTree_.set(r,h));let f;l!=null?f=!0:(f=!1,l=ht.EMPTY_NODE,a.syncPointTree_.subtree(r).foreachChild((S,b)=>{const T=Ss(b,zt());T&&(l=l.updateImmediateChild(S,T))}));const d=Yb(h,t);if(!d&&!t._queryParams.loadsAllData()){const v=qu(t);J(!a.queryToTagMap.has(v),"View does not exist, but we have a tag");const S=hD();a.queryToTagMap.set(v,S),a.tagToQueryMap.set(S,v)}const p=Gu(a.pendingWriteTree_,r);let _=JO(h,t,e,p,l,f);if(!d&&!c&&!i){const v=Hb(h,t);_=_.concat(fD(a,t,v))}return _}function hm(a,t,e){const r=a.pendingWriteTree_,l=a.syncPointTree_.findOnPath(t,(c,h)=>{const f=Ye(c,t),d=Ss(h,f);if(d)return d});return jb(r,t,l,e,!0)}function lD(a,t){const e=t._path;let i=null;a.syncPointTree_.foreachOnPath(e,(d,p)=>{const _=Ye(d,e);i=i||Ss(p,_)});let r=a.syncPointTree_.get(e);r?i=i||Ss(r,zt()):(r=new Fb,a.syncPointTree_=a.syncPointTree_.set(e,r));const l=i!=null,c=l?new Cs(i,!0,!1):null,h=Gu(a.pendingWriteTree_,t._path),f=Ub(r,t,h,l?c.getNode():ht.EMPTY_NODE,l);return GO(f)}function va(a,t){return Xb(t,a.syncPointTree_,null,Gu(a.pendingWriteTree_,zt()))}function Xb(a,t,e,i){if(Dt(a.path))return qb(a,t,e,i);{const r=t.get(zt());e==null&&r!=null&&(e=Ss(r,zt()));let l=[];const c=xt(a.path),h=a.operationForChild(c),f=t.children.get(c);if(f&&h){const d=e?e.getImmediateChild(c):null,p=kb(i,c);l=l.concat(Xb(h,f,d,p))}return r&&(l=l.concat(um(r,a,i,e))),l}}function qb(a,t,e,i){const r=t.get(zt());e==null&&r!=null&&(e=Ss(r,zt()));let l=[];return t.children.inorderTraversal((c,h)=>{const f=e?e.getImmediateChild(c):null,d=kb(i,c),p=a.operationForChild(c);p&&(l=l.concat(qb(p,h,f,d)))}),r&&(l=l.concat(um(r,a,i,e))),l}function Wb(a,t){const e=t.query,i=Wo(a,e);return{hashFn:()=>(VO(t)||ht.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?aD(a,e._path,i):rD(a,e._path);{const l=r2(r,e);return Du(a,e,null,l)}}}}function Wo(a,t){const e=qu(t);return a.queryToTagMap.get(e)}function qu(a){return a._path.toString()+"$"+a._queryIdentifier}function fm(a,t){return a.tagToQueryMap.get(t)}function dm(a){const t=a.indexOf("$");return J(t!==-1&&t<a.length-1,"Bad queryKey."),{queryId:a.substr(t+1),path:new Gt(a.substr(0,t))}}function gm(a,t,e){const i=a.syncPointTree_.get(t);J(i,"Missing sync point for query tag that we're tracking");const r=Gu(a.pendingWriteTree_,t);return um(i,e,r,null)}function cD(a){return a.fold((t,e,i)=>{if(e&&xs(e))return[Xu(e)];{let r=[];return e&&(r=Pb(e)),Be(i,(l,c)=>{r=r.concat(c)}),r}})}function ko(a){return a._queryParams.loadsAllData()&&!a._queryParams.isDefault()?new(eD())(a._repo,a._path):a}function uD(a,t){for(let e=0;e<t.length;++e){const i=t[e];if(!i._queryParams.loadsAllData()){const r=qu(i),l=a.queryToTagMap.get(r);a.queryToTagMap.delete(r),a.tagToQueryMap.delete(l)}}}function hD(){return nD++}function fD(a,t,e){const i=t._path,r=Wo(a,t),l=Wb(a,e),c=a.listenProvider_.startListening(ko(t),r,l.hashFn,l.onComplete),h=a.syncPointTree_.subtree(i);if(r)J(!xs(h.value),"If we're adding a query, it shouldn't be shadowed");else{const f=h.fold((d,p,_)=>{if(!Dt(d)&&p&&xs(p))return[Xu(p).query];{let v=[];return p&&(v=v.concat(Pb(p).map(S=>S.query))),Be(_,(S,b)=>{v=v.concat(b)}),v}});for(let d=0;d<f.length;++d){const p=f[d];a.listenProvider_.stopListening(ko(p),Wo(a,p))}}return c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new mm(e)}node(){return this.node_}}class pm{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=le(this.path_,t);return new pm(this.syncTree_,e)}node(){return hm(this.syncTree_,this.path_)}}const dD=function(a){return a=a||{},a.timestamp=a.timestamp||new Date().getTime(),a},Y0=function(a,t,e){if(!a||typeof a!="object")return a;if(J(".sv"in a,"Unexpected leaf node or priority contents"),typeof a[".sv"]=="string")return gD(a[".sv"],t,e);if(typeof a[".sv"]=="object")return mD(a[".sv"],t);J(!1,"Unexpected server value: "+JSON.stringify(a,null,2))},gD=function(a,t,e){switch(a){case"timestamp":return e.timestamp;default:J(!1,"Unexpected server value: "+a)}},mD=function(a,t,e){a.hasOwnProperty("increment")||J(!1,"Unexpected server value: "+JSON.stringify(a,null,2));const i=a.increment;typeof i!="number"&&J(!1,"Unexpected increment value: "+i);const r=t.node();if(J(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const c=r.getValue();return typeof c!="number"?i:c+i},Qb=function(a,t,e,i){return _m(t,new pm(e,a),i)},Kb=function(a,t,e){return _m(a,new mm(t),e)};function _m(a,t,e){const i=a.getPriority().val(),r=Y0(i,t.getImmediateChild(".priority"),e);let l;if(a.isLeafNode()){const c=a,h=Y0(c.getValue(),t,e);return h!==c.getValue()||r!==c.getPriority().val()?new Oe(h,be(r)):a}else{const c=a;return l=c,r!==c.getPriority().val()&&(l=l.updatePriority(new Oe(r))),c.forEachChild(ce,(h,f)=>{const d=_m(f,t.getImmediateChild(h),e);d!==f&&(l=l.updateImmediateChild(h,d))}),l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}}function ym(a,t){let e=t instanceof Gt?t:new Gt(t),i=a,r=xt(e);for(;r!==null;){const l=ca(i.node.children,r)||{children:{},childCount:0};i=new vm(r,i,l),e=Qt(e),r=xt(e)}return i}function ya(a){return a.node.value}function Zb(a,t){a.node.value=t,xg(a)}function Jb(a){return a.node.childCount>0}function pD(a){return ya(a)===void 0&&!Jb(a)}function Wu(a,t){Be(a.node.children,(e,i)=>{t(new vm(e,a,i))})}function $b(a,t,e,i){e&&t(a),Wu(a,r=>{$b(r,t,!0)})}function _D(a,t,e){let i=a.parent;for(;i!==null;){if(t(i))return!0;i=i.parent}return!1}function cl(a){return new Gt(a.parent===null?a.name:cl(a.parent)+"/"+a.name)}function xg(a){a.parent!==null&&vD(a.parent,a.name,a)}function vD(a,t,e){const i=pD(e),r=ii(a.node.children,t);i&&r?(delete a.node.children[t],a.node.childCount--,xg(a)):!i&&!r&&(a.node.children[t]=e.node,a.node.childCount++,xg(a))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD=/[\[\].#$\/\u0000-\u001F\u007F]/,SD=/[\[\].#$\u0000-\u001F\u007F]/,Gd=10*1024*1024,Sm=function(a){return typeof a=="string"&&a.length!==0&&!yD.test(a)},tC=function(a){return typeof a=="string"&&a.length!==0&&!SD.test(a)},bD=function(a){return a&&(a=a.replace(/^\/*\.info(\/|$)/,"/")),tC(a)},CD=function(a){return a===null||typeof a=="string"||typeof a=="number"&&!qg(a)||a&&typeof a=="object"&&ii(a,".sv")},eC=function(a,t,e,i){i&&t===void 0||Qu(Pu(a,"value"),t,e)},Qu=function(a,t,e){const i=e instanceof Gt?new F2(e,a):e;if(t===void 0)throw new Error(a+"contains undefined "+qs(i));if(typeof t=="function")throw new Error(a+"contains a function "+qs(i)+" with contents = "+t.toString());if(qg(t))throw new Error(a+"contains "+t.toString()+" "+qs(i));if(typeof t=="string"&&t.length>Gd/3&&Hu(t)>Gd)throw new Error(a+"contains a string greater than "+Gd+" utf8 bytes "+qs(i)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let r=!1,l=!1;if(Be(t,(c,h)=>{if(c===".value")r=!0;else if(c!==".priority"&&c!==".sv"&&(l=!0,!Sm(c)))throw new Error(a+" contains an invalid key ("+c+") "+qs(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);U2(i,c),Qu(a,h,i),P2(i)}),r&&l)throw new Error(a+' contains ".value" child '+qs(i)+" in addition to actual children.")}},xD=function(a,t){let e,i;for(e=0;e<t.length;e++){i=t[e];const l=Yo(i);for(let c=0;c<l.length;c++)if(!(l[c]===".priority"&&c===l.length-1)){if(!Sm(l[c]))throw new Error(a+"contains an invalid key ("+l[c]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}t.sort(I2);let r=null;for(e=0;e<t.length;e++){if(i=t[e],r!==null&&Rn(r,i))throw new Error(a+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},TD=function(a,t,e,i){const r=Pu(a,"values");if(!(t&&typeof t=="object")||Array.isArray(t))throw new Error(r+" must be an object containing the children to replace.");const l=[];Be(t,(c,h)=>{const f=new Gt(c);if(Qu(r,h,le(e,f)),Jg(f)===".priority"&&!CD(h))throw new Error(r+"contains an invalid value for '"+f.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");l.push(f)}),xD(r,l)},nC=function(a,t,e,i){if(!tC(e))throw new Error(Pu(a,t)+'was an invalid path = "'+e+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},wD=function(a,t,e,i){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),nC(a,t,e)},iC=function(a,t){if(xt(t)===".info")throw new Error(a+" failed = Can't modify data under /.info/")},ED=function(a,t){const e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!Sm(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!bD(e))throw new Error(Pu(a,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ku(a,t){let e=null;for(let i=0;i<t.length;i++){const r=t[i],l=r.getPath();e!==null&&!$g(l,e.path)&&(a.eventLists_.push(e),e=null),e===null&&(e={events:[],path:l}),e.events.push(r)}e&&a.eventLists_.push(e)}function sC(a,t,e){Ku(a,e),rC(a,i=>$g(i,t))}function Nn(a,t,e){Ku(a,e),rC(a,i=>Rn(i,t)||Rn(t,i))}function rC(a,t){a.recursionDepth_++;let e=!0;for(let i=0;i<a.eventLists_.length;i++){const r=a.eventLists_[i];if(r){const l=r.path;t(l)?(DD(a.eventLists_[i]),a.eventLists_[i]=null):e=!1}}e&&(a.eventLists_=[]),a.recursionDepth_--}function DD(a){for(let t=0;t<a.events.length;t++){const e=a.events[t];if(e!==null){a.events[t]=null;const i=e.getEventRunner();Mo&&Le("event: "+e.toString()),_a(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD="repo_interrupt",MD=25;class RD{constructor(t,e,i,r){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new OD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Su(),this.transactionQueueTree_=new vm,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ND(a,t,e){if(a.stats_=Kg(a.repoInfo_),a.forceRestClient_||c2())a.server_=new yu(a.repoInfo_,(i,r,l,c)=>{V0(a,i,r,l,c)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>G0(a,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ce(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}a.persistentConnection_=new Ai(a.repoInfo_,t,(i,r,l,c)=>{V0(a,i,r,l,c)},i=>{G0(a,i)},i=>{jD(a,i)},a.authTokenProvider_,a.appCheckProvider_,e),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(i=>{a.server_.refreshAuthToken(i)}),a.appCheckProvider_.addTokenChangeListener(i=>{a.server_.refreshAppCheckToken(i.token)}),a.statsReporter_=g2(a.repoInfo_,()=>new dO(a.stats_,a.server_)),a.infoData_=new lO,a.infoSyncTree_=new H0({startListening:(i,r,l,c)=>{let h=[];const f=a.infoData_.getNode(i._path);return f.isEmpty()||(h=ll(a.infoSyncTree_,i._path,f),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),bm(a,"connected",!1),a.serverSyncTree_=new H0({startListening:(i,r,l,c)=>(a.server_.listen(i,l,r,(h,f)=>{const d=c(h,f);Nn(a.eventQueue_,i._path,d)}),[]),stopListening:(i,r)=>{a.server_.unlisten(i,r)}})}function aC(a){const e=a.infoData_.getNode(new Gt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function Zu(a){return dD({timestamp:aC(a)})}function V0(a,t,e,i,r){a.dataUpdateCount++;const l=new Gt(t);e=a.interceptServerDataCallback_?a.interceptServerDataCallback_(t,e):e;let c=[];if(r)if(i){const f=fu(e,d=>be(d));c=oD(a.serverSyncTree_,l,f,r)}else{const f=be(e);c=Gb(a.serverSyncTree_,l,f,r)}else if(i){const f=fu(e,d=>be(d));c=sD(a.serverSyncTree_,l,f)}else{const f=be(e);c=ll(a.serverSyncTree_,l,f)}let h=l;c.length>0&&(h=ga(a,l)),Nn(a.eventQueue_,h,c)}function G0(a,t){bm(a,"connected",t),t===!1&&BD(a)}function jD(a,t){Be(t,(e,i)=>{bm(a,e,i)})}function bm(a,t,e){const i=new Gt("/.info/"+t),r=be(e);a.infoData_.updateSnapshot(i,r);const l=ll(a.infoSyncTree_,i,r);Nn(a.eventQueue_,i,l)}function Cm(a){return a.nextWriteId_++}function kD(a,t,e){const i=lD(a.serverSyncTree_,t);return i!=null?Promise.resolve(i):a.server_.get(t).then(r=>{const l=be(r).withIndex(t._queryParams.getIndex());Cg(a.serverSyncTree_,t,e,!0);let c;if(t._queryParams.loadsAllData())c=ll(a.serverSyncTree_,t._path,l);else{const h=Wo(a.serverSyncTree_,t);c=Gb(a.serverSyncTree_,t._path,l,h)}return Nn(a.eventQueue_,t._path,c),Du(a.serverSyncTree_,t,e,null,!0),l},r=>(ul(a,"get for query "+Ce(t)+" failed: "+r),Promise.reject(new Error(r))))}function LD(a,t,e,i,r){ul(a,"set",{path:t.toString(),value:e,priority:i});const l=Zu(a),c=be(e,i),h=hm(a.serverSyncTree_,t),f=Kb(c,h,l),d=Cm(a),p=Vb(a.serverSyncTree_,t,f,d,!0);Ku(a.eventQueue_,p),a.server_.put(t.toString(),c.val(!0),(v,S)=>{const b=v==="ok";b||Ve("set at "+t+" failed: "+v);const T=ps(a.serverSyncTree_,d,!b);Nn(a.eventQueue_,t,T),Tg(a,r,v,S)});const _=Tm(a,t);ga(a,_),Nn(a.eventQueue_,_,[])}function zD(a,t,e,i){ul(a,"update",{path:t.toString(),value:e});let r=!0;const l=Zu(a),c={};if(Be(e,(h,f)=>{r=!1,c[h]=Qb(le(t,h),be(f),a.serverSyncTree_,l)}),r)Le("update() called with empty data.  Don't do anything."),Tg(a,i,"ok",void 0);else{const h=Cm(a),f=iD(a.serverSyncTree_,t,c,h);Ku(a.eventQueue_,f),a.server_.merge(t.toString(),e,(d,p)=>{const _=d==="ok";_||Ve("update at "+t+" failed: "+d);const v=ps(a.serverSyncTree_,h,!_),S=v.length>0?ga(a,t):t;Nn(a.eventQueue_,S,v),Tg(a,i,d,p)}),Be(e,d=>{const p=Tm(a,le(t,d));ga(a,p)}),Nn(a.eventQueue_,t,[])}}function BD(a){ul(a,"onDisconnectEvents");const t=Zu(a),e=Su();pg(a.onDisconnect_,zt(),(r,l)=>{const c=Qb(r,l,a.serverSyncTree_,t);Ab(e,r,c)});let i=[];pg(e,zt(),(r,l)=>{i=i.concat(ll(a.serverSyncTree_,r,l));const c=Tm(a,r);ga(a,c)}),a.onDisconnect_=Su(),Nn(a.eventQueue_,zt(),i)}function ID(a,t,e){let i;xt(t._path)===".info"?i=Cg(a.infoSyncTree_,t,e):i=Cg(a.serverSyncTree_,t,e),sC(a.eventQueue_,t._path,i)}function FD(a,t,e){let i;xt(t._path)===".info"?i=Du(a.infoSyncTree_,t,e):i=Du(a.serverSyncTree_,t,e),sC(a.eventQueue_,t._path,i)}function UD(a){a.persistentConnection_&&a.persistentConnection_.interrupt(AD)}function ul(a,...t){let e="";a.persistentConnection_&&(e=a.persistentConnection_.id+":"),Le(e,...t)}function Tg(a,t,e,i){t&&_a(()=>{if(e==="ok")t(null);else{const r=(e||"error").toUpperCase();let l=r;i&&(l+=": "+i);const c=new Error(l);c.code=r,t(c)}})}function oC(a,t,e){return hm(a.serverSyncTree_,t,e)||ht.EMPTY_NODE}function xm(a,t=a.transactionQueueTree_){if(t||Ju(a,t),ya(t)){const e=cC(a,t);J(e.length>0,"Sending zero length transaction queue"),e.every(r=>r.status===0)&&PD(a,cl(t),e)}else Jb(t)&&Wu(t,e=>{xm(a,e)})}function PD(a,t,e){const i=e.map(d=>d.currentWriteId),r=oC(a,t,i);let l=r;const c=r.hash();for(let d=0;d<e.length;d++){const p=e[d];J(p.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;const _=Ye(t,p.path);l=l.updateChild(_,p.currentOutputSnapshotRaw)}const h=l.val(!0),f=t;a.server_.put(f.toString(),h,d=>{ul(a,"transaction put response",{path:f.toString(),status:d});let p=[];if(d==="ok"){const _=[];for(let v=0;v<e.length;v++)e[v].status=2,p=p.concat(ps(a.serverSyncTree_,e[v].currentWriteId)),e[v].onComplete&&_.push(()=>e[v].onComplete(null,!0,e[v].currentOutputSnapshotResolved)),e[v].unwatcher();Ju(a,ym(a.transactionQueueTree_,t)),xm(a,a.transactionQueueTree_),Nn(a.eventQueue_,t,p);for(let v=0;v<_.length;v++)_a(_[v])}else{if(d==="datastale")for(let _=0;_<e.length;_++)e[_].status===3?e[_].status=4:e[_].status=0;else{Ve("transaction at "+f.toString()+" failed: "+d);for(let _=0;_<e.length;_++)e[_].status=4,e[_].abortReason=d}ga(a,t)}},c)}function ga(a,t){const e=lC(a,t),i=cl(e),r=cC(a,e);return HD(a,r,i),i}function HD(a,t,e){if(t.length===0)return;const i=[];let r=[];const c=t.filter(h=>h.status===0).map(h=>h.currentWriteId);for(let h=0;h<t.length;h++){const f=t[h],d=Ye(e,f.path);let p=!1,_;if(J(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),f.status===4)p=!0,_=f.abortReason,r=r.concat(ps(a.serverSyncTree_,f.currentWriteId,!0));else if(f.status===0)if(f.retryCount>=MD)p=!0,_="maxretry",r=r.concat(ps(a.serverSyncTree_,f.currentWriteId,!0));else{const v=oC(a,f.path,c);f.currentInputSnapshot=v;const S=t[h].update(v.val());if(S!==void 0){Qu("transaction failed: Data returned ",S,f.path);let b=be(S);typeof S=="object"&&S!=null&&ii(S,".priority")||(b=b.updatePriority(v.getPriority()));const w=f.currentWriteId,N=Zu(a),I=Kb(b,v,N);f.currentOutputSnapshotRaw=b,f.currentOutputSnapshotResolved=I,f.currentWriteId=Cm(a),c.splice(c.indexOf(w),1),r=r.concat(Vb(a.serverSyncTree_,f.path,I,f.currentWriteId,f.applyLocally)),r=r.concat(ps(a.serverSyncTree_,w,!0))}else p=!0,_="nodata",r=r.concat(ps(a.serverSyncTree_,f.currentWriteId,!0))}Nn(a.eventQueue_,e,r),r=[],p&&(t[h].status=2,(function(v){setTimeout(v,Math.floor(0))})(t[h].unwatcher),t[h].onComplete&&(_==="nodata"?i.push(()=>t[h].onComplete(null,!1,t[h].currentInputSnapshot)):i.push(()=>t[h].onComplete(new Error(_),!1,null))))}Ju(a,a.transactionQueueTree_);for(let h=0;h<i.length;h++)_a(i[h]);xm(a,a.transactionQueueTree_)}function lC(a,t){let e,i=a.transactionQueueTree_;for(e=xt(t);e!==null&&ya(i)===void 0;)i=ym(i,e),t=Qt(t),e=xt(t);return i}function cC(a,t){const e=[];return uC(a,t,e),e.sort((i,r)=>i.order-r.order),e}function uC(a,t,e){const i=ya(t);if(i)for(let r=0;r<i.length;r++)e.push(i[r]);Wu(t,r=>{uC(a,r,e)})}function Ju(a,t){const e=ya(t);if(e){let i=0;for(let r=0;r<e.length;r++)e[r].status!==2&&(e[i]=e[r],i++);e.length=i,Zb(t,e.length>0?e:void 0)}Wu(t,i=>{Ju(a,i)})}function Tm(a,t){const e=cl(lC(a,t)),i=ym(a.transactionQueueTree_,t);return _D(i,r=>{Xd(a,r)}),Xd(a,i),$b(i,r=>{Xd(a,r)}),e}function Xd(a,t){const e=ya(t);if(e){const i=[];let r=[],l=-1;for(let c=0;c<e.length;c++)e[c].status===3||(e[c].status===1?(J(l===c-1,"All SENT items should be at beginning of queue."),l=c,e[c].status=3,e[c].abortReason="set"):(J(e[c].status===0,"Unexpected transaction status in abort"),e[c].unwatcher(),r=r.concat(ps(a.serverSyncTree_,e[c].currentWriteId,!0)),e[c].onComplete&&i.push(e[c].onComplete.bind(null,new Error("set"),!1,null))));l===-1?Zb(t,void 0):e.length=l+1,Nn(a.eventQueue_,cl(t),r);for(let c=0;c<i.length;c++)_a(i[c])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YD(a){let t="";const e=a.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let r=e[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}t+="/"+r}return t}function VD(a){const t={};a.charAt(0)==="?"&&(a=a.substring(1));for(const e of a.split("&")){if(e.length===0)continue;const i=e.split("=");i.length===2?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Ve(`Invalid query segment '${e}' in query '${a}'`)}return t}const X0=function(a,t){const e=GD(a),i=e.namespace;e.domain==="firebase.com"&&ki(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&e.domain!=="localhost"&&ki("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||t2();const r=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new fb(e.host,e.secure,i,r,t,"",i!==e.subdomain),path:new Gt(e.pathString)}},GD=function(a){let t="",e="",i="",r="",l="",c=!0,h="https",f=443;if(typeof a=="string"){let d=a.indexOf("//");d>=0&&(h=a.substring(0,d-1),a=a.substring(d+2));let p=a.indexOf("/");p===-1&&(p=a.length);let _=a.indexOf("?");_===-1&&(_=a.length),t=a.substring(0,Math.min(p,_)),p<_&&(r=YD(a.substring(p,_)));const v=VD(a.substring(Math.min(a.length,_)));d=t.indexOf(":"),d>=0?(c=h==="https"||h==="wss",f=parseInt(t.substring(d+1),10)):d=t.length;const S=t.slice(0,d);if(S.toLowerCase()==="localhost")e="localhost";else if(S.split(".").length<=2)e=S;else{const b=t.indexOf(".");i=t.substring(0,b).toLowerCase(),e=t.substring(b+1),l=i}"ns"in v&&(l=v.ns)}return{host:t,port:f,domain:e,subdomain:i,secure:c,scheme:h,pathString:r,namespace:l}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",XD=(function(){let a=0;const t=[];return function(e){const i=e===a;a=e;let r;const l=new Array(8);for(r=7;r>=0;r--)l[r]=q0.charAt(e%64),e=Math.floor(e/64);J(e===0,"Cannot push at time == 0");let c=l.join("");if(i){for(r=11;r>=0&&t[r]===63;r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)c+=q0.charAt(t[r]);return J(c.length===20,"nextPushId: Length should be 20."),c}})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(t,e,i,r){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=r}getPath(){const t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ce(this.snapshot.exportVal())}}class WD{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return J(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(t,e,i,r){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=r}get key(){return Dt(this._path)?null:Jg(this._path)}get ref(){return new Fi(this._repo,this._path)}get _queryIdentifier(){const t=N0(this._queryParams),e=Wg(t);return e==="{}"?"default":e}get _queryObject(){return N0(this._queryParams)}isEqual(t){if(t=ar(t),!(t instanceof wm))return!1;const e=this._repo===t._repo,i=$g(this._path,t._path),r=this._queryIdentifier===t._queryIdentifier;return e&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+B2(this._path)}}class Fi extends wm{constructor(t,e){super(t,e,new im,!1)}get parent(){const t=bb(this._path);return t===null?null:new Fi(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}}class Qo{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new Gt(t),i=Ko(this.ref,t);return new Qo(this._node.getChild(e),i,ce)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>t(new Qo(r,Ko(this.ref,i),ce)))}hasChild(t){const e=new Gt(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ae(a,t){return a=ar(a),a._checkNotDeleted("ref"),t!==void 0?Ko(a._root,t):a._root}function Ko(a,t){return a=ar(a),xt(a._path)===null?wD("child","path",t):nC("child","path",t),new Fi(a._repo,le(a._path,t))}function QD(a,t){a=ar(a),iC("push",a._path),eC("push",t,a._path,!0);const e=aC(a._repo),i=XD(e),r=Ko(a,i),l=Ko(a,i);let c;return c=Promise.resolve(l),r.then=c.then.bind(c),r.catch=c.then.bind(c,void 0),r}function Vn(a,t){a=ar(a),iC("set",a._path),eC("set",t,a._path,!1);const e=new il;return LD(a._repo,a._path,t,null,e.wrapCallback(()=>{})),e.promise}function wg(a,t){TD("update",t,a._path);const e=new il;return zD(a._repo,a._path,t,e.wrapCallback(()=>{})),e.promise}function Mi(a){a=ar(a);const t=new hC(()=>{}),e=new $u(t);return kD(a._repo,a,e).then(i=>new Qo(i,new Fi(a._repo,a._path),a._queryParams.getIndex()))}class $u{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,e){const i=e._queryParams.getIndex();return new qD("value",this,new Qo(t.snapshotNode,new Fi(e._repo,e._path),i))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new WD(this,t,e):null}matches(t){return t instanceof $u?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function KD(a,t,e,i,r){const l=new hC(e,void 0),c=new $u(l);return ID(a._repo,a,c),()=>FD(a._repo,a,c)}function Eg(a,t,e,i){return KD(a,"value",t)}QO(Fi);tD(Fi);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZD="FIREBASE_DATABASE_EMULATOR_HOST",Og={};let JD=!1;function $D(a,t,e,i){const r=t.lastIndexOf(":"),l=t.substring(0,r),c=Gg(l);a.repoInfo_=new fb(t,c,a.repoInfo_.namespace,a.repoInfo_.webSocketOnly,a.repoInfo_.nodeAdmin,a.repoInfo_.persistenceKey,a.repoInfo_.includeNamespaceInQueryParams,!0,e),i&&(a.authTokenProvider_=i)}function tA(a,t,e,i,r){let l=i||a.options.databaseURL;l===void 0&&(a.options.projectId||ki("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Le("Using default host for project ",a.options.projectId),l=`${a.options.projectId}-default-rtdb.firebaseio.com`);let c=X0(l,r),h=c.repoInfo,f;typeof process<"u"&&g0&&(f=g0[ZD]),f?(l=`http://${f}?ns=${h.namespace}`,c=X0(l,r),h=c.repoInfo):c.repoInfo.secure;const d=new h2(a.name,a.options,t);ED("Invalid Firebase Database URL",c),Dt(c.path)||ki("Database URL must point to the root of a Firebase Database (not including a child path).");const p=nA(h,a,d,new u2(a,e));return new iA(p,a)}function eA(a,t){const e=Og[t];(!e||e[a.key]!==a)&&ki(`Database ${t}(${a.repoInfo_}) has already been deleted.`),UD(a),delete e[a.key]}function nA(a,t,e,i){let r=Og[t.name];r||(r={},Og[t.name]=r);let l=r[a.toURLString()];return l&&ki("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new RD(a,JD,e,i),r[a.toURLString()]=l,l}class iA{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ND(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Fi(this._repo,zt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(eA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&ki("Cannot call "+t+" on a deleted database.")}}function sA(a=BE(),t){const e=NE(a,"database").getImmediate({identifier:t});if(!e._instanceStarted){const i=_w("database");i&&rA(e,...i)}return e}function rA(a,t,e,i={}){a=ar(a),a._checkNotDeleted("useEmulator");const r=`${t}:${e}`,l=a._repoInternal;if(a._instanceStarted){if(r===a._repoInternal.repoInfo_.host&&du(i,l.repoInfo_.emulatorOptions))return;ki("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let c;if(l.repoInfo_.nodeAdmin)i.mockUserToken&&ki('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),c=new ru(ru.OWNER);else if(i.mockUserToken){const h=typeof i.mockUserToken=="string"?i.mockUserToken:yw(i.mockUserToken,a.app.options.projectId);c=new ru(h)}Gg(t)&&(vw(t),Cw("Database",!0)),$D(l,r,i,c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aA(a){WE(zE),mu(new Uo("database",(t,{instanceIdentifier:e})=>{const i=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),l=t.getProvider("app-check-internal");return tA(i,r,l,e)},"PUBLIC").setMultipleInstances(!0)),ia(m0,p0,a),ia(m0,p0,"esm2020")}Ai.prototype.simpleListen=function(a,t){this.sendRequest("q",{p:a},t)};Ai.prototype.echo=function(a,t){this.sendRequest("echo",{d:a},t)};aA();var oA="firebase",lA="12.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ia(oA,lA,"app");const cA={apiKey:"AIzaSyCN9dMIMtjE2UNrRHRuTWPO6KUoUms3IdM",authDomain:"csm-drawing-competition.firebaseapp.com",databaseURL:"https://csm-drawing-competition-default-rtdb.firebaseio.com",projectId:"csm-drawing-competition",storageBucket:"csm-drawing-competition.firebasestorage.app",messagingSenderId:"126389105375",appId:"1:126389105375:web:85ba0b063e39537da9af6a",measurementId:"G-7GWHPY3SKB"},uA=QS(cA),oe=sA(uA);var hA=Object.defineProperty,Au=Object.getOwnPropertySymbols,fC=Object.prototype.hasOwnProperty,dC=Object.prototype.propertyIsEnumerable,W0=(a,t,e)=>t in a?hA(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,Dg=(a,t)=>{for(var e in t||(t={}))fC.call(t,e)&&W0(a,e,t[e]);if(Au)for(var e of Au(t))dC.call(t,e)&&W0(a,e,t[e]);return a},Ag=(a,t)=>{var e={};for(var i in a)fC.call(a,i)&&t.indexOf(i)<0&&(e[i]=a[i]);if(a!=null&&Au)for(var i of Au(a))t.indexOf(i)<0&&dC.call(a,i)&&(e[i]=a[i]);return e};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var sr;(a=>{const t=class Ot{constructor(f,d,p,_){if(this.version=f,this.errorCorrectionLevel=d,this.modules=[],this.isFunction=[],f<Ot.MIN_VERSION||f>Ot.MAX_VERSION)throw new RangeError("Version value out of range");if(_<-1||_>7)throw new RangeError("Mask value out of range");this.size=f*4+17;let v=[];for(let b=0;b<this.size;b++)v.push(!1);for(let b=0;b<this.size;b++)this.modules.push(v.slice()),this.isFunction.push(v.slice());this.drawFunctionPatterns();const S=this.addEccAndInterleave(p);if(this.drawCodewords(S),_==-1){let b=1e9;for(let T=0;T<8;T++){this.applyMask(T),this.drawFormatBits(T);const w=this.getPenaltyScore();w<b&&(_=T,b=w),this.applyMask(T)}}r(0<=_&&_<=7),this.mask=_,this.applyMask(_),this.drawFormatBits(_),this.isFunction=[]}static encodeText(f,d){const p=a.QrSegment.makeSegments(f);return Ot.encodeSegments(p,d)}static encodeBinary(f,d){const p=a.QrSegment.makeBytes(f);return Ot.encodeSegments([p],d)}static encodeSegments(f,d,p=1,_=40,v=-1,S=!0){if(!(Ot.MIN_VERSION<=p&&p<=_&&_<=Ot.MAX_VERSION)||v<-1||v>7)throw new RangeError("Invalid value");let b,T;for(b=p;;b++){const j=Ot.getNumDataCodewords(b,d)*8,Y=c.getTotalBits(f,b);if(Y<=j){T=Y;break}if(b>=_)throw new RangeError("Data too long")}for(const j of[Ot.Ecc.MEDIUM,Ot.Ecc.QUARTILE,Ot.Ecc.HIGH])S&&T<=Ot.getNumDataCodewords(b,j)*8&&(d=j);let w=[];for(const j of f){e(j.mode.modeBits,4,w),e(j.numChars,j.mode.numCharCountBits(b),w);for(const Y of j.getData())w.push(Y)}r(w.length==T);const N=Ot.getNumDataCodewords(b,d)*8;r(w.length<=N),e(0,Math.min(4,N-w.length),w),e(0,(8-w.length%8)%8,w),r(w.length%8==0);for(let j=236;w.length<N;j^=253)e(j,8,w);let I=[];for(;I.length*8<w.length;)I.push(0);return w.forEach((j,Y)=>I[Y>>>3]|=j<<7-(Y&7)),new Ot(b,d,I,v)}getModule(f,d){return 0<=f&&f<this.size&&0<=d&&d<this.size&&this.modules[d][f]}getModules(){return this.modules}drawFunctionPatterns(){for(let p=0;p<this.size;p++)this.setFunctionModule(6,p,p%2==0),this.setFunctionModule(p,6,p%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const f=this.getAlignmentPatternPositions(),d=f.length;for(let p=0;p<d;p++)for(let _=0;_<d;_++)p==0&&_==0||p==0&&_==d-1||p==d-1&&_==0||this.drawAlignmentPattern(f[p],f[_]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(f){const d=this.errorCorrectionLevel.formatBits<<3|f;let p=d;for(let v=0;v<10;v++)p=p<<1^(p>>>9)*1335;const _=(d<<10|p)^21522;r(_>>>15==0);for(let v=0;v<=5;v++)this.setFunctionModule(8,v,i(_,v));this.setFunctionModule(8,7,i(_,6)),this.setFunctionModule(8,8,i(_,7)),this.setFunctionModule(7,8,i(_,8));for(let v=9;v<15;v++)this.setFunctionModule(14-v,8,i(_,v));for(let v=0;v<8;v++)this.setFunctionModule(this.size-1-v,8,i(_,v));for(let v=8;v<15;v++)this.setFunctionModule(8,this.size-15+v,i(_,v));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let f=this.version;for(let p=0;p<12;p++)f=f<<1^(f>>>11)*7973;const d=this.version<<12|f;r(d>>>18==0);for(let p=0;p<18;p++){const _=i(d,p),v=this.size-11+p%3,S=Math.floor(p/3);this.setFunctionModule(v,S,_),this.setFunctionModule(S,v,_)}}drawFinderPattern(f,d){for(let p=-4;p<=4;p++)for(let _=-4;_<=4;_++){const v=Math.max(Math.abs(_),Math.abs(p)),S=f+_,b=d+p;0<=S&&S<this.size&&0<=b&&b<this.size&&this.setFunctionModule(S,b,v!=2&&v!=4)}}drawAlignmentPattern(f,d){for(let p=-2;p<=2;p++)for(let _=-2;_<=2;_++)this.setFunctionModule(f+_,d+p,Math.max(Math.abs(_),Math.abs(p))!=1)}setFunctionModule(f,d,p){this.modules[d][f]=p,this.isFunction[d][f]=!0}addEccAndInterleave(f){const d=this.version,p=this.errorCorrectionLevel;if(f.length!=Ot.getNumDataCodewords(d,p))throw new RangeError("Invalid argument");const _=Ot.NUM_ERROR_CORRECTION_BLOCKS[p.ordinal][d],v=Ot.ECC_CODEWORDS_PER_BLOCK[p.ordinal][d],S=Math.floor(Ot.getNumRawDataModules(d)/8),b=_-S%_,T=Math.floor(S/_);let w=[];const N=Ot.reedSolomonComputeDivisor(v);for(let j=0,Y=0;j<_;j++){let B=f.slice(Y,Y+T-v+(j<b?0:1));Y+=B.length;const K=Ot.reedSolomonComputeRemainder(B,N);j<b&&B.push(0),w.push(B.concat(K))}let I=[];for(let j=0;j<w[0].length;j++)w.forEach((Y,B)=>{(j!=T-v||B>=b)&&I.push(Y[j])});return r(I.length==S),I}drawCodewords(f){if(f.length!=Math.floor(Ot.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let d=0;for(let p=this.size-1;p>=1;p-=2){p==6&&(p=5);for(let _=0;_<this.size;_++)for(let v=0;v<2;v++){const S=p-v,T=(p+1&2)==0?this.size-1-_:_;!this.isFunction[T][S]&&d<f.length*8&&(this.modules[T][S]=i(f[d>>>3],7-(d&7)),d++)}}r(d==f.length*8)}applyMask(f){if(f<0||f>7)throw new RangeError("Mask value out of range");for(let d=0;d<this.size;d++)for(let p=0;p<this.size;p++){let _;switch(f){case 0:_=(p+d)%2==0;break;case 1:_=d%2==0;break;case 2:_=p%3==0;break;case 3:_=(p+d)%3==0;break;case 4:_=(Math.floor(p/3)+Math.floor(d/2))%2==0;break;case 5:_=p*d%2+p*d%3==0;break;case 6:_=(p*d%2+p*d%3)%2==0;break;case 7:_=((p+d)%2+p*d%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[d][p]&&_&&(this.modules[d][p]=!this.modules[d][p])}}getPenaltyScore(){let f=0;for(let v=0;v<this.size;v++){let S=!1,b=0,T=[0,0,0,0,0,0,0];for(let w=0;w<this.size;w++)this.modules[v][w]==S?(b++,b==5?f+=Ot.PENALTY_N1:b>5&&f++):(this.finderPenaltyAddHistory(b,T),S||(f+=this.finderPenaltyCountPatterns(T)*Ot.PENALTY_N3),S=this.modules[v][w],b=1);f+=this.finderPenaltyTerminateAndCount(S,b,T)*Ot.PENALTY_N3}for(let v=0;v<this.size;v++){let S=!1,b=0,T=[0,0,0,0,0,0,0];for(let w=0;w<this.size;w++)this.modules[w][v]==S?(b++,b==5?f+=Ot.PENALTY_N1:b>5&&f++):(this.finderPenaltyAddHistory(b,T),S||(f+=this.finderPenaltyCountPatterns(T)*Ot.PENALTY_N3),S=this.modules[w][v],b=1);f+=this.finderPenaltyTerminateAndCount(S,b,T)*Ot.PENALTY_N3}for(let v=0;v<this.size-1;v++)for(let S=0;S<this.size-1;S++){const b=this.modules[v][S];b==this.modules[v][S+1]&&b==this.modules[v+1][S]&&b==this.modules[v+1][S+1]&&(f+=Ot.PENALTY_N2)}let d=0;for(const v of this.modules)d=v.reduce((S,b)=>S+(b?1:0),d);const p=this.size*this.size,_=Math.ceil(Math.abs(d*20-p*10)/p)-1;return r(0<=_&&_<=9),f+=_*Ot.PENALTY_N4,r(0<=f&&f<=2568888),f}getAlignmentPatternPositions(){if(this.version==1)return[];{const f=Math.floor(this.version/7)+2,d=this.version==32?26:Math.ceil((this.version*4+4)/(f*2-2))*2;let p=[6];for(let _=this.size-7;p.length<f;_-=d)p.splice(1,0,_);return p}}static getNumRawDataModules(f){if(f<Ot.MIN_VERSION||f>Ot.MAX_VERSION)throw new RangeError("Version number out of range");let d=(16*f+128)*f+64;if(f>=2){const p=Math.floor(f/7)+2;d-=(25*p-10)*p-55,f>=7&&(d-=36)}return r(208<=d&&d<=29648),d}static getNumDataCodewords(f,d){return Math.floor(Ot.getNumRawDataModules(f)/8)-Ot.ECC_CODEWORDS_PER_BLOCK[d.ordinal][f]*Ot.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][f]}static reedSolomonComputeDivisor(f){if(f<1||f>255)throw new RangeError("Degree out of range");let d=[];for(let _=0;_<f-1;_++)d.push(0);d.push(1);let p=1;for(let _=0;_<f;_++){for(let v=0;v<d.length;v++)d[v]=Ot.reedSolomonMultiply(d[v],p),v+1<d.length&&(d[v]^=d[v+1]);p=Ot.reedSolomonMultiply(p,2)}return d}static reedSolomonComputeRemainder(f,d){let p=d.map(_=>0);for(const _ of f){const v=_^p.shift();p.push(0),d.forEach((S,b)=>p[b]^=Ot.reedSolomonMultiply(S,v))}return p}static reedSolomonMultiply(f,d){if(f>>>8||d>>>8)throw new RangeError("Byte out of range");let p=0;for(let _=7;_>=0;_--)p=p<<1^(p>>>7)*285,p^=(d>>>_&1)*f;return r(p>>>8==0),p}finderPenaltyCountPatterns(f){const d=f[1];r(d<=this.size*3);const p=d>0&&f[2]==d&&f[3]==d*3&&f[4]==d&&f[5]==d;return(p&&f[0]>=d*4&&f[6]>=d?1:0)+(p&&f[6]>=d*4&&f[0]>=d?1:0)}finderPenaltyTerminateAndCount(f,d,p){return f&&(this.finderPenaltyAddHistory(d,p),d=0),d+=this.size,this.finderPenaltyAddHistory(d,p),this.finderPenaltyCountPatterns(p)}finderPenaltyAddHistory(f,d){d[0]==0&&(f+=this.size),d.pop(),d.unshift(f)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],a.QrCode=t;function e(h,f,d){if(f<0||f>31||h>>>f)throw new RangeError("Value out of range");for(let p=f-1;p>=0;p--)d.push(h>>>p&1)}function i(h,f){return(h>>>f&1)!=0}function r(h){if(!h)throw new Error("Assertion error")}const l=class re{constructor(f,d,p){if(this.mode=f,this.numChars=d,this.bitData=p,d<0)throw new RangeError("Invalid argument");this.bitData=p.slice()}static makeBytes(f){let d=[];for(const p of f)e(p,8,d);return new re(re.Mode.BYTE,f.length,d)}static makeNumeric(f){if(!re.isNumeric(f))throw new RangeError("String contains non-numeric characters");let d=[];for(let p=0;p<f.length;){const _=Math.min(f.length-p,3);e(parseInt(f.substring(p,p+_),10),_*3+1,d),p+=_}return new re(re.Mode.NUMERIC,f.length,d)}static makeAlphanumeric(f){if(!re.isAlphanumeric(f))throw new RangeError("String contains unencodable characters in alphanumeric mode");let d=[],p;for(p=0;p+2<=f.length;p+=2){let _=re.ALPHANUMERIC_CHARSET.indexOf(f.charAt(p))*45;_+=re.ALPHANUMERIC_CHARSET.indexOf(f.charAt(p+1)),e(_,11,d)}return p<f.length&&e(re.ALPHANUMERIC_CHARSET.indexOf(f.charAt(p)),6,d),new re(re.Mode.ALPHANUMERIC,f.length,d)}static makeSegments(f){return f==""?[]:re.isNumeric(f)?[re.makeNumeric(f)]:re.isAlphanumeric(f)?[re.makeAlphanumeric(f)]:[re.makeBytes(re.toUtf8ByteArray(f))]}static makeEci(f){let d=[];if(f<0)throw new RangeError("ECI assignment value out of range");if(f<128)e(f,8,d);else if(f<16384)e(2,2,d),e(f,14,d);else if(f<1e6)e(6,3,d),e(f,21,d);else throw new RangeError("ECI assignment value out of range");return new re(re.Mode.ECI,0,d)}static isNumeric(f){return re.NUMERIC_REGEX.test(f)}static isAlphanumeric(f){return re.ALPHANUMERIC_REGEX.test(f)}getData(){return this.bitData.slice()}static getTotalBits(f,d){let p=0;for(const _ of f){const v=_.mode.numCharCountBits(d);if(_.numChars>=1<<v)return 1/0;p+=4+v+_.bitData.length}return p}static toUtf8ByteArray(f){f=encodeURI(f);let d=[];for(let p=0;p<f.length;p++)f.charAt(p)!="%"?d.push(f.charCodeAt(p)):(d.push(parseInt(f.substring(p+1,p+3),16)),p+=2);return d}};l.NUMERIC_REGEX=/^[0-9]*$/,l.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,l.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let c=l;a.QrSegment=l})(sr||(sr={}));(a=>{(t=>{const e=class{constructor(r,l){this.ordinal=r,this.formatBits=l}};e.LOW=new e(0,1),e.MEDIUM=new e(1,0),e.QUARTILE=new e(2,3),e.HIGH=new e(3,2),t.Ecc=e})(a.QrCode||(a.QrCode={}))})(sr||(sr={}));(a=>{(t=>{const e=class{constructor(r,l){this.modeBits=r,this.numBitsCharCount=l}numCharCountBits(r){return this.numBitsCharCount[Math.floor((r+7)/17)]}};e.NUMERIC=new e(1,[10,12,14]),e.ALPHANUMERIC=new e(2,[9,11,13]),e.BYTE=new e(4,[8,16,16]),e.KANJI=new e(8,[8,10,12]),e.ECI=new e(7,[0,0,0]),t.Mode=e})(a.QrSegment||(a.QrSegment={}))})(sr||(sr={}));var $r=sr;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var fA={L:$r.QrCode.Ecc.LOW,M:$r.QrCode.Ecc.MEDIUM,Q:$r.QrCode.Ecc.QUARTILE,H:$r.QrCode.Ecc.HIGH},gC=128,mC="L",pC="#FFFFFF",_C="#000000",vC=!1,yC=1,dA=4,gA=0,mA=.1;function SC(a,t=0){const e=[];return a.forEach(function(i,r){let l=null;i.forEach(function(c,h){if(!c&&l!==null){e.push(`M${l+t} ${r+t}h${h-l}v1H${l+t}z`),l=null;return}if(h===i.length-1){if(!c)return;l===null?e.push(`M${h+t},${r+t} h1v1H${h+t}z`):e.push(`M${l+t},${r+t} h${h+1-l}v1H${l+t}z`);return}c&&l===null&&(l=h)})}),e.join("")}function bC(a,t){return a.slice().map((e,i)=>i<t.y||i>=t.y+t.h?e:e.map((r,l)=>l<t.x||l>=t.x+t.w?r:!1))}function pA(a,t,e,i){if(i==null)return null;const r=a.length+e*2,l=Math.floor(t*mA),c=r/t,h=(i.width||l)*c,f=(i.height||l)*c,d=i.x==null?a.length/2-h/2:i.x*c,p=i.y==null?a.length/2-f/2:i.y*c,_=i.opacity==null?1:i.opacity;let v=null;if(i.excavate){let b=Math.floor(d),T=Math.floor(p),w=Math.ceil(h+d-b),N=Math.ceil(f+p-T);v={x:b,y:T,w,h:N}}const S=i.crossOrigin;return{x:d,y:p,h:f,w:h,excavation:v,opacity:_,crossOrigin:S}}function _A(a,t){return t!=null?Math.max(Math.floor(t),0):a?dA:gA}function CC({value:a,level:t,minVersion:e,includeMargin:i,marginSize:r,imageSettings:l,size:c,boostLevel:h}){let f=Se.useMemo(()=>{const b=(Array.isArray(a)?a:[a]).reduce((T,w)=>(T.push(...$r.QrSegment.makeSegments(w)),T),[]);return $r.QrCode.encodeSegments(b,fA[t],e,void 0,void 0,h)},[a,t,e,h]);const{cells:d,margin:p,numCells:_,calculatedImageSettings:v}=Se.useMemo(()=>{let S=f.getModules();const b=_A(i,r),T=S.length+b*2,w=pA(S,c,b,l);return{cells:S,margin:b,numCells:T,calculatedImageSettings:w}},[f,c,l,i,r]);return{qrcode:f,margin:p,cells:d,numCells:_,calculatedImageSettings:v}}var vA=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),yA=Se.forwardRef(function(t,e){const i=t,{value:r,size:l=gC,level:c=mC,bgColor:h=pC,fgColor:f=_C,includeMargin:d=vC,minVersion:p=yC,boostLevel:_,marginSize:v,imageSettings:S}=i,T=Ag(i,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:w}=T,N=Ag(T,["style"]),I=S?.src,j=Se.useRef(null),Y=Se.useRef(null),B=Se.useCallback(ct=>{j.current=ct,typeof e=="function"?e(ct):e&&(e.current=ct)},[e]),[K,F]=Se.useState(!1),{margin:Q,cells:Z,numCells:nt,calculatedImageSettings:ot}=CC({value:r,level:c,minVersion:p,boostLevel:_,includeMargin:d,marginSize:v,imageSettings:S,size:l});Se.useEffect(()=>{if(j.current!=null){const ct=j.current,vt=ct.getContext("2d");if(!vt)return;let U=Z;const W=Y.current,tt=ot!=null&&W!==null&&W.complete&&W.naturalHeight!==0&&W.naturalWidth!==0;tt&&ot.excavation!=null&&(U=bC(Z,ot.excavation));const mt=window.devicePixelRatio||1;ct.height=ct.width=l*mt;const bt=l/nt*mt;vt.scale(bt,bt),vt.fillStyle=h,vt.fillRect(0,0,nt,nt),vt.fillStyle=f,vA?vt.fill(new Path2D(SC(U,Q))):Z.forEach(function(D,X){D.forEach(function($,et){$&&vt.fillRect(et+Q,X+Q,1,1)})}),ot&&(vt.globalAlpha=ot.opacity),tt&&vt.drawImage(W,ot.x+Q,ot.y+Q,ot.w,ot.h)}}),Se.useEffect(()=>{F(!1)},[I]);const rt=Dg({height:l,width:l},w);let ft=null;return I!=null&&(ft=Se.createElement("img",{src:I,key:I,style:{display:"none"},onLoad:()=>{F(!0)},ref:Y,crossOrigin:ot?.crossOrigin})),Se.createElement(Se.Fragment,null,Se.createElement("canvas",Dg({style:rt,height:l,width:l,ref:B,role:"img"},N)),ft)});yA.displayName="QRCodeCanvas";var xC=Se.forwardRef(function(t,e){const i=t,{value:r,size:l=gC,level:c=mC,bgColor:h=pC,fgColor:f=_C,includeMargin:d=vC,minVersion:p=yC,boostLevel:_,title:v,marginSize:S,imageSettings:b}=i,T=Ag(i,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:w,cells:N,numCells:I,calculatedImageSettings:j}=CC({value:r,level:c,minVersion:p,boostLevel:_,includeMargin:d,marginSize:S,imageSettings:b,size:l});let Y=N,B=null;b!=null&&j!=null&&(j.excavation!=null&&(Y=bC(N,j.excavation)),B=Se.createElement("image",{href:b.src,height:j.h,width:j.w,x:j.x+w,y:j.y+w,preserveAspectRatio:"none",opacity:j.opacity,crossOrigin:j.crossOrigin}));const K=SC(Y,w);return Se.createElement("svg",Dg({height:l,width:l,viewBox:`0 0 ${I} ${I}`,ref:e,role:"img"},T),!!v&&Se.createElement("title",null,v),Se.createElement("path",{fill:h,d:`M0,0 h${I}v${I}H0z`,shapeRendering:"crispEdges"}),Se.createElement("path",{fill:f,d:K,shapeRendering:"crispEdges"}),B)});xC.displayName="QRCodeSVG";function SA({onJoinTeam:a,teams:t}){const[e,i]=_t.useState("join"),[r,l]=_t.useState(""),[c,h]=_t.useState(""),[f,d]=_t.useState(""),[p,_]=_t.useState(""),[v,S]=_t.useState(!1),b=(j,Y)=>j.trim()?Y.trim()?j.trim().length>20?(_("Name must be 20 characters or less"),!1):Y.trim().length>30?(_("Team name must be 30 characters or less"),!1):!0:(_(e==="create"?"Please enter a team name":"Please select a team"),!1):(_("Please enter your name"),!1),T=async()=>{if(b(c,r)){S(!0),_("");try{const j="team_"+Date.now(),Y=ae(oe,`teams/${j}`),K=(await Mi(ae(oe,"teams"))).val()||{};if(Object.values(K).some(Q=>Q.name.toLowerCase()===r.trim().toLowerCase())){_("A team with this name already exists"),S(!1);return}await Vn(Y,{name:r.trim(),members:[c.trim()],score:0,createdAt:Date.now()}),a(j,c.trim())}catch(j){console.error("Error creating team:",j),_("Failed to create team. Please try again.")}finally{S(!1)}}},w=async()=>{if(b(c,f)){S(!0),_("");try{const j=ae(oe,`teams/${f}`),B=(await Mi(j)).val();if(!B){_("Team not found"),S(!1);return}if(B.members&&B.members.length>=6){_("This team is full (max 6 members)"),S(!1);return}if(B.members&&B.members.includes(c.trim())){_("A member with this name already exists in this team"),S(!1);return}const K=[...B.members||[],c.trim()];await wg(j,{members:K}),a(f,c.trim())}catch(j){console.error("Error joining team:",j),_("Failed to join team. Please try again.")}finally{S(!1)}}},N=j=>{j.preventDefault(),e==="create"?T():w()},I=Object.entries(t);return x.jsx("div",{className:"team-join-container",children:x.jsxs("div",{className:"team-join-card",children:[x.jsxs("div",{className:"mode-selector",children:[x.jsx("button",{className:`mode-button ${e==="join"?"active":""}`,onClick:()=>{i("join"),_("")},children:"Join Team"}),x.jsx("button",{className:`mode-button ${e==="create"?"active":""}`,onClick:()=>{i("create"),_("")},children:"Create Team"})]}),x.jsxs("form",{onSubmit:N,className:"team-join-form",children:[x.jsxs("div",{className:"form-group",children:[x.jsx("label",{htmlFor:"userName",children:"Your Name"}),x.jsx("input",{id:"userName",type:"text",value:c,onChange:j=>h(j.target.value),placeholder:"Enter your name",maxLength:20,disabled:v})]}),e==="create"?x.jsxs("div",{className:"form-group",children:[x.jsx("label",{htmlFor:"teamName",children:"Team Name"}),x.jsx("input",{id:"teamName",type:"text",value:r,onChange:j=>l(j.target.value),placeholder:"Enter team name",maxLength:30,disabled:v})]}):x.jsxs("div",{className:"form-group",children:[x.jsx("label",{htmlFor:"teamSelect",children:"Select Team"}),I.length>0?x.jsxs("select",{id:"teamSelect",value:f,onChange:j=>d(j.target.value),disabled:v,children:[x.jsx("option",{value:"",children:"-- Choose a team --"}),I.map(([j,Y])=>x.jsxs("option",{value:j,disabled:Y.members&&Y.members.length>=6,children:[Y.name," (",Y.members?.length||0,"/6 members)",Y.members&&Y.members.length>=6?" - FULL":""]},j))]}):x.jsx("p",{className:"no-teams-message",children:"No teams yet. Be the first to create one!"})]}),p&&x.jsx("div",{className:"error-message",children:p}),x.jsx("button",{type:"submit",className:"submit-button",disabled:v||e==="join"&&I.length===0,children:v?"Please wait...":e==="create"?"Create Team":"Join Team"})]}),e==="join"&&I.length>0&&x.jsxs("div",{className:"teams-preview",children:[x.jsx("h4",{children:"Available Teams"}),x.jsx("div",{className:"teams-preview-list",children:I.map(([j,Y])=>x.jsxs("div",{className:`team-preview-item ${Y.members?.length>=6?"full":""}`,children:[x.jsx("strong",{children:Y.name}),x.jsxs("span",{className:"member-count",children:[Y.members?.length||0,"/6"]})]},j))})]})]})})}function A(a,t,e){return(t=(function(i){var r=(function(l,c){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var f=h.call(l,c);if(typeof f!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(l)})(i,"string");return typeof r=="symbol"?r:r+""})(t))in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function Q0(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter((function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),e.push.apply(e,i)}return e}function M(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Q0(Object(e),!0).forEach((function(i){A(a,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):Q0(Object(e)).forEach((function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))}))}return a}function ee(a,t){if(a==null)return{};var e,i,r=(function(c,h){if(c==null)return{};var f={};for(var d in c)if({}.hasOwnProperty.call(c,d)){if(h.indexOf(d)>=0)continue;f[d]=c[d]}return f})(a,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(a);for(i=0;i<l.length;i++)e=l[i],t.indexOf(e)>=0||{}.propertyIsEnumerable.call(a,e)&&(r[e]=a[e])}return r}function si(a,t){return t||(t=a.slice(0)),Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(t)}}))}class K0{constructor(){A(this,"browserShadowBlurConstant",1),A(this,"DPI",96),A(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),A(this,"perfLimitSizeTotal",2097152),A(this,"maxCacheSideLimit",4096),A(this,"minCacheSideLimit",256),A(this,"disableStyleCopyPaste",!1),A(this,"enableGLFiltering",!0),A(this,"textureSize",4096),A(this,"forceGLPutImageData",!1),A(this,"cachesBoundsOfCurve",!1),A(this,"fontPaths",{}),A(this,"NUM_FRACTION_DIGITS",4)}}const jt=new class extends K0{constructor(a){super(),this.configure(a)}configure(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,a)}addFonts(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=M(M({},this.fontPaths),a)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach((a=>{delete this.fontPaths[a]}))}clearFonts(){this.fontPaths={}}restoreDefaults(a){const t=new K0,e=a?.reduce(((i,r)=>(i[r]=t[r],i)),{})||t;this.configure(e)}},Ts=function(a){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return console[a]("fabric",...e)};class ei extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class bA extends ei{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class CA{}class xA extends CA{testPrecision(t,e){const i="precision ".concat(e,` float;
void main(){}`),r=t.createShader(t.FRAGMENT_SHADER);return!!r&&(t.shaderSource(r,i),t.compileShader(r),!!t.getShaderParameter(r,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((i=>this.testPrecision(e,i))),e.getExtension("WEBGL_lose_context").loseContext(),Ts("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const TA={};let Z0;const ni=()=>Z0||(Z0={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new xA,dispose(){},copyPasteData:TA}),Sa=()=>ni().document,th=()=>ni().window,TC=()=>{var a;return Math.max((a=jt.devicePixelRatio)!==null&&a!==void 0?a:th().devicePixelRatio,1)},Lo=new class{constructor(){A(this,"charWidthsCache",{}),A(this,"boundsOfCurveCache",{})}getFontCache(a){let{fontFamily:t,fontStyle:e,fontWeight:i}=a;t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});const r=this.charWidthsCache[t],l="".concat(e.toLowerCase(),"_").concat((i+"").toLowerCase());return r[l]||(r[l]={}),r[l]}clearFontCache(a){(a=(a||"").toLowerCase())?this.charWidthsCache[a]&&delete this.charWidthsCache[a]:this.charWidthsCache={}}limitDimsByArea(a){const{perfLimitSizeTotal:t}=jt,e=Math.sqrt(t*a);return[Math.floor(e),Math.floor(t/e)]}},Mg="6.7.1";function au(){}const hl=Math.PI/2,Mu=2*Math.PI,Em=Math.PI/180,Ge=Object.freeze([1,0,0,1,0,0]),Om=16,ds=.4477152502,Ct="center",It="left",nn="top",Rg="bottom",fe="right",sn="none",Dm=/\r?\n/,wC="moving",eh="scaling",EC="rotating",Am="rotate",OC="skewing",Zo="resizing",wA="modifyPoly",EA="modifyPath",Ru="changed",nh="scale",an="scaleX",jn="scaleY",ba="skewX",Ca="skewY",xe="fill",rn="stroke",Nu="modified",Qr="json",qd="svg",it=new class{constructor(){this[Qr]=new Map,this[qd]=new Map}has(a){return this[Qr].has(a)}getClass(a){const t=this[Qr].get(a);if(!t)throw new ei("No class registered for ".concat(a));return t}setClass(a,t){t?this[Qr].set(t,a):(this[Qr].set(a.type,a),this[Qr].set(a.type.toLowerCase(),a))}getSVGClass(a){return this[qd].get(a)}setSVGClass(a,t){this[qd].set(t??a.type.toLowerCase(),a)}},ju=new class extends Array{remove(a){const t=this.indexOf(a);t>-1&&this.splice(t,1)}cancelAll(){const a=this.splice(0);return a.forEach((t=>t.abort())),a}cancelByCanvas(a){if(!a)return[];const t=this.filter((e=>{var i;return e.target===a||typeof e.target=="object"&&((i=e.target)===null||i===void 0?void 0:i.canvas)===a}));return t.forEach((e=>e.abort())),t}cancelByTarget(a){if(!a)return[];const t=this.filter((e=>e.target===a));return t.forEach((e=>e.abort())),t}};class OA{constructor(){A(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),typeof t=="object")return Object.entries(t).forEach((i=>{let[r,l]=i;this.on(r,l)})),()=>this.off(t);if(e){const i=t;return this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(e),()=>this.off(i,e)}return()=>!1}once(t,e){if(typeof t=="object"){const i=[];return Object.entries(t).forEach((r=>{let[l,c]=r;i.push(this.once(l,c))})),()=>i.forEach((r=>r()))}if(e){const i=this.on(t,(function(){for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];e.call(this,...l),i()}));return i}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const i=this.__eventListeners[t],r=i.indexOf(e);r>-1&&i.splice(r,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(t===void 0)for(const i in this.__eventListeners)this._removeEventListener(i);else typeof t=="object"?Object.entries(t).forEach((i=>{let[r,l]=i;this._removeEventListener(r,l)})):this._removeEventListener(t,e)}fire(t,e){var i;if(!this.__eventListeners)return;const r=(i=this.__eventListeners[t])===null||i===void 0?void 0:i.concat();if(r)for(let l=0;l<r.length;l++)r[l].call(this,e||{})}}const Zr=(a,t)=>{const e=a.indexOf(t);return e!==-1&&a.splice(e,1),a},Li=a=>{if(a===0)return 1;switch(Math.abs(a)/hl){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},zi=a=>{if(a===0)return 0;const t=a/hl,e=Math.sign(a);switch(t){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(a)};class P{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new P(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new P(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new P(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new P(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new P(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new P(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new P(this.x/t.x,this.y/t.y)}scalarDivide(t){return new P(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new P(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}midPointFrom(t){return this.lerp(t)}min(t){return new P(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new P(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i}clone(){return new P(this.x,this.y)}rotate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mm;const i=zi(t),r=Li(t),l=this.subtract(e);return new P(l.x*r-l.y*i,l.x*i+l.y*r).add(e)}transform(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new P(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const Mm=new P(0,0),ou=a=>!!a&&Array.isArray(a._objects);function DC(a){class t extends a{constructor(){super(...arguments),A(this,"_objects",[])}_onObjectAdded(i){}_onObjectRemoved(i){}_onStackOrderChanged(i){}add(){for(var i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];const c=this._objects.push(...r);return r.forEach((h=>this._onObjectAdded(h))),c}insertAt(i){for(var r=arguments.length,l=new Array(r>1?r-1:0),c=1;c<r;c++)l[c-1]=arguments[c];return this._objects.splice(i,0,...l),l.forEach((h=>this._onObjectAdded(h))),this._objects.length}remove(){const i=this._objects,r=[];for(var l=arguments.length,c=new Array(l),h=0;h<l;h++)c[h]=arguments[h];return c.forEach((f=>{const d=i.indexOf(f);d!==-1&&(i.splice(d,1),r.push(f),this._onObjectRemoved(f))})),r}forEachObject(i){this.getObjects().forEach(((r,l,c)=>i(r,l,c)))}getObjects(){for(var i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];return r.length===0?[...this._objects]:this._objects.filter((c=>c.isType(...r)))}item(i){return this._objects[i]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(i,r){return!!this._objects.includes(i)||!!r&&this._objects.some((l=>l instanceof t&&l.contains(i,!0)))}complexity(){return this._objects.reduce(((i,r)=>i+=r.complexity?r.complexity():0),0)}sendObjectToBack(i){return!(!i||i===this._objects[0])&&(Zr(this._objects,i),this._objects.unshift(i),this._onStackOrderChanged(i),!0)}bringObjectToFront(i){return!(!i||i===this._objects[this._objects.length-1])&&(Zr(this._objects,i),this._objects.push(i),this._onStackOrderChanged(i),!0)}sendObjectBackwards(i,r){if(!i)return!1;const l=this._objects.indexOf(i);if(l!==0){const c=this.findNewLowerIndex(i,l,r);return Zr(this._objects,i),this._objects.splice(c,0,i),this._onStackOrderChanged(i),!0}return!1}bringObjectForward(i,r){if(!i)return!1;const l=this._objects.indexOf(i);if(l!==this._objects.length-1){const c=this.findNewUpperIndex(i,l,r);return Zr(this._objects,i),this._objects.splice(c,0,i),this._onStackOrderChanged(i),!0}return!1}moveObjectTo(i,r){return i!==this._objects[r]&&(Zr(this._objects,i),this._objects.splice(r,0,i),this._onStackOrderChanged(i),!0)}findNewLowerIndex(i,r,l){let c;if(l){c=r;for(let h=r-1;h>=0;--h)if(i.isOverlapping(this._objects[h])){c=h;break}}else c=r-1;return c}findNewUpperIndex(i,r,l){let c;if(l){c=r;for(let h=r+1;h<this._objects.length;++h)if(i.isOverlapping(this._objects[h])){c=h;break}}else c=r+1;return c}collectObjects(i){let{left:r,top:l,width:c,height:h}=i,{includeIntersecting:f=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const d=[],p=new P(r,l),_=p.add(new P(c,h));for(let v=this._objects.length-1;v>=0;v--){const S=this._objects[v];S.selectable&&S.visible&&(f&&S.intersectsWithRect(p,_)||S.isContainedWithinRect(p,_)||f&&S.containsPoint(p)||f&&S.containsPoint(_))&&d.push(S)}return d}}return t}class AC extends OA{_setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return typeof t=="object"?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return typeof e=="boolean"&&this.set(t,!e),this}get(t){return this[t]}}function lu(a){return th().requestAnimationFrame(a)}function DA(a){return th().cancelAnimationFrame(a)}let AA=0;const ws=()=>AA++,Bi=()=>{const a=Sa().createElement("canvas");if(!a||a.getContext===void 0)throw new ei("Failed to create `canvas` element");return a},MA=()=>Sa().createElement("img"),kn=a=>{const t=Bi();return t.width=a.width,t.height=a.height,t},MC=(a,t,e)=>a.toDataURL("image/".concat(t),e),RC=(a,t,e)=>new Promise(((i,r)=>{a.toBlob(i,"image/".concat(t),e)})),de=a=>a*Em,Ii=a=>a/Em,RA=a=>a.every(((t,e)=>t===Ge[e])),tn=(a,t,e)=>new P(a).transform(t,e),Gn=a=>{const t=1/(a[0]*a[3]-a[1]*a[2]),e=[t*a[3],-t*a[1],-t*a[2],t*a[0],0,0],{x:i,y:r}=new P(a[4],a[5]).transform(e,!0);return e[4]=-i,e[5]=-r,e},ze=(a,t,e)=>[a[0]*t[0]+a[2]*t[1],a[1]*t[0]+a[3]*t[1],a[0]*t[2]+a[2]*t[3],a[1]*t[2]+a[3]*t[3],e?0:a[0]*t[4]+a[2]*t[5]+a[4],e?0:a[1]*t[4]+a[3]*t[5]+a[5]],Rm=(a,t)=>a.reduceRight(((e,i)=>i&&e?ze(i,e,t):i||e),void 0)||Ge.concat(),NC=a=>{let[t,e]=a;return Math.atan2(e,t)},ku=a=>{const t=NC(a),e=Math.pow(a[0],2)+Math.pow(a[1],2),i=Math.sqrt(e),r=(a[0]*a[3]-a[2]*a[1])/i,l=Math.atan2(a[0]*a[2]+a[1]*a[3],e);return{angle:Ii(t),scaleX:i,scaleY:r,skewX:Ii(l),skewY:0,translateX:a[4]||0,translateY:a[5]||0}},fl=function(a){return[1,0,0,1,a,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function xa(){let{angle:a=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:t=0,y:e=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=de(a),r=Li(i),l=zi(i);return[r,l,-l,r,t?t-(r*t-l*e):0,e?e-(l*t+r*e):0]}const Nm=function(a){return[a,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:a,0,0]},jC=a=>Math.tan(de(a)),kC=a=>[1,0,jC(a),1,0,0],LC=a=>[1,jC(a),0,1,0,0],ih=a=>{let{scaleX:t=1,scaleY:e=1,flipX:i=!1,flipY:r=!1,skewX:l=0,skewY:c=0}=a,h=Nm(i?-t:t,r?-e:e);return l&&(h=ze(h,kC(l),!0)),c&&(h=ze(h,LC(c),!0)),h},NA=a=>{const{translateX:t=0,translateY:e=0,angle:i=0}=a;let r=fl(t,e);i&&(r=ze(r,xa({angle:i})));const l=ih(a);return RA(l)||(r=ze(r,l)),r},cu=function(a){let{signal:t,crossOrigin:e=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((function(i,r){if(t&&t.aborted)return r(new bA("loadImage"));const l=MA();let c;t&&(c=function(f){l.src="",r(f)},t.addEventListener("abort",c,{once:!0}));const h=function(){l.onload=l.onerror=null,c&&t?.removeEventListener("abort",c),i(l)};a?(l.onload=h,l.onerror=function(){c&&t?.removeEventListener("abort",c),r(new ei("Error loading ".concat(l.src)))},e&&(l.crossOrigin=e),l.src=a):h()}))},Jo=function(a){let{signal:t,reviver:e=au}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(((i,r)=>{const l=[];t&&t.addEventListener("abort",r,{once:!0}),Promise.all(a.map((c=>it.getClass(c.type).fromObject(c,{signal:t}).then((h=>(e(c,h),l.push(h),h)))))).then(i).catch((c=>{l.forEach((h=>{h.dispose&&h.dispose()})),r(c)})).finally((()=>{t&&t.removeEventListener("abort",r)}))}))},sh=function(a){let{signal:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(((e,i)=>{const r=[];t&&t.addEventListener("abort",i,{once:!0});const l=Object.values(a).map((h=>h&&h.type&&it.has(h.type)?Jo([h],{signal:t}).then((f=>{let[d]=f;return r.push(d),d})):h)),c=Object.keys(a);Promise.all(l).then((h=>h.reduce(((f,d,p)=>(f[c[p]]=d,f)),{}))).then(e).catch((h=>{r.forEach((f=>{f.dispose&&f.dispose()})),i(h)})).finally((()=>{t&&t.removeEventListener("abort",i)}))}))},Ta=function(a){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce(((t,e)=>(e in a&&(t[e]=a[e]),t)),{})},jm=(a,t)=>Object.keys(a).reduce(((e,i)=>(t(a[i],i,a)&&(e[i]=a[i]),e)),{}),Kt=(a,t)=>parseFloat(Number(a).toFixed(t)),$o=a=>"matrix("+a.map((t=>Kt(t,jt.NUM_FRACTION_DIGITS))).join(" ")+")",Mn=a=>!!a&&a.toLive!==void 0,J0=a=>!!a&&typeof a.toObject=="function",$0=a=>!!a&&a.offsetX!==void 0&&"source"in a,Ws=a=>!!a&&"multiSelectionStacking"in a;function zC(a){const t=a&&Hn(a);let e=0,i=0;if(!a||!t)return{left:e,top:i};let r=a;const l=t.documentElement,c=t.body||{scrollLeft:0,scrollTop:0};for(;r&&(r.parentNode||r.host)&&(r=r.parentNode||r.host,r===t?(e=c.scrollLeft||l.scrollLeft||0,i=c.scrollTop||l.scrollTop||0):(e+=r.scrollLeft||0,i+=r.scrollTop||0),r.nodeType!==1||r.style.position!=="fixed"););return{left:e,top:i}}const Hn=a=>a.ownerDocument||null,BC=a=>{var t;return((t=a.ownerDocument)===null||t===void 0?void 0:t.defaultView)||null},IC=function(a,t,e){let{width:i,height:r}=e,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;a.width=i,a.height=r,l>1&&(a.setAttribute("width",(i*l).toString()),a.setAttribute("height",(r*l).toString()),t.scale(l,l))},Ng=(a,t)=>{let{width:e,height:i}=t;e&&(a.style.width=typeof e=="number"?"".concat(e,"px"):e),i&&(a.style.height=typeof i=="number"?"".concat(i,"px"):i)};function tS(a){return a.onselectstart!==void 0&&(a.onselectstart=()=>!1),a.style.userSelect=sn,a}class FC{constructor(t){A(this,"_originalCanvasStyle",void 0),A(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(i=t)&&i.getContext!==void 0?t:t&&Sa().getElementById(t)||Bi();var i;if(e.hasAttribute("data-fabric"))throw new ei("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:i}=t;const{el:r}=this.lower;r.classList.remove("lower-canvas"),r.removeAttribute("data-fabric"),r.setAttribute("width","".concat(e)),r.setAttribute("height","".concat(i)),r.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:i,ctx:r}=this.lower;IC(i,r,t,e)}setCSSDimensions(t){Ng(this.lower.el,t)}calcOffset(){return(function(t){var e;const i=t&&Hn(t),r={left:0,top:0};if(!i)return r;const l=((e=BC(t))===null||e===void 0?void 0:e.getComputedStyle(t,null))||{};r.left+=parseInt(l.borderLeftWidth,10)||0,r.top+=parseInt(l.borderTopWidth,10)||0,r.left+=parseInt(l.paddingLeft,10)||0,r.top+=parseInt(l.paddingTop,10)||0;let c={left:0,top:0};const h=i.documentElement;t.getBoundingClientRect!==void 0&&(c=t.getBoundingClientRect());const f=zC(t);return{left:c.left+f.left-(h.clientLeft||0)+r.left,top:c.top+f.top-(h.clientTop||0)+r.top}})(this.lower.el)}dispose(){ni().dispose(this.lower.el),delete this.lower}}const jA={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...Ge]};class dl extends DC(AC){get lowerCanvasEl(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.el}get contextContainer(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.ctx}static getDefaults(){return dl.ownDefaults}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new FC(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];const l=super.insertAt(t,...i);return i.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),l}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(Ts("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?TC():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:i=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e){const r=M({width:this.width,height:this.height},t);this.elements.setDimensions(r,this.getRetinaScaling()),this.hasLostContext=!0,this.width=r.width,this.height=r.height}i||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const i=t,r=[...this.viewportTransform],l=tn(t,Gn(r));r[0]=e,r[3]=e;const c=tn(l,r);r[4]+=i.x-c.x,r[5]+=i.y-c.y,this.setViewportTransform(r)}setZoom(t){this.zoomToPoint(new P(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new P(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=lu((()=>this.renderAndReset())))}calcViewportBoundaries(){const t=this.width,e=this.height,i=Gn(this.viewportTransform),r=tn({x:0,y:0},i),l=tn({x:t,y:e},i),c=r.min(l),h=r.max(l);return this.vptCoords={tl:c,tr:new P(h.x,c.y),bl:new P(c.x,h.y),br:h}}cancelRequestedRender(){this.nextRenderHandle&&(DA(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const i=this.viewportTransform,r=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),r&&(r._set("canvas",this),r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,r)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const i=this.viewportTransform;t.save(),t.transform(...i),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let i=0,r=e.length;i<r;++i)e[i]&&e[i].render(t)}_renderBackgroundOrOverlay(t,e){const i=this["".concat(e,"Color")],r=this["".concat(e,"Image")],l=this.viewportTransform,c=this["".concat(e,"Vpt")];if(!i&&!r)return;const h=Mn(i);if(i){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=h?i.toLive(t):i,c&&t.transform(...l),h){t.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);const f=i.gradientTransform||i.patternTransform;f&&t.transform(...f)}t.fill(),t.restore()}if(r){t.save();const{skipOffscreen:f}=this;this.skipOffscreen=c,c&&t.transform(...l),r.render(t),this.skipOffscreen=f,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new P(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new P(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new P(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new P(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new P(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return tn(this.getCenterPoint(),Gn(this.viewportTransform))}_centerObject(t,e){t.setXY(e,Ct,Ct),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const i=this.clipPath,r=i&&!i.excludeFromExport?this._toObject(i,t,e):null;return M(M(M({version:Mg},Ta(this,e)),{},{objects:this._objects.filter((l=>!l.excludeFromExport)).map((l=>this._toObject(l,t,e)))},this.__serializeBgOverlay(t,e)),r?{clipPath:r}:null)}_toObject(t,e,i){let r;this.includeDefaultValues||(r=t.includeDefaultValues,t.includeDefaultValues=!1);const l=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=!!r),l}__serializeBgOverlay(t,e){const i={},r=this.backgroundImage,l=this.overlayImage,c=this.backgroundColor,h=this.overlayColor;return Mn(c)?c.excludeFromExport||(i.background=c.toObject(e)):c&&(i.background=c),Mn(h)?h.excludeFromExport||(i.overlay=h.toObject(e)):h&&(i.overlay=h),r&&!r.excludeFromExport&&(i.backgroundImage=this._toObject(r,t,e)),l&&!l.excludeFromExport&&(i.overlayImage=this._toObject(l,t,e)),i}toSVG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this.clipPath&&i.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this.clipPath&&i.push(`</g>
`),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(t,e){const i=e.width||"".concat(this.width),r=e.height||"".concat(this.height),l=jt.NUM_FRACTION_DIGITS,c=e.viewBox;let h;if(c)h='viewBox="'.concat(c.x," ").concat(c.y," ").concat(c.width," ").concat(c.height,'" ');else if(this.svgViewportTransformation){const f=this.viewportTransform;h='viewBox="'.concat(Kt(-f[4]/f[0],l)," ").concat(Kt(-f[5]/f[3],l)," ").concat(Kt(this.width/f[0],l)," ").concat(Kt(this.height/f[3],l),'" ')}else h='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',r,'" ',h,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",Mg,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),`</defs>
`)}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(ws()),'<clipPath id="'.concat(e.clipPathId,`" >
`).concat(e.toClipPathSVG(t.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map((t=>{const e=this["".concat(t,"Color")];if(Mn(e)){const i=this["".concat(t,"Vpt")],r=this.viewportTransform,l={isType:()=>!1,width:this.width/(i?r[0]:1),height:this.height/(i?r[3]:1)};return e.toSVG(l,{additionalTransform:i?$o(r):""})}})).join("")}createSVGFontFacesMarkup(){const t=[],e={},i=jt.fontPaths;this._objects.forEach((function l(c){t.push(c),ou(c)&&c._objects.forEach(l)})),t.forEach((l=>{if(!(c=l)||typeof c._renderText!="function")return;var c;const{styles:h,fontFamily:f}=l;!e[f]&&i[f]&&(e[f]=!0,h&&Object.values(h).forEach((d=>{Object.values(d).forEach((p=>{let{fontFamily:_=""}=p;!e[_]&&i[_]&&(e[_]=!0)}))})))}));const r=Object.keys(e).map((l=>`		@font-face {
			font-family: '`.concat(l,`';
			src: url('`).concat(i[l],`');
		}
`))).join("");return r?`	<style type="text/css"><![CDATA[
`.concat(r,`]]></style>
`):""}_setSVGObjects(t,e){this.forEachObject((i=>{i.excludeFromExport||this._setSVGObject(t,i,e)}))}_setSVGObject(t,e,i){t.push(e.toSVG(i))}_setSVGBgOverlayImage(t,e,i){const r=this[e];r&&!r.excludeFromExport&&r.toSVG&&t.push(r.toSVG(i))}_setSVGBgOverlayColor(t,e){const i=this["".concat(e,"Color")];if(i)if(Mn(i)){const r=i.repeat||"",l=this.width,c=this.height,h=this["".concat(e,"Vpt")]?$o(Gn(this.viewportTransform)):"";t.push('<rect transform="'.concat(h," translate(").concat(l/2,",").concat(c/2,')" x="').concat(i.offsetX-l/2,'" y="').concat(i.offsetY-c/2,'" width="').concat(r!=="repeat-y"&&r!=="no-repeat"||!$0(i)?l:i.source.width,'" height="').concat(r!=="repeat-x"&&r!=="no-repeat"||!$0(i)?c:i.source.height,'" fill="url(#SVGID_').concat(i.id,`)"></rect>
`))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',`></rect>
`)}loadFromJSON(t,e){let{signal:i}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!t)return Promise.reject(new ei("`json` is undefined"));const r=typeof t=="string"?JSON.parse(t):t,{objects:l=[],backgroundImage:c,background:h,overlayImage:f,overlay:d,clipPath:p}=r,_=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Jo(l,{reviver:e,signal:i}),sh({backgroundImage:c,backgroundColor:h,overlayImage:f,overlayColor:d,clipPath:p},{signal:i})]).then((v=>{let[S,b]=v;return this.clear(),this.add(...S),this.set(r),this.set(b),this.renderOnAddRemove=_,this}))}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=kn(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:i=1,multiplier:r=1,enableRetinaScaling:l=!1}=t,c=r*(l?this.getRetinaScaling():1);return MC(this.toCanvasElement(c,t),e,i)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:i=1,multiplier:r=1,enableRetinaScaling:l=!1}=t,c=r*(l?this.getRetinaScaling():1);return RC(this.toCanvasElement(c,t),e,i)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:e,height:i,left:r,top:l,filter:c}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const h=(e||this.width)*t,f=(i||this.height)*t,d=this.getZoom(),p=this.width,_=this.height,v=this.skipControlsDrawing,S=d*t,b=this.viewportTransform,T=[S,0,0,S,(b[4]-(r||0))*t,(b[5]-(l||0))*t],w=this.enableRetinaScaling,N=kn({width:h,height:f}),I=c?this._objects.filter((j=>c(j))):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=T,this.width=h,this.height=f,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(N.getContext("2d"),I),this.viewportTransform=b,this.width=p,this.height=_,this.calcViewportBoundaries(),this.enableRetinaScaling=w,this.skipControlsDrawing=v,N}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),ju.cancelByCanvas(this),this.disposed=!0,new Promise(((t,e)=>{const i=()=>{this.destroy(),t(!0)};i.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=i:i()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((t=>t.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}A(dl,"ownDefaults",jA);const kA=["touchstart","touchmove","touchend"],LA=a=>{const t=zC(a.target),e=(function(i){const r=i.changedTouches;return r&&r[0]?r[0]:i})(a);return new P(e.clientX+t.left,e.clientY+t.top)},jg=a=>kA.includes(a.type)||a.pointerType==="touch",eS=a=>{a.preventDefault(),a.stopPropagation()},Ri=a=>{let t=0,e=0,i=0,r=0;for(let l=0,c=a.length;l<c;l++){const{x:h,y:f}=a[l];(h>i||!l)&&(i=h),(h<t||!l)&&(t=h),(f>r||!l)&&(r=f),(f<e||!l)&&(e=f)}return{left:t,top:e,width:i-t,height:r-e}},zA=["translateX","translateY","scaleX","scaleY"],BA=(a,t)=>Lu(a,ze(t,a.calcOwnMatrix())),Lu=(a,t)=>{const e=ku(t),{translateX:i,translateY:r,scaleX:l,scaleY:c}=e,h=ee(e,zA),f=new P(i,r);a.flipX=!1,a.flipY=!1,Object.assign(a,h),a.set({scaleX:l,scaleY:c}),a.setPositionByOrigin(f,Ct,Ct)},IA=a=>{a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},UC=a=>({scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}),km=(a,t,e)=>{const i=a/2,r=t/2,l=[new P(-i,-r),new P(i,-r),new P(-i,r),new P(i,r)].map((h=>h.transform(e))),c=Ri(l);return new P(c.width,c.height)},rh=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ge;return ze(Gn(arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ge),a)},aa=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ge,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ge;return a.transform(rh(t,e))},FA=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ge,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ge;return a.transform(rh(t,e),!0)},UA=(a,t,e)=>{const i=rh(t,e);return Lu(a,ze(i,a.calcOwnMatrix())),i},PC=(a,t)=>{var e;const{transform:{target:i}}=t;(e=i.canvas)===null||e===void 0||e.fire("object:".concat(a),M(M({},t),{},{target:i})),i.fire(a,t)},PA={left:-.5,top:-.5,center:0,bottom:.5,right:.5},ve=a=>typeof a=="string"?PA[a]:a-.5,zu="not-allowed";function HC(a){return ve(a.originX)===ve(Ct)&&ve(a.originY)===ve(Ct)}function nS(a){return .5-ve(a)}const Wn=(a,t)=>a[t],YC=(a,t,e,i)=>({e:a,transform:t,pointer:new P(e,i)});function VC(a,t){const e=a.getTotalAngle()+Ii(Math.atan2(t.y,t.x))+360;return Math.round(e%360/45)}function Lm(a,t,e,i,r){var l;let{target:c,corner:h}=a;const f=c.controls[h],d=((l=c.canvas)===null||l===void 0?void 0:l.getZoom())||1,p=c.padding/d,_=(function(v,S,b,T){const w=v.getRelativeCenterPoint(),N=b!==void 0&&T!==void 0?v.translateToGivenOrigin(w,Ct,Ct,b,T):new P(v.left,v.top);return(v.angle?S.rotate(-de(v.angle),w):S).subtract(N)})(c,new P(i,r),t,e);return _.x>=p&&(_.x-=p),_.x<=-p&&(_.x+=p),_.y>=p&&(_.y-=p),_.y<=p&&(_.y+=p),_.x-=f.offsetX,_.y-=f.offsetY,_}const HA=(a,t,e,i)=>{const{target:r,offsetX:l,offsetY:c}=t,h=e-l,f=i-c,d=!Wn(r,"lockMovementX")&&r.left!==h,p=!Wn(r,"lockMovementY")&&r.top!==f;return d&&r.set(It,h),p&&r.set(nn,f),(d||p)&&PC(wC,YC(a,t,e,i)),d||p},iS={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Wd=(a,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?a+6*(t-a)*e:e<.5?t:e<2/3?a+(t-a)*(2/3-e)*6:a),sS=(a,t,e,i)=>{a/=255,t/=255,e/=255;const r=Math.max(a,t,e),l=Math.min(a,t,e);let c,h;const f=(r+l)/2;if(r===l)c=h=0;else{const d=r-l;switch(h=f>.5?d/(2-r-l):d/(r+l),r){case a:c=(t-e)/d+(t<e?6:0);break;case t:c=(e-a)/d+2;break;case e:c=(a-t)/d+4}c/=6}return[Math.round(360*c),Math.round(100*h),Math.round(100*f),i]},rS=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(a)/(a.endsWith("%")?100:1)},kc=a=>Math.min(Math.round(a),255).toString(16).toUpperCase().padStart(2,"0"),aS=a=>{let[t,e,i,r=1]=a;const l=Math.round(.3*t+.59*e+.11*i);return[l,l,l,r]};class Pt{constructor(t){if(A(this,"isUnrecognised",!1),t)if(t instanceof Pt)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,i,r,l=1]=t;this.setSource([e,i,r,l])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in iS&&(t=iS[t]),t==="transparent"?[255,255,255,0]:Pt.sourceFromHex(t)||Pt.sourceFromRgb(t)||Pt.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,i]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(i,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,i]=sS(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(i,"%)")}toHsla(){const[t,e,i,r]=sS(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(i,"%,").concat(r,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,i,r]=this.getSource();return"".concat(kc(t)).concat(kc(e)).concat(kc(i)).concat(kc(Math.round(255*r)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(aS(this.getSource())),this}toBlackWhite(t){const[e,,,i]=aS(this.getSource()),r=e<(t||127)?0:255;return this.setSource([r,r,r,i]),this}overlayWith(t){t instanceof Pt||(t=new Pt(t));const e=this.getSource(),i=t.getSource(),[r,l,c]=e.map(((h,f)=>Math.round(.5*h+.5*i[f])));return this.setSource([r,l,c,e[3]]),this}static fromRgb(t){return Pt.fromRgba(t)}static fromRgba(t){return new Pt(Pt.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[i,r,l]=e.slice(1,4).map((c=>{const h=parseFloat(c);return c.endsWith("%")?Math.round(2.55*h):h}));return[i,r,l,rS(e[4])]}}static fromHsl(t){return Pt.fromHsla(t)}static fromHsla(t){return new Pt(Pt.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const i=(Pt.parseAngletoDegrees(e[1])%360+360)%360/360,r=parseFloat(e[2])/100,l=parseFloat(e[3])/100;let c,h,f;if(r===0)c=h=f=l;else{const d=l<=.5?l*(r+1):l+r-l*r,p=2*l-d;c=Wd(p,d,i+1/3),h=Wd(p,d,i),f=Wd(p,d,i-1/3)}return[Math.round(255*c),Math.round(255*h),Math.round(255*f),rS(e[4])]}static fromHex(t){return new Pt(Pt.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let i;i=e.length<=4?e.split("").map((f=>f+f)):e.match(/.{2}/g);const[r,l,c,h=255]=i.map((f=>parseInt(f,16)));return[r,l,c,h/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),i=parseFloat(e);return e.includes("rad")?Ii(i):e.includes("turn")?360*i:i}}const oa=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Om;const e=/\D{0,2}$/.exec(a),i=parseFloat(a),r=jt.DPI;switch(e?.[0]){case"mm":return i*r/25.4;case"cm":return i*r/2.54;case"in":return i*r;case"pt":return i*r/72;case"pc":return i*r/72*12;case"em":return i*t;default:return i}},YA=a=>{const[t,e]=a.trim().split(" "),[i,r]=(l=t)&&l!==sn?[l.slice(1,4),l.slice(5,8)]:l===sn?[l,l]:["Mid","Mid"];var l;return{meetOrSlice:e||"meet",alignX:i,alignY:r}},tl=function(a,t){let e,i,r=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(t)if(t.toLive)e="url(#SVGID_".concat(t.id,")");else{const l=new Pt(t),c=l.getAlpha();e=l.toRgb(),c!==1&&(i=c.toString())}else e="none";return r?"".concat(a,": ").concat(e,"; ").concat(i?"".concat(a,"-opacity: ").concat(i,"; "):""):"".concat(a,'="').concat(e,'" ').concat(i?"".concat(a,'-opacity="').concat(i,'" '):"")};class GC{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):sn,l=this.strokeDashOffset?this.strokeDashOffset:"0",c=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",d=this.opacity!==void 0?this.opacity:"1",p=this.visible?"":" visibility: hidden;",_=t?"":this.getSvgFilter(),v=tl(xe,this.fill);return[tl(rn,this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",c,"; ","stroke-dashoffset: ",l,"; ","stroke-linejoin: ",h,"; ","stroke-miterlimit: ",f,"; ",v,"fill-rule: ",e,"; ","opacity: ",d,";",_,p].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=t?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'.concat($o(i));return"".concat(r).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:i=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=[this.getSvgTransform(!0,i),this.getSvgCommons()].join(""),l=t.indexOf("COMMON_PARTS");return t[l]=r,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:i,withShadow:r,additionalTransform:l}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c=e?"":'style="'.concat(this.getSvgStyles(),'" '),h=r?'style="'.concat(this.getSvgFilter(),'" '):"",f=this.clipPath,d=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",p=f&&f.absolutePositioned,_=this.stroke,v=this.fill,S=this.shadow,b=[],T=t.indexOf("COMMON_PARTS");let w;f&&(f.clipPathId="CLIPPATH_".concat(ws()),w='<clipPath id="'.concat(f.clipPathId,`" >
`).concat(f.toClipPathSVG(i),`</clipPath>
`)),p&&b.push("<g ",h,this.getSvgCommons(),` >
`),b.push("<g ",this.getSvgTransform(!1),p?"":h+this.getSvgCommons(),` >
`);const N=[c,d,e?"":this.addPaintOrder()," ",l?'transform="'.concat(l,'" '):""].join("");return t[T]=N,Mn(v)&&b.push(v.toSVG(this)),Mn(_)&&b.push(_.toSVG(this)),S&&b.push(S.toSVG(this)),f&&b.push(w),b.push(t.join("")),b.push(`</g>
`),p&&b.push(`</g>
`),i?i(b.join("")):b.join("")}addPaintOrder(){return this.paintFirst!==xe?' paint-order="'.concat(this.paintFirst,'" '):""}}function ah(a){return new RegExp("^("+a.join("|")+")\\b","i")}const rr="textDecorationThickness",XC=["fontSize","fontWeight","fontFamily","fontStyle"],qC=["underline","overline","linethrough"],WC=[...XC,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],QC=[...WC,...qC,"textBackgroundColor","direction",rr],VA=[...XC,...qC,rn,"strokeWidth",xe,"deltaY","textBackgroundColor",rr],GA={_reNewline:Dm,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:It,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:It,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[rr]:66.667},ti="justify",Bu="justify-left",zo="justify-right",Bo="justify-center";var oS,lS,cS;const Xn=String.raw(oS||(oS=si(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),Qd=String.raw(lS||(lS=si(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),XA=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Xn+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Xn+"))?\\s+(.*)"),qA={cx:It,x:It,r:"radius",cy:nn,y:nn,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":rr},Kd="font-size",Zd="clip-path";ah(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);ah(["symbol","image","marker","pattern","view","svg"]);const uS=ah(["symbol","g","a","svg","clipPath","defs"]);new RegExp(String.raw(cS||(cS=si(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),Xn,Qd,Xn,Qd,Xn,Qd,Xn));const WA=new P(1,0),KC=new P,ZC=(a,t)=>a.rotate(t),kg=(a,t)=>new P(t).subtract(a),Lg=a=>a.distanceFrom(KC),zg=(a,t)=>Math.atan2(Io(a,t),KA(a,t)),QA=a=>zg(WA,a),zm=a=>a.eq(KC)?a:a.scalarDivide(Lg(a)),JC=function(a){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return zm(new P(-a.y,a.x).scalarMultiply(t?1:-1))},Io=(a,t)=>a.x*t.y-a.y*t.x,KA=(a,t)=>a.x*t.x+a.y*t.y,hS=(a,t,e)=>{if(a.eq(t)||a.eq(e))return!0;const i=Io(t,e),r=Io(t,a),l=Io(e,a);return i>=0?r>=0&&l<=0:!(r<=0&&l>=0)},fS="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",dS=new RegExp("(?:\\s|^)"+fS+fS+"("+Xn+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Ni{constructor(t){const e=typeof t=="string"?Ni.parseShadow(t):t;Object.assign(this,Ni.ownDefaults,e),this.id=ws()}static parseShadow(t){const e=t.trim(),[,i=0,r=0,l=0]=(dS.exec(e)||[]).map((c=>parseFloat(c)||0));return{color:(e.replace(dS,"")||"rgb(0,0,0)").trim(),offsetX:i,offsetY:r,blur:l}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=ZC(new P(this.offsetX,this.offsetY),de(-t.angle)),i=new Pt(this.color);let r=40,l=40;return t.width&&t.height&&(r=100*Kt((Math.abs(e.x)+this.blur)/t.width,jt.NUM_FRACTION_DIGITS)+20,l=100*Kt((Math.abs(e.y)+this.blur)/t.height,jt.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(l,'%" height="').concat(100+2*l,'%" x="-').concat(r,'%" width="').concat(100+2*r,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Kt(this.blur?this.blur/2:0,jt.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Kt(e.x,jt.NUM_FRACTION_DIGITS),'" dy="').concat(Kt(e.y,jt.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(i.toRgb(),'" flood-opacity="').concat(i.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=Ni.ownDefaults;return this.includeDefaultValues?t:jm(t,((i,r)=>i!==e[r]))}static async fromObject(t){return new this(t)}}A(Ni,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),A(Ni,"type","shadow"),it.setClass(Ni,"shadow");const ma=(a,t,e)=>Math.max(a,Math.min(t,e)),ZA=[nn,It,an,jn,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",ba,Ca],Ui=[xe,rn,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],JA={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:It,originY:nn,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:xe,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},$A=(a,t,e,i)=>-e*Math.cos(a/i*hl)+e+t,tM=()=>!1;class Bm{constructor(t){let{startValue:e,byValue:i,duration:r=500,delay:l=0,easing:c=$A,onStart:h=au,onChange:f=au,onComplete:d=au,abort:p=tM,target:_}=t;A(this,"_state","pending"),A(this,"durationProgress",0),A(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=r,this.delay=l,this.easing=c,this._onStart=h,this._onChange=f,this._onComplete=d,this._abort=p,this.target=_,this.startValue=e,this.byValue=i,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const t=e=>{this._state==="pending"&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>lu(t)),this.delay):lu(t)}tick(t){const e=(t||+new Date)-this.startTime,i=Math.min(e,this.duration);this.durationProgress=i/this.duration;const{value:r,valueProgress:l}=this.calculate(i);this.value=Object.freeze(r),this.valueProgress=l,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),lu(this.tick)))}register(){ju.push(this)}unregister(){ju.remove(this)}abort(){this._state="aborted",this.unregister()}}const eM=["startValue","endValue"];class nM extends Bm{constructor(t){let{startValue:e=0,endValue:i=100}=t;super(M(M({},ee(t,eM)),{},{startValue:e,byValue:i-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const iM=["startValue","endValue"];class sM extends Bm{constructor(t){let{startValue:e=[0],endValue:i=[100]}=t;super(M(M({},ee(t,iM)),{},{startValue:e,byValue:i.map(((r,l)=>r-e[l]))}))}calculate(t){const e=this.startValue.map(((i,r)=>this.easing(t,i,this.byValue[r],this.duration,r)));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const rM=["startValue","endValue","easing","onChange","onComplete","abort"],aM=(a,t,e,i)=>t+e*(1-Math.cos(a/i*hl)),Jd=a=>a&&((t,e,i)=>a(new Pt(t).toRgba(),e,i));class oM extends Bm{constructor(t){let{startValue:e,endValue:i,easing:r=aM,onChange:l,onComplete:c,abort:h}=t,f=ee(t,rM);const d=new Pt(e).getSource(),p=new Pt(i).getSource();super(M(M({},f),{},{startValue:d,byValue:p.map(((_,v)=>_-d[v])),easing:r,onChange:Jd(l),onComplete:Jd(c),abort:Jd(h)}))}calculate(t){const[e,i,r,l]=this.startValue.map(((h,f)=>this.easing(t,h,this.byValue[f],this.duration,f))),c=[...[e,i,r].map(Math.round),ma(0,l,1)];return{value:c,valueProgress:c.map(((h,f)=>this.byValue[f]!==0?Math.abs((h-this.startValue[f])/this.byValue[f]):0)).find((h=>h!==0))||0}}}function $C(a){const t=(e=>Array.isArray(e.startValue)||Array.isArray(e.endValue))(a)?new sM(a):new nM(a);return t.start(),t}function lM(a){const t=new oM(a);return t.start(),t}class ne{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some((e=>e.eq(t)))}append(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.points=this.points.concat(e.filter((r=>!this.includes(r)))),this}static isPointContained(t,e,i){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(e.eq(i))return t.eq(e);if(e.x===i.x)return t.x===e.x&&(r||t.y>=Math.min(e.y,i.y)&&t.y<=Math.max(e.y,i.y));if(e.y===i.y)return t.y===e.y&&(r||t.x>=Math.min(e.x,i.x)&&t.x<=Math.max(e.x,i.x));{const l=kg(e,i),c=kg(e,t).divide(l);return r?Math.abs(c.x)===Math.abs(c.y):c.x===c.y&&c.x>=0&&c.x<=1}}static isPointInPolygon(t,e){const i=new P(t).setX(Math.min(t.x-1,...e.map((l=>l.x))));let r=0;for(let l=0;l<e.length;l++){const c=this.intersectSegmentSegment(e[l],e[(l+1)%e.length],t,i);if(c.includes(t))return!0;r+=+(c.status==="Intersection")}return r%2==1}static intersectLineLine(t,e,i,r){let l=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],c=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const h=e.x-t.x,f=e.y-t.y,d=r.x-i.x,p=r.y-i.y,_=t.x-i.x,v=t.y-i.y,S=d*v-p*_,b=h*v-f*_,T=p*h-d*f;if(T!==0){const w=S/T,N=b/T;return(l||0<=w&&w<=1)&&(c||0<=N&&N<=1)?new ne("Intersection").append(new P(t.x+w*h,t.y+w*f)):new ne}if(S===0||b===0){const w=l||c||ne.isPointContained(t,i,r)||ne.isPointContained(e,i,r)||ne.isPointContained(i,t,e)||ne.isPointContained(r,t,e);return new ne(w?"Coincident":void 0)}return new ne("Parallel")}static intersectSegmentLine(t,e,i,r){return ne.intersectLineLine(t,e,i,r,!1,!0)}static intersectSegmentSegment(t,e,i,r){return ne.intersectLineLine(t,e,i,r,!1,!1)}static intersectLinePolygon(t,e,i){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const l=new ne,c=i.length;for(let h,f,d,p=0;p<c;p++){if(h=i[p],f=i[(p+1)%c],d=ne.intersectLineLine(t,e,h,f,r,!1),d.status==="Coincident")return d;l.append(...d.points)}return l.points.length>0&&(l.status="Intersection"),l}static intersectSegmentPolygon(t,e,i){return ne.intersectLinePolygon(t,e,i,!1)}static intersectPolygonPolygon(t,e){const i=new ne,r=t.length,l=[];for(let c=0;c<r;c++){const h=t[c],f=t[(c+1)%r],d=ne.intersectSegmentPolygon(h,f,e);d.status==="Coincident"?(l.push(d),i.append(h,f)):i.append(...d.points)}return l.length>0&&l.length===t.length?new ne("Coincident"):(i.points.length>0&&(i.status="Intersection"),i)}static intersectPolygonRectangle(t,e,i){const r=e.min(i),l=e.max(i),c=new P(l.x,r.y),h=new P(r.x,l.y);return ne.intersectPolygonPolygon(t,[r,c,l,h])}}class cM extends AC{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?tn(t,this.group.calcTransformMatrix()):t}setXY(t,e,i){this.group&&(t=tn(t,Gn(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,i)}getRelativeXY(){return new P(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(t,e,i)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:i,bl:r}=this.aCoords||(this.aCoords=this.calcACoords()),l=[t,e,i,r];if(this.group){const c=this.group.calcTransformMatrix();return l.map((h=>tn(h,c)))}return l}intersectsWithRect(t,e){return ne.intersectPolygonRectangle(this.getCoords(),t,e).status==="Intersection"}intersectsWithObject(t){const e=ne.intersectPolygonPolygon(this.getCoords(),t.getCoords());return e.status==="Intersection"||e.status==="Coincident"||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every((e=>t.containsPoint(e)))}isContainedWithinRect(t,e){const{left:i,top:r,width:l,height:c}=this.getBoundingRect();return i>=t.x&&i+l<=e.x&&r>=t.y&&r+c<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return ne.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some((i=>i.x<=e.x&&i.x>=t.x&&i.y<=e.y&&i.y>=t.y))||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return this.intersectsWithRect(t,e)?!0:this.getCoords().every((i=>(i.x>=e.x||i.x<=t.x)&&(i.y>=e.y||i.y<=t.y)))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return Ri(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(an,t),this._set(jn,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Ii(NC(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.viewportTransform)||Ge.concat()}calcACoords(){const t=xa({angle:this.angle}),{x:e,y:i}=this.getRelativeCenterPoint(),r=fl(e,i),l=ze(r,t),c=this._getTransformedDimensions(),h=c.x/2,f=c.y/2;return{tl:tn({x:-h,y:-f},l),tr:tn({x:h,y:-f},l),bl:tn({x:-h,y:f},l),br:tn({x:h,y:f},l)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,ve(this.originX),ve(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const i=this.transformMatrixKey(t),r=this.matrixCache;return r&&r.key.every(((l,c)=>l===i[c]))?r.value:(this.group&&(e=ze(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:i,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const i=this.getRelativeCenterPoint(),r={angle:this.angle,translateX:i.x,translateY:i.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},l=NA(r);return this.ownMatrixCache={key:t,value:l},l}_getNonTransformedDimensions(){return new P(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=M({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),i=e.strokeWidth;let r=i,l=0;this.strokeUniform&&(r=0,l=i);const c=e.width+r,h=e.height+r;let f;return f=e.skewX===0&&e.skewY===0?new P(c*e.scaleX,h*e.scaleY):km(c,h,ih(e)),f.scalarAdd(l)}translateToGivenOrigin(t,e,i,r,l){let c=t.x,h=t.y;const f=ve(r)-ve(e),d=ve(l)-ve(i);if(f||d){const p=this._getTransformedDimensions();c+=f*p.x,h+=d*p.y}return new P(c,h)}translateToCenterPoint(t,e,i){if(e===Ct&&i===Ct)return t;const r=this.translateToGivenOrigin(t,e,i,Ct,Ct);return this.angle?r.rotate(de(this.angle),t):r}translateToOriginPoint(t,e,i){const r=this.translateToGivenOrigin(t,Ct,Ct,e,i);return this.angle?r.rotate(de(this.angle),t):r}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?tn(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new P(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,i){const r=this.translateToCenterPoint(t,e,i),l=this.translateToOriginPoint(r,this.originX,this.originY);this.set({left:l.x,top:l.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),It,nn)}}const uM=["type"],hM=["extraParam"];let xi=class uu extends cM{static getDefaults(){return uu.ownDefaults}get type(){const t=this.constructor.type;return t==="FabricObject"?"object":t.toLowerCase()}set type(t){Ts("warn","Setting type has no effect",t)}constructor(t){super(),A(this,"_cacheContext",null),Object.assign(this,uu.ownDefaults),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=Bi(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,i=t.height,r=jt.maxCacheSideLimit,l=jt.minCacheSideLimit;if(e<=r&&i<=r&&e*i<=jt.perfLimitSizeTotal)return e<l&&(t.width=l),i<l&&(t.height=l),t;const c=e/i,[h,f]=Lo.limitDimsByArea(c),d=ma(l,h,r),p=ma(l,f,r);return e>d&&(t.zoomX/=e/d,t.width=d,t.capped=!0),i>p&&(t.zoomY/=i/p,t.height=p,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),i=e.x*t.x/this.scaleX,r=e.y*t.y/this.scaleY;return{width:Math.ceil(i+2),height:Math.ceil(r+2),zoomX:t.x,zoomY:t.y,x:i,y:r}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:i,height:r,zoomX:l,zoomY:c,x:h,y:f}=this._limitCacheSize(this._getCacheCanvasDimensions()),d=i!==t.width||r!==t.height,p=this.zoomX!==l||this.zoomY!==c;if(!t||!e)return!1;if(d||p){i!==t.width||r!==t.height?(t.width=i,t.height=r):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const _=h/2,v=f/2;return this.cacheTranslationX=Math.round(t.width/2-_)+_,this.cacheTranslationY=Math.round(t.height/2-v)+v,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(l,c),this.zoomX=l,this.zoomY=c,!0}return!1}setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,i=this.calcTransformMatrix(!e);t.transform(i[0],i[1],i[2],i[3],i[4],i[5])}getObjectScaling(){if(!this.group)return new P(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=ku(this.calcTransformMatrix());return new P(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),i=this.getCanvasRetinaScaling();return t.scalarMultiply(e*i)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t}_set(t,e){t!==an&&t!==jn||(e=this._constrainScale(e)),t===an&&e<0?(this.flipX=!this.flipX,e*=-1):t==="scaleY"&&e<0?(this.flipY=!this.flipY,e*=-1):t!=="shadow"||!e||e instanceof Ni||(e=new Ni(e));const i=this[t]!==e;return this[t]=e,i&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||i&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:i,cacheTranslationX:r,cacheTranslationY:l}=this,{width:c,height:h}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:i,cacheTranslationX:r,cacheTranslationY:l,width:c,height:h,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===rn&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(t,e,i){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(i,0,0),t.restore()}drawObject(t,e,i){const r=this.fill,l=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,i),this.fill=r,this.stroke=l}createClipPathLayer(t,e){const i=kn(e),r=i.getContext("2d");if(r.translate(e.cacheTranslationX,e.cacheTranslationY),r.scale(e.zoomX,e.zoomY),t._cacheCanvas=i,e.parentClipPaths.forEach((l=>{l.transform(r)})),e.parentClipPaths.push(t),t.absolutePositioned){const l=Gn(this.calcTransformMatrix());r.transform(l[0],l[1],l[2],l[3],l[4],l[5])}return t.transform(r),t.drawObject(r,!0,e),i}_drawClipPath(t,e,i){if(!e)return;e._transformDone=!0;const r=this.createClipPathLayer(e,i);this.drawClipPathOnCache(t,e,r)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,i=this._cacheContext;return!(!e||!i||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&i&&!t&&(i.save(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,e.width,e.height),i.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const i=e.stroke;i&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,Mn(i)?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?this._applyPatternForTransformedGradient(t,i):(t.strokeStyle=i.toLive(t),this._applyPatternGradientTransform(t,i)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:i}=e;i&&(Mn(i)?(t.fillStyle=i.toLive(t),this._applyPatternGradientTransform(t,i)):t.fillStyle=i)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&e.length!==0&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,i=this.canvas,r=this.getCanvasRetinaScaling(),[l,,,c]=i?.viewportTransform||Ge,h=l*r,f=c*r,d=e.nonScaling?new P(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*jt.browserShadowBlurConstant*(h+f)*(d.x+d.y)/4,t.shadowOffsetX=e.offsetX*h*d.x,t.shadowOffsetY=e.offsetY*f*d.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!Mn(e))return{offsetX:0,offsetY:0};const i=e.gradientTransform||e.patternTransform,r=-this.width/2+e.offsetX||0,l=-this.height/2+e.offsetY||0;return e.gradientUnits==="percentage"?t.transform(this.width,0,0,this.height,r,l):t.transform(1,0,0,1,r,l),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:r,offsetY:l}}_renderPaintInOrder(t){this.paintFirst===rn?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),this.fillRule==="evenodd"?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var i;const r=this._limitCacheSize(this._getCacheCanvasDimensions()),l=this.getCanvasRetinaScaling(),c=r.x/this.scaleX/l,h=r.y/this.scaleY/l,f=kn({width:Math.ceil(c),height:Math.ceil(h)}),d=f.getContext("2d");d&&(d.beginPath(),d.moveTo(0,0),d.lineTo(c,0),d.lineTo(c,h),d.lineTo(0,h),d.closePath(),d.translate(c/2,h/2),d.scale(r.zoomX/this.scaleX/l,r.zoomY/this.scaleY/l),this._applyPatternGradientTransform(d,e),d.fillStyle=e.toLive(t),d.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(l*this.scaleX/r.zoomX,l*this.scaleY/r.zoomY),t.strokeStyle=(i=d.createPattern(f,"no-repeat"))!==null&&i!==void 0?i:"")}_findCenterFromElement(){return new P(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(it.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=UC(this),i=this.group,r=this.shadow,l=Math.abs,c=t.enableRetinaScaling?TC():1,h=(t.multiplier||1)*c,f=t.canvasProvider||(I=>new dl(I,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&IA(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&UA(this,this.getViewportTransform()),this.setCoords();const d=Bi(),p=this.getBoundingRect(),_=this.shadow,v=new P;if(_){const I=_.blur,j=_.nonScaling?new P(1,1):this.getObjectScaling();v.x=2*Math.round(l(_.offsetX)+I)*l(j.x),v.y=2*Math.round(l(_.offsetY)+I)*l(j.y)}const S=p.width+v.x,b=p.height+v.y;d.width=Math.ceil(S),d.height=Math.ceil(b);const T=f(d);t.format==="jpeg"&&(T.backgroundColor="#fff"),this.setPositionByOrigin(new P(T.width/2,T.height/2),Ct,Ct);const w=this.canvas;T._objects=[this],this.set("canvas",T),this.setCoords();const N=T.toCanvasElement(h||1,t);return this.set("canvas",w),this.shadow=r,i&&(this.group=i),this.set(e),this.setCoords(),T._objects=[],T.destroy(),N}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return MC(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return RC(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:i,originY:r}=this;if(e){const{x:l,y:c}=this.getRelativeCenterPoint();this.originX=Ct,this.originY=Ct,this.left=l,this.top=c}if(this.set("angle",t),e){const{x:l,y:c}=this.translateToOriginPoint(this.getRelativeCenterPoint(),i,r);this.left=l,this.top=c,this.originX=i,this.originY=r}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){ju.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&ni().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce(((i,r)=>{let[l,c]=r;return i[l]=this._animate(l,c,e),i}),{})}_animate(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=t.split("."),l=this.constructor.colorProperties.includes(r[r.length-1]),{abort:c,startValue:h,onChange:f,onComplete:d}=i,p=M(M({},i),{},{target:this,startValue:h??r.reduce(((_,v)=>_[v]),this),endValue:e,abort:c?.bind(this),onChange:(_,v,S)=>{r.reduce(((b,T,w)=>(w===r.length-1&&(b[T]=_),b[T])),this),f&&f(_,v,S)},onComplete:(_,v,S)=>{this.setCoords(),d&&d(_,v,S)}});return l?lM(p):$C(p)}isDescendantOf(t){const{parent:e,group:i}=this;return e===t||i===t||!!e&&e.isDescendantOf(t)||!!i&&i!==e&&i.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do e=e.parent,e&&t.push(e);while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),i=t.getAncestors();if(e.length===0&&i.length>0&&this===i[i.length-1])return{fork:[],otherFork:[t,...i.slice(0,i.length-1)],common:[this]};for(let r,l=0;l<e.length;l++){if(r=e[l],r===t)return{fork:[this,...e.slice(0,l)],otherFork:[],common:e.slice(l)};for(let c=0;c<i.length;c++){if(this===i[c])return{fork:[],otherFork:[t,...i.slice(0,c)],common:[this,...e]};if(r===i[c])return{fork:[this,...e.slice(0,l)],otherFork:[t,...i.slice(0,c)],common:e.slice(l)}}}return{fork:[this,...e],otherFork:[t,...i],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const i=e.common[0]||this.canvas;if(!i)return;const r=e.fork.pop(),l=e.otherFork.pop(),c=i._objects.indexOf(r),h=i._objects.indexOf(l);return c>-1&&c>h}toObject(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(uu.customProperties,this.constructor.customProperties||[]);let e;const i=jt.NUM_FRACTION_DIGITS,{clipPath:r,fill:l,stroke:c,shadow:h,strokeDashArray:f,left:d,top:p,originX:_,originY:v,width:S,height:b,strokeWidth:T,strokeLineCap:w,strokeDashOffset:N,strokeLineJoin:I,strokeUniform:j,strokeMiterLimit:Y,scaleX:B,scaleY:K,angle:F,flipX:Q,flipY:Z,opacity:nt,visible:ot,backgroundColor:rt,fillRule:ft,paintFirst:ct,globalCompositeOperation:vt,skewX:U,skewY:W}=this;r&&!r.excludeFromExport&&(e=r.toObject(t.concat("inverted","absolutePositioned")));const tt=bt=>Kt(bt,i),mt=M(M({},Ta(this,t)),{},{type:this.constructor.type,version:Mg,originX:_,originY:v,left:tt(d),top:tt(p),width:tt(S),height:tt(b),fill:J0(l)?l.toObject():l,stroke:J0(c)?c.toObject():c,strokeWidth:tt(T),strokeDashArray:f&&f.concat(),strokeLineCap:w,strokeDashOffset:N,strokeLineJoin:I,strokeUniform:j,strokeMiterLimit:tt(Y),scaleX:tt(B),scaleY:tt(K),angle:tt(F),flipX:Q,flipY:Z,opacity:tt(nt),shadow:h&&h.toObject(),visible:ot,backgroundColor:rt,fillRule:ft,paintFirst:ct,globalCompositeOperation:vt,skewX:tt(U),skewY:tt(W)},e?{clipPath:e}:null);return this.includeDefaultValues?mt:this._removeDefaultValues(mt)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),i=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return jm(t,((r,l)=>{if(l===It||l===nn||l==="type")return!0;const c=i[l];return r!==c&&!(Array.isArray(r)&&Array.isArray(c)&&r.length===0&&c.length===0)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=ee(t,uM),i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:r}=i,l=ee(i,hM);return sh(e,l).then((c=>r?(delete c[r],new this(e[r],c)):new this(c)))}static fromObject(t,e){return this._fromObject(t,e)}};A(xi,"stateProperties",ZA),A(xi,"cacheProperties",Ui),A(xi,"ownDefaults",JA),A(xi,"type","FabricObject"),A(xi,"colorProperties",[xe,rn,"backgroundColor"]),A(xi,"customProperties",[]),it.setClass(xi),it.setClass(xi,"object");const wa=(a,t,e)=>(i,r,l,c)=>{const h=t(i,r,l,c);return h&&PC(a,M(M({},YC(i,r,l,c)),e)),h};function Ea(a){return(t,e,i,r)=>{const{target:l,originX:c,originY:h}=e,f=l.getRelativeCenterPoint(),d=l.translateToOriginPoint(f,c,h),p=a(t,e,i,r);return l.setPositionByOrigin(d,e.originX,e.originY),p}}const gS=wa(Zo,Ea(((a,t,e,i)=>{const r=Lm(t,t.originX,t.originY,e,i);if(ve(t.originX)===ve(Ct)||ve(t.originX)===ve(fe)&&r.x<0||ve(t.originX)===ve(It)&&r.x>0){const{target:l}=t,c=l.strokeWidth/(l.strokeUniform?l.scaleX:1),h=HC(t)?2:1,f=l.width,d=Math.abs(r.x*h/l.scaleX)-c;return l.set("width",Math.max(d,1)),f!==l.width}return!1})));function fM(a,t,e,i,r){i=i||{};const l=this.sizeX||i.cornerSize||r.cornerSize,c=this.sizeY||i.cornerSize||r.cornerSize,h=i.transparentCorners!==void 0?i.transparentCorners:r.transparentCorners,f=h?rn:xe,d=!h&&(i.cornerStrokeColor||r.cornerStrokeColor);let p,_=t,v=e;a.save(),a.fillStyle=i.cornerColor||r.cornerColor||"",a.strokeStyle=i.cornerStrokeColor||r.cornerStrokeColor||"",l>c?(p=l,a.scale(1,c/l),v=e*l/c):c>l?(p=c,a.scale(l/c,1),_=t*c/l):p=l,a.beginPath(),a.arc(_,v,p/2,0,Mu,!1),a[f](),d&&a.stroke(),a.restore()}function dM(a,t,e,i,r){i=i||{};const l=this.sizeX||i.cornerSize||r.cornerSize,c=this.sizeY||i.cornerSize||r.cornerSize,h=i.transparentCorners!==void 0?i.transparentCorners:r.transparentCorners,f=h?rn:xe,d=!h&&(i.cornerStrokeColor||r.cornerStrokeColor),p=l/2,_=c/2;a.save(),a.fillStyle=i.cornerColor||r.cornerColor||"",a.strokeStyle=i.cornerStrokeColor||r.cornerStrokeColor||"",a.translate(t,e);const v=r.getTotalAngle();a.rotate(de(v)),a["".concat(f,"Rect")](-p,-_,l,c),d&&a.strokeRect(-p,-_,l,c),a.restore()}class Fn{constructor(t){A(this,"visible",!0),A(this,"actionName",nh),A(this,"angle",0),A(this,"x",0),A(this,"y",0),A(this,"offsetX",0),A(this,"offsetY",0),A(this,"sizeX",0),A(this,"sizeY",0),A(this,"touchSizeX",0),A(this,"touchSizeY",0),A(this,"cursorStyle","crosshair"),A(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,i,r){var l;let{tl:c,tr:h,br:f,bl:d}=r;return((l=e.canvas)===null||l===void 0?void 0:l.getActiveObject())===e&&e.isControlVisible(t)&&ne.isPointInPolygon(i,[c,h,f,d])}getActionHandler(t,e,i){return this.actionHandler}getMouseDownHandler(t,e,i){return this.mouseDownHandler}getMouseUpHandler(t,e,i){return this.mouseUpHandler}cursorStyleHandler(t,e,i){return e.cursorStyle}getActionName(t,e,i){return e.actionName}getVisibility(t,e){var i,r;return(i=(r=t._controlsVisibility)===null||r===void 0?void 0:r[e])!==null&&i!==void 0?i:this.visible}setVisibility(t,e,i){this.visible=t}positionHandler(t,e,i,r){return new P(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,i,r,l,c){const h=Rm([fl(i,r),xa({angle:t}),Nm((l?this.touchSizeX:this.sizeX)||e,(l?this.touchSizeY:this.sizeY)||e)]);return{tl:new P(-.5,-.5).transform(h),tr:new P(.5,-.5).transform(h),br:new P(.5,.5).transform(h),bl:new P(-.5,.5).transform(h)}}render(t,e,i,r,l){((r=r||{}).cornerStyle||l.cornerStyle)==="circle"?fM.call(this,t,e,i,r,l):dM.call(this,t,e,i,r,l)}}const gM=(a,t,e)=>e.lockRotation?zu:t.cursorStyle,mM=wa(EC,Ea(((a,t,e,i)=>{let{target:r,ex:l,ey:c,theta:h,originX:f,originY:d}=t;const p=r.translateToOriginPoint(r.getRelativeCenterPoint(),f,d);if(Wn(r,"lockRotation"))return!1;const _=Math.atan2(c-p.y,l-p.x),v=Math.atan2(i-p.y,e-p.x);let S=Ii(v-_+h);if(r.snapAngle&&r.snapAngle>0){const T=r.snapAngle,w=r.snapThreshold||T,N=Math.ceil(S/T)*T,I=Math.floor(S/T)*T;Math.abs(S-I)<w?S=I:Math.abs(S-N)<w&&(S=N)}S<0&&(S=360+S),S%=360;const b=r.angle!==S;return r.angle=S,b})));function t1(a,t){const e=t.canvas,i=a[e.uniScaleKey];return e.uniformScaling&&!i||!e.uniformScaling&&i}function e1(a,t,e){const i=Wn(a,"lockScalingX"),r=Wn(a,"lockScalingY");if(i&&r||!t&&(i||r)&&e||i&&t==="x"||r&&t==="y")return!0;const{width:l,height:c,strokeWidth:h}=a;return l===0&&h===0&&t!=="y"||c===0&&h===0&&t!=="x"}const pM=["e","se","s","sw","w","nw","n","ne","e"],Do=(a,t,e)=>{const i=t1(a,e);if(e1(e,t.x!==0&&t.y===0?"x":t.x===0&&t.y!==0?"y":"",i))return zu;const r=VC(e,t);return"".concat(pM[r],"-resize")};function Im(a,t,e,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const l=t.target,c=r.by,h=t1(a,l);let f,d,p,_,v,S;if(e1(l,c,h))return!1;if(t.gestureScale)d=t.scaleX*t.gestureScale,p=t.scaleY*t.gestureScale;else{if(f=Lm(t,t.originX,t.originY,e,i),v=c!=="y"?Math.sign(f.x||t.signX||1):1,S=c!=="x"?Math.sign(f.y||t.signY||1):1,t.signX||(t.signX=v),t.signY||(t.signY=S),Wn(l,"lockScalingFlip")&&(t.signX!==v||t.signY!==S))return!1;if(_=l._getTransformedDimensions(),h&&!c){const w=Math.abs(f.x)+Math.abs(f.y),{original:N}=t,I=w/(Math.abs(_.x*N.scaleX/l.scaleX)+Math.abs(_.y*N.scaleY/l.scaleY));d=N.scaleX*I,p=N.scaleY*I}else d=Math.abs(f.x*l.scaleX/_.x),p=Math.abs(f.y*l.scaleY/_.y);HC(t)&&(d*=2,p*=2),t.signX!==v&&c!=="y"&&(t.originX=nS(t.originX),d*=-1,t.signX=v),t.signY!==S&&c!=="x"&&(t.originY=nS(t.originY),p*=-1,t.signY=S)}const b=l.scaleX,T=l.scaleY;return c?(c==="x"&&l.set(an,d),c==="y"&&l.set(jn,p)):(!Wn(l,"lockScalingX")&&l.set(an,d),!Wn(l,"lockScalingY")&&l.set(jn,p)),b!==l.scaleX||T!==l.scaleY}const Lc=wa(eh,Ea(((a,t,e,i)=>Im(a,t,e,i)))),_M=wa(eh,Ea(((a,t,e,i)=>Im(a,t,e,i,{by:"x"})))),vM=wa(eh,Ea(((a,t,e,i)=>Im(a,t,e,i,{by:"y"})))),yM=["target","ex","ey","skewingSide"],$d={x:{counterAxis:"y",scale:an,skew:ba,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:jn,skew:Ca,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},SM=["ns","nesw","ew","nwse"],bM=(a,t,e)=>{if(t.x!==0&&Wn(e,"lockSkewingY")||t.y!==0&&Wn(e,"lockSkewingX"))return zu;const i=VC(e,t)%4;return"".concat(SM[i],"-resize")};function n1(a,t,e,i,r){const{target:l}=e,{counterAxis:c,origin:h,lockSkewing:f,skew:d,flip:p}=$d[a];if(Wn(l,f))return!1;const{origin:_,flip:v}=$d[c],S=ve(e[_])*(l[v]?-1:1),b=-Math.sign(S)*(l[p]?-1:1),T=.5*-((l[d]===0&&Lm(e,Ct,Ct,i,r)[a]>0||l[d]>0?1:-1)*b)+.5;return wa(OC,Ea(((N,I,j,Y)=>(function(B,K,F){let{target:Q,ex:Z,ey:nt,skewingSide:ot}=K,rt=ee(K,yM);const{skew:ft}=$d[B],ct=F.subtract(new P(Z,nt)).divide(new P(Q.scaleX,Q.scaleY))[B],vt=Q[ft],U=rt[ft],W=Math.tan(de(U)),tt=B==="y"?Q._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:Q._getTransformedDimensions({scaleX:1,scaleY:1}).y,mt=2*ct*ot/Math.max(tt,1)+W,bt=Ii(Math.atan(mt));Q.set(ft,bt);const D=vt!==Q[ft];if(D&&B==="y"){const{skewX:X,scaleX:$}=Q,et=Q._getTransformedDimensions({skewY:vt}),dt=Q._getTransformedDimensions(),gt=X!==0?et.x/dt.x:1;gt!==1&&Q.set(an,gt*$)}return D})(a,I,new P(j,Y)))))(t,M(M({},e),{},{[h]:T,skewingSide:b}),i,r)}const CM=(a,t,e,i)=>n1("x",a,t,e,i),xM=(a,t,e,i)=>n1("y",a,t,e,i);function oh(a,t){return a[t.canvas.altActionKey]}const zc=(a,t,e)=>{const i=oh(a,e);return t.x===0?i?ba:jn:t.y===0?i?Ca:an:""},ta=(a,t,e)=>oh(a,e)?bM(0,t,e):Do(a,t,e),mS=(a,t,e,i)=>oh(a,t.target)?xM(a,t,e,i):_M(a,t,e,i),pS=(a,t,e,i)=>oh(a,t.target)?CM(a,t,e,i):vM(a,t,e,i),i1=()=>({ml:new Fn({x:-.5,y:0,cursorStyleHandler:ta,actionHandler:mS,getActionName:zc}),mr:new Fn({x:.5,y:0,cursorStyleHandler:ta,actionHandler:mS,getActionName:zc}),mb:new Fn({x:0,y:.5,cursorStyleHandler:ta,actionHandler:pS,getActionName:zc}),mt:new Fn({x:0,y:-.5,cursorStyleHandler:ta,actionHandler:pS,getActionName:zc}),tl:new Fn({x:-.5,y:-.5,cursorStyleHandler:Do,actionHandler:Lc}),tr:new Fn({x:.5,y:-.5,cursorStyleHandler:Do,actionHandler:Lc}),bl:new Fn({x:-.5,y:.5,cursorStyleHandler:Do,actionHandler:Lc}),br:new Fn({x:.5,y:.5,cursorStyleHandler:Do,actionHandler:Lc}),mtr:new Fn({x:0,y:-.5,actionHandler:mM,cursorStyleHandler:gM,offsetY:-40,withConnection:!0,actionName:Am})}),TM=()=>({mr:new Fn({x:.5,y:0,actionHandler:gS,cursorStyleHandler:ta,actionName:Zo}),ml:new Fn({x:-.5,y:0,actionHandler:gS,cursorStyleHandler:ta,actionName:Zo})}),wM=()=>M(M({},i1()),TM());class el extends xi{static getDefaults(){return M(M({},super.getDefaults()),el.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),el.ownDefaults),this.setOptions(t)}static createControls(){return{controls:i1()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,i=e.target,r=e.action;if(this===i&&r&&r.startsWith(nh))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const i=Object.entries(this.oCoords);for(let r=i.length-1;r>=0;r--){const[l,c]=i[r],h=this.controls[l];if(h.shouldActivate(l,this,t,e?c.touchCorner:c.corner))return this.__corner=l,{key:l,control:h,coord:this.oCoords[l]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),i=fl(e.x,e.y),r=xa({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),l=ze(i,r),c=ze(t,l),h=ze(c,[1/t[0],0,0,1/t[3],0,0]),f=this.group?ku(this.calcTransformMatrix()):void 0;f&&(f.scaleX=Math.abs(f.scaleX),f.scaleY=Math.abs(f.scaleY));const d=this._calculateCurrentDimensions(f),p={};return this.forEachControl(((_,v)=>{const S=_.positionHandler(d,h,this,_);p[v]=Object.assign(S,this._calcCornerCoords(_,S))})),p}_calcCornerCoords(t,e){const i=this.getTotalAngle();return{corner:t.calcCornerCoords(i,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(i,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),i=this._calculateCurrentDimensions(),r=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/r[0],1/r[3]),t.rotate(de(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=M({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},i);t.save(),t.strokeStyle=r.borderColor,this._setLineDash(t,r.borderDashArray),this.strokeBorders(t,e),r.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:i,hasControls:r}=this,l=M({hasBorders:i,hasControls:r},e),c=this.getViewportTransform(),h=l.hasBorders,f=l.hasControls,d=ze(c,this.calcTransformMatrix()),p=ku(d);t.save(),t.translate(p.translateX,p.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(p.angle-=180),t.rotate(de(this.group?p.angle:this.angle)),h&&this.drawBorders(t,p,e),f&&this.drawControls(t,e),t.restore()}drawBorders(t,e,i){let r;if(i&&i.forActiveSelection||this.group){const l=km(this.width,this.height,ih(e)),c=this.isStrokeAccountedForInDimensions()?Mm:(this.strokeUniform?new P().scalarAdd(this.canvas?this.canvas.getZoom():1):new P(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);r=l.add(c).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else r=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,r,i)}drawControlsConnectingLines(t,e){let i=!1;t.beginPath(),this.forEachControl(((r,l)=>{r.withConnection&&r.getVisibility(this,l)&&(i=!0,t.moveTo(r.x*e.x,r.y*e.y),t.lineTo(r.x*e.x+r.offsetX,r.y*e.y+r.offsetY))})),i&&t.stroke()}drawControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.save();const i=this.getCanvasRetinaScaling(),{cornerStrokeColor:r,cornerDashArray:l,cornerColor:c}=this,h=M({cornerStrokeColor:r,cornerDashArray:l,cornerColor:c},e);t.setTransform(i,0,0,i,0,0),t.strokeStyle=t.fillStyle=h.cornerColor,this.transparentCorners||(t.strokeStyle=h.cornerStrokeColor),this._setLineDash(t,h.cornerDashArray),this.forEachControl(((f,d)=>{if(f.getVisibility(this,d)){const p=this.oCoords[d];f.render(t,p.x,p.y,h,this)}})),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(t).forEach((e=>{let[i,r]=e;return this.setControlVisible(i,r)}))}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const i=this.canvas.viewportTransform;e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(e);const r=this.width+4,l=this.height+4;return e.clearRect(-r/2,-l/2,r,l),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function s1(a,t){return t.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((i=>{i!=="constructor"&&Object.defineProperty(a.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i)||Object.create(null))}))})),a}A(el,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Fe extends el{}s1(Fe,[GC]),it.setClass(Fe),it.setClass(Fe,"object");const EM=(a,t,e,i)=>{const r=2*(i=Math.round(i))+1,{data:l}=a.getImageData(t-i,e-i,r,r);for(let c=3;c<l.length;c+=4)if(l[c]>0)return!1;return!0};class r1{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new P(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new P(1/this.options.scaleX,1/this.options.scaleY):new P(1,1)}createSideVector(t,e){const i=kg(t,e);return this.options.strokeUniform?i.multiply(this.scale):i}projectOrthogonally(t,e,i){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,i)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(t){const e=new P(t);return e.y+=e.x*Math.tan(de(this.options.skewY)),e.x+=e.y*Math.tan(de(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const OM=new P;class la extends r1{static getOrthogonalRotationFactor(t,e){const i=e?zg(t,e):QA(t);return Math.abs(i)<hl?-1:1}constructor(t,e,i,r){super(r),A(this,"AB",void 0),A(this,"AC",void 0),A(this,"alpha",void 0),A(this,"bisector",void 0),this.A=new P(t),this.B=new P(e),this.C=new P(i),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=zg(this.AB,this.AC),this.bisector=zm(ZC(this.AB.eq(OM)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(t,e),l=JC(r),c=la.getOrthogonalRotationFactor(l,this.bisector);return this.scaleUnitVector(l,i*c)}projectBevel(){const t=[];return(this.alpha%Mu==0?[this.B]:[this.B,this.C]).forEach((e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))})),t}projectMiter(){const t=[],e=Math.abs(this.alpha),i=1/Math.sin(e/2),r=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*i),l=this.options.strokeUniform?Lg(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return Lg(r)/this.strokeProjectionMagnitude<=l&&t.push(this.applySkew(this.A.add(r))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const i=[],r=new P(la.getOrthogonalRotationFactor(this.bisector),la.getOrthogonalRotationFactor(new P(this.bisector.y,this.bisector.x)));return[new P(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r),new P(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r)].forEach((l=>{hS(l,t,e)&&i.push(this.A.add(l))})),i}projectRoundWithSkew(t,e){const i=[],{skewX:r,skewY:l,scaleX:c,scaleY:h,strokeUniform:f}=this.options,d=new P(Math.tan(de(r)),Math.tan(de(l))),p=this.strokeProjectionMagnitude,_=f?p/h/Math.sqrt(1/h**2+1/c**2*d.y**2):p/Math.sqrt(1+d.y**2),v=new P(Math.sqrt(Math.max(p**2-_**2,0)),_),S=f?p/Math.sqrt(1+d.x**2*(1/h)**2/(1/c+1/c*d.x*d.y)**2):p/Math.sqrt(1+d.x**2/(1+d.x*d.y)**2),b=new P(S,Math.sqrt(Math.max(p**2-S**2,0)));return[b,b.scalarMultiply(-1),v,v.scalarMultiply(-1)].map((T=>this.applySkew(f?T.multiply(this.strokeUniformScalar):T))).forEach((T=>{hS(T,t,e)&&i.push(this.applySkew(this.A).add(T))})),i}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%Mu==0,i=this.applySkew(this.A),r=t[e?0:2].subtract(i),l=t[e?1:0].subtract(i),c=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),h=Io(r,c)>0,f=h?r:l,d=h?l:r;return this.isSkewed()?t.push(...this.projectRoundWithSkew(f,d)):t.push(...this.projectRoundNoSkew(f,d)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector})))}}class _S extends r1{constructor(t,e,i){super(i),this.A=new P(t),this.T=new P(e)}calcOrthogonalProjection(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(t,e);return this.scaleUnitVector(JC(r),i)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new P(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new la(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new P(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),i=this.scaleUnitVector(zm(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),r=this.A.add(i);t.push(r.add(e),r.subtract(e))}return t.map((e=>this.applySkew(e)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t})))}}const DM=function(a,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const i=[];if(a.length===0)return i;const r=a.reduce(((l,c)=>(l[l.length-1].eq(c)||l.push(new P(c)),l)),[new P(a[0])]);if(r.length===1)e=!0;else if(!e){const l=r[0],c=((h,f)=>{for(let d=h.length-1;d>=0;d--)if(f(h[d],d,h))return d;return-1})(r,(h=>!h.eq(l)));r.splice(c+1)}return r.forEach(((l,c,h)=>{let f,d;c===0?(d=h[1],f=e?l:h[h.length-1]):c===h.length-1?(f=h[c-1],d=e?l:h[0]):(f=h[c-1],d=h[c+1]),e&&h.length===1?i.push(...new _S(l,l,t).project()):!e||c!==0&&c!==h.length-1?i.push(...new la(l,f,d,t).project()):i.push(...new _S(l,c===0?d:f,t).project())})),i},Fm=a=>{const t={};return Object.keys(a).forEach((e=>{t[e]={},Object.keys(a[e]).forEach((i=>{t[e][i]=M({},a[e][i])}))})),t},AM=a=>a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let Eo;const Um=a=>{if(Eo||Eo||(Eo="Intl"in th()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),Eo){const t=Eo.segment(a);return Array.from(t).map((e=>{let{segment:i}=e;return i}))}return MM(a)},MM=a=>{const t=[];for(let e,i=0;i<a.length;i++)(e=RM(a,i))!==!1&&t.push(e);return t},RM=(a,t)=>{const e=a.charCodeAt(t);if(isNaN(e))return"";if(e<55296||e>57343)return a.charAt(t);if(55296<=e&&e<=56319){if(a.length<=t+1)throw"High surrogate without following low surrogate";const r=a.charCodeAt(t+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return a.charAt(t)+a.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";const i=a.charCodeAt(t-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1},Pm=function(a,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return a.fill!==t.fill||a.stroke!==t.stroke||a.strokeWidth!==t.strokeWidth||a.fontSize!==t.fontSize||a.fontFamily!==t.fontFamily||a.fontWeight!==t.fontWeight||a.fontStyle!==t.fontStyle||a.textDecorationThickness!==t.textDecorationThickness||a.textBackgroundColor!==t.textBackgroundColor||a.deltaY!==t.deltaY||e&&(a.overline!==t.overline||a.underline!==t.underline||a.linethrough!==t.linethrough)},NM=(a,t)=>{const e=t.split(`
`),i=[];let r=-1,l={};a=Fm(a);for(let c=0;c<e.length;c++){const h=Um(e[c]);if(a[c])for(let f=0;f<h.length;f++){r++;const d=a[c][f];d&&Object.keys(d).length>0&&(Pm(l,d,!0)?i.push({start:r,end:r+1,style:d}):i[i.length-1].end++),l=d||{}}else r+=h.length,l={}}return i},jM=(a,t)=>{if(!Array.isArray(a))return Fm(a);const e=t.split(Dm),i={};let r=-1,l=0;for(let c=0;c<e.length;c++){const h=Um(e[c]);for(let f=0;f<h.length;f++)r++,a[l]&&a[l].start<=r&&r<a[l].end&&(i[c]=i[c]||{},i[c][f]=M({},a[l].style),r===a[l].end-1&&l++)}return i},Es=["display","transform",xe,"fill-opacity","fill-rule","opacity",rn,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function vS(a,t){const e=a.nodeName,i=a.getAttribute("class"),r=a.getAttribute("id"),l="(?![a-zA-Z\\-]+)";let c;if(c=new RegExp("^"+e,"i"),t=t.replace(c,""),r&&t.length&&(c=new RegExp("#"+r+l,"i"),t=t.replace(c,"")),i&&t.length){const h=i.split(" ");for(let f=h.length;f--;)c=new RegExp("\\."+h[f]+l,"i"),t=t.replace(c,"")}return t.length===0}function kM(a,t){let e=!0;const i=vS(a,t.pop());return i&&t.length&&(e=(function(r,l){let c,h=!0;for(;r.parentElement&&r.parentElement.nodeType===1&&l.length;)h&&(c=l.pop()),h=vS(r=r.parentElement,c);return l.length===0})(a,t)),i&&e&&t.length===0}const LM=a=>{var t;return(t=qA[a])!==null&&t!==void 0?t:a},zM=new RegExp("(".concat(Xn,")"),"gi"),BM=a=>a.replace(zM," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var yS,SS,bS,CS,xS,TS,wS;const He="(".concat(Xn,")"),IM=String.raw(yS||(yS=si(["(skewX)(",")"],["(skewX)\\(","\\)"])),He),FM=String.raw(SS||(SS=si(["(skewY)(",")"],["(skewY)\\(","\\)"])),He),UM=String.raw(bS||(bS=si(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),He,He,He),PM=String.raw(CS||(CS=si(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),He,He),HM=String.raw(xS||(xS=si(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),He,He),YM=String.raw(TS||(TS=si(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),He,He,He,He,He,He),Hm="(?:".concat(YM,"|").concat(HM,"|").concat(UM,"|").concat(PM,"|").concat(IM,"|").concat(FM,")"),VM="(?:".concat(Hm,"*)"),GM=String.raw(wS||(wS=si(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),VM),XM=new RegExp(GM),qM=new RegExp(Hm),WM=new RegExp(Hm,"g");function Bg(a){const t=[];if(!(a=BM(a).replace(/\s*([()])\s*/gi,"$1"))||a&&!XM.test(a))return[...Ge];for(const e of a.matchAll(WM)){const i=qM.exec(e[0]);if(!i)continue;let r=Ge;const l=i.filter((b=>!!b)),[,c,...h]=l,[f,d,p,_,v,S]=h.map((b=>parseFloat(b)));switch(c){case"translate":r=fl(f,d);break;case Am:r=xa({angle:f},{x:d,y:p});break;case nh:r=Nm(f,d);break;case ba:r=kC(f);break;case Ca:r=LC(f);break;case"matrix":r=[f,d,p,_,v,S]}t.push(r)}return Rm(t)}function QM(a,t,e,i){const r=Array.isArray(t);let l,c=t;if(a!==xe&&a!==rn||t!==sn){if(a==="strokeUniform")return t==="non-scaling-stroke";if(a==="strokeDashArray")c=t===sn?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(a==="transformMatrix")c=e&&e.transformMatrix?ze(e.transformMatrix,Bg(t)):Bg(t);else if(a==="visible")c=t!==sn&&t!=="hidden",e&&e.visible===!1&&(c=!1);else if(a==="opacity")c=parseFloat(t),e&&e.opacity!==void 0&&(c*=e.opacity);else if(a==="textAnchor")c=t==="start"?It:t==="end"?fe:Ct;else if(a==="charSpacing"||a===rr)l=oa(t,i)/i*1e3;else if(a==="paintFirst"){const h=t.indexOf(xe),f=t.indexOf(rn);c=xe,(h>-1&&f>-1&&f<h||h===-1&&f>-1)&&(c=rn)}else{if(a==="href"||a==="xlink:href"||a==="font"||a==="id")return t;if(a==="imageSmoothing")return t==="optimizeQuality";l=r?t.map(oa):oa(t,i)}}else c="";return!r&&isNaN(l)?c:l}function KM(a,t){const e=a.match(XA);if(!e)return;const i=e[1],r=e[3],l=e[4],c=e[5],h=e[6];i&&(t.fontStyle=i),r&&(t.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),l&&(t.fontSize=oa(l)),h&&(t.fontFamily=h),c&&(t.lineHeight=c==="normal"?1:c)}function ZM(a,t){a.replace(/;\s*$/,"").split(";").forEach((e=>{if(!e)return;const[i,r]=e.split(":");t[i.trim().toLowerCase()]=r.trim()}))}function JM(a){const t={},e=a.getAttribute("style");return e&&(typeof e=="string"?ZM(e,t):(function(i,r){Object.entries(i).forEach((l=>{let[c,h]=l;h!==void 0&&(r[c.toLowerCase()]=h)}))})(e,t)),t}const $M={stroke:"strokeOpacity",fill:"fillOpacity"};function Pi(a,t,e){if(!a)return{};let i,r={},l=Om;a.parentNode&&uS.test(a.parentNode.nodeName)&&(r=Pi(a.parentElement,t,e),r.fontSize&&(i=l=oa(r.fontSize)));const c=M(M(M({},t.reduce(((d,p)=>{const _=a.getAttribute(p);return _&&(d[p]=_),d}),{})),(function(d){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_={};for(const v in p)kM(d,v.split(" "))&&(_=M(M({},_),p[v]));return _})(a,e)),JM(a));c[Zd]&&a.setAttribute(Zd,c[Zd]),c[Kd]&&(i=oa(c[Kd],l),c[Kd]="".concat(i));const h={};for(const d in c){const p=LM(d),_=QM(p,c[d],r,i);h[p]=_}h&&h.font&&KM(h.font,h);const f=M(M({},r),h);return uS.test(a.nodeName)?f:(function(d){const p=Fe.getDefaults();return Object.entries($M).forEach((_=>{let[v,S]=_;if(d[S]===void 0||d[v]==="")return;if(d[v]===void 0){if(!p[v])return;d[v]=p[v]}if(d[v].indexOf("url(")===0)return;const b=new Pt(d[v]);d[v]=b.setAlpha(Kt(b.getAlpha()*d[S],2)).toRgba()})),d})(f)}const tR=["left","top","width","height","visible"],a1=["rx","ry"];class $n extends Fe{static getDefaults(){return M(M({},super.getDefaults()),$n.ownDefaults)}constructor(t){super(),Object.assign(this,$n.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:i}=this,r=-e/2,l=-i/2,c=this.rx?Math.min(this.rx,e/2):0,h=this.ry?Math.min(this.ry,i/2):0,f=c!==0||h!==0;t.beginPath(),t.moveTo(r+c,l),t.lineTo(r+e-c,l),f&&t.bezierCurveTo(r+e-ds*c,l,r+e,l+ds*h,r+e,l+h),t.lineTo(r+e,l+i-h),f&&t.bezierCurveTo(r+e,l+i-ds*h,r+e-ds*c,l+i,r+e-c,l+i),t.lineTo(r+c,l+i),f&&t.bezierCurveTo(r+ds*c,l+i,r,l+i-ds*h,r,l+i-h),t.lineTo(r,l+h),f&&t.bezierCurveTo(r,l+ds*h,r+ds*c,l,r+c,l),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...a1,...t])}_toSVG(){const{width:t,height:e,rx:i,ry:r}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(i,'" ry="').concat(r,'" width="').concat(t,'" height="').concat(e,`" />
`)]}static async fromElement(t,e,i){const r=Pi(t,this.ATTRIBUTE_NAMES,i),{left:l=0,top:c=0,width:h=0,height:f=0,visible:d=!0}=r,p=ee(r,tR);return new this(M(M(M({},e),p),{},{left:l,top:c,width:h,height:f,visible:!!(d&&h&&f)}))}}A($n,"type","Rect"),A($n,"cacheProperties",[...Ui,...a1]),A($n,"ownDefaults",{rx:0,ry:0}),A($n,"ATTRIBUTE_NAMES",[...Es,"x","y","rx","ry","width","height"]),it.setClass($n),it.setSVGClass($n);const Oi="initialization",Iu="added",Ym="removed",Fu="imperative",o1=(a,t)=>{const{strokeUniform:e,strokeWidth:i,width:r,height:l,group:c}=t,h=c&&c!==a?rh(c.calcTransformMatrix(),a.calcTransformMatrix()):null,f=h?t.getRelativeCenterPoint().transform(h):t.getRelativeCenterPoint(),d=!t.isStrokeAccountedForInDimensions(),p=e&&d?FA(new P(i,i),void 0,a.calcTransformMatrix()):Mm,_=!e&&d?i:0,v=km(r+_,l+_,Rm([h,t.calcOwnMatrix()],!0)).add(p).scalarDivide(2);return[f.subtract(v),f.add(v)]};class lh{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:i,strategy:r}=t;return e===Oi||e===Fu||!!i&&r!==i}shouldLayoutClipPath(t){let{type:e,target:{clipPath:i}}=t;return e!==Oi&&i&&!i.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:i,target:r}=e;if(i===Fu&&e.overrides)return e.overrides;if(t.length===0)return;const{left:l,top:c,width:h,height:f}=Ri(t.map((_=>o1(r,_))).reduce(((_,v)=>_.concat(v)),[])),d=new P(h,f),p=new P(l,c).add(d.scalarDivide(2));if(i===Oi){const _=this.getInitialSize(e,{size:d,center:p});return{center:p,relativeCorrection:new P(0,0),size:_}}return{center:p.transform(r.calcOwnMatrix()),size:d}}}A(lh,"type","strategy");class Ig extends lh{shouldPerformLayout(t){return!0}}A(Ig,"type","fit-content"),it.setClass(Ig);const eR=["strategy"],nR=["target","strategy","bubbles","prevStrategy"],l1="layoutManager";class nl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Ig;A(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=M(M({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const i=this.getLayoutResult(e);i&&this.commitLayout(e,i),this.onAfterLayout(e,i),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:i}=e;return[Nu,wC,Zo,EC,eh,OC,Ru,wA,EA].map((r=>t.on(r,(l=>this.performLayout(r===Nu?{type:"object_modified",trigger:r,e:l,target:i}:{type:"object_modifying",trigger:r,e:l,target:i})))))}subscribe(t,e){this.unsubscribe(t,e);const i=this.attachHandlers(t,e);this._subscriptions.set(t,i)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach((i=>i())),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach((e=>this.unsubscribe(e,t)))}subscribeTargets(t){t.targets.forEach((e=>this.subscribe(e,t)))}onBeforeLayout(t){const{target:e,type:i}=t,{canvas:r}=e;if(i===Oi||i===Iu?this.subscribeTargets(t):i===Ym&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),r&&r.fire("object:layout:before",{target:e,context:t}),i===Fu&&t.deep){const l=ee(t,eR);e.forEachObject((c=>c.layoutManager&&c.layoutManager.performLayout(M(M({},l),{},{bubbles:!1,target:c}))))}}getLayoutResult(t){const{target:e,strategy:i,type:r}=t,l=i.calcLayoutResult(t,e.getObjects());if(!l)return;const c=r===Oi?new P:e.getRelativeCenterPoint(),{center:h,correction:f=new P,relativeCorrection:d=new P}=l,p=c.subtract(h).add(f).transform(r===Oi?Ge:Gn(e.calcOwnMatrix()),!0).add(d);return{result:l,prevCenter:c,nextCenter:h,offset:p}}commitLayout(t,e){const{target:i}=t,{result:{size:r},nextCenter:l}=e;var c,h;i.set({width:r.x,height:r.y}),this.layoutObjects(t,e),t.type===Oi?i.set({left:(c=t.x)!==null&&c!==void 0?c:l.x+r.x*ve(i.originX),top:(h=t.y)!==null&&h!==void 0?h:l.y+r.y*ve(i.originY)}):(i.setPositionByOrigin(l,Ct,Ct),i.setCoords(),i.set("dirty",!0))}layoutObjects(t,e){const{target:i}=t;i.forEachObject((r=>{r.group===i&&this.layoutObject(t,e,r)})),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,i.clipPath)}layoutObject(t,e,i){let{offset:r}=e;i.set({left:i.left+r.x,top:i.top+r.y})}onAfterLayout(t,e){const{target:i,strategy:r,bubbles:l,prevStrategy:c}=t,h=ee(t,nR),{canvas:f}=i;i.fire("layout:after",{context:t,result:e}),f&&f.fire("object:layout:after",{context:t,result:e,target:i});const d=i.parent;l&&d!=null&&d.layoutManager&&((h.path||(h.path=[])).push(i),d.layoutManager.performLayout(M(M({},h),{},{target:d}))),i.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach((e=>e.forEach((i=>i())))),t.clear()}toObject(){return{type:l1,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}it.setClass(nl,l1);const iR=["type","objects","layoutManager"];class sR extends nl{performLayout(){}}class tr extends DC(Fe){static getDefaults(){return M(M({},super.getDefaults()),tr.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),A(this,"_activeObjects",[]),A(this,"__objectSelectionTracker",void 0),A(this,"__objectSelectionDisposer",void 0),Object.assign(this,tr.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var i;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((r=>{this.enterGroup(r,!1)})),this.layoutManager=(i=e.layoutManager)!==null&&i!==void 0?i:new nl,this.layoutManager.performLayout({type:Oi,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(Ts("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(t)===-1||(Ts("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter(((e,i,r)=>this.canEnterGroup(e)&&r.indexOf(e)===i))}add(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const r=this._filterObjectsBeforeEnteringGroup(e),l=super.add(...r);return this._onAfterObjectsChange(Iu,r),l}insertAt(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];const l=this._filterObjectsBeforeEnteringGroup(i),c=super.insertAt(t,...l);return this._onAfterObjectsChange(Iu,l),c}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(Ym,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const i=this[t];return super._set(t,e),t==="canvas"&&i!==e&&(this._objects||[]).forEach((r=>{r._set(t,e)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:i}=e;const r=this._activeObjects;if(t)r.push(i),this._set("dirty",!0);else if(r.length>0){const l=r.indexOf(i);l>-1&&(r.splice(l,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&Lu(t,ze(Gn(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const i=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();i&&(i===t||t.isDescendantOf(i))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(Lu(t,ze(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const i=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;i>-1&&this._activeObjects.splice(i,1)}shouldCache(){const t=Fe.prototype.shouldCache.call(this);if(t){for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,i){this._renderBackground(t);for(let l=0;l<this._objects.length;l++){var r;const c=this._objects[l];(r=this.canvas)!==null&&r!==void 0&&r.preserveObjectStacking&&c.group!==this?(t.save(),t.transform(...Gn(this.calcTransformMatrix())),c.render(t),t.restore()):c.group===this&&c.render(t)}this._drawClipPath(t,this.clipPath,i)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((t=>t.setCoords()))}triggerLayout(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(M({target:this,type:Fu},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const i=this.includeDefaultValues;return this._objects.filter((function(r){return!r.excludeFromExport})).map((function(r){const l=r.includeDefaultValues;r.includeDefaultValues=i;const c=r[t||"toObject"](e);return r.includeDefaultValues=l,c}))}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.layoutManager.toObject();return M(M(M({},super.toObject(["subTargetCheck","interactive",...t])),e.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((t=>{this._watchObject(!1,t),t.dispose()})),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=$n.prototype._toSVG.call(this),i=e.indexOf("COMMON_PARTS");e[i]='for="group" ';const r=e.join("");return t?t(r):r}_toSVG(t){const e=["<g ","COMMON_PARTS",` >
`],i=this._createSVGBgRect(t);i&&e.push("		",i);for(let r=0;r<this._objects.length;r++)e.push("		",this._objects[r].toSVG(t));return e.push(`</g>
`),e}getSvgStyles(){const t=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],i=this._createSVGBgRect(t);i&&e.push("	",i);for(let r=0;r<this._objects.length;r++)e.push("	",this._objects[r].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:i,objects:r=[],layoutManager:l}=t,c=ee(t,iR);return Promise.all([Jo(r,e),sh(c,e)]).then((h=>{let[f,d]=h;const p=new this(f,M(M(M({},c),d),{},{layoutManager:new sR}));if(l){const _=it.getClass(l.type),v=it.getClass(l.strategy);p.layoutManager=new _(new v)}else p.layoutManager=new nl;return p.layoutManager.subscribeTargets({type:Oi,target:p,targets:p.getObjects()}),p.setCoords(),p}))}}A(tr,"type","Group"),A(tr,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),it.setClass(tr);const rR=(a,t)=>Math.min(t.width/a.width,t.height/a.height),aR=(a,t)=>Math.max(t.width/a.width,t.height/a.height),Fg="\\s*,?\\s*",Oo="".concat(Fg,"(").concat(Xn,")"),oR="".concat(Oo).concat(Oo).concat(Oo).concat(Fg,"([01])").concat(Fg,"([01])").concat(Oo).concat(Oo),lR={m:"l",M:"L"},cR=(a,t,e,i,r,l,c,h,f,d,p)=>{const _=Li(a),v=zi(a),S=Li(t),b=zi(t),T=e*r*S-i*l*b+c,w=i*r*S+e*l*b+h;return["C",d+f*(-e*r*v-i*l*_),p+f*(-i*r*v+e*l*_),T+f*(e*r*b+i*l*S),w+f*(i*r*b-e*l*S),T,w]},ES=(a,t,e,i)=>{const r=Math.atan2(t,a),l=Math.atan2(i,e);return l>=r?l-r:2*Math.PI-(r-l)};function OS(a,t,e,i,r,l,c,h){let f;if(jt.cachesBoundsOfCurve&&(f=[...arguments].join(),Lo.boundsOfCurveCache[f]))return Lo.boundsOfCurveCache[f];const d=Math.sqrt,p=Math.abs,_=[],v=[[0,0],[0,0]];let S=6*a-12*e+6*r,b=-3*a+9*e-9*r+3*c,T=3*e-3*a;for(let Y=0;Y<2;++Y){if(Y>0&&(S=6*t-12*i+6*l,b=-3*t+9*i-9*l+3*h,T=3*i-3*t),p(b)<1e-12){if(p(S)<1e-12)continue;const Z=-T/S;0<Z&&Z<1&&_.push(Z);continue}const B=S*S-4*T*b;if(B<0)continue;const K=d(B),F=(-S+K)/(2*b);0<F&&F<1&&_.push(F);const Q=(-S-K)/(2*b);0<Q&&Q<1&&_.push(Q)}let w=_.length;const N=w,I=c1(a,t,e,i,r,l,c,h);for(;w--;){const{x:Y,y:B}=I(_[w]);v[0][w]=Y,v[1][w]=B}v[0][N]=a,v[1][N]=t,v[0][N+1]=c,v[1][N+1]=h;const j=[new P(Math.min(...v[0]),Math.min(...v[1])),new P(Math.max(...v[0]),Math.max(...v[1]))];return jt.cachesBoundsOfCurve&&(Lo.boundsOfCurveCache[f]=j),j}const uR=(a,t,e)=>{let[i,r,l,c,h,f,d,p]=e;const _=((v,S,b,T,w,N,I)=>{if(b===0||T===0)return[];let j=0,Y=0,B=0;const K=Math.PI,F=I*Em,Q=zi(F),Z=Li(F),nt=.5*(-Z*v-Q*S),ot=.5*(-Z*S+Q*v),rt=b**2,ft=T**2,ct=ot**2,vt=nt**2,U=rt*ft-rt*ct-ft*vt;let W=Math.abs(b),tt=Math.abs(T);if(U<0){const Xe=Math.sqrt(1-U/(rt*ft));W*=Xe,tt*=Xe}else B=(w===N?-1:1)*Math.sqrt(U/(rt*ct+ft*vt));const mt=B*W*ot/tt,bt=-B*tt*nt/W,D=Z*mt-Q*bt+.5*v,X=Q*mt+Z*bt+.5*S;let $=ES(1,0,(nt-mt)/W,(ot-bt)/tt),et=ES((nt-mt)/W,(ot-bt)/tt,(-nt-mt)/W,(-ot-bt)/tt);N===0&&et>0?et-=2*K:N===1&&et<0&&(et+=2*K);const dt=Math.ceil(Math.abs(et/K*2)),gt=[],At=et/dt,Ae=8/3*Math.sin(At/4)*Math.sin(At/4)/Math.sin(At/2);let Zt=$+At;for(let Xe=0;Xe<dt;Xe++)gt[Xe]=cR($,Zt,Z,Q,W,tt,D,X,Ae,j,Y),j=gt[Xe][5],Y=gt[Xe][6],$=Zt,Zt+=At;return gt})(d-a,p-t,r,l,h,f,c);for(let v=0,S=_.length;v<S;v++)_[v][1]+=a,_[v][2]+=t,_[v][3]+=a,_[v][4]+=t,_[v][5]+=a,_[v][6]+=t;return _},hR=a=>{let t=0,e=0,i=0,r=0;const l=[];let c,h=0,f=0;for(const d of a){const p=[...d];let _;switch(p[0]){case"l":p[1]+=t,p[2]+=e;case"L":t=p[1],e=p[2],_=["L",t,e];break;case"h":p[1]+=t;case"H":t=p[1],_=["L",t,e];break;case"v":p[1]+=e;case"V":e=p[1],_=["L",t,e];break;case"m":p[1]+=t,p[2]+=e;case"M":t=p[1],e=p[2],i=p[1],r=p[2],_=["M",t,e];break;case"c":p[1]+=t,p[2]+=e,p[3]+=t,p[4]+=e,p[5]+=t,p[6]+=e;case"C":h=p[3],f=p[4],t=p[5],e=p[6],_=["C",p[1],p[2],h,f,t,e];break;case"s":p[1]+=t,p[2]+=e,p[3]+=t,p[4]+=e;case"S":c==="C"?(h=2*t-h,f=2*e-f):(h=t,f=e),t=p[3],e=p[4],_=["C",h,f,p[1],p[2],t,e],h=_[3],f=_[4];break;case"q":p[1]+=t,p[2]+=e,p[3]+=t,p[4]+=e;case"Q":h=p[1],f=p[2],t=p[3],e=p[4],_=["Q",h,f,t,e];break;case"t":p[1]+=t,p[2]+=e;case"T":c==="Q"?(h=2*t-h,f=2*e-f):(h=t,f=e),t=p[1],e=p[2],_=["Q",h,f,t,e];break;case"a":p[6]+=t,p[7]+=e;case"A":uR(t,e,p).forEach((v=>l.push(v))),t=p[6],e=p[7];break;case"z":case"Z":t=i,e=r,_=["Z"]}_?(l.push(_),c=_[0]):c=""}return l},Uu=(a,t,e,i)=>Math.sqrt((e-a)**2+(i-t)**2),c1=(a,t,e,i,r,l,c,h)=>f=>{const d=f**3,p=(S=>3*S**2*(1-S))(f),_=(S=>3*S*(1-S)**2)(f),v=(S=>(1-S)**3)(f);return new P(c*d+r*p+e*_+a*v,h*d+l*p+i*_+t*v)},u1=a=>a**2,h1=a=>2*a*(1-a),f1=a=>(1-a)**2,fR=(a,t,e,i,r,l,c,h)=>f=>{const d=u1(f),p=h1(f),_=f1(f),v=3*(_*(e-a)+p*(r-e)+d*(c-r)),S=3*(_*(i-t)+p*(l-i)+d*(h-l));return Math.atan2(S,v)},dR=(a,t,e,i,r,l)=>c=>{const h=u1(c),f=h1(c),d=f1(c);return new P(r*h+e*f+a*d,l*h+i*f+t*d)},gR=(a,t,e,i,r,l)=>c=>{const h=1-c,f=2*(h*(e-a)+c*(r-e)),d=2*(h*(i-t)+c*(l-i));return Math.atan2(d,f)},DS=(a,t,e)=>{let i=new P(t,e),r=0;for(let l=1;l<=100;l+=1){const c=a(l/100);r+=Uu(i.x,i.y,c.x,c.y),i=c}return r},mR=(a,t)=>{let e,i=0,r=0,l={x:a.x,y:a.y},c=M({},l),h=.01,f=0;const d=a.iterator,p=a.angleFinder;for(;r<t&&h>1e-4;)c=d(i),f=i,e=Uu(l.x,l.y,c.x,c.y),e+r>t?(i-=h,h/=2):(l=c,i+=h,r+=e);return M(M({},c),{},{angle:p(f)})},d1=a=>{let t,e,i=0,r=0,l=0,c=0,h=0;const f=[];for(const d of a){const p={x:r,y:l,command:d[0],length:0};switch(d[0]){case"M":e=p,e.x=c=r=d[1],e.y=h=l=d[2];break;case"L":e=p,e.length=Uu(r,l,d[1],d[2]),r=d[1],l=d[2];break;case"C":t=c1(r,l,d[1],d[2],d[3],d[4],d[5],d[6]),e=p,e.iterator=t,e.angleFinder=fR(r,l,d[1],d[2],d[3],d[4],d[5],d[6]),e.length=DS(t,r,l),r=d[5],l=d[6];break;case"Q":t=dR(r,l,d[1],d[2],d[3],d[4]),e=p,e.iterator=t,e.angleFinder=gR(r,l,d[1],d[2],d[3],d[4]),e.length=DS(t,r,l),r=d[3],l=d[4];break;case"Z":e=p,e.destX=c,e.destY=h,e.length=Uu(r,l,c,h),r=c,l=h}i+=e.length,f.push(e)}return f.push({length:i,x:r,y:l}),f},pR=function(a,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:d1(a),i=0;for(;t-e[i].length>0&&i<e.length-2;)t-=e[i].length,i++;const r=e[i],l=t/r.length,c=a[i];switch(r.command){case"M":return{x:r.x,y:r.y,angle:0};case"Z":return M(M({},new P(r.x,r.y).lerp(new P(r.destX,r.destY),l)),{},{angle:Math.atan2(r.destY-r.y,r.destX-r.x)});case"L":return M(M({},new P(r.x,r.y).lerp(new P(c[1],c[2]),l)),{},{angle:Math.atan2(c[2]-r.y,c[1]-r.x)});case"C":case"Q":return mR(r,t)}},_R=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),AS=new RegExp(oR,"g"),vR=new RegExp(Xn,"gi"),yR={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},SR=a=>{var t;const e=[],i=(t=a.match(_R))!==null&&t!==void 0?t:[];for(const r of i){const l=r[0];if(l==="z"||l==="Z"){e.push([l]);continue}const c=yR[l.toLowerCase()];let h=[];if(l==="a"||l==="A"){AS.lastIndex=0;for(let f=null;f=AS.exec(r);)h.push(...f.slice(1))}else h=r.match(vR)||[];for(let f=0;f<h.length;f+=c){const d=new Array(c),p=lR[l];d[0]=f>0&&p?p:l;for(let _=0;_<c;_++)d[_+1]=parseFloat(h[f+_]);e.push(d)}}return e},bR=(a,t)=>a.map((e=>e.map(((i,r)=>r===0||t===void 0?i:Kt(i,t))).join(" "))).join(" ");function Ug(a,t){const e=a.style;e&&t&&(typeof t=="string"?e.cssText+=";"+t:Object.entries(t).forEach((i=>{let[r,l]=i;return e.setProperty(r,l)})))}class CR extends FC{constructor(t){let{allowTouchScrolling:e=!1,containerClass:i=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),A(this,"upper",void 0),A(this,"container",void 0);const{el:r}=this.lower,l=this.createUpperCanvas();this.upper={el:l,ctx:l.getContext("2d")},this.applyCanvasStyle(r,{allowTouchScrolling:e}),this.applyCanvasStyle(l,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const c=this.createContainerElement();c.classList.add(i),r.parentNode&&r.parentNode.replaceChild(c,r),c.append(r,l),this.container=c}createUpperCanvas(){const{el:t}=this.lower,e=Bi();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=Sa().createElement("div");return t.setAttribute("data-fabric","wrapper"),Ug(t,{position:"relative"}),tS(t),t}applyCanvasStyle(t,e){const{styles:i,allowTouchScrolling:r}=e;Ug(t,M(M({},i),{},{"touch-action":r?"manipulation":sn})),tS(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:i,ctx:r}=this.upper;IC(i,r,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),Ng(this.upper.el,t),Ng(this.container,t)}cleanupDOM(t){const e=this.container,{el:i}=this.lower,{el:r}=this.upper;super.cleanupDOM(t),e.removeChild(r),e.removeChild(i),e.parentNode&&e.parentNode.replaceChild(i,e)}dispose(){super.dispose(),ni().dispose(this.upper.el),delete this.upper,delete this.container}}class ch extends dl{constructor(){super(...arguments),A(this,"targets",[]),A(this,"_hoveredTargets",[]),A(this,"_objectsToRender",void 0),A(this,"_currentTransform",null),A(this,"_groupSelector",null),A(this,"contextTopDirty",!1)}static getDefaults(){return M(M({},super.getDefaults()),ch.ownDefaults)}get upperCanvasEl(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.el}get contextTop(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new CR(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter((e=>!e.group&&e!==t)).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),i=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=i,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,i){const r=this.targetFindTolerance,l=this.pixelFindContext;this.clearContext(l),l.save(),l.translate(-e+r,-i+r),l.transform(...this.viewportTransform);const c=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(l),t.selectionBackgroundColor=c,l.restore();const h=Math.round(r*this.getRetinaScaling());return EM(l,h,h,h)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find((i=>!!i&&t[i]===!0)):t[e])}_shouldClearSelection(t,e){const i=this.getActiveObjects(),r=this._activeObject;return!!(!e||e&&r&&i.length>1&&i.indexOf(e)===-1&&r!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&r&&r!==e)}_shouldCenterTransform(t,e,i){if(!t)return;let r;return e===nh||e===an||e===jn||e===Zo?r=this.centeredScaling||t.centeredScaling:e===Am&&(r=this.centeredRotation||t.centeredRotation),r?!i:i}_getOriginFromCorner(t,e){const i={x:t.originX,y:t.originY};return e&&(["ml","tl","bl"].includes(e)?i.x=fe:["mr","tr","br"].includes(e)&&(i.x=It),["tl","mt","tr"].includes(e)?i.y=Rg:["bl","mb","br"].includes(e)&&(i.y=nn)),i}_setupCurrentTransform(t,e,i){var r;const l=e.group?aa(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:c="",control:h}=e.getActiveControl()||{},f=i&&h?(r=h.getActionHandler(t,e,h))===null||r===void 0?void 0:r.bind(h):HA,d=((S,b,T,w)=>{if(!b||!S)return"drag";const N=w.controls[b];return N.getActionName(T,N,w)})(i,c,t,e),p=t[this.centeredKey],_=this._shouldCenterTransform(e,d,p)?{x:Ct,y:Ct}:this._getOriginFromCorner(e,c),v={target:e,action:d,actionHandler:f,actionPerformed:!1,corner:c,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:l.x-e.left,offsetY:l.y-e.top,originX:_.x,originY:_.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,theta:de(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:p,original:M(M({},UC(e)),{},{originX:_.x,originY:_.y})};this._currentTransform=v,this.fire("before:transform",{e:t,transform:v})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:i,deltaX:r,deltaY:l}=this._groupSelector,c=new P(e,i).transform(this.viewportTransform),h=new P(e+r,i+l).transform(this.viewportTransform),f=this.selectionLineWidth/2;let d=Math.min(c.x,h.x),p=Math.min(c.y,h.y),_=Math.max(c.x,h.x),v=Math.max(c.y,h.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(d,p,_-d,v-p)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,d+=f,p+=f,_-=f,v-=f,Fe.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(d,p,_-d,v-p))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),i=this._activeObject,r=this.getActiveObjects();if(this.targets=[],i&&r.length>=1){if(i.findControl(e,jg(t))||r.length>1&&this.searchPossibleTargets([i],e))return i;if(i===this.searchPossibleTargets([i],e)){if(this.preserveObjectStacking){const l=this.targets;this.targets=[];const c=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&c&&c!==i?(this.targets=l,i):c}return i}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let i=t.getCoords();const r=this.getZoom(),l=t.padding/r;if(l){const[c,h,f,d]=i,p=Math.atan2(h.y-c.y,h.x-c.x),_=Li(p)*l,v=zi(p)*l,S=_+v,b=_-v;i=[new P(c.x-b,c.y-S),new P(h.x+S,h.y-b),new P(f.x+b,f.y+S),new P(d.x-S,d.y+b)]}return ne.isPointInPolygon(e,i)}_checkTarget(t,e){return!!(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,aa(e,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing||!this.isTargetTransparent(t,e.x,e.y)))}_searchPossibleTargets(t,e){let i=t.length;for(;i--;){const r=t[i];if(this._checkTarget(r,e)){if(ou(r)&&r.subTargetCheck){const l=this._searchPossibleTargets(r._objects,e);l&&this.targets.push(l)}return r}}}searchPossibleTargets(t,e){const i=this._searchPossibleTargets(t,e);if(i&&ou(i)&&i.interactive&&this.targets[0]){const r=this.targets;for(let l=r.length-1;l>0;l--){const c=r[l];if(!ou(c)||!c.interactive)return c}return r[0]}return i}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=this.upperCanvasEl,r=i.getBoundingClientRect();let l=LA(t),c=r.width||0,h=r.height||0;c&&h||(nn in r&&Rg in r&&(h=Math.abs(r.top-r.bottom)),fe in r&&It in r&&(c=Math.abs(r.right-r.left))),this.calcOffset(),l.x=l.x-this._offset.left,l.y=l.y-this._offset.top,e||(l=aa(l,void 0,this.viewportTransform));const f=this.getRetinaScaling();f!==1&&(l.x/=f,l.y/=f);const d=c===0||h===0?new P(1,1):new P(i.width/c,i.height/h);return l.multiply(d)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Bi(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return Ws(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let i=!1,r=!1;const l=this.getActiveObjects(),c=[],h=[];t.forEach((f=>{l.includes(f)||(i=!0,f.fire("deselected",{e,target:f}),h.push(f))})),l.forEach((f=>{t.includes(f)||(i=!0,f.fire("selected",{e,target:f}),c.push(f))})),t.length>0&&l.length>0?(r=!0,i&&this.fire("selection:updated",{e,selected:c,deselected:h})):l.length>0?(r=!0,this.fire("selection:created",{e,selected:c})):t.length>0&&(r=!0,this.fire("selection:cleared",{e,deselected:h})),r&&(this._objectsToRender=void 0)}setActiveObject(t,e){const i=this.getActiveObjects(),r=this._setActiveObject(t,e);return this._fireSelectionEvents(i,e),r}_setActiveObject(t,e){const i=this._activeObject;return i!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e})&&(this._activeObject=t,Ws(t)&&i!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const i=this._activeObject;return!!i&&!i.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===i&&this.endCurrentTransform(t),Ws(i)&&i===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),i=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[i]});const r=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),r}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,i=e.target,r={e:t,target:i,transform:e,action:e.action};i._scaling&&(i._scaling=!1),i.setCoords(),e.actionPerformed&&(this.fire("object:modified",r),i.fire(Nu,r))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;Ws(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,i){const r=this._realizeGroupTransformOnObject(t),l=super._toObject(t,e,i);return t.set(r),l}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&Ws(e)&&this._activeObject===e){const i=Ta(t,["angle","flipX","flipY",It,an,jn,ba,Ca,nn]);return BA(t,e.calcOwnMatrix()),i}return{}}_setSVGObject(t,e,i){const r=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,i),e.set(r)}}A(ch,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class xR{constructor(t){A(this,"targets",[]),A(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:r}=t.getActiveObject()||{};r&&r.focus()},i=t.upperCanvasEl;i.addEventListener("click",e),this.__disposer=()=>i.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach((t=>{t.isEditing&&t.exitEditing()}))}add(t){this.targets.push(t)}remove(t){this.unregister(t),Zr(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;!((e=this.target)===null||e===void 0)&&e.isEditing&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const TR=["target","oldTarget","fireCanvas","e"],_n={passive:!1},Kr=(a,t)=>{const e=a.getViewportPoint(t),i=a.getScenePoint(t);return{viewportPoint:e,scenePoint:i,pointer:e,absolutePointer:i}},gs=function(a){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return a.addEventListener(...e)},An=function(a){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return a.removeEventListener(...e)},wR={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Pg extends ch{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),A(this,"_isClick",void 0),A(this,"textEditingManager",new xR(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((e=>{this[e]=this[e].bind(this)})),this.addOrRemove(gs,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const i=this.upperCanvasEl,r=this._getEventPrefix();t(BC(i),"resize",this._onResize),t(i,r+"down",this._onMouseDown),t(i,"".concat(r,"move"),this._onMouseMove,_n),t(i,"".concat(r,"out"),this._onMouseOut),t(i,"".concat(r,"enter"),this._onMouseEnter),t(i,"wheel",this._onMouseWheel),t(i,"contextmenu",this._onContextMenu),t(i,"click",this._onClick),t(i,"dblclick",this._onClick),t(i,"dragstart",this._onDragStart),t(i,"dragend",this._onDragEnd),t(i,"dragover",this._onDragOver),t(i,"dragenter",this._onDragEnter),t(i,"dragleave",this._onDragLeave),t(i,"drop",this._onDrop),this.enablePointerEvents||t(i,"touchstart",this._onTouchStart,_n)}removeListeners(){this.addOrRemove(An,"remove");const t=this._getEventPrefix(),e=Hn(this.upperCanvasEl);An(e,"".concat(t,"up"),this._onMouseUp),An(e,"touchend",this._onTouchEnd,_n),An(e,"".concat(t,"move"),this._onMouseMove,_n),An(e,"touchmove",this._onMouseMove,_n),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,i=M({e:t},Kr(this,t));this.fire("mouse:out",M(M({},i),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",M({},i)),this._hoveredTargets.forEach((r=>{this.fire("mouse:out",M(M({},i),{},{target:r})),r&&r.fire("mouseout",M({},i))})),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",M({e:t},Kr(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const i={e:t,target:e};return this.fire("dragstart",i),e.fire("dragstart",i),void gs(this.upperCanvasEl,"drag",this._onDragProgress)}eS(t)}_renderDragEffects(t,e,i){let r=!1;const l=this._dropTarget;l&&l!==e&&l!==i&&(l.clearContextTop(),r=!0),e?.clearContextTop(),i!==e&&i?.clearContextTop();const c=this.contextTop;c.save(),c.transform(...this.viewportTransform),e&&(c.save(),e.transform(c),e.renderDragSourceEffect(t),c.restore(),r=!0),i&&(c.save(),i.transform(c),i.renderDropTargetEffect(t),c.restore(),r=!0),c.restore(),r&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==sn,i=e?this._activeObject:void 0,r={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:i};An(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",r),this._dragSource&&this._dragSource.fire("dragend",r),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:i,targets:r}=this.findDragTargets(t),l=this._dragSource,c={e:t,target:i,subTargets:r,dragSource:l,canDrop:!1,dropTarget:void 0};let h;this.fire(e,c),this._fireEnterLeaveEvents(i,c),i&&(i.canDrop(t)&&(h=i),i.fire(e,c));for(let f=0;f<r.length;f++){const d=r[f];d.canDrop(t)&&(h=d),d.fire(e,c)}this._renderDragEffects(t,l,h),this._dropTarget=h}_onDragEnter(t){const{target:e,targets:i}=this.findDragTargets(t),r={e:t,target:e,subTargets:i,dragSource:this._dragSource};this.fire("dragenter",r),this._fireEnterLeaveEvents(e,r)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:i}=this.findDragTargets(t),r=this._basicEventHandler("drop:before",M({e:t,target:e,subTargets:i,dragSource:this._dragSource},Kr(this,t)));r.didDrop=!1,r.dropTarget=void 0,this._basicEventHandler("drop",r),this.fire("drop:after",r)}_onContextMenu(t){const e=this.findTarget(t),i=this.targets||[],r=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:i});return this.stopContextMenu&&eS(t),this._basicEventHandler("contextmenu",r),!1}_onClick(t){const e=t.detail;e>3||e<2||(this._cacheTransformEventData(t),e==2&&t.type==="dblclick"&&this._handleEvent(t,"dblclick"),e==3&&this._handleEvent(t,"tripleclick"),this._resetTransformEventData())}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return t.isPrimary===!0||t.isPrimary!==!1&&(t.type==="touchend"&&t.touches.length===0||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const i=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||i&&this._target===i)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const r=this.upperCanvasEl,l=this._getEventPrefix(),c=Hn(r);gs(c,"touchend",this._onTouchEnd,_n),e&&gs(c,"touchmove",this._onMouseMove,_n),An(r,"".concat(l,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,i=this._getEventPrefix();An(e,"".concat(i,"move"),this._onMouseMove,_n);const r=Hn(e);gs(r,"".concat(i,"up"),this._onMouseUp),gs(r,"".concat(i,"move"),this._onMouseMove,_n)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),i=Hn(this.upperCanvasEl);An(i,"touchend",this._onTouchEnd,_n),An(i,"touchmove",this._onMouseMove,_n),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{gs(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,i=this._getEventPrefix();if(this._isMainEvent(t)){const r=Hn(this.upperCanvasEl);An(r,"".concat(i,"up"),this._onMouseUp),An(r,"".concat(i,"move"),this._onMouseMove,_n),gs(e,"".concat(i,"move"),this._onMouseMove,_n)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const i=this._currentTransform,r=this._isClick,l=this._target,{button:c}=t;if(c)return(this.fireMiddleClick&&c===1||this.fireRightClick&&c===2)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let h,f,d=!1;if(i&&(this._finalizeCurrentTransform(t),d=i.actionPerformed),!r){const p=l===this._activeObject;this.handleSelection(t),d||(d=this._shouldRender(l)||!p&&l===this._activeObject)}if(l){const p=l.findControl(this.getViewportPoint(t),jg(t)),{key:_,control:v}=p||{};if(f=_,l.selectable&&l!==this._activeObject&&l.activeOn==="up")this.setActiveObject(l,t),d=!0;else if(v){const S=v.getMouseUpHandler(t,l,v);S&&(h=this.getScenePoint(t),S.call(v,t,i,h.x,h.y))}l.isMoving=!1}if(i&&(i.target!==l||i.corner!==f)){const p=i.target&&i.target.controls[i.corner],_=p&&p.getMouseUpHandler(t,i.target,p);h=h||this.getScenePoint(t),_&&_.call(p,t,i,h.x,h.y)}this._setCursorFromEvent(t,l),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,l&&(l.__corner=void 0),d?this.requestRenderAll():r||(e=this._activeObject)!==null&&e!==void 0&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:i,subTargets:r=[]}=e;this.fire(t,e),i&&i.fire(t,e);for(let l=0;l<r.length;l++)r[l]!==i&&r[l].fire(t,e);return e}_handleEvent(t,e,i){const r=this._target,l=this.targets||[],c=M(M(M({e:t,target:r,subTargets:l},Kr(this,t)),{},{transform:this._currentTransform},e==="up:before"||e==="up"?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{}),e==="down:before"||e==="down"?i:{});this.fire("mouse:".concat(e),c),r&&r.fire("mouse".concat(e),c);for(let h=0;h<l.length;h++)l[h]!==r&&l[h].fire("mouse".concat(e),c)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target,i=!!e&&e===this._activeObject;const{button:r}=t;if(r)return(this.fireMiddleClick&&r===1||this.fireRightClick&&r===2)&&this._handleEvent(t,"down",{alreadySelected:i}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t)||this._currentTransform)return;let l=this._shouldRender(e),c=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,c=!0,l=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const h=this.getScenePoint(t);this._groupSelector={x:h.x,y:h.y,deltaY:0,deltaX:0}}if(i=!!e&&e===this._activeObject,e){e.selectable&&e.activeOn==="down"&&this.setActiveObject(e,t);const h=e.findControl(this.getViewportPoint(t),jg(t));if(e===this._activeObject&&(h||!c)){this._setupCurrentTransform(t,e,i);const f=h?h.control:void 0,d=this.getScenePoint(t),p=f&&f.getMouseDownHandler(t,e,f);p&&p.call(f,t,this._currentTransform,d.x,d.y)}}l&&(this._objectsToRender=void 0),this._handleEvent(t,"down",{alreadySelected:i}),l&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=aa(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const i=this.getScenePoint(t);e.deltaX=i.x-e.x,e.deltaY=i.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const i=this.findTarget(t);this._setCursorFromEvent(t,i),this._fireOverOutEvents(t,i)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const i=this._hoveredTarget,r=this._hoveredTargets,l=this.targets,c=Math.max(r.length,l.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:i,fireCanvas:!0});for(let h=0;h<c;h++)this.fireSyntheticInOutEvents("mouse",{e:t,target:l[h],oldTarget:r[h]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const i=this._draggedoverTarget,r=this._hoveredTargets,l=this.targets,c=Math.max(r.length,l.length);this.fireSyntheticInOutEvents("drag",M(M({},e),{},{target:t,oldTarget:i,fireCanvas:!0}));for(let h=0;h<c;h++)this.fireSyntheticInOutEvents("drag",M(M({},e),{},{target:l[h],oldTarget:r[h]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:i,oldTarget:r,fireCanvas:l,e:c}=e,h=ee(e,TR);const{targetIn:f,targetOut:d,canvasIn:p,canvasOut:_}=wR[t],v=r!==i;if(r&&v){const S=M(M({},h),{},{e:c,target:r,nextTarget:i},Kr(this,c));l&&this.fire(_,S),r.fire(d,S)}if(i&&v){const S=M(M({},h),{},{e:c,target:i,previousTarget:r},Kr(this,c));l&&this.fire(p,S),i.fire(f,S)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),i=this._currentTransform,r=i.target,l=r.group?aa(e,void 0,r.group.calcTransformMatrix()):e;i.shiftKey=t.shiftKey,i.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,i,l),i.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,i){const{action:r,actionHandler:l,target:c}=e,h=!!l&&l(t,e,i.x,i.y);h&&c.setCoords(),r==="drag"&&h&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||h}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let i=e.hoverCursor||this.hoverCursor;const r=Ws(this._activeObject)?this._activeObject:null,l=(!r||e.group!==r)&&e.findControl(this.getViewportPoint(t));if(l){const c=l.control;this.setCursor(c.cursorStyleHandler(t,c,e))}else e.subTargetCheck&&this.targets.concat().reverse().map((c=>{i=c.hoverCursor||i})),this.setCursor(i)}handleMultiSelection(t,e){const i=this._activeObject,r=Ws(i);if(i&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(i!==e||r)&&(r||!e.isDescendantOf(i)&&!i.isDescendantOf(e))&&!e.onSelect({e:t})&&!i.getActiveControl()){if(r){const l=i.getObjects();if(e===i){const c=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(l,c)||this.searchPossibleTargets(this._objects,c))||!e.selectable)return!1}e.group===i?(i.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],i.size()===1&&this._setActiveObject(i.item(0),t)):(i.multiSelectAdd(e),this._hoveredTarget=i,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(l,t)}else{i.isEditing&&i.exitEditing();const l=new(it.getClass("ActiveSelection"))([],{canvas:this});l.multiSelectAdd(i,e),this._hoveredTarget=l,this._setActiveObject(l,t),this._fireSelectionEvents([i],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:i,deltaX:r,deltaY:l}=this._groupSelector,c=new P(e,i),h=c.add(new P(r,l)),f=c.min(h),d=c.max(h).subtract(f),p=this.collectObjects({left:f.x,top:f.y,width:d.x,height:d.y},{includeIntersecting:!this.selectionFullyContained}),_=c.eq(h)?p[0]?[p[0]]:[]:p.length>1?p.filter((v=>!v.onSelect({e:t}))).reverse():p;if(_.length===1)this.setActiveObject(_[0],t);else if(_.length>1){const v=it.getClass("ActiveSelection");this.setActiveObject(new v(_,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const g1={x1:0,y1:0,x2:0,y2:0},ER=M(M({},g1),{},{r1:0,r2:0}),ea=(a,t)=>isNaN(a)&&typeof t=="number"?t:a,OR=/^(\d+\.\d+)%|(\d+)%$/;function m1(a){return a&&OR.test(a)}function p1(a,t){const e=typeof a=="number"?a:typeof a=="string"?parseFloat(a)/(m1(a)?100:1):NaN;return ma(0,ea(e,t),1)}const DR=/\s*;\s*/,AR=/\s*:\s*/;function MR(a,t){let e,i;const r=a.getAttribute("style");if(r){const c=r.split(DR);c[c.length-1]===""&&c.pop();for(let h=c.length;h--;){const[f,d]=c[h].split(AR).map((p=>p.trim()));f==="stop-color"?e=d:f==="stop-opacity"&&(i=d)}}const l=new Pt(e||a.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:p1(a.getAttribute("offset"),0),color:l.toRgb(),opacity:ea(parseFloat(i||a.getAttribute("stop-opacity")||""),1)*l.getAlpha()*t}}function RR(a,t){const e=[],i=a.getElementsByTagName("stop"),r=p1(t,1);for(let l=i.length;l--;)e.push(MR(i[l],r));return e}function _1(a){return a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?"linear":"radial"}function v1(a){return a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function In(a,t){return a.getAttribute(t)}function NR(a,t){return(function(e,i){let r,{width:l,height:c,gradientUnits:h}=i;return Object.keys(e).reduce(((f,d)=>{const p=e[d];return p==="Infinity"?r=1:p==="-Infinity"?r=0:(r=typeof p=="string"?parseFloat(p):p,typeof p=="string"&&m1(p)&&(r*=.01,h==="pixels"&&(d!=="x1"&&d!=="x2"&&d!=="r2"||(r*=l),d!=="y1"&&d!=="y2"||(r*=c)))),f[d]=r,f}),{})})(_1(a)==="linear"?(function(e){return{x1:In(e,"x1")||0,y1:In(e,"y1")||0,x2:In(e,"x2")||"100%",y2:In(e,"y2")||0}})(a):(function(e){return{x1:In(e,"fx")||In(e,"cx")||"50%",y1:In(e,"fy")||In(e,"cy")||"50%",r1:0,x2:In(e,"cx")||"50%",y2:In(e,"cy")||"50%",r2:In(e,"r")||"50%"}})(a),M(M({},t),{},{gradientUnits:v1(a)}))}class Bc{constructor(t){const{type:e="linear",gradientUnits:i="pixels",coords:r={},colorStops:l=[],offsetX:c=0,offsetY:h=0,gradientTransform:f,id:d}=t||{};Object.assign(this,{type:e,gradientUnits:i,coords:M(M({},e==="radial"?ER:g1),r),colorStops:l,offsetX:c,offsetY:h,gradientTransform:f,id:d?"".concat(d,"_").concat(ws()):ws()})}addColorStop(t){for(const e in t){const i=new Pt(t[e]);this.colorStops.push({offset:parseFloat(e),color:i.toRgb(),opacity:i.getAlpha()})}return this}toObject(t){return M(M({},Ta(this,t)),{},{type:this.type,coords:M({},this.coords),colorStops:this.colorStops.map((e=>M({},e))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=[],r=this.gradientTransform?this.gradientTransform.concat():Ge.concat(),l=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",c=this.colorStops.map((_=>M({},_))).sort(((_,v)=>_.offset-v.offset));let h=-this.offsetX,f=-this.offsetY;var d;l==="objectBoundingBox"?(h/=t.width,f/=t.height):(h+=t.width/2,f+=t.height/2),(d=t)&&typeof d._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(h-=t.pathOffset.x,f-=t.pathOffset.y),r[4]-=h,r[5]-=f;const p=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(l,'"'),'gradientTransform="'.concat(e?e+" ":"").concat($o(r),'"'),""].join(" ");if(this.type==="linear"){const{x1:_,y1:v,x2:S,y2:b}=this.coords;i.push("<linearGradient ",p,' x1="',_,'" y1="',v,'" x2="',S,'" y2="',b,`">
`)}else if(this.type==="radial"){const{x1:_,y1:v,x2:S,y2:b,r1:T,r2:w}=this.coords,N=T>w;i.push("<radialGradient ",p,' cx="',N?_:S,'" cy="',N?v:b,'" r="',N?T:w,'" fx="',N?S:_,'" fy="',N?b:v,`">
`),N&&(c.reverse(),c.forEach((j=>{j.offset=1-j.offset})));const I=Math.min(T,w);if(I>0){const j=I/Math.max(T,w);c.forEach((Y=>{Y.offset+=j*(1-Y.offset)}))}}return c.forEach((_=>{let{color:v,offset:S,opacity:b}=_;i.push("<stop ",'offset="',100*S+"%",'" style="stop-color:',v,b!==void 0?";stop-opacity: "+b:";",`"/>
`)})),i.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),i.join("")}toLive(t){const{x1:e,y1:i,x2:r,y2:l,r1:c,r2:h}=this.coords,f=this.type==="linear"?t.createLinearGradient(e,i,r,l):t.createRadialGradient(e,i,c,r,l,h);return this.colorStops.forEach((d=>{let{color:p,opacity:_,offset:v}=d;f.addColorStop(v,_!==void 0?new Pt(p).setAlpha(_).toRgba():p)})),f}static async fromObject(t){const{colorStops:e,gradientTransform:i}=t;return new this(M(M({},t),{},{colorStops:e?e.map((r=>M({},r))):void 0,gradientTransform:i?[...i]:void 0}))}static fromElement(t,e,i){const r=v1(t),l=e._findCenterFromElement();return new this(M({id:t.getAttribute("id")||void 0,type:_1(t),coords:NR(t,{width:i.viewBoxWidth||i.width,height:i.viewBoxHeight||i.height}),colorStops:RR(t,i.opacity),gradientUnits:r,gradientTransform:Bg(t.getAttribute("gradientTransform")||"")},r==="pixels"?{offsetX:e.width/2-l.x,offsetY:e.height/2-l.y}:{offsetX:0,offsetY:0}))}}A(Bc,"type","Gradient"),it.setClass(Bc,"gradient"),it.setClass(Bc,"linear"),it.setClass(Bc,"radial");const jR=["type","source","patternTransform"];class tg{get type(){return"pattern"}set type(t){Ts("warn","Setting type has no effect",t)}constructor(t){A(this,"repeat","repeat"),A(this,"offsetX",0),A(this,"offsetY",0),A(this,"crossOrigin",""),this.id=ws(),Object.assign(this,t)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:e,crossOrigin:i}=this;return M(M({},Ta(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:i,offsetX:Kt(this.offsetX,jt.NUM_FRACTION_DIGITS),offsetY:Kt(this.offsetY,jt.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:i}=t;const{source:r,repeat:l,id:c}=this,h=ea(this.offsetX/e,0),f=ea(this.offsetY/i,0),d=l==="repeat-y"||l==="no-repeat"?1+Math.abs(h||0):ea(r.width/e,0),p=l==="repeat-x"||l==="no-repeat"?1+Math.abs(f||0):ea(r.height/i,0);return['<pattern id="SVGID_'.concat(c,'" x="').concat(h,'" y="').concat(f,'" width="').concat(d,'" height="').concat(p,'">'),'<image x="0" y="0" width="'.concat(r.width,'" height="').concat(r.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(t,e){let{type:i,source:r,patternTransform:l}=t,c=ee(t,jR);const h=await cu(r,M(M({},e),{},{crossOrigin:c.crossOrigin}));return new this(M(M({},c),{},{patternTransform:l&&l.slice(0),source:h}))}}A(tg,"type","Pattern"),it.setClass(tg),it.setClass(tg,"pattern");const kR=["path","left","top"],LR=["d"];class ms extends Fe{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:i,left:r,top:l}=e,c=ee(e,kR);super(),Object.assign(this,ms.ownDefaults),this.setOptions(c),this._setPath(t||[],!0),typeof r=="number"&&this.set(It,r),typeof l=="number"&&this.set(nn,l)}_setPath(t,e){this.path=hR(Array.isArray(t)?t:SR(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new P(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,i=-this.pathOffset.y;t.beginPath();for(const r of this.path)switch(r[0]){case"L":t.lineTo(r[1]+e,r[2]+i);break;case"M":t.moveTo(r[1]+e,r[2]+i);break;case"C":t.bezierCurveTo(r[1]+e,r[2]+i,r[3]+e,r[4]+i,r[5]+e,r[6]+i);break;case"Q":t.quadraticCurveTo(r[1]+e,r[2]+i,r[3]+e,r[4]+i);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return M(M({},super.toObject(t)),{},{path:this.path.map((e=>e.slice()))})}toDatalessObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=bR(this.path,jt.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const t=jt.NUM_FRACTION_DIGITS;return" translate(".concat(Kt(-this.pathOffset.x,t),", ").concat(Kt(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:i,pathOffset:r}=this._calcDimensions();this.set({width:e,height:i,pathOffset:r}),t&&this.setPositionByOrigin(r,Ct,Ct)}_calcBoundsFromPath(){const t=[];let e=0,i=0,r=0,l=0;for(const c of this.path)switch(c[0]){case"L":r=c[1],l=c[2],t.push({x:e,y:i},{x:r,y:l});break;case"M":r=c[1],l=c[2],e=r,i=l;break;case"C":t.push(...OS(r,l,c[1],c[2],c[3],c[4],c[5],c[6])),r=c[5],l=c[6];break;case"Q":t.push(...OS(r,l,c[1],c[2],c[1],c[2],c[3],c[4])),r=c[3],l=c[4];break;case"Z":r=e,l=i}return Ri(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return M(M({},t),{},{pathOffset:new P(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,i){const r=Pi(t,this.ATTRIBUTE_NAMES,i),{d:l}=r;return new this(l,M(M(M({},ee(r,LR)),e),{},{left:void 0,top:void 0}))}}A(ms,"type","Path"),A(ms,"cacheProperties",[...Ui,"path","fillRule"]),A(ms,"ATTRIBUTE_NAMES",[...Es,"d"]),it.setClass(ms),it.setSVGClass(ms);const zR=["left","top","radius"],y1=["radius","startAngle","endAngle","counterClockwise"];class Ti extends Fe{static getDefaults(){return M(M({},super.getDefaults()),Ti.ownDefaults)}constructor(t){super(),Object.assign(this,Ti.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),t==="radius"&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,de(this.startAngle),de(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(an)}getRadiusY(){return this.get("radius")*this.get(jn)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...y1,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(t===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:e}=this,i=de(this.startAngle),r=de(this.endAngle),l=Li(i)*e,c=zi(i)*e,h=Li(r)*e,f=zi(r)*e,d=t>180?1:0,p=this.counterClockwise?0:1;return['<path d="M '.concat(l," ").concat(c," A ").concat(e," ").concat(e," 0 ").concat(d," ").concat(p," ").concat(h," ").concat(f,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(t,e,i){const r=Pi(t,this.ATTRIBUTE_NAMES,i),{left:l=0,top:c=0,radius:h=0}=r;return new this(M(M({},ee(r,zR)),{},{radius:h,left:l-h,top:c-h}))}static fromObject(t){return super._fromObject(t)}}A(Ti,"type","Circle"),A(Ti,"cacheProperties",[...Ui,...y1]),A(Ti,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),A(Ti,"ATTRIBUTE_NAMES",["cx","cy","r",...Es]),it.setClass(Ti),it.setSVGClass(Ti);const BR=["x1","y1","x2","y2"],IR=["x1","y1","x2","y2"],Hg=["x1","x2","y1","y2"];class Qs extends Fe{constructor(){let[t,e,i,r]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Qs.ownDefaults),this.setOptions(l),this.x1=t,this.x2=i,this.y1=e,this.y2=r,this._setWidthHeight();const{left:c,top:h}=l;typeof c=="number"&&this.set(It,c),typeof h=="number"&&this.set(nn,h)}_setWidthHeight(){const{x1:t,y1:e,x2:i,y2:r}=this;this.width=Math.abs(i-t),this.height=Math.abs(r-e);const{left:l,top:c,width:h,height:f}=Ri([{x:t,y:e},{x:i,y:r}]),d=new P(l+h/2,c+f/2);this.setPositionByOrigin(d,Ct,Ct)}_set(t,e){return super._set(t,e),Hg.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const i=t.strokeStyle;var r;Mn(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=(r=this.stroke)!==null&&r!==void 0?r:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=i}_findCenterFromElement(){return new P((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return M(M({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(t.y-=this.strokeWidth),this.height===0&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:i,y2:r,width:l,height:c}=this,h=t<=e?-1:1,f=i<=r?-1:1;return{x1:h*l/2,x2:h*-l/2,y1:f*c/2,y2:f*-c/2}}_toSVG(){const{x1:t,x2:e,y1:i,y2:r}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(i,'" x2="').concat(e,'" y2="').concat(r,`" />
`)]}static async fromElement(t,e,i){const r=Pi(t,this.ATTRIBUTE_NAMES,i),{x1:l=0,y1:c=0,x2:h=0,y2:f=0}=r;return new this([l,c,h,f],ee(r,BR))}static fromObject(t){let{x1:e,y1:i,x2:r,y2:l}=t,c=ee(t,IR);return this._fromObject(M(M({},c),{},{points:[e,i,r,l]}),{extraParam:"points"})}}A(Qs,"type","Line"),A(Qs,"cacheProperties",[...Ui,...Hg]),A(Qs,"ATTRIBUTE_NAMES",Es.concat(Hg)),it.setClass(Qs),it.setSVGClass(Qs);class Zs extends Fe{static getDefaults(){return M(M({},super.getDefaults()),Zs.ownDefaults)}constructor(t){super(),Object.assign(this,Zs.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}A(Zs,"type","Triangle"),A(Zs,"ownDefaults",{width:100,height:100}),it.setClass(Zs),it.setSVGClass(Zs);const S1=["rx","ry"];class wi extends Fe{static getDefaults(){return M(M({},super.getDefaults()),wi.ownDefaults)}constructor(t){super(),Object.assign(this,wi.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(an)}getRy(){return this.get("ry")*this.get(jn)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...S1,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,Mu,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,i){const r=Pi(t,this.ATTRIBUTE_NAMES,i);return r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,new this(r)}}function FR(a){if(!a)return[];const t=a.replace(/,/g," ").trim().split(/\s+/),e=[];for(let i=0;i<t.length;i+=2)e.push({x:parseFloat(t[i]),y:parseFloat(t[i+1])});return e}A(wi,"type","Ellipse"),A(wi,"cacheProperties",[...Ui,...S1]),A(wi,"ownDefaults",{rx:0,ry:0}),A(wi,"ATTRIBUTE_NAMES",[...Es,"cx","cy","rx","ry"]),it.setClass(wi),it.setSVGClass(wi);const UR=["left","top"],b1={exactBoundingBox:!1};class Un extends Fe{static getDefaults(){return M(M({},super.getDefaults()),Un.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),A(this,"strokeDiff",void 0),Object.assign(this,Un.ownDefaults),this.setOptions(e),this.points=t;const{left:i,top:r}=e;this.initialized=!0,this.setBoundingBox(!0),typeof i=="number"&&this.set(It,i),typeof r=="number"&&this.set(nn,r)}isOpen(){return!0}_projectStrokeOnPoints(t){return DM(this.points,t,this.isOpen())}_calcDimensions(t){t=M({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map((d=>d.projectedPoint)):this.points;if(e.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new P,strokeOffset:new P,strokeDiff:new P};const i=Ri(e),r=ih(M(M({},t),{},{scaleX:1,scaleY:1})),l=Ri(this.points.map((d=>tn(d,r,!0)))),c=new P(this.scaleX,this.scaleY);let h=i.left+i.width/2,f=i.top+i.height/2;return this.exactBoundingBox&&(h-=f*Math.tan(de(this.skewX)),f-=h*Math.tan(de(this.skewY))),M(M({},i),{},{pathOffset:new P(h,f),strokeOffset:new P(l.left,l.top).subtract(new P(i.left,i.top)).multiply(c),strokeDiff:new P(i.width,i.height).subtract(new P(l.width,l.height)).multiply(c)})}_findCenterFromElement(){const t=Ri(this.points);return new P(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:i,width:r,height:l,pathOffset:c,strokeOffset:h,strokeDiff:f}=this._calcDimensions();this.set({width:r,height:l,pathOffset:c,strokeOffset:h,strokeDiff:f}),t&&this.setPositionByOrigin(new P(e+r/2,i+l/2),Ct,Ct)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new P(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let c;if(Object.keys(t).some((h=>this.strokeUniform||this.constructor.layoutProperties.includes(h)))){var e,i;const{width:h,height:f}=this._calcDimensions(t);c=new P((e=t.width)!==null&&e!==void 0?e:h,(i=t.height)!==null&&i!==void 0?i:f)}else{var r,l;c=new P((r=t.width)!==null&&r!==void 0?r:this.width,(l=t.height)!==null&&l!==void 0?l:this.height)}return c.multiply(new P(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const i=this.initialized&&this[t]!==e,r=super._set(t,e);return this.exactBoundingBox&&i&&((t===an||t===jn)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),r}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return M(M({},super.toObject(t)),{},{points:this.points.map((e=>{let{x:i,y:r}=e;return{x:i,y:r}}))})}_toSVG(){const t=[],e=this.pathOffset.x,i=this.pathOffset.y,r=jt.NUM_FRACTION_DIGITS;for(let l=0,c=this.points.length;l<c;l++)t.push(Kt(this.points[l].x-e,r),",",Kt(this.points[l].y-i,r)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),`" />
`)]}_render(t){const e=this.points.length,i=this.pathOffset.x,r=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-i,this.points[0].y-r);for(let l=0;l<e;l++){const c=this.points[l];t.lineTo(c.x-i,c.y-r)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,i){return new this(FR(t.getAttribute("points")),M(M({},ee(Pi(t,this.ATTRIBUTE_NAMES,i),UR)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}A(Un,"ownDefaults",b1),A(Un,"type","Polyline"),A(Un,"layoutProperties",[ba,Ca,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),A(Un,"cacheProperties",[...Ui,"points"]),A(Un,"ATTRIBUTE_NAMES",[...Es]),it.setClass(Un),it.setSVGClass(Un);class Ic extends Un{isOpen(){return!1}}A(Ic,"ownDefaults",b1),A(Ic,"type","Polygon"),it.setClass(Ic),it.setSVGClass(Ic);class C1 extends Fe{isEmptyStyles(t){if(!this.styles||t!==void 0&&!this.styles[t])return!0;const e=t===void 0?this.styles:{line:this.styles[t]};for(const i in e)for(const r in e[i])for(const l in e[i][r])return!1;return!0}styleHas(t,e){if(!this.styles||e!==void 0&&!this.styles[e])return!1;const i=e===void 0?this.styles:{0:this.styles[e]};for(const r in i)for(const l in i[r])if(i[r][l][t]!==void 0)return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let i,r,l=0,c=!0,h=0;for(const f in e){i=0;for(const d in e[f]){const p=e[f][d]||{};l++,p[t]!==void 0?(r?p[t]!==r&&(c=!1):r=p[t],p[t]===this[t]&&delete p[t]):c=!1,Object.keys(p).length!==0?i++:delete e[f][d]}i===0&&delete e[f]}for(let f=0;f<this._textLines.length;f++)h+=this._textLines[f].length;c&&l===h&&(this[t]=r,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let i,r,l;for(r in e){for(l in i=e[r],i)delete i[l][t],Object.keys(i[l]).length===0&&delete i[l];Object.keys(i).length===0&&delete e[r]}}_extendStyles(t,e){const{lineIndex:i,charIndex:r}=this.get2DCursorLocation(t);this._getLineStyle(i)||this._setLineStyle(i);const l=jm(M(M({},this._getStyleDeclaration(i,r)),e),(c=>c!==void 0));this._setStyleDeclaration(i,r,l)}getSelectionStyles(t,e,i){const r=[];for(let l=t;l<(e||t);l++)r.push(this.getStyleAtPosition(l,i));return r}getStyleAtPosition(t,e){const{lineIndex:i,charIndex:r}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(i,r):this._getStyleDeclaration(i,r)}setSelectionStyles(t,e,i){for(let r=e;r<(i||e);r++)this._extendStyles(r,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var i;const r=this.styles&&this.styles[t];return r&&(i=r[e])!==null&&i!==void 0?i:{}}getCompleteStyleDeclaration(t,e){return M(M({},Ta(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,i){this.styles[t][e]=i}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}A(C1,"_styleProperties",VA);const PR=/  +/g,HR=/"/g;function eg(a,t,e,i,r){return"		".concat((function(l,c){let{left:h,top:f,width:d,height:p}=c,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:jt.NUM_FRACTION_DIGITS;const v=tl(xe,l,!1),[S,b,T,w]=[h,f,d,p].map((N=>Kt(N,_)));return"<rect ".concat(v,' x="').concat(S,'" y="').concat(b,'" width="').concat(T,'" height="').concat(w,'"></rect>')})(a,{left:t,top:e,width:i,height:r}),`
`)}const YR=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let ng;class Pe extends C1{static getDefaults(){return M(M({},super.getDefaults()),Pe.ownDefaults)}constructor(t,e){super(),A(this,"__charBounds",[]),Object.assign(this,Pe.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=d1(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(ti)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,i,r,l,c,h;for(let f=0,d=this._textLines.length;f<d;f++)if((this.textAlign===ti||f!==d-1&&!this.isEndOfWrapping(f))&&(r=0,l=this._textLines[f],e=this.getLineWidth(f),e<this.width&&(h=this.textLines[f].match(this._reSpacesAndTabs)))){i=h.length,t=(this.width-e)/i;for(let p=0;p<=l.length;p++)c=this.__charBounds[f][p],this._reSpaceAndTab.test(l[p])?(c.width+=t,c.kernedWidth+=t,c.left+=r,r+=t):c.left+=r}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const i=e?this._unwrappedTextLines:this._textLines;let r;for(r=0;r<i.length;r++){if(t<=i[r].length)return{lineIndex:r,charIndex:t};t-=i[r].length+this.missingNewlineOffset(r,e)}return{lineIndex:r-1,charIndex:i[r-1].length<t?i[r-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===rn?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,i){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case Ct:t.textBaseline="middle";break;case"ascender":t.textBaseline=nn;break;case"descender":t.textBaseline=Rg}t.font=this._getFontDeclaration(e,i)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,i=this._textLines.length;e<i;e++){const r=this.getLineWidth(e);r>t&&(t=r)}return t}_renderTextLine(t,e,i,r,l,c){this._renderChars(t,e,i,r,l,c)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,i=this._getLeftOffset();let r=this._getTopOffset();for(let l=0,c=this._textLines.length;l<c;l++){const h=this.getHeightOfLine(l);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",l)){r+=h;continue}const f=this._textLines[l].length,d=this._getLineLeftOffset(l);let p,_,v=0,S=0,b=this.getValueOfPropertyAt(l,0,"textBackgroundColor");for(let T=0;T<f;T++){const w=this.__charBounds[l][T];_=this.getValueOfPropertyAt(l,T,"textBackgroundColor"),this.path?(t.save(),t.translate(w.renderLeft,w.renderTop),t.rotate(w.angle),t.fillStyle=_,_&&t.fillRect(-w.width/2,-h/this.lineHeight*(1-this._fontSizeFraction),w.width,h/this.lineHeight),t.restore()):_!==b?(p=i+d+S,this.direction==="rtl"&&(p=this.width-p-v),t.fillStyle=b,b&&t.fillRect(p,r,v,h/this.lineHeight),S=w.left,v=w.width,b=_):v+=w.kernedWidth}_&&!this.path&&(p=i+d+S,this.direction==="rtl"&&(p=this.width-p-v),t.fillStyle=_,t.fillRect(p,r,v,h/this.lineHeight)),r+=h}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,i,r){const l=Lo.getFontCache(e),c=this._getFontDeclaration(e),h=i+t,f=i&&c===this._getFontDeclaration(r),d=e.fontSize/this.CACHE_FONT_SIZE;let p,_,v,S;if(i&&l[i]!==void 0&&(v=l[i]),l[t]!==void 0&&(S=p=l[t]),f&&l[h]!==void 0&&(_=l[h],S=_-v),p===void 0||v===void 0||_===void 0){const b=(function(){return ng||(ng=kn({width:0,height:0}).getContext("2d")),ng})();this._setTextStyles(b,e,!0),p===void 0&&(S=p=b.measureText(t).width,l[t]=p),v===void 0&&f&&i&&(v=b.measureText(i).width,l[i]=v),f&&_===void 0&&(_=b.measureText(h).width,l[h]=_,S=_-v)}return{width:p*d,kernedWidth:S*d}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return this.charSpacing!==0&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,i,r=0;const l=this.pathSide===fe,c=this.path,h=this._textLines[t],f=h.length,d=new Array(f);this.__charBounds[t]=d;for(let p=0;p<f;p++){const _=h[p];i=this._getGraphemeBox(_,t,p,e),d[p]=i,r+=i.kernedWidth,e=_}if(d[f]={left:i?i.left+i.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},c&&c.segmentsInfo){let p=0;const _=c.segmentsInfo[c.segmentsInfo.length-1].length;switch(this.textAlign){case It:p=l?_-r:0;break;case Ct:p=(_-r)/2;break;case fe:p=l?0:_-r}p+=this.pathStartOffset*(l?-1:1);for(let v=l?f-1:0;l?v>=0:v<f;l?v--:v++)i=d[v],p>_?p%=_:p<0&&(p+=_),this._setGraphemeOnPath(p,i),p+=i.kernedWidth}return{width:r,numOfSpaces:0}}_setGraphemeOnPath(t,e){const i=t+e.kernedWidth/2,r=this.path,l=pR(r.path,i,r.segmentsInfo);e.renderLeft=l.x-r.pathOffset.x,e.renderTop=l.y-r.pathOffset.y,e.angle=l.angle+(this.pathSide===fe?Math.PI:0)}_getGraphemeBox(t,e,i,r,l){const c=this.getCompleteStyleDeclaration(e,i),h=r?this.getCompleteStyleDeclaration(e,i-1):{},f=this._measureChar(t,c,r,h);let d,p=f.kernedWidth,_=f.width;this.charSpacing!==0&&(d=this._getWidthOfCharSpacing(),_+=d,p+=d);const v={width:_,left:0,height:c.fontSize,kernedWidth:p,deltaY:c.deltaY};if(i>0&&!l){const S=this.__charBounds[e][i-1];v.left=S.left+S.width+f.kernedWidth-f.width}return v}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let i=1,r=this._textLines[t].length;i<r;i++)e=Math.max(this.getHeightOfChar(t,i),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let i=0,r=this._textLines.length;i<r;i++)t=this.getHeightOfLine(i),e+=i===r-1?t/this.lineHeight:t;return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let i=0;const r=this._getLeftOffset(),l=this._getTopOffset();for(let c=0,h=this._textLines.length;c<h;c++){const f=this.getHeightOfLine(c),d=f/this.lineHeight,p=this._getLineLeftOffset(c);this._renderTextLine(e,t,this._textLines[c],r+p,l+i+d,c),i+=f}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(xe))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,i,r,l,c){const h=this.getHeightOfLine(c),f=this.textAlign.includes(ti),d=this.path,p=!f&&this.charSpacing===0&&this.isEmptyStyles(c)&&!d,_=this.direction==="ltr",v=this.direction==="ltr"?1:-1,S=e.direction;let b,T,w,N,I,j="",Y=0;if(e.save(),S!==this.direction&&(e.canvas.setAttribute("dir",_?"ltr":"rtl"),e.direction=_?"ltr":"rtl",e.textAlign=_?It:fe),l-=h*this._fontSizeFraction/this.lineHeight,p)return this._renderChar(t,e,c,0,i.join(""),r,l),void e.restore();for(let B=0,K=i.length-1;B<=K;B++)N=B===K||this.charSpacing||d,j+=i[B],w=this.__charBounds[c][B],Y===0?(r+=v*(w.kernedWidth-w.width),Y+=w.width):Y+=w.kernedWidth,f&&!N&&this._reSpaceAndTab.test(i[B])&&(N=!0),N||(b=b||this.getCompleteStyleDeclaration(c,B),T=this.getCompleteStyleDeclaration(c,B+1),N=Pm(b,T,!1)),N&&(d?(e.save(),e.translate(w.renderLeft,w.renderTop),e.rotate(w.angle),this._renderChar(t,e,c,B,j,-Y/2,0),e.restore()):(I=r,this._renderChar(t,e,c,B,j,I,l)),j="",b=T,r+=v*Y,Y=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,i=this.height+this.strokeWidth,r=kn({width:e,height:i}),l=r.getContext("2d");return r.width=e,r.height=i,l.beginPath(),l.moveTo(0,0),l.lineTo(e,0),l.lineTo(e,i),l.lineTo(0,i),l.closePath(),l.translate(e/2,i/2),l.fillStyle=t.toLive(l),this._applyPatternGradientTransform(l,t),l.fill(),l.createPattern(r,"no-repeat")}handleFiller(t,e,i){let r,l;return Mn(i)?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(r=-this.width/2,l=-this.height/2,t.translate(r,l),t[e]=this._applyPatternGradientTransformText(i),{offsetX:r,offsetY:l}):(t[e]=i.toLive(t),this._applyPatternGradientTransform(t,i)):(t[e]=i,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:i,strokeWidth:r}=e;return t.lineWidth=r,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",i)}_setFillStyles(t,e){let{fill:i}=e;return this.handleFiller(t,"fillStyle",i)}_renderChar(t,e,i,r,l,c,h){const f=this._getStyleDeclaration(i,r),d=this.getCompleteStyleDeclaration(i,r),p=t==="fillText"&&d.fill,_=t==="strokeText"&&d.stroke&&d.strokeWidth;if(_||p){if(e.save(),e.font=this._getFontDeclaration(d),f.textBackgroundColor&&this._removeShadow(e),f.deltaY&&(h+=f.deltaY),p){const v=this._setFillStyles(e,d);e.fillText(l,c-v.offsetX,h-v.offsetY)}if(_){const v=this._setStrokeStyles(e,d);e.strokeText(l,c-v.offsetX,h-v.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,i){const r=this.get2DCursorLocation(t,!0),l=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),c=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),h={fontSize:l*i.size,deltaY:c+l*i.baseline};this.setSelectionStyles(h,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),i=this.width-e,r=this.textAlign,l=this.direction,c=this.isEndOfWrapping(t);let h=0;return r===ti||r===Bo&&!c||r===zo&&!c||r===Bu&&!c?0:(r===Ct&&(h=i/2),r===fe&&(h=i),r===Bo&&(h=i/2),r===zo&&(h=i),l==="rtl"&&(r===fe||r===ti||r===zo?h=0:r===It||r===Bu?h=-i:r!==Ct&&r!==Bo||(h=-i/2)),h)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,i){var r;return(r=this._getStyleDeclaration(t,e)[i])!==null&&r!==void 0?r:this[i]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let i=this._getTopOffset();const r=this._getLeftOffset(),l=this.path,c=this._getWidthOfCharSpacing(),h=e==="linethrough"?.5:e==="overline"?1:0,f=this.offsets[e];for(let d=0,p=this._textLines.length;d<p;d++){const _=this.getHeightOfLine(d);if(!this[e]&&!this.styleHas(e,d)){i+=_;continue}const v=this._textLines[d],S=_/this.lineHeight,b=this._getLineLeftOffset(d);let T=0,w=0,N=this.getValueOfPropertyAt(d,0,e),I=this.getValueOfPropertyAt(d,0,xe),j=this.getValueOfPropertyAt(d,0,rr),Y=N,B=I,K=j;const F=i+S*(1-this._fontSizeFraction);let Q=this.getHeightOfChar(d,0),Z=this.getValueOfPropertyAt(d,0,"deltaY");for(let rt=0,ft=v.length;rt<ft;rt++){const ct=this.__charBounds[d][rt];Y=this.getValueOfPropertyAt(d,rt,e),B=this.getValueOfPropertyAt(d,rt,xe),K=this.getValueOfPropertyAt(d,rt,rr);const vt=this.getHeightOfChar(d,rt),U=this.getValueOfPropertyAt(d,rt,"deltaY");if(l&&Y&&B){const W=this.fontSize*K/1e3;t.save(),t.fillStyle=I,t.translate(ct.renderLeft,ct.renderTop),t.rotate(ct.angle),t.fillRect(-ct.kernedWidth/2,f*vt+U-h*W,ct.kernedWidth,W),t.restore()}else if((Y!==N||B!==I||vt!==Q||K!==j||U!==Z)&&w>0){const W=this.fontSize*j/1e3;let tt=r+b+T;this.direction==="rtl"&&(tt=this.width-tt-w),N&&I&&j&&(t.fillStyle=I,t.fillRect(tt,F+f*Q+Z-h*W,w,W)),T=ct.left,w=ct.width,N=Y,j=K,I=B,Q=vt,Z=U}else w+=ct.kernedWidth}let nt=r+b+T;this.direction==="rtl"&&(nt=this.width-nt-w),t.fillStyle=B;const ot=this.fontSize*K/1e3;Y&&B&&K&&t.fillRect(nt,F+f*Q+Z-h*ot,w-c,ot),i+=_}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:i=this.fontWeight,fontSize:r=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0;const c=t.includes("'")||t.includes('"')||t.includes(",")||Pe.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,i,"".concat(l?this.CACHE_FONT_SIZE:r,"px"),c].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return Um(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),i=new Array(e.length),r=[`
`];let l=[];for(let c=0;c<e.length;c++)i[c]=this.graphemeSplit(e[c]),l=l.concat(i[c],r);return l.pop(),{_unwrappedLines:i,lines:e,graphemeText:l,graphemeLines:i}}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return M(M({},super.toObject([...QC,...t])),{},{styles:NM(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:i}=this.constructor;super.set(t,e);let r=!1,l=!1;if(typeof t=="object")for(const c in t)c==="path"&&this.setPathInfo(),r=r||i.includes(c),l=l||c==="path";else r=i.includes(t),l=t==="path";return l&&this.setPathInfo(),r&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,i){const r=Pi(t,Pe.ATTRIBUTE_NAMES,i),l=M(M({},e),r),{textAnchor:c=It,textDecoration:h="",dx:f=0,dy:d=0,top:p=0,left:_=0,fontSize:v=Om,strokeWidth:S=1}=l,b=ee(l,YR),T=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),M({left:_+f,top:p+d,underline:h.includes("underline"),overline:h.includes("overline"),linethrough:h.includes("line-through"),strokeWidth:0,fontSize:v},b)),w=T.getScaledHeight()/T.height,N=((T.height+T.strokeWidth)*T.lineHeight-T.height)*w,I=T.getScaledHeight()+N;let j=0;return c===Ct&&(j=T.getScaledWidth()/2),c===fe&&(j=T.getScaledWidth()),T.set({left:T.left-j,top:T.top-(I-T.fontSize*(.07+T._fontSizeFraction))/T.lineHeight,strokeWidth:S}),T}static fromObject(t){return this._fromObject(M(M({},t),{},{styles:jM(t.styles||{},t.text)}),{extraParam:"text"})}}A(Pe,"textLayoutProperties",WC),A(Pe,"cacheProperties",[...Ui,...QC]),A(Pe,"ownDefaults",GA),A(Pe,"type","Text"),A(Pe,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),A(Pe,"ATTRIBUTE_NAMES",Es.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),s1(Pe,[class extends GC{_toSVG(){const a=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(t)}toSVG(a){const t=this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0}),e=this.path;return e?t+e._createBaseSVGMarkup(e._toSVG(),{reviver:a,withShadow:!0,additionalTransform:$o(this.calcOwnMatrix())}):t}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(a){let{textBgRects:t,textSpans:e}=a;const i=this.getSvgTextDecoration(this);return[t.join(""),'		<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(HR,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",i?'text-decoration="'.concat(i,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.join(""),`</text>
`]}_getSVGTextAndBg(a,t){const e=[],i=[];let r,l=a;this.backgroundColor&&i.push(...eg(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let c=0,h=this._textLines.length;c<h;c++)r=this._getLineLeftOffset(c),this.direction==="rtl"&&(r+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",c))&&this._setSVGTextLineBg(i,c,t+r,l),this._setSVGTextLineText(e,c,t+r,l),l+=this.getHeightOfLine(c);return{textSpans:e,textBgRects:i}}_createTextCharSpan(a,t,e,i,r){const l=jt.NUM_FRACTION_DIGITS,c=this.getSvgSpanStyles(t,a!==a.trim()||!!a.match(PR)),h=c?'style="'.concat(c,'"'):"",f=t.deltaY,d=f?' dy="'.concat(Kt(f,l),'" '):"",{angle:p,renderLeft:_,renderTop:v,width:S}=r;let b="";if(_!==void 0){const T=S/2;p&&(b=' rotate="'.concat(Kt(Ii(p),l),'"'));const w=xa({angle:Ii(p)});w[4]=_,w[5]=v;const N=new P(-T,0).transform(w);e=N.x,i=N.y}return'<tspan x="'.concat(Kt(e,l),'" y="').concat(Kt(i,l),'" ').concat(d).concat(b).concat(h,">").concat(AM(a),"</tspan>")}_setSVGTextLineText(a,t,e,i){const r=this.getHeightOfLine(t),l=this.textAlign.includes(ti),c=this._textLines[t];let h,f,d,p,_,v="",S=0;i+=r*(1-this._fontSizeFraction)/this.lineHeight;for(let b=0,T=c.length-1;b<=T;b++)_=b===T||this.charSpacing||this.path,v+=c[b],d=this.__charBounds[t][b],S===0?(e+=d.kernedWidth-d.width,S+=d.width):S+=d.kernedWidth,l&&!_&&this._reSpaceAndTab.test(c[b])&&(_=!0),_||(h=h||this.getCompleteStyleDeclaration(t,b),f=this.getCompleteStyleDeclaration(t,b+1),_=Pm(h,f,!0)),_&&(p=this._getStyleDeclaration(t,b),a.push(this._createTextCharSpan(v,p,e,i,d)),v="",h=f,this.direction==="rtl"?e-=S:e+=S,S=0)}_setSVGTextLineBg(a,t,e,i){const r=this._textLines[t],l=this.getHeightOfLine(t)/this.lineHeight;let c,h=0,f=0,d=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(let p=0;p<r.length;p++){const{left:_,width:v,kernedWidth:S}=this.__charBounds[t][p];c=this.getValueOfPropertyAt(t,p,"textBackgroundColor"),c!==d?(d&&a.push(...eg(d,e+f,i,h,l)),f=_,h=v,d=c):h+=S}c&&a.push(...eg(d,e+f,i,h,l))}_getSVGLineTopOffset(a){let t,e=0;for(t=0;t<a;t++)e+=this.getHeightOfLine(t);const i=this.getHeightOfLine(t);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*i/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(a){return"".concat(super.getSvgStyles(a)," text-decoration-thickness: ").concat(Kt(this.textDecorationThickness*this.getObjectScaling().y/10,jt.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(a,t){const{fontFamily:e,strokeWidth:i,stroke:r,fill:l,fontSize:c,fontStyle:h,fontWeight:f,deltaY:d,textDecorationThickness:p,linethrough:_,overline:v,underline:S}=a,b=this.getSvgTextDecoration({underline:S??this.underline,overline:v??this.overline,linethrough:_??this.linethrough}),T=p||this.textDecorationThickness;return[r?tl(rn,r):"",i?"stroke-width: ".concat(i,"; "):"",e?"font-family: ".concat(e.includes("'")||e.includes('"')?e:"'".concat(e,"'"),"; "):"",c?"font-size: ".concat(c,"px; "):"",h?"font-style: ".concat(h,"; "):"",f?"font-weight: ".concat(f,"; "):"",b?"text-decoration: ".concat(b,"; text-decoration-thickness: ").concat(Kt(T*this.getObjectScaling().y/10,jt.NUM_FRACTION_DIGITS),"%; "):"",l?tl(xe,l):"",d?"baseline-shift: ".concat(-d,"; "):"",t?"white-space: pre; ":""].join("")}getSvgTextDecoration(a){return["overline","underline","line-through"].filter((t=>a[t.replace("-","")])).join(" ")}}]),it.setClass(Pe),it.setSVGClass(Pe);class VR{constructor(t){A(this,"target",void 0),A(this,"__mouseDownInPlace",!1),A(this,"__dragStartFired",!1),A(this,"__isDraggingOver",!1),A(this,"__dragStartSelection",void 0),A(this,"__dragImageDisposer",void 0),A(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach((i=>i())),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,i=e.getSelectionStartFromPointer(t);return e.isEditing&&i>=e.selectionStart&&i<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var i;let{selectionStart:r,selectionEnd:l}=e;const c=this.target,h=c.canvas,f=new P(c.flipX?-1:1,c.flipY?-1:1),d=c._getCursorBoundaries(r),p=new P(d.left+d.leftOffset,d.top+d.topOffset).multiply(f).transform(c.calcTransformMatrix()),_=h.getScenePoint(t).subtract(p),v=c.getCanvasRetinaScaling(),S=c.getBoundingRect(),b=p.subtract(new P(S.left,S.top)),T=h.viewportTransform,w=b.add(_).transform(T,!0),N=c.backgroundColor,I=Fm(c.styles);c.backgroundColor="";const j={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};c.setSelectionStyles(j,0,r),c.setSelectionStyles(j,l,c.text.length),c.dirty=!0;const Y=c.toCanvasElement({enableRetinaScaling:h.enableRetinaScaling,viewportTransform:!0});c.backgroundColor=N,c.styles=I,c.dirty=!0,Ug(Y,{position:"fixed",left:"".concat(-Y.width,"px"),border:sn,width:"".concat(Y.width/v,"px"),height:"".concat(Y.height/v,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{Y.remove()},Hn(t.target||this.target.hiddenTextarea).body.appendChild(Y),(i=t.dataTransfer)===null||i===void 0||i.setDragImage(Y,w.x,w.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,i=this.isActive();if(i&&t.dataTransfer){const r=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},l=e._text.slice(r.selectionStart,r.selectionEnd).join(""),c=M({text:e.text,value:l},r);t.dataTransfer.setData("text/plain",l),t.dataTransfer.setData("application/fabric",JSON.stringify({value:l,styles:e.getSelectionStyles(r.selectionStart,r.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,c)}return e.abortCursorAnimation(),i}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),i=this.__dragStartSelection;return e<i.selectionStart||e>i.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e}=t;const i=this.targetCanDrop(e);!this.__isDraggingOver&&i&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e}=t,i=this.targetCanDrop(e);!this.__isDraggingOver&&i?this.__isDraggingOver=!0:this.__isDraggingOver&&!i&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:i}=t,r=i.defaultPrevented;this.__isDraggingOver=!1,i.preventDefault();let l=(e=i.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain");if(l&&!r){const c=this.target,h=c.canvas;let f=c.getSelectionStartFromPointer(i);const{styles:d}=i.dataTransfer.types.includes("application/fabric")?JSON.parse(i.dataTransfer.getData("application/fabric")):{},p=l[Math.max(0,l.length-1)],_=0;if(this.__dragStartSelection){const v=this.__dragStartSelection.selectionStart,S=this.__dragStartSelection.selectionEnd;f>v&&f<=S?f=v:f>S&&(f-=S-v),c.removeChars(v,S),delete this.__dragStartSelection}c._reNewline.test(p)&&(c._reNewline.test(c._text[f])||f===c._text.length)&&(l=l.trimEnd()),t.didDrop=!0,t.dropTarget=c,c.insertChars(l,d,f),h.setActiveObject(c),c.enterEditing(i),c.selectionStart=Math.min(f+_,c._text.length),c.selectionEnd=Math.min(c.selectionStart+l.length,c._text.length),c.hiddenTextarea.value=c.text,c._updateTextarea(),c.hiddenTextarea.focus(),c.fire(Ru,{index:f+_,action:"drop"}),h.fire("text:changed",{target:c}),h.contextTopDirty=!0,h.requestRenderAll()}}dragEndHandler(t){let{e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var i;const r=this.target,l=this.target.canvas,{selectionStart:c,selectionEnd:h}=this.__dragStartSelection,f=((i=e.dataTransfer)===null||i===void 0?void 0:i.dropEffect)||sn;f===sn?(r.selectionStart=c,r.selectionEnd=h,r._updateTextarea(),r.hiddenTextarea.focus()):(r.clearContextTop(),f==="move"&&(r.removeChars(c,h),r.selectionStart=r.selectionEnd=c,r.hiddenTextarea&&(r.hiddenTextarea.value=r.text),r._updateTextarea(),r.fire(Ru,{index:c,action:"dragend"}),l.fire("text:changed",{target:r}),l.requestRenderAll()),r.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const MS=/[ \n\.,;!\?\-]/;class GR extends Pe{constructor(){super(...arguments),A(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:i,delay:r,onComplete:l}=t;return $C({startValue:this._currentCursorOpacity,endValue:e,duration:i,delay:r,onComplete:l,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:c=>{this._currentCursorOpacity=c,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;(t=this._currentTickCompleteState)===null||t===void 0||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach((e=>{e&&!e.isDone()&&(t=!0,e.abort())})),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((t=>!t||t.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i--;for(;/\S/.test(this._text[i])&&i>-1;)e++,i--;return t-e}findWordBoundaryRight(t){let e=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e}findLineBoundaryLeft(t){let e=0,i=t-1;for(;!/\n/.test(this._text[i])&&i>-1;)e++,i--;return t-e}findLineBoundaryRight(t){let e=0,i=t;for(;!/\n/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e}searchWordBoundary(t,e){const i=this._text;let r=t>0&&this._reSpace.test(i[t])&&(e===-1||!Dm.test(i[t-1]))?t-1:t,l=i[r];for(;r>0&&r<i.length&&!MS.test(l);)r+=e,l=i[r];return e===-1&&MS.test(l)&&r++,r}selectWord(t){var e;t=(e=t)!==null&&e!==void 0?e:this.selectionStart;const i=this.searchWordBoundary(t,-1),r=Math.max(i,this.searchWordBoundary(t,1));this.selectionStart=i,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){var e;t=(e=t)!==null&&e!==void 0?e:this.selectionStart;const i=this.findLineBoundaryLeft(t),r=this.findLineBoundaryRight(t);this.selectionStart=i,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;Hn(e).activeElement!==e&&e.focus();const i=this.getSelectionStartFromPointer(t),r=this.selectionStart,l=this.selectionEnd;(i===this.__selectionStartOnMouseDown&&r!==l||r!==i&&l!==i)&&(i>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=i):(this.selectionStart=i,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===r&&this.selectionEnd===l||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,i){const r=i.slice(0,t),l=this.graphemeSplit(r).length;if(t===e)return{selectionStart:l,selectionEnd:l};const c=i.slice(t,e);return{selectionStart:l,selectionEnd:l+this.graphemeSplit(c).length}}fromGraphemeToStringSelection(t,e,i){const r=i.slice(0,t).join("").length;return t===e?{selectionStart:r,selectionEnd:r}:{selectionStart:r,selectionEnd:r+i.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),r=i.lineIndex,l=i.charIndex,c=this.getValueOfPropertyAt(r,l,"fontSize")*this.lineHeight,h=e.leftOffset,f=this.getCanvasRetinaScaling(),d=this.canvas.upperCanvasEl,p=d.width/f,_=d.height/f,v=p-c,S=_-c,b=new P(e.left+h,e.top+e.topOffset+c).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new P(d.clientWidth/p,d.clientHeight/_));return b.x<0&&(b.x=0),b.x>v&&(b.x=v),b.y<0&&(b.y=0),b.y>S&&(b.y=S),b.x+=this.canvas._offset.left,b.y+=this.canvas._offset.top,{left:"".concat(b.x,"px"),top:"".concat(b.y,"px"),fontSize:"".concat(c,"px"),charHeight:c}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(Nu),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:i,charIndex:r}=this.get2DCursorLocation(t,!0),{lineIndex:l,charIndex:c}=this.get2DCursorLocation(e,!0);if(i!==l){if(this.styles[i])for(let h=r;h<this._unwrappedTextLines[i].length;h++)delete this.styles[i][h];if(this.styles[l])for(let h=c;h<this._unwrappedTextLines[l].length;h++){const f=this.styles[l][h];f&&(this.styles[i]||(this.styles[i]={}),this.styles[i][r+h-c]=f)}for(let h=i+1;h<=l;h++)delete this.styles[h];this.shiftLineStyles(l,i-l)}else if(this.styles[i]){const h=this.styles[i],f=c-r;for(let d=r;d<c;d++)delete h[d];for(const d in this.styles[i]){const p=parseInt(d,10);p>=c&&(h[p-f]=h[d],delete h[d])}}}shiftLineStyles(t,e){const i=Object.assign({},this.styles);for(const r in this.styles){const l=parseInt(r,10);l>t&&(this.styles[l+e]=i[l],i[l-e]||delete this.styles[l])}}insertNewlineStyleObject(t,e,i,r){const l={},c=this._unwrappedTextLines[t].length,h=c===e;let f=!1;i||(i=1),this.shiftLineStyles(t,i);const d=this.styles[t]?this.styles[t][e===0?e:e-1]:void 0;for(const _ in this.styles[t]){const v=parseInt(_,10);v>=e&&(f=!0,l[v-e]=this.styles[t][_],h&&e===0||delete this.styles[t][_])}let p=!1;for(f&&!h&&(this.styles[t+i]=l,p=!0),(p||c>e)&&i--;i>0;)r&&r[i-1]?this.styles[t+i]={0:M({},r[i-1])}:d?this.styles[t+i]={0:M({},d)}:delete this.styles[t+i],i--;this._forceClearCache=!0}insertCharStyleObject(t,e,i,r){this.styles||(this.styles={});const l=this.styles[t],c=l?M({},l):{};i||(i=1);for(const f in c){const d=parseInt(f,10);d>=e&&(l[d+i]=c[d],c[d-i]||delete l[d])}if(this._forceClearCache=!0,r){for(;i--;)Object.keys(r[i]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+i]=M({},r[i]));return}if(!l)return;const h=l[e?e-1:1];for(;h&&i--;)this.styles[t][e+i]=M({},h)}insertNewStyleBlock(t,e,i){const r=this.get2DCursorLocation(e,!0),l=[0];let c,h=0;for(let f=0;f<t.length;f++)t[f]===`
`?(h++,l[h]=0):l[h]++;for(l[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,l[0],i),i=i&&i.slice(l[0]+1)),h&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+l[0],h),c=1;c<h;c++)l[c]>0?this.insertCharStyleObject(r.lineIndex+c,0,l[c],i):i&&this.styles[r.lineIndex+c]&&i[0]&&(this.styles[r.lineIndex+c][0]=i[0]),i=i&&i.slice(l[c]+1);l[c]>0&&this.insertCharStyleObject(r.lineIndex+c,0,l[c],i)}removeChars(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i;r>i&&this.removeStyleFromTo(i,r);const l=this.graphemeSplit(t);this.insertNewStyleBlock(l,i,e),this._text=[...this._text.slice(0,i),...l,...this._text.slice(r)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,i){i<=t?(e===t?this._selectionDirection=It:this._selectionDirection===fe&&(this._selectionDirection=It,this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?this._selectionDirection===fe?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection=fe:this._selectionDirection===It&&(this._selectionDirection=fe,this.selectionStart=e),this.selectionEnd=i)}}class XR extends GR{initHiddenTextarea(){const t=this.canvas&&Hn(this.canvas.getElement())||Sa(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((c=>{let[h,f]=c;return e.setAttribute(h,f)}));const{top:i,left:r,fontSize:l}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(i,"; left: ").concat(r,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(l,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((c=>{let[h,f]=c;return e.addEventListener(h,this[f].bind(this))})),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste,{value:i,selectionStart:r,selectionEnd:l}=this.hiddenTextarea;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const c=()=>{this.updateFromTextArea(),this.fire(Ru),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void c();const h=this._splitTextIntoLines(i).graphemeText,f=this._text.length,d=h.length,p=this.selectionStart,_=this.selectionEnd,v=p!==_;let S,b,T,w,N=d-f;const I=this.fromStringToGraphemeSelection(r,l,i),j=p>I.selectionStart;v?(b=this._text.slice(p,_),N+=_-p):d<f&&(b=j?this._text.slice(_+N,_):this._text.slice(p,p-N));const Y=h.slice(I.selectionEnd-N,I.selectionEnd);if(b&&b.length&&(Y.length&&(S=this.getSelectionStyles(p,p+1,!1),S=Y.map((()=>S[0]))),v?(T=p,w=_):j?(T=_-b.length,w=_):(T=_,w=_+b.length),this.removeStyleFromTo(T,w)),Y.length){const{copyPasteData:B}=ni();e&&Y.join("")===B.copiedText&&!jt.disableStyleCopyPaste&&(S=B.copiedTextStyle),this.insertNewStyleBlock(Y,p,S)}c()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:i,selectionEnd:r}=e;this.compositionStart=i,this.compositionEnd=r,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=ni();t.copiedText=this.getSelectedText(),jt.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let i,r=this._getLineLeftOffset(t);return e>0&&(i=this.__charBounds[t][e-1],r+=i.left+i.width),r}getDownCursorOffset(t,e){const i=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(i),l=r.lineIndex;if(l===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-i;const c=r.charIndex,h=this._getWidthBeforeCursor(l,c),f=this._getIndexOnLine(l+1,h);return this._textLines[l].slice(c).length+f+1+this.missingNewlineOffset(l)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const i=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(i),l=r.lineIndex;if(l===0||t.metaKey||t.keyCode===33)return-i;const c=r.charIndex,h=this._getWidthBeforeCursor(l,c),f=this._getIndexOnLine(l-1,h),d=this._textLines[l].slice(0,c),p=this.missingNewlineOffset(l-1);return-this._textLines[l-1].length+f-d.length+(1-p)}_getIndexOnLine(t,e){const i=this._textLines[t];let r,l,c=this._getLineLeftOffset(t),h=0;for(let f=0,d=i.length;f<d;f++)if(r=this.__charBounds[t][f].width,c+=r,c>e){l=!0;const p=c-r,_=c,v=Math.abs(p-e);h=Math.abs(_-e)<v?f:f-1;break}return l||(h=i.length-1),h}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const i=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===fe);if(e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),i!==0){const r=this.text.length;this.selectionStart=ma(0,this.selectionStart,r),this.selectionEnd=ma(0,this.selectionEnd,r),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===It?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),t!==0}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0}moveCursorLeft(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)}_move(t,e,i){let r;if(t.altKey)r=this["findWordBoundary".concat(i)](this[e]);else{if(!t.metaKey&&t.keyCode!==35&&t.keyCode!==36)return this[e]+=i==="Left"?-1:1,!0;r=this["findLineBoundary".concat(i)](this[e])}return r!==void 0&&this[e]!==r&&(this[e]=r,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=It,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===fe&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=It,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const i="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===It&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=fe,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=fe,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const RS=a=>!!a.button;class qR extends XR{constructor(){super(...arguments),A(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new VR(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}doubleClickHandler(t){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}tripleClickHandler(t){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}_mouseDownHandler(t){let{e,alreadySelected:i}=t;this.canvas&&this.editable&&!RS(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),i&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=i||this.isEditing)))}mouseUpHandler(t){let{e,transform:i}=t;const r=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const l=this.canvas._activeObject;if(l&&l!==this)return}!this.editable||this.group&&!this.group.interactive||i&&i.actionPerformed||RS(e)||r||this.selected&&!this.getActiveControl()&&(this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),i=this.selectionStart,r=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,r,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(Gn(this.calcTransformMatrix())).add(new P(-this._getLeftOffset(),-this._getTopOffset()));let i=0,r=0,l=0;for(let d=0;d<this._textLines.length&&i<=e.y;d++)i+=this.getHeightOfLine(d),l=d,d>0&&(r+=this._textLines[d-1].length+this.missingNewlineOffset(d-1));let c=Math.abs(this._getLineLeftOffset(l));const h=this._textLines[l].length,f=this.__charBounds[l];for(let d=0;d<h;d++){const p=c+f[d].kernedWidth;if(e.x<=p){Math.abs(e.x-p)<=Math.abs(e.x-c)&&r++;break}c=p,r++}return Math.min(this.flipX?h-r:r,this._text.length)}}const Fc="moveCursorUp",Uc="moveCursorDown",Pc="moveCursorLeft",Hc="moveCursorRight",Yc="exitEditing",NS=(a,t)=>{const e=t.getRetinaScaling();a.setTransform(e,0,0,e,0,0);const i=t.viewportTransform;a.transform(i[0],i[1],i[2],i[3],i[4],i[5])},WR=M({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Yc,27:Yc,33:Fc,34:Uc,35:Hc,36:Pc,37:Pc,38:Fc,39:Hc,40:Uc},keysMapRtl:{9:Yc,27:Yc,33:Fc,34:Uc,35:Pc,36:Hc,37:Hc,38:Fc,39:Pc,40:Uc},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Di extends qR{static getDefaults(){return M(M({},super.getDefaults()),Di.ownDefaults)}get type(){const t=super.type;return t==="itext"?"i-text":t}constructor(t,e){super(t,M(M({},Di.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):(t==="canvas"&&(this.canvas instanceof Pg&&this.canvas.textEditingManager.remove(this),e instanceof Pg&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,i=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,i)}setSelectionStyles(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,i)}get2DCursorLocation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const i=super.toCanvasElement(t);return this.isEditing=e,i}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries(),i=this.findAncestorsWithClipPath(),r=i.length>0;let l,c=t;if(r){l=kn(t.canvas),c=l.getContext("2d"),NS(c,this.canvas);const h=this.calcTransformMatrix();c.transform(h[0],h[1],h[2],h[3],h[4],h[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(c,e):this.renderCursor(c,e),r)for(const h of i){const f=h.clipPath,d=kn(t.canvas),p=d.getContext("2d");if(NS(p,this.canvas),!f.absolutePositioned){const _=h.calcTransformMatrix();p.transform(_[0],_[1],_[2],_[3],_[4],_[5])}f.transform(p),f.drawObject(p,!0,{}),this.drawClipPathOnCache(c,f,d)}r&&(t.setTransform(1,0,0,1,0,0),t.drawImage(l,0,0)),this.canvas.contextTopDirty=!0,t.restore()}findAncestorsWithClipPath(){const t=[];let e=this;for(;e;)e.clipPath&&t.push(e),e=e.parent;return t}_getCursorBoundaries(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const i=this._getLeftOffset(),r=this._getTopOffset(),l=this._getCursorBoundariesOffsets(t,e);return{left:i,top:r,leftOffset:l.left,topOffset:l.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,i=0;const{charIndex:r,lineIndex:l}=this.get2DCursorLocation(t);for(let d=0;d<l;d++)e+=this.getHeightOfLine(d);const c=this._getLineLeftOffset(l),h=this.__charBounds[l][r];h&&(i=h.left),this.charSpacing!==0&&r===this._textLines[l].length&&(i-=this._getWidthOfCharSpacing());const f={top:e,left:c+(i>0?i:0)};return this.direction==="rtl"&&(this.textAlign===fe||this.textAlign===ti||this.textAlign===zo?f.left*=-1:this.textAlign===It||this.textAlign===Bu?f.left=c-(i>0?i:0):this.textAlign!==Ct&&this.textAlign!==Bo||(f.left=c-(i>0?i:0))),f}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(t);const i=this.get2DCursorLocation(t),r=i.lineIndex,l=i.charIndex>0?i.charIndex-1:0,c=this.getValueOfPropertyAt(r,l,"fontSize"),h=this.getObjectScaling().x*this.canvas.getZoom(),f=this.cursorWidth/h,d=this.getValueOfPropertyAt(r,l,"deltaY"),p=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-c*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(r,l,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-f/2,top:p+e.top+d,width:f,height:c}}_renderCursor(t,e,i){const{color:r,opacity:l,left:c,top:h,width:f,height:d}=this.getCursorRenderingData(i,e);t.fillStyle=r,t.globalAlpha=l,t.fillRect(c,h,f,d)}renderSelection(t,e){const i={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,i,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,i){const r=e.selectionStart,l=e.selectionEnd,c=this.textAlign.includes(ti),h=this.get2DCursorLocation(r),f=this.get2DCursorLocation(l),d=h.lineIndex,p=f.lineIndex,_=h.charIndex<0?0:h.charIndex,v=f.charIndex<0?0:f.charIndex;for(let S=d;S<=p;S++){const b=this._getLineLeftOffset(S)||0;let T=this.getHeightOfLine(S),w=0,N=0,I=0;if(S===d&&(N=this.__charBounds[d][_].left),S>=d&&S<p)I=c&&!this.isEndOfWrapping(S)?this.width:this.getLineWidth(S)||5;else if(S===p)if(v===0)I=this.__charBounds[p][v].left;else{const F=this._getWidthOfCharSpacing();I=this.__charBounds[p][v-1].left+this.__charBounds[p][v-1].width-F}w=T,(this.lineHeight<1||S===p&&this.lineHeight>1)&&(T/=this.lineHeight);let j=i.left+b+N,Y=T,B=0;const K=I-N;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",Y=1,B=T):t.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===fe||this.textAlign===ti||this.textAlign===zo?j=this.width-j-K:this.textAlign===It||this.textAlign===Bu?j=i.left+b-I:this.textAlign!==Ct&&this.textAlign!==Bo||(j=i.left+b-I)),t.fillRect(j,i.top+i.topOffset+B,K,Y),i.topOffset+=w}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,xe)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}A(Di,"ownDefaults",WR),A(Di,"type","IText"),it.setClass(Di),it.setClass(Di,"i-text");class Js extends Di{static getDefaults(){return M(M({},super.getDefaults()),Js.ownDefaults)}constructor(t,e){super(t,M(M({},Js.ownDefaults),e))}static createControls(){return{controls:wM()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(ti)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,i=0,r=0;const l={};for(let c=0;c<t.graphemeLines.length;c++)t.graphemeText[r]===`
`&&c>0?(i=0,r++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[r])&&c>0&&(i++,r++),l[c]={line:e,offset:i},r+=t.graphemeLines[c].length,i+=t.graphemeLines[c].length;return l}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const i=this._styleMap[e];i&&(e=i.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,i=0,r=t+1,l=!1;const c=this._styleMap[t],h=this._styleMap[t+1];c&&(t=c.line,i=c.offset),h&&(r=h.line,l=r===t,e=h.offset);const f=t===void 0?this.styles:{line:this.styles[t]};for(const d in f)for(const p in f[d]){const _=parseInt(p,10);if(_>=i&&(!l||_<e))for(const v in f[d][p])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const i=this._styleMap[t];if(!i)return{};t=i.line,e=i.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,i){const r=this._styleMap[t];super._setStyleDeclaration(r.line,r.offset+e,i)}_deleteStyleDeclaration(t,e){const i=this._styleMap[t];super._deleteStyleDeclaration(i.line,i.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const i=this.getGraphemeDataForRender(t),r=[];for(let l=0;l<i.wordsData.length;l++)r.push(...this._wrapLine(l,e,i));return this.isWrapping=!1,r}getGraphemeDataForRender(t){const e=this.splitByGrapheme,i=e?"":" ";let r=0;return{wordsData:t.map(((l,c)=>{let h=0;const f=e?this.graphemeSplit(l):this.wordSplit(l);return f.length===0?[{word:[],width:0}]:f.map((d=>{const p=e?[d]:this.graphemeSplit(d),_=this._measureWord(p,c,h);return r=Math.max(_,r),h+=p.length+i.length,{word:p,width:_}}))})),largestWordWidth:r}}_measureWord(t,e){let i,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=0;for(let c=0,h=t.length;c<h;c++)l+=this._getGraphemeBox(t[c],e,c+r,i,!0).kernedWidth,i=t[c];return l}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,i){let{largestWordWidth:r,wordsData:l}=i,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const h=this._getWidthOfCharSpacing(),f=this.splitByGrapheme,d=[],p=f?"":" ";let _=0,v=[],S=0,b=0,T=!0;e-=c;const w=Math.max(e,r,this.dynamicMinWidth),N=l[t];let I;for(S=0,I=0;I<N.length;I++){const{word:j,width:Y}=N[I];S+=j.length,_+=b+Y-h,_>w&&!T?(d.push(v),v=[],_=Y,T=!0):_+=h,T||f||v.push(p),v=v.concat(j),b=f?0:this._measureWord([p],t,S),S++,T=!1}return I&&d.push(v),r+c>this.dynamicMinWidth&&(this.dynamicMinWidth=r-h+c),d}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),i=this._wrapText(e.lines,this.width),r=new Array(i.length);for(let l=0;l<i.length;l++)r[l]=i[l].join("");return e.lines=r,e.graphemeLines=i,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const i=parseInt(e,10);if(this._textLines[i]){const r=this._styleMap[e].line;t.set("".concat(r),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}A(Js,"type","Textbox"),A(Js,"textLayoutProperties",[...Di.textLayoutProperties,"width"]),A(Js,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),it.setClass(Js);class jS extends lh{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:i}=t,{clipPath:r,group:l}=i;if(!r||!this.shouldPerformLayout(t))return;const{width:c,height:h}=Ri(o1(i,r)),f=new P(c,h);if(r.absolutePositioned)return{center:aa(r.getRelativeCenterPoint(),void 0,l?l.calcTransformMatrix():void 0),size:f};{const d=r.getRelativeCenterPoint().transform(i.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:p=new P,correction:_=new P}=this.calcBoundingBox(e,t)||{};return{center:p.add(d),correction:_.subtract(d),size:f}}return{center:i.getRelativeCenterPoint().add(d),size:f}}}}A(jS,"type","clip-path"),it.setClass(jS);class kS extends lh{getInitialSize(t,e){let{target:i}=t,{size:r}=e;return new P(i.width||r.x,i.height||r.y)}}A(kS,"type","fixed"),it.setClass(kS);class QR extends nl{subscribeTargets(t){const e=t.target;t.targets.reduce(((i,r)=>(r.parent&&i.add(r.parent),i)),new Set).forEach((i=>{i.layoutManager.subscribeTargets({target:i,targets:[e]})}))}unsubscribeTargets(t){const e=t.target,i=e.getObjects();t.targets.reduce(((r,l)=>(l.parent&&r.add(l.parent),r)),new Set).forEach((r=>{!i.some((l=>l.parent===r))&&r.layoutManager.unsubscribeTargets({target:r,targets:[e]})}))}}class $s extends tr{static getDefaults(){return M(M({},super.getDefaults()),$s.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,$s.ownDefaults),this.setOptions(e);const{left:i,top:r,layoutManager:l}=e;this.groupInit(t,{left:i,top:r,layoutManager:l??new QR})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.multiSelectionStacking==="selection-order"?this.add(...e):e.forEach((r=>{const l=this._objects.findIndex((h=>h.isInFrontOf(r))),c=l===-1?this.size():l;this.insertAt(c,r)}))}canEnterGroup(t){return this.getObjects().some((e=>e.isDescendantOf(t)||t.isDescendantOf(e)))?(Ts("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const i=new Set;e.forEach((r=>{const{parent:l}=r;l&&i.add(l)})),t===Ym?i.forEach((r=>{r._onAfterObjectsChange(Iu,e)})):i.forEach((r=>{r._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const r=M(M({hasControls:!1},i),{},{forActiveSelection:!0});for(let l=0;l<this._objects.length;l++)this._objects[l]._renderControls(t,r);super._renderControls(t,e),t.restore()}}A($s,"type","ActiveSelection"),A($s,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),it.setClass($s),it.setClass($s,"activeSelection");class KR{constructor(){A(this,"resources",{})}applyFilters(t,e,i,r,l){const c=l.getContext("2d");if(!c)return;c.drawImage(e,0,0,i,r);const h={sourceWidth:i,sourceHeight:r,imageData:c.getImageData(0,0,i,r),originalEl:e,originalImageData:c.getImageData(0,0,i,r),canvasEl:l,ctx:c,filterBackend:this};t.forEach((d=>{d.applyTo(h)}));const{imageData:f}=h;return f.width===i&&f.height===r||(l.width=f.width,l.height=f.height),c.putImageData(f,0,0),h}}class x1{constructor(){let{tileSize:t=jt.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};A(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),A(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const i=kn({width:t,height:e}),r=i.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)}applyFilters(t,e,i,r,l,c){const h=this.gl,f=l.getContext("2d");if(!h||!f)return;let d;c&&(d=this.getCachedTexture(c,e));const p={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:i,sourceHeight:r,destinationWidth:i,destinationHeight:r,context:h,sourceTexture:this.createTexture(h,i,r,d?void 0:e),targetTexture:this.createTexture(h,i,r),originalTexture:d||this.createTexture(h,i,r,d?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:l},_=h.createFramebuffer();return h.bindFramebuffer(h.FRAMEBUFFER,_),t.forEach((v=>{v&&v.applyTo(p)})),(function(v){const S=v.targetCanvas,b=S.width,T=S.height,w=v.destinationWidth,N=v.destinationHeight;b===w&&T===N||(S.width=w,S.height=N)})(p),this.copyGLTo2D(h,p),h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(p.sourceTexture),h.deleteTexture(p.targetTexture),h.deleteFramebuffer(_),f.setTransform(1,0,0,1,0,0),p}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,i,r,l){const{NEAREST:c,TEXTURE_2D:h,RGBA:f,UNSIGNED_BYTE:d,CLAMP_TO_EDGE:p,TEXTURE_MAG_FILTER:_,TEXTURE_MIN_FILTER:v,TEXTURE_WRAP_S:S,TEXTURE_WRAP_T:b}=t,T=t.createTexture();return t.bindTexture(h,T),t.texParameteri(h,_,l||c),t.texParameteri(h,v,l||c),t.texParameteri(h,S,p),t.texParameteri(h,b,p),r?t.texImage2D(h,0,f,f,d,r):t.texImage2D(h,0,f,e,i,0,f,d,null),T}getCachedTexture(t,e,i){const{textureCache:r}=this;if(r[t])return r[t];{const l=this.createTexture(this.gl,e.width,e.height,e,i);return l&&(r[t]=l),l}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const i=t.canvas,r=e.targetCanvas,l=r.getContext("2d");if(!l)return;l.translate(0,r.height),l.scale(1,-1);const c=i.height-r.height;l.drawImage(i,0,c,r.width,r.height,0,0,r.width,r.height)}copyGLTo2DPutImageData(t,e){const i=e.targetCanvas.getContext("2d"),r=e.destinationWidth,l=e.destinationHeight,c=r*l*4;if(!i)return;const h=new Uint8Array(this.imageBuffer,0,c),f=new Uint8ClampedArray(this.imageBuffer,0,c);t.readPixels(0,0,r,l,t.RGBA,t.UNSIGNED_BYTE,h);const d=new ImageData(f,r,l);i.putImageData(d,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const i=t.getExtension("WEBGL_debug_renderer_info");if(i){const r=t.getParameter(i.UNMASKED_RENDERER_WEBGL),l=t.getParameter(i.UNMASKED_VENDOR_WEBGL);r&&(e.renderer=r.toLowerCase()),l&&(e.vendor=l.toLowerCase())}return this.gpuInfo=e,e}}let ig;function ZR(){const{WebGLProbe:a}=ni();return a.queryWebGL(Bi()),jt.enableGLFiltering&&a.isSupported(jt.textureSize)?new x1({tileSize:jt.textureSize}):new KR}function sg(){return!ig&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(ig=ZR()),ig}const JR=["filters","resizeFilter","src","crossOrigin","type"],T1=["cropX","cropY"];class vn extends Fe{static getDefaults(){return M(M({},super.getDefaults()),vn.ownDefaults)}constructor(t,e){super(),A(this,"_lastScaleX",1),A(this,"_lastScaleY",1),A(this,"_filterScalingX",1),A(this,"_filterScalingY",1),this.filters=[],Object.assign(this,vn.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(ws()),this.setElement(typeof t=="string"?(this.canvas&&Hn(this.canvas.getElement())||Sa()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(i),(e=t.classList)===null||e===void 0||e.add(vn.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=sg(!1);e instanceof x1&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((t=>{const e=this[t];e&&ni().dispose(e),this[t]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||this.strokeWidth===0)return;const e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=[];return this.filters.forEach((i=>{i&&e.push(i.toObject())})),M(M({},super.toObject([...T1,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,i=-this.width/2,r=-this.height/2;let l=[],c=[],h="",f="";if(!e)return[];if(this.hasCrop()){const d=ws();l.push('<clipPath id="imageCrop_'+d+`">
`,'	<rect x="'+i+'" y="'+r+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),h=' clip-path="url(#imageCrop_'+d+')" '}if(this.imageSmoothing||(f=' image-rendering="optimizeSpeed"'),t.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(i-this.cropX,'" y="').concat(r-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(f).concat(h,`></image>
`)),this.stroke||this.strokeDashArray){const d=this.fill;this.fill=null,c=['	<rect x="'.concat(i,'" y="').concat(r,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=d}return l=this.paintFirst!==xe?l.concat(c,t):l.concat(t,c),l}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return cu(t,{crossOrigin:e,signal:i}).then((r=>{e!==void 0&&this.set({crossOrigin:e}),this.setElement(r)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),r=i.x,l=i.y,c=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||r>e&&l>e)return this._element=c,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,void(this._lastScaleY=l);const h=kn(c),{width:f,height:d}=c;this._element=h,this._lastScaleX=t.scaleX=r,this._lastScaleY=t.scaleY=l,sg().applyFilters([t],c,f,d,this._element),this._filterScalingX=h.width/this._originalElement.width,this._filterScalingY=h.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(t=t.filter((l=>l&&!l.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),t.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,i=e.naturalWidth||e.width,r=e.naturalHeight||e.height;if(this._element===this._originalElement){const l=kn({width:i,height:r});this._element=l,this._filteredEl=l}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,r),this._lastScaleX=1,this._lastScaleY=1);sg().applyFilters(t,this._originalElement,i,r,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const i=this._filterScalingX,r=this._filterScalingY,l=this.width,c=this.height,h=Math.max(this.cropX,0),f=Math.max(this.cropY,0),d=e.naturalWidth||e.width,p=e.naturalHeight||e.height,_=h*i,v=f*r,S=Math.min(l*i,d-_),b=Math.min(c*r,p-v),T=-l/2,w=-c/2,N=Math.min(l,d/i-h),I=Math.min(c,p/r-f);e&&t.drawImage(e,_,v,S,b,T,w,N,I)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=this.getOriginalSize();this.width=t||i.width,this.height=e||i.height}parsePreserveAspectRatioAttribute(){const t=YA(this.preserveAspectRatio||""),e=this.width,i=this.height,r={width:e,height:i};let l,c=this._element.width,h=this._element.height,f=1,d=1,p=0,_=0,v=0,S=0;return!t||t.alignX===sn&&t.alignY===sn?(f=e/c,d=i/h):(t.meetOrSlice==="meet"&&(f=d=rR(this._element,r),l=(e-c*f)/2,t.alignX==="Min"&&(p=-l),t.alignX==="Max"&&(p=l),l=(i-h*d)/2,t.alignY==="Min"&&(_=-l),t.alignY==="Max"&&(_=l)),t.meetOrSlice==="slice"&&(f=d=aR(this._element,r),l=c-e/f,t.alignX==="Mid"&&(v=l/2),t.alignX==="Max"&&(v=l),l=h-i/d,t.alignY==="Mid"&&(S=l/2),t.alignY==="Max"&&(S=l),c=e/f,h=i/d)),{width:c,height:h,scaleX:f,scaleY:d,offsetLeft:p,offsetTop:_,cropX:v,cropY:S}}static fromObject(t,e){let{filters:i,resizeFilter:r,src:l,crossOrigin:c,type:h}=t,f=ee(t,JR);return Promise.all([cu(l,M(M({},e),{},{crossOrigin:c})),i&&Jo(i,e),r&&Jo([r],e),sh(f,e)]).then((d=>{let[p,_=[],[v]=[],S={}]=d;return new this(p,M(M({},f),{},{src:l,filters:_,resizeFilter:v},S))}))}static fromURL(t){let{crossOrigin:e=null,signal:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return cu(t,{crossOrigin:e,signal:i}).then((l=>new this(l,r)))}static async fromElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const r=Pi(t,this.ATTRIBUTE_NAMES,i);return this.fromURL(r["xlink:href"]||r.href,e,r).catch((l=>(Ts("log","Unable to parse Image",l),null)))}}A(vn,"type","Image"),A(vn,"cacheProperties",[...Ui,...T1]),A(vn,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),A(vn,"CSS_CANVAS","canvas-img"),A(vn,"ATTRIBUTE_NAMES",[...Es,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),it.setClass(vn),it.setSVGClass(vn);ah(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const uh=a=>a.webgl!==void 0,Vm="precision highp float",$R=`
    `.concat(Vm,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),tN=["type"],eN=["type"],nN=new RegExp(Vm,"g");class Te{get type(){return this.constructor.type}constructor(){let t=ee(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},tN);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return $R}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:r="highp"}}=ni();r!=="highp"&&(e=e.replace(nN,Vm.replace("highp",r)));const l=t.createShader(t.VERTEX_SHADER),c=t.createShader(t.FRAGMENT_SHADER),h=t.createProgram();if(!l||!c||!h)throw new ei("Vertex, fragment shader or program creation error");if(t.shaderSource(l,i),t.compileShader(l),!t.getShaderParameter(l,t.COMPILE_STATUS))throw new ei("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(l)));if(t.shaderSource(c,e),t.compileShader(c),!t.getShaderParameter(c,t.COMPILE_STATUS))throw new ei("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(c)));if(t.attachShader(h,l),t.attachShader(h,c),t.linkProgram(h),!t.getProgramParameter(h,t.LINK_STATUS))throw new ei('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(h)));const f=this.getUniformLocations(t,h)||{};return f.uStepW=t.getUniformLocation(h,"uStepW"),f.uStepH=t.getUniformLocation(h,"uStepH"),{program:h,attributeLocations:this.getAttributeLocations(t,h),uniformLocations:f}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const i=this.constructor.uniformLocations,r={};for(let l=0;l<i.length;l++)r[i[l]]=t.getUniformLocation(e,i[l]);return r}sendAttributeData(t,e,i){const r=e.aPosition,l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const i=t.destinationWidth,r=t.destinationHeight;t.sourceWidth===i&&t.sourceHeight===r||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,i,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){uh(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,i=this.retrieveShader(t);t.pass===0&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.aPosition),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:i}=t,r=kn({width:e,height:i});t.helpLayer=r}}toObject(){const t=Object.keys(this.constructor.defaults||{});return M({type:this.type},t.reduce(((e,i)=>(e[i]=this[i],e)),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(ee(t,eN))}}A(Te,"type","BaseFilter"),A(Te,"uniformLocations",[]);const iN={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class Vc extends Te{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(iN[this.mode],`
        }
      }
      `)}applyTo2d(t){let{imageData:{data:e}}=t;const i=new Pt(this.color).getSource(),r=this.alpha,l=i[0]*r,c=i[1]*r,h=i[2]*r,f=1-r;for(let d=0;d<e.length;d+=4){const p=e[d],_=e[d+1],v=e[d+2];let S,b,T;switch(this.mode){case"multiply":S=p*l/255,b=_*c/255,T=v*h/255;break;case"screen":S=255-(255-p)*(255-l)/255,b=255-(255-_)*(255-c)/255,T=255-(255-v)*(255-h)/255;break;case"add":S=p+l,b=_+c,T=v+h;break;case"difference":S=Math.abs(p-l),b=Math.abs(_-c),T=Math.abs(v-h);break;case"subtract":S=p-l,b=_-c,T=v-h;break;case"darken":S=Math.min(p,l),b=Math.min(_,c),T=Math.min(v,h);break;case"lighten":S=Math.max(p,l),b=Math.max(_,c),T=Math.max(v,h);break;case"overlay":S=l<128?2*p*l/255:255-2*(255-p)*(255-l)/255,b=c<128?2*_*c/255:255-2*(255-_)*(255-c)/255,T=h<128?2*v*h/255:255-2*(255-v)*(255-h)/255;break;case"exclusion":S=l+p-2*l*p/255,b=c+_-2*c*_/255,T=h+v-2*h*v/255;break;case"tint":S=l+p*f,b=c+_*f,T=h+v*f}e[d]=S,e[d+1]=b,e[d+2]=T}}sendUniformData(t,e){const i=new Pt(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,t.uniform4fv(e.uColor,i)}}A(Vc,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),A(Vc,"type","BlendColor"),A(Vc,"uniformLocations",["uColor"]),it.setClass(Vc);const sN={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},rN=["type","image"];class Gc extends Te{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return sN[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(t){const e=t.context,i=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,i,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:i}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/i,1]}applyTo2d(t){let{imageData:{data:e,width:i,height:r},filterBackend:{resources:l}}=t;const c=this.image;l.blendImage||(l.blendImage=Bi());const h=l.blendImage,f=h.getContext("2d");h.width!==i||h.height!==r?(h.width=i,h.height=r):f.clearRect(0,0,i,r),f.setTransform(c.scaleX,0,0,c.scaleY,c.left,c.top),f.drawImage(c.getElement(),0,0,i,r);const d=f.getImageData(0,0,i,r).data;for(let p=0;p<e.length;p+=4){const _=e[p],v=e[p+1],S=e[p+2],b=e[p+3],T=d[p],w=d[p+1],N=d[p+2],I=d[p+3];switch(this.mode){case"multiply":e[p]=_*T/255,e[p+1]=v*w/255,e[p+2]=S*N/255,e[p+3]=b*I/255;break;case"mask":e[p+3]=I}}}sendUniformData(t,e){const i=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,i)}toObject(){return M(M({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:i,image:r}=t,l=ee(t,rN);return vn.fromObject(r,e).then((c=>new this(M(M({},l),{},{image:c}))))}}A(Gc,"type","BlendImage"),A(Gc,"defaults",{mode:"multiply",alpha:1}),A(Gc,"uniformLocations",["uTransformMatrix","uImage"]),it.setClass(Gc);class Xc extends Te{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float totalC = 0.0;
      float totalA = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);
        float weight = 1.0 - abs(percent);
        float alpha = weight * sample.a;
        color.rgb += sample.rgb * alpha;
        color.a += alpha;
        totalA += weight;
        totalC += alpha;
      }
      gl_FragColor.rgb = color.rgb / totalC;
      gl_FragColor.a = color.a / totalA;
    }
  `}applyTo(t){uh(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){let{imageData:{data:e,width:i,height:r}}=t;this.aspectRatio=i/r,this.horizontal=!0;let l=this.getBlurValue()*i;const c=new Uint8ClampedArray(e),h=15,f=4*i;for(let d=0;d<e.length;d+=4){let p=0,_=0,v=0,S=0,b=0;const T=d-d%f,w=T+f;for(let N=-14;N<h;N++){const I=N/h,j=4*Math.floor(l*I),Y=1-Math.abs(I);let B=d+j;B<T?B=T:B>w&&(B=w);const K=e[B+3]*Y;p+=e[B]*K,_+=e[B+1]*K,v+=e[B+2]*K,S+=K,b+=Y}c[d]=p/S,c[d+1]=_/S,c[d+2]=v/S,c[d+3]=S/b}this.horizontal=!1,l=this.getBlurValue()*r;for(let d=0;d<c.length;d+=4){let p=0,_=0,v=0,S=0,b=0;const T=d%f,w=c.length-f+T;for(let N=-14;N<h;N++){const I=N/h,j=Math.floor(l*I)*f,Y=1-Math.abs(I);let B=d+j;B<T?B=T:B>w&&(B=w);const K=c[B+3]*Y;p+=c[B]*K,_+=c[B+1]*K,v+=c[B+2]*K,S+=K,b+=Y}e[d]=p/S,e[d+1]=_/S,e[d+2]=v/S,e[d+3]=S/b}}sendUniformData(t,e){const i=this.chooseRightDelta();t.uniform2fv(e.uDelta,i)}isNeutralState(){return this.blur===0}getBlurValue(){let t=1;const{horizontal:e,aspectRatio:i}=this;return e?i>1&&(t=1/i):i<1&&(t=i),t*this.blur*.12}chooseRightDelta(){const t=this.getBlurValue();return this.horizontal?[t,0]:[0,t]}}A(Xc,"type","Blur"),A(Xc,"defaults",{blur:0}),A(Xc,"uniformLocations",["uDelta"]),it.setClass(Xc);class qc extends Te{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const i=Math.round(255*this.brightness);for(let r=0;r<e.length;r+=4)e[r]+=i,e[r+1]+=i,e[r+2]+=i}isNeutralState(){return this.brightness===0}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}A(qc,"type","Brightness"),A(qc,"defaults",{brightness:0}),A(qc,"uniformLocations",["uBrightness"]),it.setClass(qc);const w1={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class na extends Te{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(t){const e=t.imageData.data,i=this.matrix,r=this.colorsOnly;for(let l=0;l<e.length;l+=4){const c=e[l],h=e[l+1],f=e[l+2];if(e[l]=c*i[0]+h*i[1]+f*i[2]+255*i[4],e[l+1]=c*i[5]+h*i[6]+f*i[7]+255*i[9],e[l+2]=c*i[10]+h*i[11]+f*i[12]+255*i[14],!r){const d=e[l+3];e[l]+=d*i[3],e[l+1]+=d*i[8],e[l+2]+=d*i[13],e[l+3]=c*i[15]+h*i[16]+f*i[17]+d*i[18]+255*i[19]}}}sendUniformData(t,e){const i=this.matrix,r=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],l=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,r),t.uniform4fv(e.uConstants,l)}toObject(){return M(M({},super.toObject()),{},{matrix:[...this.matrix]})}}function cr(a,t){var e;const i=(A(e=class extends na{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",a),A(e,"defaults",{colorsOnly:!1,matrix:t}),e);return it.setClass(i,a),i}A(na,"type","ColorMatrix"),A(na,"defaults",w1),A(na,"uniformLocations",["uColorMatrix","uConstants"]),it.setClass(na);cr("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);cr("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);cr("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);cr("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);cr("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);cr("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);cr("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class LS extends Te{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){uh(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach((e=>{e.applyTo(t)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((t=>t.toObject()))}}isNeutralState(){return!this.subFilters.some((t=>!t.isNeutralState()))}static fromObject(t,e){return Promise.all((t.subFilters||[]).map((i=>it.getClass(i.type).fromObject(i,e)))).then((i=>new this({subFilters:i})))}}A(LS,"type","Composed"),it.setClass(LS);class Wc extends Te{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(t){let{imageData:{data:e}}=t;const i=Math.floor(255*this.contrast),r=259*(i+255)/(255*(259-i));for(let l=0;l<e.length;l+=4)e[l]=r*(e[l]-128)+128,e[l+1]=r*(e[l+1]-128)+128,e[l+2]=r*(e[l+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}A(Wc,"type","Contrast"),A(Wc,"defaults",{contrast:0}),A(Wc,"uniformLocations",["uContrast"]),it.setClass(Wc);const aN={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class Qc extends Te{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return aN[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,i=e.data,r=this.matrix,l=Math.round(Math.sqrt(r.length)),c=Math.floor(l/2),h=e.width,f=e.height,d=t.ctx.createImageData(h,f),p=d.data,_=this.opaque?1:0;let v,S,b,T,w,N,I,j,Y,B,K,F,Q;for(K=0;K<f;K++)for(B=0;B<h;B++){for(w=4*(K*h+B),v=0,S=0,b=0,T=0,Q=0;Q<l;Q++)for(F=0;F<l;F++)I=K+Q-c,N=B+F-c,I<0||I>=f||N<0||N>=h||(j=4*(I*h+N),Y=r[Q*l+F],v+=i[j]*Y,S+=i[j+1]*Y,b+=i[j+2]*Y,_||(T+=i[j+3]*Y));p[w]=v,p[w+1]=S,p[w+2]=b,p[w+3]=_?i[w+3]:T}t.imageData=d}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return M(M({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}A(Qc,"type","Convolute"),A(Qc,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),A(Qc,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),it.setClass(Qc);const E1="Gamma";class Kc extends Te{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const i=this.gamma,r=1/i[0],l=1/i[1],c=1/i[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const h=this.rgbValues;for(let f=0;f<256;f++)h.r[f]=255*Math.pow(f/255,r),h.g[f]=255*Math.pow(f/255,l),h.b[f]=255*Math.pow(f/255,c);for(let f=0;f<e.length;f+=4)e[f]=h.r[e[f]],e[f+1]=h.g[e[f+1]],e[f+2]=h.b[e[f+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return t[0]===1&&t[1]===1&&t[2]===1}toObject(){return{type:E1,gamma:this.gamma.concat()}}}A(Kc,"type",E1),A(Kc,"defaults",{gamma:[1,1,1]}),A(Kc,"uniformLocations",["uGamma"]),it.setClass(Kc);const oN={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class Zc extends Te{applyTo2d(t){let{imageData:{data:e}}=t;for(let i,r=0;r<e.length;r+=4){const l=e[r],c=e[r+1],h=e[r+2];switch(this.mode){case"average":i=(l+c+h)/3;break;case"lightness":i=(Math.min(l,c,h)+Math.max(l,c,h))/2;break;case"luminosity":i=.21*l+.72*c+.07*h}e[r+2]=e[r+1]=e[r]=i}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return oN[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}A(Zc,"type","Grayscale"),A(Zc,"defaults",{mode:"average"}),A(Zc,"uniformLocations",["uMode"]),it.setClass(Zc);const lN=M(M({},w1),{},{rotation:0});class rg extends na{calculateMatrix(){const t=this.rotation*Math.PI,e=Li(t),i=zi(t),r=1/3,l=Math.sqrt(r)*i,c=1-e;this.matrix=[e+c/3,r*c-l,r*c+l,0,0,r*c+l,e+r*c,r*c-l,0,0,r*c-l,r*c+l,e+r*c,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}A(rg,"type","HueRotation"),A(rg,"defaults",lN),it.setClass(rg);class Jc extends Te{applyTo2d(t){let{imageData:{data:e}}=t;for(let i=0;i<e.length;i+=4)e[i]=255-e[i],e[i+1]=255-e[i+1],e[i+2]=255-e[i+2],this.alpha&&(e[i+3]=255-e[i+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}A(Jc,"type","Invert"),A(Jc,"defaults",{alpha:!1,invert:!0}),A(Jc,"uniformLocations",["uInvert","uAlpha"]),it.setClass(Jc);class $c extends Te{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const i=this.noise;for(let r=0;r<e.length;r+=4){const l=(.5-Math.random())*i;e[r]+=l,e[r+1]+=l,e[r+2]+=l}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return this.noise===0}}A($c,"type","Noise"),A($c,"defaults",{noise:0}),A($c,"uniformLocations",["uNoise","uSeed"]),it.setClass($c);class tu extends Te{applyTo2d(t){let{imageData:{data:e,width:i,height:r}}=t;for(let l=0;l<r;l+=this.blocksize)for(let c=0;c<i;c+=this.blocksize){const h=4*l*i+4*c,f=e[h],d=e[h+1],p=e[h+2],_=e[h+3];for(let v=l;v<Math.min(l+this.blocksize,r);v++)for(let S=c;S<Math.min(c+this.blocksize,i);S++){const b=4*v*i+4*S;e[b]=f,e[b+1]=d,e[b+2]=p,e[b+3]=_}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}A(tu,"type","Pixelate"),A(tu,"defaults",{blocksize:4}),A(tu,"uniformLocations",["uBlocksize"]),it.setClass(tu);class eu extends Te{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(t){let{imageData:{data:e}}=t;const i=255*this.distance,r=new Pt(this.color).getSource(),l=[r[0]-i,r[1]-i,r[2]-i],c=[r[0]+i,r[1]+i,r[2]+i];for(let h=0;h<e.length;h+=4){const f=e[h],d=e[h+1],p=e[h+2];f>l[0]&&d>l[1]&&p>l[2]&&f<c[0]&&d<c[1]&&p<c[2]&&(e[h+3]=0)}}sendUniformData(t,e){const i=new Pt(this.color).getSource(),r=this.distance,l=[0+i[0]/255-r,0+i[1]/255-r,0+i[2]/255-r,1],c=[i[0]/255+r,i[1]/255+r,i[2]/255+r,1];t.uniform4fv(e.uLow,l),t.uniform4fv(e.uHigh,c)}}A(eu,"type","RemoveColor"),A(eu,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),A(eu,"uniformLocations",["uLow","uHigh"]),it.setClass(eu);class nu extends Te{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,i=this.getFilterWindow(),r=new Array(i);for(let l=1;l<=i;l++)r[l-1]=t(l*e);return r}generateShader(t){const e=new Array(t);for(let i=1;i<=t;i++)e[i-1]="".concat(i,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(t,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(e.map(((i,r)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(i,") * uTaps[").concat(r,"] + texture2D(uTexture, vTexCoord - ").concat(i,") * uTaps[").concat(r,`];
              sum += 2.0 * uTaps[`).concat(r,`];
            `))).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){uh(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-11920929e-14)return 1;const i=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(i)/i}}applyTo2d(t){const e=t.imageData,i=this.scaleX,r=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/r;const l=e.width,c=e.height,h=Math.round(l*i),f=Math.round(c*r);let d;d=this.resizeType==="sliceHack"?this.sliceByTwo(t,l,c,h,f):this.resizeType==="hermite"?this.hermiteFastResize(t,l,c,h,f):this.resizeType==="bilinear"?this.bilinearFiltering(t,l,c,h,f):this.resizeType==="lanczos"?this.lanczosResize(t,l,c,h,f):new ImageData(h,f),t.imageData=d}sliceByTwo(t,e,i,r,l){const c=t.imageData,h=.5;let f=!1,d=!1,p=e*h,_=i*h;const v=t.filterBackend.resources;let S=0,b=0;const T=e;let w=0;v.sliceByTwo||(v.sliceByTwo=Bi());const N=v.sliceByTwo;(N.width<1.5*e||N.height<i)&&(N.width=1.5*e,N.height=i);const I=N.getContext("2d");for(I.clearRect(0,0,1.5*e,i),I.putImageData(c,0,0),r=Math.floor(r),l=Math.floor(l);!f||!d;)e=p,i=_,r<Math.floor(p*h)?p=Math.floor(p*h):(p=r,f=!0),l<Math.floor(_*h)?_=Math.floor(_*h):(_=l,d=!0),I.drawImage(N,S,b,e,i,T,w,p,_),S=T,b=w,w+=_;return I.getImageData(S,b,r,l)}lanczosResize(t,e,i,r,l){const c=t.imageData.data,h=t.ctx.createImageData(r,l),f=h.data,d=this.lanczosCreate(this.lanczosLobes),p=this.rcpScaleX,_=this.rcpScaleY,v=2/this.rcpScaleX,S=2/this.rcpScaleY,b=Math.ceil(p*this.lanczosLobes/2),T=Math.ceil(_*this.lanczosLobes/2),w={},N={x:0,y:0},I={x:0,y:0};return(function j(Y){let B,K,F,Q,Z,nt,ot,rt,ft,ct,vt;for(N.x=(Y+.5)*p,I.x=Math.floor(N.x),B=0;B<l;B++){for(N.y=(B+.5)*_,I.y=Math.floor(N.y),Z=0,nt=0,ot=0,rt=0,ft=0,K=I.x-b;K<=I.x+b;K++)if(!(K<0||K>=e)){ct=Math.floor(1e3*Math.abs(K-N.x)),w[ct]||(w[ct]={});for(let U=I.y-T;U<=I.y+T;U++)U<0||U>=i||(vt=Math.floor(1e3*Math.abs(U-N.y)),w[ct][vt]||(w[ct][vt]=d(Math.sqrt(Math.pow(ct*v,2)+Math.pow(vt*S,2))/1e3)),F=w[ct][vt],F>0&&(Q=4*(U*e+K),Z+=F,nt+=F*c[Q],ot+=F*c[Q+1],rt+=F*c[Q+2],ft+=F*c[Q+3]))}Q=4*(B*r+Y),f[Q]=nt/Z,f[Q+1]=ot/Z,f[Q+2]=rt/Z,f[Q+3]=ft/Z}return++Y<r?j(Y):h})(0)}bilinearFiltering(t,e,i,r,l){let c,h,f,d,p,_,v,S,b,T,w,N,I,j=0;const Y=this.rcpScaleX,B=this.rcpScaleY,K=4*(e-1),F=t.imageData.data,Q=t.ctx.createImageData(r,l),Z=Q.data;for(v=0;v<l;v++)for(S=0;S<r;S++)for(p=Math.floor(Y*S),_=Math.floor(B*v),b=Y*S-p,T=B*v-_,I=4*(_*e+p),w=0;w<4;w++)c=F[I+w],h=F[I+4+w],f=F[I+K+w],d=F[I+K+4+w],N=c*(1-b)*(1-T)+h*b*(1-T)+f*T*(1-b)+d*b*T,Z[j++]=N;return Q}hermiteFastResize(t,e,i,r,l){const c=this.rcpScaleX,h=this.rcpScaleY,f=Math.ceil(c/2),d=Math.ceil(h/2),p=t.imageData.data,_=t.ctx.createImageData(r,l),v=_.data;for(let S=0;S<l;S++)for(let b=0;b<r;b++){const T=4*(b+S*r);let w=0,N=0,I=0,j=0,Y=0,B=0,K=0;const F=(S+.5)*h;for(let Q=Math.floor(S*h);Q<(S+1)*h;Q++){const Z=Math.abs(F-(Q+.5))/d,nt=(b+.5)*c,ot=Z*Z;for(let rt=Math.floor(b*c);rt<(b+1)*c;rt++){let ft=Math.abs(nt-(rt+.5))/f;const ct=Math.sqrt(ot+ft*ft);ct>1&&ct<-1||(w=2*ct*ct*ct-3*ct*ct+1,w>0&&(ft=4*(rt+Q*e),K+=w*p[ft+3],I+=w,p[ft+3]<255&&(w=w*p[ft+3]/250),j+=w*p[ft],Y+=w*p[ft+1],B+=w*p[ft+2],N+=w))}}v[T]=j/N,v[T+1]=Y/N,v[T+2]=B/N,v[T+3]=K/I}return _}}A(nu,"type","Resize"),A(nu,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),A(nu,"uniformLocations",["uDelta","uTaps"]),it.setClass(nu);class iu extends Te{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const i=-this.saturation;for(let r=0;r<e.length;r+=4){const l=e[r],c=e[r+1],h=e[r+2],f=Math.max(l,c,h);e[r]+=f!==l?(f-l)*i:0,e[r+1]+=f!==c?(f-c)*i:0,e[r+2]+=f!==h?(f-h)*i:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}A(iu,"type","Saturation"),A(iu,"defaults",{saturation:0}),A(iu,"uniformLocations",["uSaturation"]),it.setClass(iu);class su extends Te{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const i=-this.vibrance;for(let r=0;r<e.length;r+=4){const l=e[r],c=e[r+1],h=e[r+2],f=Math.max(l,c,h),d=(l+c+h)/3,p=2*Math.abs(f-d)/255*i;e[r]+=f!==l?(f-l)*p:0,e[r+1]+=f!==c?(f-c)*p:0,e[r+2]+=f!==h?(f-h)*p:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}A(su,"type","Vibrance"),A(su,"defaults",{vibrance:0}),A(su,"uniformLocations",["uVibrance"]),it.setClass(su);function cN({teamId:a,round:t,userName:e}){const i=_t.useRef(null),r=_t.useRef(null),[l,c]=_t.useState("#DC143C"),[h,f]=_t.useState(5),[d,p]=_t.useState("brush"),[_,v]=_t.useState(!1),S=_t.useRef(!1);_t.useRef(null);const b=`round${t}-${a}`;_t.useEffect(()=>{const F=new Pg(i.current,{width:window.innerWidth>768?800:window.innerWidth-40,height:window.innerWidth>768?600:400,backgroundColor:"#ffffff",isDrawingMode:!0});r.current=F,F.freeDrawingBrush.color=l,F.freeDrawingBrush.width=h,T(F);const Q=ae(oe,`drawings/${b}/strokes`),Z=Eg(Q,rt=>{if(S.current)return;const ft=rt.val();ft&&(S.current=!0,w(F,ft),S.current=!1)}),nt=rt=>{_||N(rt.path)};F.on("path:created",nt);const ot=()=>{const rt=window.innerWidth>768?800:window.innerWidth-40,ft=window.innerWidth>768?600:400;F.setDimensions({width:rt,height:ft}),F.renderAll()};return window.addEventListener("resize",ot),()=>{Z(),F.off("path:created",nt),window.removeEventListener("resize",ot),F.dispose()}},[b]),_t.useEffect(()=>{if(r.current){const F=r.current;F.freeDrawingBrush.color=d==="eraser"?"#ffffff":l,F.freeDrawingBrush.width=h}},[l,h,d]),_t.useEffect(()=>{r.current&&(r.current.isDrawingMode=d==="brush"||d==="eraser")},[d]);const T=async F=>{try{const Q=ae(oe,`drawings/${b}`),nt=(await Mi(Q)).val();nt&&nt.imageData&&vn.fromURL(nt.imageData,ot=>{F.setBackgroundImage(ot,F.renderAll.bind(F),{scaleX:F.width/ot.width,scaleY:F.height/ot.height})})}catch(Q){console.error("Error loading drawing:",Q)}},w=(F,Q)=>{F.getObjects().forEach(nt=>F.remove(nt)),Object.values(Q).forEach(nt=>{nt&&nt.path&&ms.fromObject(nt,ot=>{F.add(ot),F.renderAll()})})},N=async F=>{try{const Q=ae(oe,`drawings/${b}/strokes`),Z=QD(Q),nt={path:F.path,stroke:F.stroke,strokeWidth:F.strokeWidth,fill:F.fill,left:F.left,top:F.top,timestamp:Date.now(),user:e};await Vn(Z,nt),I()}catch(Q){console.error("Error saving stroke:",Q)}},I=async()=>{if(r.current)try{const F=r.current.toDataURL({format:"png",quality:.8}),Q=ae(oe,`drawings/${b}/imageData`);await Vn(Q,F)}catch(F){console.error("Error saving image:",F)}},j=async()=>{if(r.current&&confirm("Are you sure you want to clear the canvas? This affects all team members!"))try{r.current.clear(),r.current.backgroundColor="#ffffff",r.current.renderAll();const F=ae(oe,`drawings/${b}`);await Vn(F,{strokes:{},imageData:null,clearedAt:Date.now(),clearedBy:e})}catch(F){console.error("Error clearing canvas:",F)}},Y=async()=>{if(r.current)try{const F=r.current,Q=F.getObjects();if(Q.length>0){F.remove(Q[Q.length-1]),F.renderAll();const Z=ae(oe,`drawings/${b}/strokes`),ot=(await Mi(Z)).val()||{},rt=Object.keys(ot);if(rt.length>0){const ft=rt[rt.length-1],ct={...ot};delete ct[ft],await Vn(Z,ct),I()}}}catch(F){console.error("Error undoing:",F)}},B=["#DC143C","#000000","#FFFFFF","#FF6B6B","#4ECDC4","#FFE66D","#A8E6CF","#FF8B94","#C7CEEA","#FFDAC1"],K=[2,5,10,20,30];return x.jsxs("div",{className:"collaborative-canvas-container",children:[x.jsxs("div",{className:"canvas-toolbar",children:[x.jsxs("div",{className:"tool-group",children:[x.jsx("label",{children:"Tool:"}),x.jsx("button",{className:`tool-button ${d==="brush"?"active":""}`,onClick:()=>p("brush"),title:"Brush",children:x.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[x.jsx("path",{d:"M12 19l7-7 3 3-7 7-3-3z"}),x.jsx("path",{d:"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}),x.jsx("path",{d:"M2 2l7.586 7.586"})]})}),x.jsx("button",{className:`tool-button ${d==="eraser"?"active":""}`,onClick:()=>p("eraser"),title:"Eraser",children:x.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[x.jsx("path",{d:"M20 20H7L3 16L12 7L21 16V20Z"}),x.jsx("path",{d:"M7 20L12 15"})]})})]}),x.jsxs("div",{className:"tool-group",children:[x.jsx("label",{children:"Color:"}),x.jsx("div",{className:"color-palette",children:B.map(F=>x.jsx("button",{className:`color-button ${l===F?"active":""}`,style:{backgroundColor:F},onClick:()=>c(F),title:F},F))})]}),x.jsxs("div",{className:"tool-group",children:[x.jsx("label",{children:"Size:"}),x.jsx("div",{className:"size-selector",children:K.map(F=>x.jsx("button",{className:`size-button ${h===F?"active":""}`,onClick:()=>f(F),children:F},F))})]}),x.jsxs("div",{className:"tool-group",children:[x.jsxs("button",{className:"action-button undo-button",onClick:Y,title:"Undo",children:[x.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[x.jsx("path",{d:"M3 7v6h6"}),x.jsx("path",{d:"M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"})]}),"Undo"]}),x.jsxs("button",{className:"action-button clear-button",onClick:j,title:"Clear All",children:[x.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[x.jsx("path",{d:"M3 6h18"}),x.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]}),"Clear"]})]})]}),x.jsx("div",{className:"canvas-wrapper",children:x.jsx("canvas",{ref:i})}),x.jsx("div",{className:"canvas-info",children:x.jsx("p",{className:"team-drawing-info",children:"Team members can see your drawings in real-time!"})})]})}function uN({round:a,teams:t,userTeam:e,deviceId:i}){const[r,l]=_t.useState({}),[c,h]=_t.useState({first:"",second:"",third:""}),[f,d]=_t.useState(!1),[p,_]=_t.useState(!0),[v,S]=_t.useState(!1),[b,T]=_t.useState("");_t.useEffect(()=>{w(),N()},[a]);const w=async()=>{try{_(!0);const B=ae(oe,"drawings"),F=(await Mi(B)).val()||{},Q={};Object.entries(F).forEach(([Z,nt])=>{if(Z.startsWith(`round${a}-`)){const ot=Z.replace(`round${a}-`,"");nt.imageData&&t[ot]&&(Q[ot]={imageData:nt.imageData,teamName:t[ot].name})}}),l(Q)}catch(B){console.error("Error loading drawings:",B),T("Failed to load drawings")}finally{_(!1)}},N=async()=>{try{const B=ae(oe,`votes/round${a}/${i}`),K=await Mi(B);K.exists()&&(d(!0),h(K.val()))}catch(B){console.error("Error checking votes:",B)}},I=(B,K)=>{if(f)return;if(K===e){T("You cannot vote for your own team!"),setTimeout(()=>T(""),3e3);return}const F={...c,[B]:K},Q=Object.values(F).filter(nt=>nt),Z=new Set(Q);if(Q.length!==Z.size){T("You cannot vote for the same team multiple times!"),setTimeout(()=>T(""),3e3);return}h({...c,[B]:K}),T("")},j=async()=>{if(f)return;if(!c.first||!c.second||!c.third){T("Please select all three positions (1st, 2nd, 3rd)");return}const B=[c.first,c.second,c.third],K=new Set(B);if(B.length!==K.size){T("You cannot vote for the same team multiple times!");return}if(e&&B.includes(e)){T("You cannot vote for your own team!");return}S(!0),T("");try{const F=ae(oe,`votes/round${a}/${i}`);await Vn(F,{first:c.first,second:c.second,third:c.third,timestamp:Date.now(),userTeam:e||"spectator"}),d(!0)}catch(F){console.error("Error submitting votes:",F),T("Failed to submit votes. Please try again.")}finally{S(!1)}};if(p)return x.jsxs("div",{className:"voting-loading",children:[x.jsx("div",{className:"spinner"}),x.jsx("p",{children:"Loading drawings..."})]});const Y=Object.entries(r).filter(([B])=>B!==e);return Y.length===0?x.jsx("div",{className:"voting-empty",children:x.jsx("p",{children:"No drawings to vote on yet."})}):x.jsx("div",{className:"voting-screen",children:f?x.jsxs("div",{className:"vote-confirmation",children:[x.jsx("div",{className:"confirmation-icon",children:"✓"}),x.jsx("h3",{children:"Your votes have been submitted!"}),x.jsxs("div",{className:"vote-summary",children:[x.jsxs("div",{className:"vote-item",children:[x.jsx("span",{className:"vote-position gold",children:"1st Place:"}),x.jsx("span",{className:"vote-team",children:t[c.first]?.name})]}),x.jsxs("div",{className:"vote-item",children:[x.jsx("span",{className:"vote-position silver",children:"2nd Place:"}),x.jsx("span",{className:"vote-team",children:t[c.second]?.name})]}),x.jsxs("div",{className:"vote-item",children:[x.jsx("span",{className:"vote-position bronze",children:"3rd Place:"}),x.jsx("span",{className:"vote-team",children:t[c.third]?.name})]})]}),x.jsx("p",{className:"waiting-text",children:"Waiting for admin to tally votes..."})]}):x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"vote-selection-panel",children:[x.jsx("h3",{children:"Select Your Top 3"}),x.jsxs("div",{className:"vote-selections",children:[x.jsxs("div",{className:"vote-selector",children:[x.jsx("label",{className:"gold",children:"1st Place (3 points)"}),x.jsxs("select",{value:c.first,onChange:B=>I("first",B.target.value),disabled:v,children:[x.jsx("option",{value:"",children:"-- Select --"}),Y.map(([B,K])=>x.jsx("option",{value:B,children:K.teamName},B))]})]}),x.jsxs("div",{className:"vote-selector",children:[x.jsx("label",{className:"silver",children:"2nd Place (2 points)"}),x.jsxs("select",{value:c.second,onChange:B=>I("second",B.target.value),disabled:v,children:[x.jsx("option",{value:"",children:"-- Select --"}),Y.map(([B,K])=>x.jsx("option",{value:B,children:K.teamName},B))]})]}),x.jsxs("div",{className:"vote-selector",children:[x.jsx("label",{className:"bronze",children:"3rd Place (1 point)"}),x.jsxs("select",{value:c.third,onChange:B=>I("third",B.target.value),disabled:v,children:[x.jsx("option",{value:"",children:"-- Select --"}),Y.map(([B,K])=>x.jsx("option",{value:B,children:K.teamName},B))]})]})]}),b&&x.jsx("div",{className:"error-message",children:b}),x.jsx("button",{className:"submit-votes-button",onClick:j,disabled:v||!c.first||!c.second||!c.third,children:v?"Submitting...":"Submit Votes"})]}),x.jsxs("div",{className:"drawings-gallery",children:[x.jsx("h3",{children:"All Drawings"}),x.jsx("div",{className:"drawings-grid",children:Y.map(([B,K])=>x.jsxs("div",{className:`drawing-card ${c.first===B?"selected-first":c.second===B?"selected-second":c.third===B?"selected-third":""}`,children:[x.jsxs("div",{className:"drawing-header",children:[x.jsx("h4",{children:K.teamName}),c.first===B&&x.jsx("span",{className:"vote-badge gold",children:"1st"}),c.second===B&&x.jsx("span",{className:"vote-badge silver",children:"2nd"}),c.third===B&&x.jsx("span",{className:"vote-badge bronze",children:"3rd"})]}),x.jsx("div",{className:"drawing-image",children:x.jsx("img",{src:K.imageData,alt:`${K.teamName}'s drawing`})})]},B))})]})]})})}const hN="chainsaw123";function fN({gameState:a,teams:t,onClose:e}){const[i,r]=_t.useState(!1),[l,c]=_t.useState(""),[h,f]=_t.useState(""),[d,p]=_t.useState({}),[_,v]=_t.useState(!1);_t.useEffect(()=>{sessionStorage.getItem("csm_admin_auth")==="true"&&r(!0)},[]),_t.useEffect(()=>{i&&a.phase==="voting"&&b()},[i,a.phase]);const S=Z=>{Z.preventDefault(),l===hN?(r(!0),sessionStorage.setItem("csm_admin_auth","true"),f("")):f("Incorrect password")},b=async()=>{try{const Z=ae(oe,`votes/round${a.currentRound}`),nt=await Mi(Z);p(nt.val()||{})}catch(Z){console.error("Error loading votes:",Z)}},T=async Z=>{v(!0);try{const nt=ae(oe,"gameState");await wg(nt,Z)}catch(nt){console.error("Error updating game state:",nt),f("Failed to update game state")}finally{v(!1)}},w=()=>{T({phase:"registration"})},N=Z=>{T({phase:"drawing",currentRound:Z,roundStartTime:Date.now()})},I=()=>{T({phase:"voting"})},j=async()=>{v(!0);try{const Z=ae(oe,`votes/round${a.currentRound}`),ot=(await Mi(Z)).val()||{},rt={};Object.values(ot).forEach(W=>{W.first&&(rt[W.first]=(rt[W.first]||0)+3),W.second&&(rt[W.second]=(rt[W.second]||0)+2),W.third&&(rt[W.third]=(rt[W.third]||0)+1)});const ft=ae(oe,"teams"),vt=(await Mi(ft)).val()||{},U={};Object.keys(vt).forEach(W=>{const tt=vt[W].score||0,mt=rt[W]||0;U[`${W}/score`]=tt+mt}),await wg(ft,U),await T({phase:"results"})}catch(Z){console.error("Error tallying votes:",Z),f("Failed to tally votes")}finally{v(!1)}},Y=()=>{const Z=a.currentRound+1;Z<3&&T({phase:"drawing",currentRound:Z,roundStartTime:Date.now()})},B=()=>{T({phase:"final"})},K=async()=>{if(confirm("Are you sure you want to reset the entire game? This will delete all teams, drawings, and votes!")){v(!0);try{await Vn(ae(oe,"gameState"),{phase:"setup",currentRound:0,roundStartTime:null}),await Vn(ae(oe,"teams"),{}),await Vn(ae(oe,"drawings"),{}),await Vn(ae(oe,"votes"),{}),localStorage.removeItem("csm_user_team"),localStorage.removeItem("csm_user_name"),alert("Game has been reset!")}catch(Z){console.error("Error resetting game:",Z),f("Failed to reset game")}finally{v(!1)}}};if(!i)return x.jsx("div",{className:"admin-panel",children:x.jsxs("div",{className:"admin-login",children:[x.jsx("h3",{children:"Admin Login"}),x.jsxs("form",{onSubmit:S,children:[x.jsx("input",{type:"password",value:l,onChange:Z=>c(Z.target.value),placeholder:"Enter password",autoFocus:!0}),h&&x.jsx("div",{className:"error-message",children:h}),x.jsx("button",{type:"submit",children:"Login"})]}),x.jsx("button",{className:"close-button",onClick:e,children:"Close"})]})});const F=Object.keys(d).length,Q=Object.keys(t).length;return x.jsx("div",{className:"admin-panel",children:x.jsxs("div",{className:"admin-content",children:[x.jsxs("div",{className:"admin-header",children:[x.jsx("h3",{children:"Admin Panel"}),x.jsx("button",{className:"close-button",onClick:e,children:"×"})]}),x.jsxs("div",{className:"admin-info",children:[x.jsxs("div",{className:"info-card",children:[x.jsx("label",{children:"Current Phase:"}),x.jsx("span",{className:"phase-badge",children:a.phase})]}),x.jsxs("div",{className:"info-card",children:[x.jsx("label",{children:"Current Round:"}),x.jsxs("span",{children:[a.currentRound+1," / 3"]})]}),x.jsxs("div",{className:"info-card",children:[x.jsx("label",{children:"Teams:"}),x.jsx("span",{children:Q})]}),a.phase==="voting"&&x.jsxs("div",{className:"info-card",children:[x.jsx("label",{children:"Votes Received:"}),x.jsx("span",{children:F})]})]}),x.jsxs("div",{className:"admin-controls",children:[a.phase==="setup"&&x.jsx("button",{className:"admin-action-button primary",onClick:w,disabled:_,children:"Start Registration"}),a.phase==="registration"&&x.jsxs(x.Fragment,{children:[x.jsx("button",{className:"admin-action-button primary",onClick:()=>N(0),disabled:_||Q===0,children:"Start Round 1"}),Q===0&&x.jsx("p",{className:"warning-text",children:"Waiting for teams to join..."})]}),a.phase==="drawing"&&x.jsx("button",{className:"admin-action-button warning",onClick:I,disabled:_,children:"End Drawing → Start Voting"}),a.phase==="voting"&&x.jsxs(x.Fragment,{children:[x.jsx("button",{className:"admin-action-button primary",onClick:j,disabled:_,children:"Tally Votes → Show Results"}),x.jsxs("p",{className:"info-text",children:[F," vote",F!==1?"s":""," received"]})]}),a.phase==="results"&&x.jsx(x.Fragment,{children:a.currentRound<2?x.jsxs("button",{className:"admin-action-button primary",onClick:Y,disabled:_,children:["Start Round ",a.currentRound+2]}):x.jsx("button",{className:"admin-action-button primary",onClick:B,disabled:_,children:"Show Final Results"})}),a.phase==="final"&&x.jsx("p",{className:"info-text",children:"Game Complete! Reset to start over."}),x.jsx("div",{className:"admin-divider"}),x.jsx("button",{className:"admin-action-button danger",onClick:K,disabled:_,children:"Reset Entire Game"})]}),h&&x.jsx("div",{className:"error-message",children:h}),x.jsxs("div",{className:"teams-overview",children:[x.jsx("h4",{children:"Teams"}),x.jsx("div",{className:"teams-table",children:Q===0?x.jsx("p",{className:"no-data",children:"No teams yet"}):x.jsxs("table",{children:[x.jsx("thead",{children:x.jsxs("tr",{children:[x.jsx("th",{children:"Team Name"}),x.jsx("th",{children:"Members"}),x.jsx("th",{children:"Score"})]})}),x.jsx("tbody",{children:Object.entries(t).sort(([,Z],[,nt])=>(nt.score||0)-(Z.score||0)).map(([Z,nt])=>x.jsxs("tr",{children:[x.jsx("td",{children:nt.name}),x.jsx("td",{children:nt.members?.length||0}),x.jsx("td",{children:nt.score||0})]},Z))})]})})]}),a.phase==="voting"&&F>0&&x.jsxs("div",{className:"votes-overview",children:[x.jsxs("h4",{children:["Votes Received (",F,")"]}),x.jsx("div",{className:"votes-list",children:Object.entries(d).map(([Z,nt])=>x.jsxs("div",{className:"vote-item-admin",children:[x.jsxs("small",{children:["Device: ",Z.substring(0,12),"..."]}),x.jsxs("div",{children:["1st: ",t[nt.first]?.name||"Unknown"," | 2nd: ",t[nt.second]?.name||"Unknown"," | 3rd: ",t[nt.third]?.name||"Unknown"]})]},Z))})]})]})})}function zS({teams:a,isFinal:t=!1}){const e=_t.useMemo(()=>Object.entries(a).map(([l,c])=>({id:l,...c})).sort((l,c)=>(c.score||0)-(l.score||0)),[a]);if(e.length===0)return x.jsx("div",{className:"leaderboard",children:x.jsx("p",{className:"no-teams",children:"No teams yet"})});const i=e.slice(0,3),r=e.slice(3);return x.jsxs("div",{className:"leaderboard",children:[t&&x.jsxs("div",{className:"podium",children:[i.length>=2&&x.jsxs("div",{className:"podium-position second",children:[x.jsx("div",{className:"podium-medal silver-medal",children:"2"}),x.jsxs("div",{className:"podium-info",children:[x.jsx("h3",{children:i[1].name}),x.jsxs("p",{className:"score",children:[i[1].score||0," points"]})]}),x.jsx("div",{className:"podium-stand silver-stand",children:x.jsx("span",{className:"stand-label",children:"2nd"})})]}),i.length>=1&&x.jsxs("div",{className:"podium-position first",children:[x.jsx("div",{className:"podium-crown",children:"👑"}),x.jsx("div",{className:"podium-medal gold-medal",children:"1"}),x.jsxs("div",{className:"podium-info",children:[x.jsx("h3",{children:i[0].name}),x.jsxs("p",{className:"score",children:[i[0].score||0," points"]})]}),x.jsx("div",{className:"podium-stand gold-stand",children:x.jsx("span",{className:"stand-label",children:"1st"})})]}),i.length>=3&&x.jsxs("div",{className:"podium-position third",children:[x.jsx("div",{className:"podium-medal bronze-medal",children:"3"}),x.jsxs("div",{className:"podium-info",children:[x.jsx("h3",{children:i[2].name}),x.jsxs("p",{className:"score",children:[i[2].score||0," points"]})]}),x.jsx("div",{className:"podium-stand bronze-stand",children:x.jsx("span",{className:"stand-label",children:"3rd"})})]})]}),x.jsxs("div",{className:"leaderboard-list",children:[x.jsx("h3",{children:t?"Full Rankings":"Current Standings"}),x.jsx("div",{className:"rankings",children:e.map((l,c)=>x.jsxs("div",{className:`ranking-item ${c===0?"rank-1":c===1?"rank-2":c===2?"rank-3":""}`,children:[x.jsx("div",{className:"rank-number",children:c===0&&t?"🥇":c===1&&t?"🥈":c===2&&t?"🥉":`#${c+1}`}),x.jsxs("div",{className:"team-info-leaderboard",children:[x.jsx("h4",{children:l.name}),x.jsxs("p",{className:"members-count",children:[l.members?.length||0," members"]})]}),x.jsxs("div",{className:"team-score",children:[x.jsx("span",{className:"score-value",children:l.score||0}),x.jsx("span",{className:"score-label",children:"pts"})]})]},l.id))})]}),r.length>0&&t&&x.jsx("div",{className:"other-teams",children:x.jsxs("details",{children:[x.jsxs("summary",{children:["Show all teams (",r.length," more)"]}),x.jsx("div",{className:"other-teams-list",children:r.map((l,c)=>x.jsxs("div",{className:"other-team-item",children:[x.jsxs("span",{className:"position",children:["#",c+4]}),x.jsx("span",{className:"name",children:l.name}),x.jsxs("span",{className:"score",children:[l.score||0," pts"]})]},l.id))})]})})]})}const dN=()=>{let a=localStorage.getItem("csm_device_id");return a||(a="device_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),localStorage.setItem("csm_device_id",a)),a},ag=[{title:"Round 1: Favorite Character",prompt:"Draw your favorite Chainsaw Man character",duration:600},{title:"Round 2: Design a Devil",prompt:"Design your own Devil",duration:600},{title:"Round 3: Iconic Scene",prompt:"Recreate an iconic Chainsaw Man scene",duration:900}];function gN(){const[a,t]=_t.useState(null),[e,i]=_t.useState(null),[r,l]=_t.useState(null),[c,h]=_t.useState(!1),[f,d]=_t.useState({}),p=dN();_t.useEffect(()=>{const T=ae(oe,"gameState"),w=Eg(T,N=>{const I=N.val();if(I)t(I);else{const j={phase:"setup",currentRound:0,roundStartTime:null};Vn(T,j),t(j)}});return()=>w()},[]),_t.useEffect(()=>{const T=ae(oe,"teams"),w=Eg(T,N=>{const I=N.val();d(I||{})});return()=>w()},[]),_t.useEffect(()=>{const T=localStorage.getItem("csm_user_team"),w=localStorage.getItem("csm_user_name");T&&w&&(i(T),l(w))},[]);const _=(T,w)=>{i(T),l(w),localStorage.setItem("csm_user_team",T),localStorage.setItem("csm_user_name",w)},v=()=>{i(null),l(null),localStorage.removeItem("csm_user_team"),localStorage.removeItem("csm_user_name")};if(!a)return x.jsx("div",{className:"app",children:x.jsxs("div",{className:"loading",children:[x.jsx("div",{className:"spinner"}),x.jsx("p",{children:"Connecting to Firebase..."}),x.jsx("p",{className:"error-hint",children:"If this persists, check your Firebase configuration in src/firebase.js"})]})});const S=window.location.href,b=ag[a.currentRound]||ag[0];return x.jsxs("div",{className:"app",children:[x.jsxs("header",{className:"app-header",children:[x.jsxs("div",{className:"header-content",children:[x.jsx("h1",{className:"glitch-text","data-text":"CHAINSAW MAN",children:"CHAINSAW MAN"}),x.jsx("h2",{className:"subtitle",children:"DRAWING COMPETITION"})]}),x.jsx("button",{className:"admin-button",onClick:()=>h(!c),children:c?"Hide Admin":"Admin"})]}),c&&x.jsx(fN,{gameState:a,teams:f,onClose:()=>h(!1)}),x.jsxs("main",{className:"app-main",children:[a.phase==="setup"&&x.jsx("div",{className:"phase-container setup-phase",children:x.jsxs("div",{className:"welcome-card",children:[x.jsx("h2",{children:"Welcome to the Chainsaw Man Drawing Competition!"}),x.jsx("p",{children:"Admin: Click the Admin button and start registration to begin."}),x.jsxs("div",{className:"game-info",children:[x.jsx("h3",{children:"How it works:"}),x.jsxs("ol",{children:[x.jsx("li",{children:"Form teams of 1-6 members"}),x.jsx("li",{children:"Draw collaboratively on a shared canvas"}),x.jsx("li",{children:"Vote for your favorite drawings"}),x.jsx("li",{children:"Win glory and bragging rights!"})]}),x.jsx("h3",{children:"Rounds:"}),x.jsx("ul",{children:ag.map((T,w)=>x.jsxs("li",{children:[x.jsxs("strong",{children:[T.title,":"]})," ",T.prompt," (",T.duration/60," minutes)"]},w))})]})]})}),a.phase==="registration"&&x.jsxs("div",{className:"phase-container registration-phase",children:[x.jsxs("div",{className:"qr-section",children:[x.jsx("h3",{children:"Scan to Join!"}),x.jsx("div",{className:"qr-code-container",children:x.jsx(xC,{value:S,size:200,level:"H"})}),x.jsx("p",{className:"url-display",children:S})]}),e?x.jsxs("div",{className:"team-joined-card",children:[x.jsx("h3",{children:"You're in!"}),x.jsxs("div",{className:"team-info",children:[x.jsx("p",{className:"team-name",children:f[e]?.name||e}),x.jsxs("p",{className:"user-name",children:["Playing as: ",r]}),x.jsxs("div",{className:"team-members",children:[x.jsx("h4",{children:"Team Members:"}),x.jsx("ul",{children:f[e]?.members?.map((T,w)=>x.jsx("li",{className:T===r?"current-user":"",children:T},w))})]})]}),x.jsx("button",{onClick:v,className:"leave-button",children:"Leave Team"}),x.jsx("p",{className:"waiting-message",children:"Waiting for admin to start the game..."})]}):x.jsx(SA,{onJoinTeam:_,teams:f}),x.jsxs("div",{className:"teams-list",children:[x.jsxs("h3",{children:["Current Teams (",Object.keys(f).length,")"]}),x.jsx("div",{className:"teams-grid",children:Object.entries(f).map(([T,w])=>x.jsxs("div",{className:"team-card",children:[x.jsx("h4",{children:w.name}),x.jsxs("p",{className:"member-count",children:[w.members?.length||0," members"]})]},T))})]})]}),a.phase==="drawing"&&x.jsxs("div",{className:"phase-container drawing-phase",children:[x.jsxs("div",{className:"round-header",children:[x.jsx("h2",{children:b.title}),x.jsx("p",{className:"prompt",children:b.prompt}),x.jsx("div",{className:"timer-container",children:x.jsx(mN,{startTime:a.roundStartTime,duration:b.duration})})]}),e?x.jsx(cN,{teamId:e,round:a.currentRound,userName:r}):x.jsxs("div",{className:"not-joined-message",children:[x.jsx("p",{children:"You haven't joined a team yet!"}),x.jsx("p",{children:"Registration is closed for this round."})]}),x.jsx("div",{className:"other-teams-drawing",children:x.jsxs("h3",{children:["Teams currently drawing: ",Object.keys(f).length]})})]}),a.phase==="voting"&&x.jsxs("div",{className:"phase-container voting-phase",children:[x.jsx("h2",{children:"Vote for the Best Drawings!"}),x.jsx("p",{className:"voting-instructions",children:"Select your top 3 favorite drawings (you cannot vote for your own team)"}),x.jsx(uN,{round:a.currentRound,teams:f,userTeam:e,deviceId:p})]}),a.phase==="results"&&x.jsxs("div",{className:"phase-container results-phase",children:[x.jsxs("h2",{children:["Round ",a.currentRound+1," Results"]}),x.jsx(zS,{teams:f}),x.jsx("p",{className:"waiting-message",children:a.currentRound<2?"Admin will start the next round soon...":"Admin will show final results..."})]}),a.phase==="final"&&x.jsxs("div",{className:"phase-container final-phase",children:[x.jsx("h2",{className:"glitch-text","data-text":"FINAL RESULTS",children:"FINAL RESULTS"}),x.jsx(zS,{teams:f,isFinal:!0}),x.jsxs("div",{className:"celebration",children:[x.jsx("p",{children:"Thank you for participating!"}),x.jsx("p",{children:"Powered by Terrapin Anime Society"})]})]})]})]})}function mN({startTime:a,duration:t}){const[e,i]=_t.useState(t);_t.useEffect(()=>{if(!a)return;const c=setInterval(()=>{const h=Math.floor((Date.now()-a)/1e3),f=Math.max(0,t-h);i(f)},1e3);return()=>clearInterval(c)},[a,t]);const r=Math.floor(e/60),l=e%60;return x.jsx("div",{className:`timer ${e<60?"timer-warning":""}`,children:x.jsxs("span",{className:"time-display",children:[String(r).padStart(2,"0"),":",String(l).padStart(2,"0")]})})}aw.createRoot(document.getElementById("root")).render(x.jsx(_t.StrictMode,{children:x.jsx(gN,{})}));
